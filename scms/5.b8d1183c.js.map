{"version":3,"sources":["webpack:///./libs/ueditor/third-party/zeroclipboard/ZeroClipboard.js","webpack:///./libs/ueditor/ueditor.all.js","webpack:///./libs/ueditor/index.js","webpack:///./libs/ueditor/lang/zh-cn/zh-cn.js","webpack:///./libs/ueditor/third-party/zeroclipboard/ZeroClipboard.swf","webpack:///./libs/ueditor/themes/iframe.css","webpack:///./libs/ueditor/ueditor.config.js"],"names":["_currentElement","__webpack_require__","_flashState","bridge","version","pluginType","disabled","outdated","unavailable","deactivated","overdue","ready","_clipData","_clipDataFormatMap","_clientIdCounter","_clientMeta","_elementIdCounter","_elementMeta","_camelizeCssPropName","matcherRegex","replacerFn","match","group","toUpperCase","prop","replace","_elementMouseOver","event","target","window","this","srcElement","ZeroClipboard","activate","_addEventHandler","element","method","func","nodeType","addEventListener","attachEvent","_removeEventHandler","removeEventListener","detachEvent","_addClass","value","classList","contains","add","classNames","split","className","setClass","c","cl","length","indexOf","_removeClass","remove","undefined","_getDOMObjectPosition","obj","defaultZIndex","info","left","top","width","height","zIndex","_getSafeZIndex","getBoundingClientRect","pageXOffset","pageYOffset","zoomFactor","rect","physicalWidth","logicalWidth","document","body","right","offsetWidth","Math","round","_getZoomFactor","documentElement","scrollLeft","scrollTop","leftBorderWidth","clientLeft","topBorderWidth","clientTop","bottom","_inArray","elem","array","fromIndex","i","len","hasOwnProperty","_prepClip","elements","TypeError","_dispatchCallback","context","args","async","setTimeout","apply","val","tmp","parseInt","isNaN","_globalConfig","_extend","arg","copy","arguments","_extractDomain","originOrUrl","protocolIndex","pathIndex","slice","toLowerCase","_determineScriptAccess","_extractAllDomains","origins","resultsArray","_typeof","push","currentDomain","configOptions","swfDomain","swfPath","trustedDomains","trustedOrigins","_objectKeys","Object","keys","_args","arraySlice","call","Array","prototype","ax","mimeType","hasFlash","isActiveX","isPPAPI","flashVersion","parseFlashVersion","desc","matches","join","inspectPlugin","plugin","description","filename","flashPlayerFileName","test","isPepperFlash","navigator","plugins","mimeTypes","enabledPlugin","ActiveXObject","GetVariable","e1","e2","e3","parseFloat","_detectFlashSupport","id","instance","handlers","clip","isFlashUnusable","_client","maxWait","flashLoadTimeout","emit","type","name","client","_bridge","setText","text","setData","setHtml","html","setRichText","richText","clearData","setSize","_setSize","destroy","unclip","off","location","host","cacheBust","forceHandCursor","forceEnhancedClipboard","debug","title","autoActivate","config","options","clientId","deactivate","flashBridge","htmlBridge","_getHtmlBridge","style","display","removeSwfFromIE","readyState","parentNode","removeChild","hoverClass","activeClass","_reposition","newTitle","getAttribute","setAttribute","enabled","setHandCursor","_setHandCursor","el","camelProp","getComputedStyle","getPropertyValue","currentStyle","tagName","_getStyle","removeAttribute","state","browser","newObj","_pick","flash","_omit","zeroclipboard","format","data","dataObj","dataFormat","_deleteOwnProperties","container","getElementById","allowScriptAccess","allowNetworking","flashvars","domain","domains","str","trustedOriginsExpanded","protocol","encodeURIComponent","_vars","swfUrl","path","Date","getTime","_cacheBust","_createHtmlBridge","divToBeReplaced","createElement","appendChild","tmpDiv","oldIE","innerHTML","firstChild","replaceChild","position","nodeName","pos","eventType","eventObj","performCallbackAsync","clients","eventCopy","returnVal","_createEvent","_preprocessEvent","_dispatchClientCallbacks","_getAllClientsClippedToElement","clientIds","_getAllClients","clipData","newClipData","formatMap","rtf","_mapClipDataToFlash","handleEvent","_eventMessages","error","flash-disabled","flash-outdated","flash-unavailable","flash-deactivated","flash-overdue","relatedTarget","currentTarget","msg","message","minimumVersion","clipboardData","clipResults","newResults","tmpHash","_mapClipResultsFromFlash","_getRelatedTarget","targetEl","relatedTargetId","wasDeactivated","textContent","htmlContent","outerHTML","innerText","activeElement","err","_safeActiveElement","focus","on","eventName","events","added","errorTypes","foundIndex","perEventHandlers","splice","zcClippingId","clippedElements","meta","arrayIndex","elementMetaId","_iframe","UEDITOR_CONFIG","baidu","UE","editor","commands","instants","I18N","_customizeUI","dom","agent","userAgent","opera","ie","webkit","mac","quirks","compatMode","gecko","product","v1","v2","max","ie11Compat","documentMode","ie9Compat","ie8","ie8Compat","ie7Compat","ie6Compat","ie9above","ie9below","ie11above","ie11below","geckoRelease","chrome","RegExp","safari","isCompatible","mobile","air","utils","each","iterator","l","key","makeInstance","noop","Function","extend","t","s","b","k","extend2","a","x","inherits","subClass","superClass","oldP","newP","constructor","bind","fn","defer","delay","exclusion","timerID","clearTimeout","item","start","index","isNumber","v","removeItem","trim","listToMap","list","isArray","ci","unhtml","reg","<","&","\"",">","'","unhtmlForUrl","m","&lt;","&amp;","&quot;","&gt;","&#39;","&nbsp;","cssStyleToDomStyle","cache","float","cssFloat","styleFloat","cssName","charAt","loadFile","tmpList","getItem","doc","url","src","href","e","funs","tag","p","onload","onreadystatechange","fi","pop","onerror","Error","getElementsByTagName","write","isEmptyObject","isString","fixColor","color","toString","optCss","padding","margin","opt","r","clone","source","transUnitToPx","unit","u","domReady","fnArr","doReady","isReady","onready","win","doScroll","callee","cssRule","indexList","styleSheets","cssText","sheetStyle","createStyleSheet","node","sort","compareFn","item1","item2","localeCompare","j","serializeParam","json","strArr","formatUrl","isCrossDomainUrl","hostname","port","clearEmptyAttrs","str2json","JSON","parse","json2str","stringify","pad","escapeMap","\b","\t","\n","\f","\r","\\","isFinite","String","charCodeAt","floor","encodeString","preComma","result","encodeArray","isDate","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","encodeDate","encode","EventBase","getListener","force","allListeners","__allListeners","addListener","types","listener","ti","removeListener","trigger","fireEvent","listeners","dtd","_","X","A","isindex","fieldset","B","input","button","select","textarea","label","C","D","iframe","E","hr","ul","menu","div","blockquote","noscript","table","center","address","dir","pre","h5","dl","h4","noframes","h6","ol","h1","h3","h2","F","ins","del","script","G","acronym","bdo","var","#","abbr","code","br","cite","kbd","strike","tt","strong","q","samp","em","dfn","span","H","sub","img","embed","object","sup","basefont","map","applet","font","big","small","I","J","K","form","L","M","tr","N","O","param","P","Q","li","R","S","base","link","T","U","head","V","block","empty","area","col","command","dialog","keygen","track","wbr","$nonBodyContent","$block","$inline","$inlineWithA","$body","$cdata","$empty","$nonChild","$listItem","dd","dt","$list","$isNotEmpty","$removeEmpty","$removeEmptyBlock","$tableContent","caption","colgroup","tbody","td","tfoot","th","thead","$notTransContent","option","optgroup","legend","getDomNode","ltr","startFromChild","guard","parent","tmpNode","attrFix","tabindex","readonly","for","class","maxlength","cellspacing","cellpadding","rowspan","colspan","usemap","frameborder","styleBlock","domUtils","NODE_ELEMENT","NODE_DOCUMENT","NODE_TEXT","NODE_COMMENT","NODE_DOCUMENT_FRAGMENT","POSITION_IDENTICAL","POSITION_DISCONNECTED","POSITION_FOLLOWING","POSITION_PRECEDING","POSITION_IS_CONTAINED","POSITION_CONTAINS","fillChar","8","46","16","17","18","37","38","39","40","13","getPosition","nodeA","nodeB","parentsA","parentsB","reverse","nextSibling","getNodeIndex","ignoreTextNode","preNode","previousSibling","inDoc","findParent","filterFn","includeSelf","isBody","findParentByTagName","tagNames","excludeFn","findParents","closerFirst","parents","insertAfter","newNode","insertBefore","keepChildren","child","hasChildNodes","getNextDomNode","getPreDomNode","isBookmarkNode","getWindow","ownerDocument","defaultView","parentWindow","getCommonAncestor","clearEmptySibling","ignoreNext","ignorePre","clear","next","isEmptyInlineElement","nodeValue","offset","createTextNode","retval","splitText","isWhitespace","getXY","y","offsetParent","offsetTop","offsetLeft","handler","_d","els","evt","un","isSameElement","thisAttrs","attributes","otherAttrs","attrA","attrB","al","bl","specified","isSameStyle","getNamedItem","styleA","styleB","isBlockElm","breakParent","leftNodes","rightNodes","parentClone","cloneNode","trimWhiteTextNode","mergeChild","attrs","childNodes","filter","hasClass","ni","arr","n","mergeToParent","textDecoration","mergeSibling","merge","rtl","lastChild","unSelectable","onselectstart","onclick","onkeyup","onkeydown","unselectable","all","MozUserSelect","webkitUserSelect","msUserSelect","KhtmlUserSelect","removeAttributes","attrNames","getAttributeNode","removeAttributeNode","setAttributes","attr","styleName","fontSize","offsetHeight","getStyle","removeClasses","elm","cls","addClass","isRegExp","preventDefault","returnValue","removeStyle","removeProperty","setStyle","setStyles","styles","removeDirtyAttr","nodes","getChildCount","count","first","isEmptyNode","isBr","clearSelectedArr","scrollToView","winHeight","mode","clientWidth","clientHeight","getViewPaneSize","currentScroll","getScrollPosition","scrollTo","isFillChar","isInStart","isStartInblock","range","tmpRange","cloneRange","flag","startContainer","startOffset","setStartBefore","setStart","collapse","isEmptyBlock","setViewportOffset","fillNode","moveChild","hasNoAttributes","isCustomeNode","isTagNode","filterNodeList","nodelist","forAll","results","isFunction","isInNodeEndBoundary","rng","isBoundaryNode","fillHtml","fillCharReg","fillData","guid","selectOneNode","collapsed","endContainer","endOffset","setEndPoint","toStart","updateCollapse","execContentsAction","action","tmpStart","tmpEnd","end","frag","createDocumentFragment","substringData","deleteData","current","currentLevel","startParents","endParents","si","ei","Range","me","removeFillData","excludeNode","cloneContents","deleteContents","txt","extractContents","setEnd","setStartAfter","setEndAfter","setEndBefore","setStartAtFirst","setStartAtLast","setEndAtFirst","setEndAtLast","selectNode","selectNodeContents","shrinkBoundary","ignoreEnd","check","trimBoundary","txtToElmBoundary","textNode","ignoreCollapsed","adjust","insertNode","nextNode","setCursor","toEnd","noFillData","createBookmark","serialize","same","endNode","startNode","moveToBookmark","bookmark","enlarge","toBlock","stopFn","enlargeToBlockElm","adjustmentBoundary","applyInlineStyle","aNode","level","removeInlineStyle","getClosedNode","textRange","nativeRange","createControlRange","addElement","createTextRange","moveToElementText","moveStart","tmpText","nativeRangeEnd","notInsertFillData","txtNode","sel","getSelection","removeAllRanges","createRange","checkOffset","addRange","inFillChar","createAddress","ignoreTxt","addr","getAddress","isStart","addrs","firstIndex","startAddress","endAddress","concat","moveToAddress","getNode","equals","traversal","doFn","getBoundaryInformation","getIndex","duplicate","parentElement","distance","siblings","children","testRange","startIndex","endIndex","compareEndPoints","_getIERange","ieRange","getNative","Selection","frameElement","_bakIERange","getIERange","ex","rangeInBody","txtRange","selection","_cachedRange","getRange","_cachedStartElement","getStart","_cachedStartElementPath","getStartElementPath","isFocus","rangeCount","optimze","bi","transformIERangeToRange","firstRange","getRangeAt","lastRange","_bakRange","min","getText","nativeSel","clearRange","_selectionChangeTimer","uid","setValue","tis","hasContents","allHtmlEnabled","getAllHtml","getContent","langReadied","langIsReady","Editor","shortcutkeys","inputRules","outputRules","setOpt","defaultOptions","loadServerConfig","langPath","lang","load","checkCurLang","registerCommand","getOpt","delEditor","render","getStyleValue","initialFrameWidth","minFrameWidth","initialFrameHeight","minFrameHeight","iframeCssUrl","initialStyle","customDomain","overflow","_setup","geckoSel","contentEditable","spellcheck","_initEvents","autoSyncData","initialContent","autoClearinitialContent","oldExecCommand","execCommand","_setDefaultContent","setContent","focusInEnd","_selectionChange","fullscreen","ui","setFullScreen","_bindshortcutKeys","_bakNativeRange","setInterval","isShow","setHide","setDisabled","sync","formId","setHeight","notSetHeight","addshortcutkey","cmd","keyCode","which","$1","ctrlKey","metaKey","$2","$3","queryCommandState","notSetCursor","ignoreBlank","formatter","root","htmlparser","filterOutputRule","toHtml","headHtml","headHtmlForIE9","charset","getPlainTxt","getContentTxt","isAppendTo","notFireSelectionchange","filterInputRule","enterTag","isCdataDiv","blur","nativeRng","_proxyDomEvent","stopPropagation","shiftKey","altKey","mouseX","mouseY","hackForMouseUp","clientX","clientY","bakGetIERange","moveToPoint","_callCmdFn","fnName","cmdFn","cmdName","notNeedUndo","__hasEnterExecCommand","ignoreContentChange","_ignoreContentChange","queryCommandValue","tags","cn","reset","setEnabled","lastBk","bkqueryCommandState","bkqueryCommandValue","enable","except","disable","cont","setShow","show","hide","getLang","getContentLength","ingoneHtml","addInputRule","rule","addOutputRule","getActionUrl","actionName","imageUrl","serverUrl","_url","UEDITOR_HOME_URL","iframeStyleSrc","autoClearEmptyNode","imagePopup","theme","themePath","scaleEnabled","tableNativeEditInFF","fileNameFormat","showErrorMsg","console","configUrl","isJsonp","_serverConfigLoaded","ajax","request","dataType","onsuccess","eval","responseText","isServerConfigLoaded","afterConfigReady","readyHandler","fnStr","creatAjaxRequest","doJsonp","opts","callbackFnName","timer","successhandler","scr","callbackField","timeOut","random","getCallBack","exec","search","queryStr","onTimeOut","exception","oncomplete","createScriptTag","ajaxOptions","xhr","timeIsOut","defaultAjaxOptions","timeout","ajaxOpts","submitStr","abort","open","status","setRequestHeader","send","doAjax","getJSONP","filterWord","transUnit","isWordDocument","marks","parts","filterPasteWord","uNode","notTransAttrs","_src","_href","cdata_data","notTransTagName","indentChar","breakChar","insertLine","begin","insertIndent","nodeToHtml","isText","attrhtml","isElement","isComment","getNodeById","getAttr","getNodesByTagName","createText","noTrans","htmlstr","tmpRoot","textStr","getData","cj","attrName","setAttr","attrVal","isObject","cssStyle","nodeTraversal","re_tag","re_attr","allowEmptyTags","needParentNode","needChild","htmlattr","needParentTag","hasParent","tmpParent","comment","currentIndex","nextIndex","currentParent","lastIndex","filterNode","rules","tmpVal","tmpAttrs","tmpCssStyle","_plugins","register","pluginName","oldOptionName","afterDisabled","optionName","execFn","_export","execName","run","exeFn","keymap","Backspace","Tab","Enter","Shift","Control","Alt","CapsLock","Esc","Spacebar","PageUp","PageDown","End","Home","Left","Up","Right","Down","Insert","Del","NumLock","Cmd","=","-","z","LocalStorage","storage","localStorage","addBehavior","LOCAL_FILE","setItem","save","getUserData","saveLocalData","getLocalData","ROOTKEY","setPreferences","getPreferences","removePreferences","allowDivTransToP","disabledTableInTable","cdata_tag","_ue_custom_node_","last","tmpNodes","tdParent","notNeedFilter","filterRules","hadBreak","tmpLi","autoHeightEnabled","autotypeset","mergeEmptyline","removeClass","removeEmptyline","textAlign","imageBlockLine","pasteFilter","clearFontSize","clearFontFamily","removeEmptyNode","removeTagNames","indent","indentValue","bdc2sb","tobdc","highlightCont","remainClass","selectTdClass","pagebreak","anchorclass","remainTag","isLine","notEmpty","removeNotAttributeSpan","autotype","fontFamily","textIndent","pN","pNode","txtstring","fromCharCode","ToDBC","DBC2SB","cookieOpt","readLocalOpts","shortcutkey","autosubmit","submit","isSetColored","cssRuleId","stringToObj","substr","setBackground","orgFn","bindEvents","su","imagePath","substring","bgObj","background-color","background-image","background-repeat","background-position","aftersetcontent","inputRule","outputRule","background","align","floatStyle","unhtmlData","border","alt","hspace","vspace","shift","imgCi","defaultValue","justify","bookmark2","common","text-align","doJustify","fonts","forecolor","backcolor","fontsize","fontfamily","underline","strikethrough","fontborder","needCmd","needSetChild","mergesibling","bk","mergeWithParent","backgroundColor","1","2","3","4","5","6","7","spanParent","styleVal","optimize","highlight","textValue","rngClone","doLink","ps","pe","as","removeFormatTags","removeFormatAttributes","notIncludeA","tagReg","isRedundantSpan","bookmark1","doRemove","getObj","startBlock","endBlock","blockquotes","doEnd","childs","bkEnd","curNode","print","d","close","selectAll","notExchange","sourceCmdName","para","doParagraph","forward","doDirectionality","date","hh","ii","ss","formatTime","yyyy","yy","mm","formatDate","rowspacingtop","rowspacingbottom","lineheight","as3","bash","cpp","css","cf","c#","delphi","diff","erlang","groovy","java","jfx","js","pl","php","plain","python","ruby","scala","sql","vb","xml","filterTxtRules","brs","notNeedCodeQuery","help","undo","redo","searchreplace","preview","insertparagraph","elementpath","insertcode","inserthtml","selectall","fillchar","evtName","anchorname","anchor","20","notBreakTags","isHr","pageBreakTag","noshade","size","images","wordimage","urlList","word_img","saveSceneTimer","maxUndoCount","maxInputCount","noNeedFillCharTags","orgState","compareAddr","indexA","indexB","undoManger","hasUndo","hasRedo","content","restore","scene","update","clearKey","getScene","rngAddress","notCompareRange","currentScene","lastScene","rngAddrA","rngAddrB","compareRangeAddress","keycont","exclude","inputType","Undo","Redo","isCollapsed","interalTimer","clearInterval","stopCmdUndo","startCmdUndo","initZeroClipboard","alert","getClipboardData","callback","pastebin","pi","pastebins","querySelectorAll","txtContent","getPureHtml","atr","di","divs","tmpP","metas","dirtyNodes","spans","retainOnlyLabelPasted","plainType","tmpAddress","pasteplain","transP","removeNode","$","TD","PRE","BLOCKQUOTE","customStyle","cn1","cn2","num","num1","num2","dash","dot","listToArray","autoTransWordToList","insertorderedlist","decimal","lower-alpha","lower-roman","upper-alpha","upper-roman","insertunorderedlist","circle","disc","square","listDefaultPaddingLeft","listiconpath","maxListLevel","disablePInList","listStyle","OL","UL","liiconpath","adjustListStyle","ignore","nodeStyleType","styleIndex","setListStyle","paddingLeft","adjustList","ignoreEmpty","nextList","preList","getLi","customCss","pn","newChildrens","lastNode","checkListType","unorderlisttype","orderlisttype","cacheNode","appendLi","preventAndSave","findList","parentList","nextLi","checkLevel","levelNum","closeList","parentLi","startParent","endParent","bko","modifyStart","modifyEnd","nodeStyle","tmpFrag","tmpfrag","hasBlock","tmpDivs","sourceEditors","holder","onresize","setSelectionRange","dispose","codemirror","codeEditor","CodeMirror","tabMode","lineNumbers","lineWrapping","getWrapperElement","getScrollerElement","refresh","getCodeMirror","getValue","sourceEditor","orgSetContent","bakCssText","oldGetContent","bakAddress","sourceMode","sourceEditorFirst","createSourceEditor","oldQueryCommandState","hTag","doSave","startTd","endTd","excludeTagNameForTabKey","tabSize","tabNode","elementUpdated","Scale","resizer","cover","prePos","startPos","init","dragId","hands","getDom","initStyle","initEvents","isDraging","_eventHandler","hand","proxy","updateContainerStyle","updateTargetElement","attachTo","_validScaledProp","ele","wrap","hideCover","showCover","editorPos","iframePos","targetObj","imgPos","borderLeftWidth","borderTopWidth","imageScale","imageScaleEnabled","_keyDownHandler","_mouseDownHandler","keydown","charCode","keyCodes","32","checkIsCludeLink","bakOverflow","currentHeight","isFullscreen","lastHeight","f","adjustHeight","enableAutoHeight","overflowY","disableAutoHeight","lastScrollY","onscroll","scrollY","topOffset","optsAutoFloatEnabled","autoFloatEnabled","toolbarBox","orgTop","uiUtils","LteIE6","placeHolder","defer_updateFloating","updateFloating","autofloatMsg","getClientRect","docStyle","backgroundImage","backgroundAttachment","fixIE6FixedPos","unsetFloating","rect3","toolbarTopOffset","toobarBoxPos","origalFloat","origalLeft","setFloating","creatInsertStr","classname","ext","lastIndexOf","switchImgAndVideo","img2video","videoObjs","vi","UETable","indexTable","selectedTds","cellsRange","removeSelectedClass","cells","cell","addSelectedClass","getWidth","getTableCellAlignState","tempStatus","isSame","cellNode","currentState","getTableItemsByRange","getUETableBySelected","ueTable","getDefaultValue","tableBorder","tdPadding","tdBorder","tmpValue","borderMap","thin","medium","thick","insertRow","insertCell","getUETable","tdOrTable","cloneCell","ignoreMerge","keepPro","tmpCell","rowSpan","colSpan","borderLeftStyle","borderTopStyle","borderLeftColor","borderRightColor","borderRightWidth","borderTopColor","borderBottomColor","borderBottomWidth","getMaxRows","row","rows","maxLen","currentMax","getMaxCols","cellRows","cellsNum","getCellColIndex","getHSideCell","previewRowIndex","previewColIndex","cellInfo","getCellInfo","beginColIndex","colIndex","endColIndex","colsNum","beginRowIndex","rowIndex","getCell","cellIndex","getTabNextCell","preRowIndex","nextCell","getVSideCell","ignoreRange","nextRowIndex","nextColIndex","endRowIndex","rowsNum","getSameEndPosCells","xOrY","returns","setCellContent","getSameStartPosXCells","dNum","tds","selectTds","startInfo","endInfo","rowInfo","numCols","deleteCell","getCellsRange","cellA","cellB","cellAInfo","cellBInfo","checkRange","tmpBeginRowIndex","tmpBeginColIndex","tmpEndRowIndex","tmpEndColIndex","getCells","clearSelected","tdHash","returnTds","setSelected","isFullRow","isFullCol","ths","getNextCell","getPreviewCell","moveContent","cellTo","cellFrom","mergeRight","rightColIndex","rightCellInfo","rightCell","mergeDown","downRowIndex","downCellInfo","downCell","mergeRange","leftTopCell","deleteRow","curIndex","sourceCell","isInsertTitle","replaceTdToTh","tableRow","infoRow","insertCellIndex","nextRow","preMerged","getPreviewMergedCellsNum","deleteTds","cacheMap","tmpRowIndex","tmpCellIndex","mergeTds","insertCol","preCell","backWidth","isInsertTitleCol","updateWidth","tmpWidth","deleteCol","tableRows","backTableWidth","backTdWidth","toFixed","splitToCells","splitToRows","splitToCols","endRow","indexRow","endCol","isLastCell","getLastCell","cols","selectRow","selectTable","repeat","colorList","colors","getColor","removeBackground","UT","resetTdWidth","needIEHack","getTableWidth","tdsWidths","getSelectedArr","ut","defaultCols","numRows","defaultRows","tdvalign","firstParentBlock","tableWidth","tdWidth","createTable","valign","firstRow","tableItems","maxRowNum","newCell","maxColNum","averageWidth","setAverageWidth","tb","sumWidth","tbAttr","ceil","getAverageWidth","averageHeight","setAverageHeight","rowNum","sumHeight","tdpadding","captionHeight","thHeight","captionArr","thArr","trs","getAverageHeight","verticalAlign","vAlign","activeMenuCell","borderColor","bkColor","interlaced","borderWidth","borderStyle","tableDragTimer","cellMinWidth","isInResizeBuffer","cellBorderWidth","offsetOfTableCell","singleClickState","userActionStatus","dblclickTime","orgGetText","currentTd","onDrag","onBorder","dragButton","dragOver","dragLine","dragTd","mousedown","cursorpath","tableDragable","deletetable","inserttable","cellvalign","insertcaption","deletecaption","inserttitle","deletetitle","mergeright","mergedown","mergecells","insertrow","insertrownext","deleterow","insertcol","insertcolnext","deletecol","splittocells","splittorows","splittocols","adaptbytext","adaptbywindow","adaptbycustomer","insertparagraphbeforetable","averagedistributecol","averagedistributerow","removeStyleSize","replaceToProperty","getParentTdOrTh","mouseCoords","pageX","pageY","mouseMoveEvent","isEditorDisabled","abs","clearTableDragTimer","tableBorderDrag","toggleDraggableState","preTd","nextTd","getPermissionX","mousePosY","getPermissionY","getRelation","inTableSide","cursor","toggleDragButton","onmouseover","onmouseout","doClick","doDblClick","createDragButton","capHeight","draggable","mousePos","hideDragLine","getDragLine","showDragLineAt","elePos","mouseDownEvent","getTargetTd","tableClickHander","tableDbclickHandler","h","getCellsByMoveBorder","originArr","extractArray","oldWidth","newWidth","changeable","change","getTabcellSpace","reconstruct","borderActionHandler","mouseOverEvent","mouseUpEvent","dragTdPos","dragLinePos","changeValue","relatedCell","direction","getTableCellWidth","cellGroup","curCell","correctChangeValue","changeColWidth","backHeight","setCellHeight","changeRowHeight","tar","lineHight","tmpHeight","isContainMergeCell","temp","borderCells","tabRow","currIndex","tabCell","tab","offsetVal","prev","getTableCellOffset","tabcellSpace","trow","tabcell","mirror","paddingSpace","tmpTabWidth","contenteditable","onresizestart","ondragstart","line","tablePos","cellPos","switchBorderColor","tableArr","cellWidth","cellHeight","tableCopyList","tables","cloneTd","wordBreak","onmousemove","endTdCol","endTdRow","getClass","currentRowIndex","ua","notCtrlKey","ratio","backWidths","datatat","cmdFun","lastState","lastValue","sortTable","sortByCellIndex","trArray","lastRowIndex","Fn","reversecurrent","td1","td2","orderbyasc","value1","value2","reversebyasc","orderbynum","reversebynum","tr1","tr2","fragment","items","contextMenu","cleardoc","confirm","confirmclear","unlink","paragraph","icon","subMenu","justifyleft","justifyright","justifycenter","justifyjustify","inserttitlecol","deletetitlecol","averageDiseRow","averageDisCol","edittd","getDialog","edittable","setbordervisible","tablesort","enablesort","disablesort","borderbk","setcolor","unsetcolor","setbackground","unsetbackground","redandblue","threecolorgradient","aligntd","aligntable","tableleft","tablecenter","tableright","insertparagraphbefore","insertparagraphafter","getViewportOffsetByEvent","contextItems","subItem","query","getLabel","Menu","showAt","shortcutMenu","customEvt","screenX","screenY","ShortCutMenu","isHidden","basestyles","bold","italic","subscript","superscript","Bold","Italic","Underline","elementPathEnabled","names","addList","imgT","addFormat","_blockElm","findTextInString","searchStr","casesensitive","findNTextInBlockElm","currentNode","currentNodeLength","searchReplace","startBlockNode","rngText","replaceStr","replaceText","methodName","findTextBlockElm","rngStart","rngEnd","customstyle","tmpObj","catchRemoteImageEnable","catcherLocalDomain","catcherActionUrl","catcherUrlPrefix","catcherFieldName","remoteImages","imgs","urls","catchremoteimage","callbacks","params","success","oldSrc","newSrc","snapplugin","getLocation","pathname","hash","snapscreen","local","res","onSuccess","rs","snapscreenUrlPrefix","snapscreenImgAlign","callBackErrorMsg","saveSnapshot","_dialogs","front","createInsertStr","toEmbed","cssfloat","logo","webapp","tnode","music","musicObj","sendAndInsertFile","file","fieldName","urlPrefix","maxSize","allowFiles","actionUrl","loadingHtml","errorHandler","successHandler","filetype","loadingId","loader","original","fileext","XMLHttpRequest","fd","FormData","append","response","er","FileReader","hasImg","getPasteImage","dataTransfer","files","getDropImage","getAsFile","lastSaveTime","MIN_TIME","saveKey","saveData","_saveFlag","saveInterval","contentchange","clearlocaldata","getlocaldata","drafts","chartserror","charts","tableNode","flagText","validData","subTitle","xTitle","yTitle","suffix","tip","tableDataFormat","chartType","firstRows","cellCount","getSection","section","nextSection","previousSection","parentSection","getNodeFromAddress","bindMultiEvents","afterexeccommand","keyup","getsections","levels","levelFn","getSectionLevel","Directory","previous","tmpSection","movesection","sourceSection","targetSection","isAfter","targetAddress","addressTarget","isAfterStartAddress","isBeforeEndAddress","isContainsAddress","deletesection","selectsection","scrolltosection","containerBtn","isLoaded","initUploadBtn","w","btnIframe","btnStyle","wrapper","btnIframeDoc","btnIframeBody","timestrap","contentDocument","contentWindow","imageFieldName","stateTimer","imageActionUrl","showErrorLoader","imageurl","imageUrlPrefix","simpleuploadbtnready","simpleupload","serverParam","serverparam","getFileIcon","maps","rar","zip","gz","bz2","docx","pdf","mp3","xls","chm","ppt","pptx","avi","rmvb","wmv","flv","swf","rm","exe","psd","jpg","png","jpeg","gif","ico","bmp","insertfile","filelist","URL","iconDir","xssFilter","whitList","xssFilterRules","tagList","inputXssFilter","outputXssFilter","uidCount","hook","dg","_callbacks","createElementByHtml","getViewportElement","bcr","getViewportRect","viewportEl","innerWidth","innerHeight","fixedLayer","getFixedLayer","getEventOffset","frameEl","setGlobal","magic","unsetGlobal","copyAttributes","tgt","attrNode","elA","elB","compareDocumentPosition","startDrag","startX","startY","handleMouseMove","ondragmove","cancelBubble","handleMouseUp","ondragstop","releaseCaptrue","releaseCapture","setCapture","layer","updateFixedOffset","makeUnselectable","WebkitUserSelect","UIBase","uiName","initOptions","initUIBase","_globalKey","renderHtml","seatEl","postRender","getHtmlTpl","formatHtml","tpl","prefix","box","Separator","initSeparator","Mask","_fill","_onMouseDown","_onClick","vpRect","Popup","initPopup","allPopups","closeAllPopup","queryAutoHide","postHide","ANCHOR_CLASSES","SHADOW_RADIUS","_hidden","autoRender","canSideLeft","canSideUp","getContentHtmlTpl","_UIBase_postRender","captureWheel","captured","_height","_top","combox","ifr","wheelDelta","detail","_doAutoRender","mesureSize","fitSize","sized","__size","popBodyEl","showAnchor","hoz","showAnchorRect","adj","visibility","_show","sideLeft","sideUp","popSize","popEl","notNofity","ColorPicker","noColorText","COLORS","genColorPicker","_onTableClick","_onTableOver","_onTableOut","_onPickNoColor","TablePicker","initTablePicker","defaultNumRows","defaultNumCols","maxNumRows","maxNumCols","lengthOfCellSide","_UIBase_render","_track","sideLen","_onMouseOver","rel","fromElement","_onMouseOut","toElement","_onMouseMove","TPL_STATEFUL","Stateful","alwalysHoverable","Stateful_init","_Stateful_dGetHtmlTpl","Stateful_getHtmlTpl","Stateful_onMouseEnter","isDisabled","addState","Stateful_onMouseLeave","removeState","Stateful_onMouseOver","Stateful_onMouseOut","Stateful_onMouseDown","Stateful_onMouseUp","Stateful_postRender","hasState","getStateDom","isChecked","setChecked","checked","Button","btnName","cssRules","initButton","showIcon","showText","setTitle","SplitButton","initSplitButton","popup","setPopup","_onPopupShow","_onPopupHide","showPopup","_onArrowClick","_onButtonClick","ColorButton","initColorButton","onpickcolor","_onPickColor","onpicknocolor","_SplitButton_postRender","setColor","TableButton","initTableButton","onpicktable","_onPickTable","AutoTypeSetPicker","initAutoTypeSetPicker","textAlignInputName","imageBlockInputName","symbolConverInputName","mergeLine","delLine","removeFormat","alignment","imageFloat","removeFontsize","removeFontFamily","removeHtml","symbol","AutoTypeSetButton","initAutoTypeSetButton","getPara","ipt","editorId","ipts","attrValue","iptchild","iptChilds","selects","popupUI","radios","defalutSelect","symbolConver","checkboxs","CellAlignPicker","initSelected","initCellAlignPicker","middle","selected","selectedIndex","alignType","tempClassName","tempIndex","tmpl","PastePicker","initPastePicker","_isTransfer","cur","screenHt","subPop","Toolbar","initToolbar","buff","initMenu","menuSeparator","initItems","getSeparator","MenuItem","createItem","_Popup_getContentHtmlTpl","_Popup_postRender","ownerMenu","clearItems","_showingTimer","_closingTimer","parentMenu","renderLabelHtml","delayShowSubMenu","delayHideSubMenu","hideSubMenu","_bakQueryAutoHide","tabIndex","showSubMenu","this_","Combox","initCombox","onbuttonclick","selectByIndex","setLabel","initValue","indexByValue","getLabelForUnknowValue","modalMask","dragMask","activeDialog","Dialog","autoReset","onok","oncancel","onclose","ok","holdScroll","initDialog","closeButton","closeDialog","initResizeEvent","buttons","__resizeTimer","dialogWrapNode","contentNode","wrapRect","contentRect","safeSetOffset","showAtCenter","_originalContext","overflowX","titleHeight","getContentHtml","contentHtml","iframeUrl","footHtml","_hide","_onTitlebarMouseDown","wrapNode","_onCloseButtonClick","MenuButton","initMenuButton","_value","MultiMenuPop","initMultiMenu","iframe_rendered","onshow","timeID","UI","allMenus","isSubMenuShow","initShortCutMenu","hideAllMenu","SPACE","initEvent","getSubMenuMark","wt","ht","distanceX","distanceY","setOpacity","relatedTgt","opacity","layerEle","hasContextmenu","fixedlayer","setPos","setPosByCxtMenu","Breakline","Message","initMessage","keepshow","setType","closer","getType","editorui","_Dialog","scrollX","iframeUrlMap","insertimage","spechars","gmap","insertvideo","emotion","attachment","insertframe","edittip","scrawl","template","btnCmds","labelMap","causeByUi","uiReady","typeset","imagefloat","directionality","cmd2","dialogBtns","noOk","vals","mapUrl","onselect","langLabel","langCs","ck","ri","rowspacings","lists","_onMenuClick","isFullScreen","iconSpan","nodeStack","EditorUI","initEditorUI","_initToolbars","_actualFrameWidth","wordCount","setCount","_scale","enableScale","disableScale","pastePop","isPaste","maximumWords","wordCountMsg","wordOverFlowMsg","errMsg","countDom","_onEditButtonClick","linkDialog","_onImgEditButtonClick","_onImgSetFloat","_setIframeAlign","frame","anchorEl","newFrame","_updateIframe","mapDialog","insertframeDialog","_onRemoveButtonClick","dialogs","dialogName","toolbars","toolbarUis","toolbar","toolbarUi","toolbarItem","toolbarItemUi","itemUI","renderToolbarBoxHtml","showWordImageDialog","_fullscreen","_bakHtmlOverflow","_bakBodyOverflow","_bakAutoHeight","_bakScrollTop","_bakEditorContaninerWidth","_bakCssText","_bakCssText1","_updateFullScreen","scroll","triggerLayout","_updateElementPath","disableElementPath","enableElementPath","editorHolder","editorDocument","bottombar","scale","scalelayer","isMouseMove","minEditorHeight","minEditorWidth","scaleWidth","scaleHeight","down","move","up","clearSelection","fullScreen","timerId","updateFullScreenTime","showToolbarMsg","hideToolbarMsg","zoom","instances","oldRender","renderUI","newDiv","displays","styleWidth","getEditor","registerUI","_messageItems","updateHolderPos","toolbarbox","mid","formatmatch","horizontal","removeformat","time","directionalityltr","directionalityrtl","imagenone","imageleft","imageright","imagecenter","touppercase","tolowercase","songti","kaiti","heiti","lishu","yahei","andaleMono","arial","arialBlack","comicSansMs","impact","timesNewRoman","tc","tl","im","hi","autoupload","exceedSizeError","exceedTypeError","jsonEncodeError","loading","loadError","errorLoadConfig","elementPathTip","wordCountTip","cancel","tableDrag","loadconfigError","loadconfigFormatError","loadconfigHttpError","snapScreen_plugin","browserMsg","uploadErrorMsg","confirmClear","delete","deletecode","mergeleft","copymsg","paste","pastemsg","anthorMsg","clearColor","standardColor","themeColor","property","default","modify","anchorMsg","clickToUpload","unset","t_row","t_col","more","pasteOpt","pasteSourceFormat","tagFormat","pasteTextFormat","autoTypeSet","static","lang_background_normal","lang_background_local","lang_background_set","lang_background_none","lang_background_colored","lang_background_color","lang_background_netimg","lang_background_align","lang_background_position","repeatType","noUploadImage","toggleSelect","lang_tab_remote","lang_tab_upload","lang_tab_online","lang_tab_search","lang_input_url","lang_input_size","lang_input_width","lang_input_height","lang_input_border","lang_input_vhspace","lang_input_title","lang_input_align","lang_imgLoading","lang_start_upload","lock","searchType","searchTxt","searchBtn","searchReset","noneAlign","leftAlign","rightAlign","centerAlign","uploadSelectFile","uploadAddFile","uploadStart","uploadPause","uploadContinue","uploadRetry","uploadDelete","uploadTurnLeft","uploadTurnRight","uploadPreview","uploadNoPreview","updateStatusReady","updateStatusConfirm","updateStatusFinish","updateStatusError","errorNotSupport","errorExceedSize","errorFileType","errorInterrupt","errorUploadRetry","errorHttp","errorServerUpload","remoteLockError","numError","imageUrlError","imageLoadError","searchRemind","searchLoading","searchRetry","lang_drop_remind","lang_tab_insertV","lang_tab_searchV","lang_tab_uploadV","lang_video_url","lang_video_size","lang_videoW","lang_videoH","lang_alignment","videoSearchTxt","videoType","videoSearchBtn","videoSearchReset","lang_input_fileStatus","startUpload","lang_upload_size","lang_upload_width","lang_upload_height","lang_upload_alignment","lang_format_advice","floatLeft","floatRight","\"default\"","urlError","clickToSelect","goToSource","noVideo","browseFiles","uploadSuccess","delSuccessFile","delFailSaveFile","statusPrompt","flashVersionError","flashLoadingError","fileUploadReady","delUploadQueue","limitPrompt1","limitPrompt2","delFailFile","fileSizeLimit","emptyFile","fileTypeError","unknownError","fileUploading","cancelUpload","netError","failUpload","serverIOError","noAuthority","fileNumLimit","failCheck","fileCanceling","stopUploading","tip1","tip2","applyFor","anthorApi","lang_template_bkcolor","lang_template_clear","lang_template_select","blank","blog","resume","sciPapers","lang_input_previousStep","lang_input_nextsStep","lang_input_clear","lang_input_addPic","lang_input_ScalePic","lang_input_removePic","J_imgTxt","noScarwl","scrawlUpLoading","continueBtn","imageError","backgroundUploading","lang_input_tips","J_searchBtn","emptyTxt","chapter","singer","special","listenTest","lang_input_anchorName","lang_data_source","lang_chart_format","lang_data_align","lang_chart_align_same","lang_chart_align_reverse","lang_chart_title","lang_chart_main_title","lang_chart_sub_title","lang_chart_x_title","lang_chart_y_title","lang_chart_tip","lang_cahrt_tip_prefix","lang_cahrt_tip_description","lang_chart_data_unit","lang_chart_data_unit_title","lang_chart_data_unit_description","lang_chart_type","lang_prev_btn","lang_next_btn","lang_input_choice","lang_input_Tuzki","lang_input_BOBO","lang_input_lvdouwa","lang_input_babyCat","lang_input_bubble","lang_input_youa","lang_input_address","lang_input_search","searchError","lang_input_about","lang_input_shortcuts","lang_input_introduction","lang_Txt_shortcuts","lang_Txt_func","lang_Txt_bold","lang_Txt_copy","lang_Txt_cut","lang_Txt_Paste","lang_Txt_undo","lang_Txt_redo","lang_Txt_italic","lang_Txt_underline","lang_Txt_selectAll","lang_Txt_visualEnter","lang_Txt_fullscreen","lang_input_isScroll","lang_input_frameborder","lang_input_alignMode","enterAddress","lang_input_text","lang_input_target","validLink","httpPrompt","lang_city","lang_address","city","lang_search","lang_dynamicmap","cityMsg","errorMsg","lang_tab_replace","lang_search1","lang_search2","lang_replace","lang_searchReg","lang_searchReg1","lang_case_sensitive1","lang_case_sensitive2","nextFindBtn","preFindBtn","nextReplaceBtn","preReplaceBtn","repalceBtn","repalceAllBtn","getEnd","countMsg","lang_showMsg","lang_download","lang_step1","lang_step2","tsfh","lmsz","szfh","rwfh","xlzm","ewzm","pyzm","yyyb","zyzf","lang_tableStyle","lang_insertCaption","lang_insertTitle","lang_insertTitleCol","lang_orderbycontent","lang_tableSize","lang_autoSizeContent","lang_autoSizePage","lang_example","lang_borderStyle","lang_color","captionName","titleName","cellsName","lang_delRow","lang_delCol","lang_tdBkColor","formula","lang_resave","uploadBtn","clipboard","lang_step","fileType","flashError","copySuccess","flashI18n","autosave","saving","module","exports","article","aside","audio","bdi","details","footer","header","mark","nav","video","getUEBasePath","docUrl","confUrl","basePath","optimizationPath","getBasePath","self","configPath","getConfigFilePath"],"mappings":"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","file":"5.b8d1183c.js","sourcesContent":["/*!\n* ZeroClipboard\n* The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.\n* Copyright (c) 2014 Jon Rohan, James M. Greene\n* Licensed MIT\n* http://zeroclipboard.org/\n* v2.0.0-beta.5\n*/\nimport swfPath from './ZeroClipboard.swf';\n\nvar _currentElement;\nvar _flashState = {\n  bridge: null,\n  version: \"0.0.0\",\n  pluginType: \"unknown\",\n  disabled: null,\n  outdated: null,\n  unavailable: null,\n  deactivated: null,\n  overdue: null,\n  ready: null\n};\nvar _clipData = {};\nvar _clipDataFormatMap = null;\nvar _clientIdCounter = 0;\nvar _clientMeta = {};\nvar _elementIdCounter = 0;\nvar _elementMeta = {};\n// var _swfPath = function() {\n//   var i, jsDir, tmpJsPath, jsPath, swfPath = \"ZeroClipboard.swf\";\n//   if (!(document.currentScript && (jsPath = document.currentScript.src))) {\n//     var scripts = document.getElementsByTagName(\"script\");\n//     if (\"readyState\" in scripts[0]) {\n//       for (i = scripts.length; i--; ) {\n//         if (scripts[i].readyState === \"interactive\" && (jsPath = scripts[i].src)) {\n//           break;\n//         }\n//       }\n//     } else if (document.readyState === \"loading\") {\n//       jsPath = scripts[scripts.length - 1].src;\n//     } else {\n//       for (i = scripts.length; i--; ) {\n//         tmpJsPath = scripts[i].src;\n//         if (!tmpJsPath) {\n//           jsDir = null;\n//           break;\n//         }\n//         tmpJsPath = tmpJsPath.split(\"#\")[0].split(\"?\")[0];\n//         tmpJsPath = tmpJsPath.slice(0, tmpJsPath.lastIndexOf(\"/\") + 1);\n//         if (jsDir == null) {\n//           jsDir = tmpJsPath;\n//         } else if (jsDir !== tmpJsPath) {\n//           jsDir = null;\n//           break;\n//         }\n//       }\n//       if (jsDir !== null) {\n//         jsPath = jsDir;\n//       }\n//     }\n//   }\n//   if (jsPath) {\n//     jsPath = jsPath.split(\"#\")[0].split(\"?\")[0];\n//     swfPath = jsPath.slice(0, jsPath.lastIndexOf(\"/\") + 1) + swfPath;\n//   }\n//   return swfPath;\n// }();\nvar _camelizeCssPropName = function () {\n  var matcherRegex = /\\-([a-z])/g, replacerFn = function (match, group) {\n    return group.toUpperCase();\n  };\n  return function (prop) {\n    return prop.replace(matcherRegex, replacerFn);\n  };\n}();\nvar _getStyle = function (el, prop) {\n  var value, camelProp, tagName;\n  if (window.getComputedStyle) {\n    value = window.getComputedStyle(el, null).getPropertyValue(prop);\n  } else {\n    camelProp = _camelizeCssPropName(prop);\n    if (el.currentStyle) {\n      value = el.currentStyle[camelProp];\n    } else {\n      value = el.style[camelProp];\n    }\n  }\n  if (prop === \"cursor\") {\n    if (!value || value === \"auto\") {\n      tagName = el.tagName.toLowerCase();\n      if (tagName === \"a\") {\n        return \"pointer\";\n      }\n    }\n  }\n  return value;\n};\nvar _elementMouseOver = function (event) {\n  if (!event) {\n    event = window.event;\n  }\n  var target;\n  if (this !== window) {\n    target = this;\n  } else if (event.target) {\n    target = event.target;\n  } else if (event.srcElement) {\n    target = event.srcElement;\n  }\n  ZeroClipboard.activate(target);\n};\nvar _addEventHandler = function (element, method, func) {\n  if (!element || element.nodeType !== 1) {\n    return;\n  }\n  if (element.addEventListener) {\n    element.addEventListener(method, func, false);\n  } else if (element.attachEvent) {\n    element.attachEvent(\"on\" + method, func);\n  }\n};\nvar _removeEventHandler = function (element, method, func) {\n  if (!element || element.nodeType !== 1) {\n    return;\n  }\n  if (element.removeEventListener) {\n    element.removeEventListener(method, func, false);\n  } else if (element.detachEvent) {\n    element.detachEvent(\"on\" + method, func);\n  }\n};\nvar _addClass = function (element, value) {\n  if (!element || element.nodeType !== 1) {\n    return element;\n  }\n  if (element.classList) {\n    if (!element.classList.contains(value)) {\n      element.classList.add(value);\n    }\n    return element;\n  }\n  if (value && typeof value === \"string\") {\n    var classNames = (value || \"\").split(/\\s+/);\n    if (element.nodeType === 1) {\n      if (!element.className) {\n        element.className = value;\n      } else {\n        var className = \" \" + element.className + \" \", setClass = element.className;\n        for (var c = 0, cl = classNames.length; c < cl; c++) {\n          if (className.indexOf(\" \" + classNames[c] + \" \") < 0) {\n            setClass += \" \" + classNames[c];\n          }\n        }\n        element.className = setClass.replace(/^\\s+|\\s+$/g, \"\");\n      }\n    }\n  }\n  return element;\n};\nvar _removeClass = function (element, value) {\n  if (!element || element.nodeType !== 1) {\n    return element;\n  }\n  if (element.classList) {\n    if (element.classList.contains(value)) {\n      element.classList.remove(value);\n    }\n    return element;\n  }\n  if (value && typeof value === \"string\" || value === undefined) {\n    var classNames = (value || \"\").split(/\\s+/);\n    if (element.nodeType === 1 && element.className) {\n      if (value) {\n        var className = (\" \" + element.className + \" \").replace(/[\\n\\t]/g, \" \");\n        for (var c = 0, cl = classNames.length; c < cl; c++) {\n          className = className.replace(\" \" + classNames[c] + \" \", \" \");\n        }\n        element.className = className.replace(/^\\s+|\\s+$/g, \"\");\n      } else {\n        element.className = \"\";\n      }\n    }\n  }\n  return element;\n};\nvar _getZoomFactor = function () {\n  var rect, physicalWidth, logicalWidth, zoomFactor = 1;\n  if (typeof document.body.getBoundingClientRect === \"function\") {\n    rect = document.body.getBoundingClientRect();\n    physicalWidth = rect.right - rect.left;\n    logicalWidth = document.body.offsetWidth;\n    zoomFactor = Math.round(physicalWidth / logicalWidth * 100) / 100;\n  }\n  return zoomFactor;\n};\nvar _getDOMObjectPosition = function (obj, defaultZIndex) {\n  var info = {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0,\n    zIndex: _getSafeZIndex(defaultZIndex) - 1\n  };\n  if (obj.getBoundingClientRect) {\n    var rect = obj.getBoundingClientRect();\n    var pageXOffset, pageYOffset, zoomFactor;\n    if (\"pageXOffset\" in window && \"pageYOffset\" in window) {\n      pageXOffset = window.pageXOffset;\n      pageYOffset = window.pageYOffset;\n    } else {\n      zoomFactor = _getZoomFactor();\n      pageXOffset = Math.round(document.documentElement.scrollLeft / zoomFactor);\n      pageYOffset = Math.round(document.documentElement.scrollTop / zoomFactor);\n    }\n    var leftBorderWidth = document.documentElement.clientLeft || 0;\n    var topBorderWidth = document.documentElement.clientTop || 0;\n    info.left = rect.left + pageXOffset - leftBorderWidth;\n    info.top = rect.top + pageYOffset - topBorderWidth;\n    info.width = \"width\" in rect ? rect.width : rect.right - rect.left;\n    info.height = \"height\" in rect ? rect.height : rect.bottom - rect.top;\n  }\n  return info;\n};\nvar _cacheBust = function (path, options) {\n  var cacheBust = options == null || options && options.cacheBust === true;\n  if (cacheBust) {\n    return (path.indexOf(\"?\") === -1 ? \"?\" : \"&\") + \"noCache=\" + new Date().getTime();\n  } else {\n    return \"\";\n  }\n};\nvar _vars = function (options) {\n  var i, len, domain, domains, str = \"\", trustedOriginsExpanded = [];\n  if (options.trustedDomains) {\n    if (typeof options.trustedDomains === \"string\") {\n      domains = [options.trustedDomains];\n    } else if (typeof options.trustedDomains === \"object\" && \"length\" in options.trustedDomains) {\n      domains = options.trustedDomains;\n    }\n  }\n  if (domains && domains.length) {\n    for (i = 0, len = domains.length; i < len; i++) {\n      if (domains.hasOwnProperty(i) && domains[i] && typeof domains[i] === \"string\") {\n        domain = _extractDomain(domains[i]);\n        if (!domain) {\n          continue;\n        }\n        if (domain === \"*\") {\n          trustedOriginsExpanded = [domain];\n          break;\n        }\n        trustedOriginsExpanded.push.apply(trustedOriginsExpanded, [domain, \"//\" + domain, window.location.protocol + \"//\" + domain]);\n      }\n    }\n  }\n  if (trustedOriginsExpanded.length) {\n    str += \"trustedOrigins=\" + encodeURIComponent(trustedOriginsExpanded.join(\",\"));\n  }\n  if (options.forceEnhancedClipboard === true) {\n    str += (str ? \"&\" : \"\") + \"forceEnhancedClipboard=true\";\n  }\n  return str;\n};\nvar _inArray = function (elem, array, fromIndex) {\n  if (typeof array.indexOf === \"function\") {\n    return array.indexOf(elem, fromIndex);\n  }\n  var i, len = array.length;\n  if (typeof fromIndex === \"undefined\") {\n    fromIndex = 0;\n  } else if (fromIndex < 0) {\n    fromIndex = len + fromIndex;\n  }\n  for (i = fromIndex; i < len; i++) {\n    if (array.hasOwnProperty(i) && array[i] === elem) {\n      return i;\n    }\n  }\n  return -1;\n};\nvar _prepClip = function (elements) {\n  if (typeof elements === \"string\") {\n    throw new TypeError(\"ZeroClipboard doesn't accept query strings.\");\n  }\n  return typeof elements.length !== \"number\" ? [elements] : elements;\n};\nvar _dispatchCallback = function (func, context, args, async) {\n  if (async) {\n    window.setTimeout(function () {\n      func.apply(context, args);\n    }, 0);\n  } else {\n    func.apply(context, args);\n  }\n};\nvar _getSafeZIndex = function (val) {\n  var zIndex, tmp;\n  if (val) {\n    if (typeof val === \"number\" && val > 0) {\n      zIndex = val;\n    } else if (typeof val === \"string\" && (tmp = parseInt(val, 10)) && !isNaN(tmp) && tmp > 0) {\n      zIndex = tmp;\n    }\n  }\n  if (!zIndex) {\n    if (typeof _globalConfig.zIndex === \"number\" && _globalConfig.zIndex > 0) {\n      zIndex = _globalConfig.zIndex;\n    } else if (typeof _globalConfig.zIndex === \"string\" && (tmp = parseInt(_globalConfig.zIndex, 10)) && !isNaN(tmp) && tmp > 0) {\n      zIndex = tmp;\n    }\n  }\n  return zIndex || 0;\n};\nvar _extend = function () {\n  var i, len, arg, prop, src, copy, target = arguments[0] || {};\n  for (i = 1, len = arguments.length; i < len; i++) {\n    if ((arg = arguments[i]) != null) {\n      for (prop in arg) {\n        if (arg.hasOwnProperty(prop)) {\n          src = target[prop];\n          copy = arg[prop];\n          if (target === copy) {\n            continue;\n          }\n          if (copy !== undefined) {\n            target[prop] = copy;\n          }\n        }\n      }\n    }\n  }\n  return target;\n};\nvar _extractDomain = function (originOrUrl) {\n  if (originOrUrl == null || originOrUrl === \"\") {\n    return null;\n  }\n  originOrUrl = originOrUrl.replace(/^\\s+|\\s+$/g, \"\");\n  if (originOrUrl === \"\") {\n    return null;\n  }\n  var protocolIndex = originOrUrl.indexOf(\"//\");\n  originOrUrl = protocolIndex === -1 ? originOrUrl : originOrUrl.slice(protocolIndex + 2);\n  var pathIndex = originOrUrl.indexOf(\"/\");\n  originOrUrl = pathIndex === -1 ? originOrUrl : protocolIndex === -1 || pathIndex === 0 ? null : originOrUrl.slice(0, pathIndex);\n  if (originOrUrl && originOrUrl.slice(-4).toLowerCase() === \".swf\") {\n    return null;\n  }\n  return originOrUrl || null;\n};\nvar _determineScriptAccess = function () {\n  var _extractAllDomains = function (origins, resultsArray) {\n    var i, len, tmp;\n    if (origins == null || resultsArray[0] === \"*\") {\n      return;\n    }\n    if (typeof origins === \"string\") {\n      origins = [origins];\n    }\n    if (!(typeof origins === \"object\" && typeof origins.length === \"number\")) {\n      return;\n    }\n    for (i = 0, len = origins.length; i < len; i++) {\n      if (origins.hasOwnProperty(i) && (tmp = _extractDomain(origins[i]))) {\n        if (tmp === \"*\") {\n          resultsArray.length = 0;\n          resultsArray.push(\"*\");\n          break;\n        }\n        if (_inArray(tmp, resultsArray) === -1) {\n          resultsArray.push(tmp);\n        }\n      }\n    }\n  };\n  return function (currentDomain, configOptions) {\n    var swfDomain = _extractDomain(configOptions.swfPath);\n    if (swfDomain === null) {\n      swfDomain = currentDomain;\n    }\n    var trustedDomains = [];\n    _extractAllDomains(configOptions.trustedOrigins, trustedDomains);\n    _extractAllDomains(configOptions.trustedDomains, trustedDomains);\n    var len = trustedDomains.length;\n    if (len > 0) {\n      if (len === 1 && trustedDomains[0] === \"*\") {\n        return \"always\";\n      }\n      if (_inArray(currentDomain, trustedDomains) !== -1) {\n        if (len === 1 && currentDomain === swfDomain) {\n          return \"sameDomain\";\n        }\n        return \"always\";\n      }\n    }\n    return \"never\";\n  };\n}();\nvar _objectKeys = function (obj) {\n  if (obj == null) {\n    return [];\n  }\n  if (Object.keys) {\n    return Object.keys(obj);\n  }\n  var keys = [];\n  for (var prop in obj) {\n    if (obj.hasOwnProperty(prop)) {\n      keys.push(prop);\n    }\n  }\n  return keys;\n};\nvar _deleteOwnProperties = function (obj) {\n  if (obj) {\n    for (var prop in obj) {\n      if (obj.hasOwnProperty(prop)) {\n        delete obj[prop];\n      }\n    }\n  }\n  return obj;\n};\nvar _safeActiveElement = function () {\n  try {\n    return document.activeElement;\n  } catch (err) { }\n  return null;\n};\nvar _pick = function (obj, keys) {\n  var newObj = {};\n  for (var i = 0, len = keys.length; i < len; i++) {\n    if (keys[i] in obj) {\n      newObj[keys[i]] = obj[keys[i]];\n    }\n  }\n  return newObj;\n};\nvar _omit = function (obj, keys) {\n  var newObj = {};\n  for (var prop in obj) {\n    if (_inArray(prop, keys) === -1) {\n      newObj[prop] = obj[prop];\n    }\n  }\n  return newObj;\n};\nvar _mapClipDataToFlash = function (clipData) {\n  var newClipData = {}, formatMap = {};\n  if (!(typeof clipData === \"object\" && clipData)) {\n    return;\n  }\n  for (var dataFormat in clipData) {\n    if (dataFormat && clipData.hasOwnProperty(dataFormat) && typeof clipData[dataFormat] === \"string\" && clipData[dataFormat]) {\n      switch (dataFormat.toLowerCase()) {\n        case \"text/plain\":\n        case \"text\":\n        case \"air:text\":\n        case \"flash:text\":\n          newClipData.text = clipData[dataFormat];\n          formatMap.text = dataFormat;\n          break;\n\n        case \"text/html\":\n        case \"html\":\n        case \"air:html\":\n        case \"flash:html\":\n          newClipData.html = clipData[dataFormat];\n          formatMap.html = dataFormat;\n          break;\n\n        case \"application/rtf\":\n        case \"text/rtf\":\n        case \"rtf\":\n        case \"richtext\":\n        case \"air:rtf\":\n        case \"flash:rtf\":\n          newClipData.rtf = clipData[dataFormat];\n          formatMap.rtf = dataFormat;\n          break;\n\n        default:\n          break;\n      }\n    }\n  }\n  return {\n    data: newClipData,\n    formatMap: formatMap\n  };\n};\nvar _mapClipResultsFromFlash = function (clipResults, formatMap) {\n  if (!(typeof clipResults === \"object\" && clipResults && typeof formatMap === \"object\" && formatMap)) {\n    return clipResults;\n  }\n  var newResults = {};\n  for (var prop in clipResults) {\n    if (clipResults.hasOwnProperty(prop)) {\n      if (prop !== \"success\" && prop !== \"data\") {\n        newResults[prop] = clipResults[prop];\n        continue;\n      }\n      newResults[prop] = {};\n      var tmpHash = clipResults[prop];\n      for (var dataFormat in tmpHash) {\n        if (dataFormat && tmpHash.hasOwnProperty(dataFormat) && formatMap.hasOwnProperty(dataFormat)) {\n          newResults[prop][formatMap[dataFormat]] = tmpHash[dataFormat];\n        }\n      }\n    }\n  }\n  return newResults;\n};\nvar _args = function (arraySlice) {\n  return function (args) {\n    return arraySlice.call(args, 0);\n  };\n}(Array.prototype.slice);\nvar _detectFlashSupport = function () {\n  var plugin, ax, mimeType, hasFlash = false, isActiveX = false, isPPAPI = false, flashVersion = \"\";\n  function parseFlashVersion(desc) {\n    var matches = desc.match(/[\\d]+/g);\n    matches.length = 3;\n    return matches.join(\".\");\n  }\n  function isPepperFlash(flashPlayerFileName) {\n    return !!flashPlayerFileName && (flashPlayerFileName = flashPlayerFileName.toLowerCase()) && (/^(pepflashplayer\\.dll|libpepflashplayer\\.so|pepperflashplayer\\.plugin)$/.test(flashPlayerFileName) || flashPlayerFileName.slice(-13) === \"chrome.plugin\");\n  }\n  function inspectPlugin(plugin) {\n    if (plugin) {\n      hasFlash = true;\n      if (plugin.version) {\n        flashVersion = parseFlashVersion(plugin.version);\n      }\n      if (!flashVersion && plugin.description) {\n        flashVersion = parseFlashVersion(plugin.description);\n      }\n      if (plugin.filename) {\n        isPPAPI = isPepperFlash(plugin.filename);\n      }\n    }\n  }\n  if (navigator.plugins && navigator.plugins.length) {\n    plugin = navigator.plugins[\"Shockwave Flash\"];\n    inspectPlugin(plugin);\n    if (navigator.plugins[\"Shockwave Flash 2.0\"]) {\n      hasFlash = true;\n      flashVersion = \"2.0.0.11\";\n    }\n  } else if (navigator.mimeTypes && navigator.mimeTypes.length) {\n    mimeType = navigator.mimeTypes[\"application/x-shockwave-flash\"];\n    plugin = mimeType && mimeType.enabledPlugin;\n    inspectPlugin(plugin);\n  } else if (typeof ActiveXObject !== \"undefined\") {\n    isActiveX = true;\n    try {\n      ax = new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash.7\");\n      hasFlash = true;\n      flashVersion = parseFlashVersion(ax.GetVariable(\"$version\"));\n    } catch (e1) {\n      try {\n        ax = new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash.6\");\n        hasFlash = true;\n        flashVersion = \"6.0.21\";\n      } catch (e2) {\n        try {\n          ax = new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash\");\n          hasFlash = true;\n          flashVersion = parseFlashVersion(ax.GetVariable(\"$version\"));\n        } catch (e3) {\n          isActiveX = false;\n        }\n      }\n    }\n  }\n  _flashState.disabled = hasFlash !== true;\n  _flashState.outdated = flashVersion && parseFloat(flashVersion) < 11;\n  _flashState.version = flashVersion || \"0.0.0\";\n  _flashState.pluginType = isPPAPI ? \"pepper\" : isActiveX ? \"activex\" : hasFlash ? \"netscape\" : \"unknown\";\n};\n_detectFlashSupport();\nvar ZeroClipboard = function (elements) {\n  if (!(this instanceof ZeroClipboard)) {\n    return new ZeroClipboard(elements);\n  }\n  this.id = \"\" + _clientIdCounter++;\n  _clientMeta[this.id] = {\n    instance: this,\n    elements: [],\n    handlers: {}\n  };\n  if (elements) {\n    this.clip(elements);\n  }\n  if (typeof _flashState.ready !== \"boolean\") {\n    _flashState.ready = false;\n  }\n  if (!ZeroClipboard.isFlashUnusable() && _flashState.bridge === null) {\n    var _client = this;\n    var maxWait = _globalConfig.flashLoadTimeout;\n    if (typeof maxWait === \"number\" && maxWait >= 0) {\n      setTimeout(function () {\n        if (typeof _flashState.deactivated !== \"boolean\") {\n          _flashState.deactivated = true;\n        }\n        if (_flashState.deactivated === true) {\n          ZeroClipboard.emit({\n            type: \"error\",\n            name: \"flash-deactivated\",\n            client: _client\n          });\n        }\n      }, maxWait);\n    }\n    _flashState.overdue = false;\n    _bridge();\n  }\n};\nZeroClipboard.prototype.setText = function (text) {\n  ZeroClipboard.setData(\"text/plain\", text);\n  return this;\n};\nZeroClipboard.prototype.setHtml = function (html) {\n  ZeroClipboard.setData(\"text/html\", html);\n  return this;\n};\nZeroClipboard.prototype.setRichText = function (richText) {\n  ZeroClipboard.setData(\"application/rtf\", richText);\n  return this;\n};\nZeroClipboard.prototype.setData = function () {\n  ZeroClipboard.setData.apply(ZeroClipboard, _args(arguments));\n  return this;\n};\nZeroClipboard.prototype.clearData = function () {\n  ZeroClipboard.clearData.apply(ZeroClipboard, _args(arguments));\n  return this;\n};\nZeroClipboard.prototype.setSize = function (width, height) {\n  _setSize(width, height);\n  return this;\n};\nvar _setHandCursor = function (enabled) {\n  if (_flashState.ready === true && _flashState.bridge && typeof _flashState.bridge.setHandCursor === \"function\") {\n    _flashState.bridge.setHandCursor(enabled);\n  } else {\n    _flashState.ready = false;\n  }\n};\nZeroClipboard.prototype.destroy = function () {\n  this.unclip();\n  this.off();\n  delete _clientMeta[this.id];\n};\nvar _getAllClients = function () {\n  var i, len, client, clients = [], clientIds = _objectKeys(_clientMeta);\n  for (i = 0, len = clientIds.length; i < len; i++) {\n    client = _clientMeta[clientIds[i]].instance;\n    if (client && client instanceof ZeroClipboard) {\n      clients.push(client);\n    }\n  }\n  return clients;\n};\nZeroClipboard.version = \"2.0.0-beta.5\";\nvar _globalConfig = {\n  swfPath,\n  trustedDomains: location.host ? [location.host] : [],\n  cacheBust: true,\n  forceHandCursor: false,\n  forceEnhancedClipboard: false,\n  zIndex: 999999999,\n  debug: false,\n  title: null,\n  autoActivate: true,\n  flashLoadTimeout: 3e4\n};\nZeroClipboard.isFlashUnusable = function () {\n  return !!(_flashState.disabled || _flashState.outdated || _flashState.unavailable || _flashState.deactivated);\n};\nZeroClipboard.config = function (options) {\n  if (typeof options === \"object\" && options !== null) {\n    _extend(_globalConfig, options);\n  }\n  if (typeof options === \"string\" && options) {\n    if (_globalConfig.hasOwnProperty(options)) {\n      return _globalConfig[options];\n    }\n    return;\n  }\n  var copy = {};\n  for (var prop in _globalConfig) {\n    if (_globalConfig.hasOwnProperty(prop)) {\n      if (typeof _globalConfig[prop] === \"object\" && _globalConfig[prop] !== null) {\n        if (\"length\" in _globalConfig[prop]) {\n          copy[prop] = _globalConfig[prop].slice(0);\n        } else {\n          copy[prop] = _extend({}, _globalConfig[prop]);\n        }\n      } else {\n        copy[prop] = _globalConfig[prop];\n      }\n    }\n  }\n  return copy;\n};\nZeroClipboard.destroy = function () {\n  ZeroClipboard.deactivate();\n  for (var clientId in _clientMeta) {\n    if (_clientMeta.hasOwnProperty(clientId) && _clientMeta[clientId]) {\n      var client = _clientMeta[clientId].instance;\n      if (client && typeof client.destroy === \"function\") {\n        client.destroy();\n      }\n    }\n  }\n  var flashBridge = _flashState.bridge;\n  if (flashBridge) {\n    var htmlBridge = _getHtmlBridge(flashBridge);\n    if (htmlBridge) {\n      if (_flashState.pluginType === \"activex\" && \"readyState\" in flashBridge) {\n        flashBridge.style.display = \"none\";\n        (function removeSwfFromIE() {\n          if (flashBridge.readyState === 4) {\n            for (var prop in flashBridge) {\n              if (typeof flashBridge[prop] === \"function\") {\n                flashBridge[prop] = null;\n              }\n            }\n            flashBridge.parentNode.removeChild(flashBridge);\n            if (htmlBridge.parentNode) {\n              htmlBridge.parentNode.removeChild(htmlBridge);\n            }\n          } else {\n            setTimeout(removeSwfFromIE, 10);\n          }\n        })();\n      } else {\n        flashBridge.parentNode.removeChild(flashBridge);\n        if (htmlBridge.parentNode) {\n          htmlBridge.parentNode.removeChild(htmlBridge);\n        }\n      }\n    }\n    _flashState.ready = null;\n    _flashState.bridge = null;\n    _flashState.deactivated = null;\n  }\n  ZeroClipboard.clearData();\n};\nZeroClipboard.activate = function (element) {\n  if (_currentElement) {\n    _removeClass(_currentElement, _globalConfig.hoverClass);\n    _removeClass(_currentElement, _globalConfig.activeClass);\n  }\n  _currentElement = element;\n  _addClass(element, _globalConfig.hoverClass);\n  _reposition();\n  var newTitle = _globalConfig.title || element.getAttribute(\"title\");\n  if (newTitle) {\n    var htmlBridge = _getHtmlBridge(_flashState.bridge);\n    if (htmlBridge) {\n      htmlBridge.setAttribute(\"title\", newTitle);\n    }\n  }\n  var useHandCursor = _globalConfig.forceHandCursor === true || _getStyle(element, \"cursor\") === \"pointer\";\n  _setHandCursor(useHandCursor);\n};\nZeroClipboard.deactivate = function () {\n  var htmlBridge = _getHtmlBridge(_flashState.bridge);\n  if (htmlBridge) {\n    htmlBridge.removeAttribute(\"title\");\n    htmlBridge.style.left = \"0px\";\n    htmlBridge.style.top = \"-9999px\";\n    _setSize(1, 1);\n  }\n  if (_currentElement) {\n    _removeClass(_currentElement, _globalConfig.hoverClass);\n    _removeClass(_currentElement, _globalConfig.activeClass);\n    _currentElement = null;\n  }\n};\nZeroClipboard.state = function () {\n  return {\n    browser: _pick(navigator, [\"userAgent\", \"platform\", \"appName\"]),\n    flash: _omit(_flashState, [\"bridge\"]),\n    zeroclipboard: {\n      version: ZeroClipboard.version,\n      config: ZeroClipboard.config()\n    }\n  };\n};\nZeroClipboard.setData = function (format, data) {\n  var dataObj;\n  if (typeof format === \"object\" && format && typeof data === \"undefined\") {\n    dataObj = format;\n    ZeroClipboard.clearData();\n  } else if (typeof format === \"string\" && format) {\n    dataObj = {};\n    dataObj[format] = data;\n  } else {\n    return;\n  }\n  for (var dataFormat in dataObj) {\n    if (dataFormat && dataObj.hasOwnProperty(dataFormat) && typeof dataObj[dataFormat] === \"string\" && dataObj[dataFormat]) {\n      _clipData[dataFormat] = dataObj[dataFormat];\n    }\n  }\n};\nZeroClipboard.clearData = function (format) {\n  if (typeof format === \"undefined\") {\n    _deleteOwnProperties(_clipData);\n    _clipDataFormatMap = null;\n  } else if (typeof format === \"string\" && _clipData.hasOwnProperty(format)) {\n    delete _clipData[format];\n  }\n};\nvar _bridge = function () {\n  var flashBridge, len;\n  var container = document.getElementById(\"global-zeroclipboard-html-bridge\");\n  if (!container) {\n    var allowScriptAccess = _determineScriptAccess(location.host, _globalConfig);\n    var allowNetworking = allowScriptAccess === \"never\" ? \"none\" : \"all\";\n    var flashvars = _vars(_globalConfig);\n    var swfUrl = _globalConfig.swfPath + _cacheBust(_globalConfig.swfPath, _globalConfig);\n    container = _createHtmlBridge();\n    var divToBeReplaced = document.createElement(\"div\");\n    container.appendChild(divToBeReplaced);\n    document.body.appendChild(container);\n    var tmpDiv = document.createElement(\"div\");\n    var oldIE = _flashState.pluginType === \"activex\";\n    tmpDiv.innerHTML = '<object id=\"global-zeroclipboard-flash-bridge\" name=\"global-zeroclipboard-flash-bridge\" ' + 'width=\"100%\" height=\"100%\" ' + (oldIE ? 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\"' : 'type=\"application/x-shockwave-flash\" data=\"' + swfUrl + '\"') + \">\" + (oldIE ? '<param name=\"movie\" value=\"' + swfUrl + '\"/>' : \"\") + '<param name=\"allowScriptAccess\" value=\"' + allowScriptAccess + '\"/>' + '<param name=\"allowNetworking\" value=\"' + allowNetworking + '\"/>' + '<param name=\"menu\" value=\"false\"/>' + '<param name=\"wmode\" value=\"transparent\"/>' + '<param name=\"flashvars\" value=\"' + flashvars + '\"/>' + \"</object>\";\n    flashBridge = tmpDiv.firstChild;\n    tmpDiv = null;\n    flashBridge.ZeroClipboard = ZeroClipboard;\n    container.replaceChild(flashBridge, divToBeReplaced);\n  }\n  if (!flashBridge) {\n    flashBridge = document[\"global-zeroclipboard-flash-bridge\"];\n    if (flashBridge && (len = flashBridge.length)) {\n      flashBridge = flashBridge[len - 1];\n    }\n    if (!flashBridge) {\n      flashBridge = container.firstChild;\n    }\n  }\n  _flashState.bridge = flashBridge || null;\n};\nvar _createHtmlBridge = function () {\n  var container = document.createElement(\"div\");\n  container.id = \"global-zeroclipboard-html-bridge\";\n  container.className = \"global-zeroclipboard-container\";\n  container.style.position = \"absolute\";\n  container.style.left = \"0px\";\n  container.style.top = \"-9999px\";\n  container.style.width = \"1px\";\n  container.style.height = \"1px\";\n  container.style.zIndex = \"\" + _getSafeZIndex(_globalConfig.zIndex);\n  return container;\n};\nvar _getHtmlBridge = function (flashBridge) {\n  var htmlBridge = flashBridge && flashBridge.parentNode;\n  while (htmlBridge && htmlBridge.nodeName === \"OBJECT\" && htmlBridge.parentNode) {\n    htmlBridge = htmlBridge.parentNode;\n  }\n  return htmlBridge || null;\n};\nvar _reposition = function () {\n  if (_currentElement) {\n    var pos = _getDOMObjectPosition(_currentElement, _globalConfig.zIndex);\n    var htmlBridge = _getHtmlBridge(_flashState.bridge);\n    if (htmlBridge) {\n      htmlBridge.style.top = pos.top + \"px\";\n      htmlBridge.style.left = pos.left + \"px\";\n      htmlBridge.style.width = pos.width + \"px\";\n      htmlBridge.style.height = pos.height + \"px\";\n      htmlBridge.style.zIndex = pos.zIndex + 1;\n    }\n    _setSize(pos.width, pos.height);\n  }\n};\nvar _setSize = function (width, height) {\n  var htmlBridge = _getHtmlBridge(_flashState.bridge);\n  if (htmlBridge) {\n    htmlBridge.style.width = width + \"px\";\n    htmlBridge.style.height = height + \"px\";\n  }\n};\nZeroClipboard.emit = function (event) {\n  var eventType, eventObj, performCallbackAsync, clients, i, len, eventCopy, returnVal, tmp;\n  if (typeof event === \"string\" && event) {\n    eventType = event;\n  }\n  if (typeof event === \"object\" && event && typeof event.type === \"string\" && event.type) {\n    eventType = event.type;\n    eventObj = event;\n  }\n  if (!eventType) {\n    return;\n  }\n  event = _createEvent(eventType, eventObj);\n  _preprocessEvent(event);\n  if (event.type === \"ready\" && _flashState.overdue === true) {\n    return ZeroClipboard.emit({\n      type: \"error\",\n      name: \"flash-overdue\"\n    });\n  }\n  performCallbackAsync = !/^(before)?copy$/.test(event.type);\n  if (event.client) {\n    _dispatchClientCallbacks.call(event.client, event, performCallbackAsync);\n  } else {\n    clients = event.target && event.target !== window && _globalConfig.autoActivate === true ? _getAllClientsClippedToElement(event.target) : _getAllClients();\n    for (i = 0, len = clients.length; i < len; i++) {\n      eventCopy = _extend({}, event, {\n        client: clients[i]\n      });\n      _dispatchClientCallbacks.call(clients[i], eventCopy, performCallbackAsync);\n    }\n  }\n  if (event.type === \"copy\") {\n    tmp = _mapClipDataToFlash(_clipData);\n    returnVal = tmp.data;\n    _clipDataFormatMap = tmp.formatMap;\n  }\n  return returnVal;\n};\nvar _dispatchClientCallbacks = function (event, async) {\n  var handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers[event.type];\n  if (handlers && handlers.length) {\n    var i, len, func, context, originalContext = this;\n    for (i = 0, len = handlers.length; i < len; i++) {\n      func = handlers[i];\n      context = originalContext;\n      if (typeof func === \"string\" && typeof window[func] === \"function\") {\n        func = window[func];\n      }\n      if (typeof func === \"object\" && func && typeof func.handleEvent === \"function\") {\n        context = func;\n        func = func.handleEvent;\n      }\n      if (typeof func === \"function\") {\n        _dispatchCallback(func, context, [event], async);\n      }\n    }\n  }\n  return this;\n};\nvar _eventMessages = {\n  ready: \"Flash communication is established\",\n  error: {\n    \"flash-disabled\": \"Flash is disabled or not installed\",\n    \"flash-outdated\": \"Flash is too outdated to support ZeroClipboard\",\n    \"flash-unavailable\": \"Flash is unable to communicate bidirectionally with JavaScript\",\n    \"flash-deactivated\": \"Flash is too outdated for your browser and/or is configured as click-to-activate\",\n    \"flash-overdue\": \"Flash communication was established but NOT within the acceptable time limit\"\n  }\n};\nvar _createEvent = function (eventType, event) {\n  if (!(eventType || event && event.type)) {\n    return;\n  }\n  event = event || {};\n  eventType = (eventType || event.type).toLowerCase();\n  _extend(event, {\n    type: eventType,\n    target: event.target || _currentElement || null,\n    relatedTarget: event.relatedTarget || null,\n    currentTarget: _flashState && _flashState.bridge || null\n  });\n  var msg = _eventMessages[event.type];\n  if (event.type === \"error\" && event.name && msg) {\n    msg = msg[event.name];\n  }\n  if (msg) {\n    event.message = msg;\n  }\n  if (event.type === \"ready\") {\n    _extend(event, {\n      target: null,\n      version: _flashState.version\n    });\n  }\n  if (event.type === \"error\") {\n    event.target = null;\n    if (/^flash-(outdated|unavailable|deactivated|overdue)$/.test(event.name)) {\n      _extend(event, {\n        version: _flashState.version,\n        minimumVersion: \"11.0.0\"\n      });\n    }\n  }\n  if (event.type === \"copy\") {\n    event.clipboardData = {\n      setData: ZeroClipboard.setData,\n      clearData: ZeroClipboard.clearData\n    };\n  }\n  if (event.type === \"aftercopy\") {\n    event = _mapClipResultsFromFlash(event, _clipDataFormatMap);\n  }\n  if (event.target && !event.relatedTarget) {\n    event.relatedTarget = _getRelatedTarget(event.target);\n  }\n  return event;\n};\nvar _getRelatedTarget = function (targetEl) {\n  var relatedTargetId = targetEl && targetEl.getAttribute && targetEl.getAttribute(\"data-clipboard-target\");\n  return relatedTargetId ? document.getElementById(relatedTargetId) : null;\n};\nvar _preprocessEvent = function (event) {\n  var element = event.target || _currentElement;\n  switch (event.type) {\n    case \"error\":\n      if (_inArray(event.name, [\"flash-disabled\", \"flash-outdated\", \"flash-deactivated\", \"flash-overdue\"])) {\n        _extend(_flashState, {\n          disabled: event.name === \"flash-disabled\",\n          outdated: event.name === \"flash-outdated\",\n          unavailable: event.name === \"flash-unavailable\",\n          deactivated: event.name === \"flash-deactivated\",\n          overdue: event.name === \"flash-overdue\",\n          ready: false\n        });\n      }\n      break;\n\n    case \"ready\":\n      var wasDeactivated = _flashState.deactivated === true;\n      _extend(_flashState, {\n        disabled: false,\n        outdated: false,\n        unavailable: false,\n        deactivated: false,\n        overdue: wasDeactivated,\n        ready: !wasDeactivated\n      });\n      break;\n\n    case \"copy\":\n      var textContent, htmlContent, targetEl = event.relatedTarget;\n      if (!(_clipData[\"text/html\"] || _clipData[\"text/plain\"]) && targetEl && (htmlContent = targetEl.value || targetEl.outerHTML || targetEl.innerHTML) && (textContent = targetEl.value || targetEl.textContent || targetEl.innerText)) {\n        event.clipboardData.clearData();\n        event.clipboardData.setData(\"text/plain\", textContent);\n        if (htmlContent !== textContent) {\n          event.clipboardData.setData(\"text/html\", htmlContent);\n        }\n      } else if (!_clipData[\"text/plain\"] && event.target && (textContent = event.target.getAttribute(\"data-clipboard-text\"))) {\n        event.clipboardData.clearData();\n        event.clipboardData.setData(\"text/plain\", textContent);\n      }\n      break;\n\n    case \"aftercopy\":\n      ZeroClipboard.clearData();\n      if (element && element !== _safeActiveElement() && element.focus) {\n        element.focus();\n      }\n      break;\n\n    case \"mouseover\":\n      _addClass(element, _globalConfig.hoverClass);\n      break;\n\n    case \"mouseout\":\n      if (_globalConfig.autoActivate === true) {\n        ZeroClipboard.deactivate();\n      }\n      break;\n\n    case \"mousedown\":\n      _addClass(element, _globalConfig.activeClass);\n      break;\n\n    case \"mouseup\":\n      _removeClass(element, _globalConfig.activeClass);\n      break;\n  }\n};\nZeroClipboard.prototype.on = function (eventName, func) {\n  var i, len, events, added = {}, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n  if (typeof eventName === \"string\" && eventName) {\n    events = eventName.toLowerCase().split(/\\s+/);\n  } else if (typeof eventName === \"object\" && eventName && typeof func === \"undefined\") {\n    for (i in eventName) {\n      if (eventName.hasOwnProperty(i) && typeof i === \"string\" && i && typeof eventName[i] === \"function\") {\n        this.on(i, eventName[i]);\n      }\n    }\n  }\n  if (events && events.length) {\n    for (i = 0, len = events.length; i < len; i++) {\n      eventName = events[i].replace(/^on/, \"\");\n      added[eventName] = true;\n      if (!handlers[eventName]) {\n        handlers[eventName] = [];\n      }\n      handlers[eventName].push(func);\n    }\n    if (added.ready && _flashState.ready) {\n      ZeroClipboard.emit({\n        type: \"ready\",\n        client: this\n      });\n    }\n    if (added.error) {\n      var errorTypes = [\"disabled\", \"outdated\", \"unavailable\", \"deactivated\", \"overdue\"];\n      for (i = 0, len = errorTypes.length; i < len; i++) {\n        if (_flashState[errorTypes[i]]) {\n          ZeroClipboard.emit({\n            type: \"error\",\n            name: \"flash-\" + errorTypes[i],\n            client: this\n          });\n          break;\n        }\n      }\n    }\n  }\n  return this;\n};\nZeroClipboard.prototype.off = function (eventName, func) {\n  var i, len, foundIndex, events, perEventHandlers, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n  if (arguments.length === 0) {\n    events = _objectKeys(handlers);\n  } else if (typeof eventName === \"string\" && eventName) {\n    events = eventName.split(/\\s+/);\n  } else if (typeof eventName === \"object\" && eventName && typeof func === \"undefined\") {\n    for (i in eventName) {\n      if (eventName.hasOwnProperty(i) && typeof i === \"string\" && i && typeof eventName[i] === \"function\") {\n        this.off(i, eventName[i]);\n      }\n    }\n  }\n  if (events && events.length) {\n    for (i = 0, len = events.length; i < len; i++) {\n      eventName = events[i].toLowerCase().replace(/^on/, \"\");\n      perEventHandlers = handlers[eventName];\n      if (perEventHandlers && perEventHandlers.length) {\n        if (func) {\n          foundIndex = _inArray(func, perEventHandlers);\n          while (foundIndex !== -1) {\n            perEventHandlers.splice(foundIndex, 1);\n            foundIndex = _inArray(func, perEventHandlers, foundIndex);\n          }\n        } else {\n          handlers[eventName].length = 0;\n        }\n      }\n    }\n  }\n  return this;\n};\nZeroClipboard.prototype.handlers = function (eventName) {\n  var prop, copy = null, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n  if (handlers) {\n    if (typeof eventName === \"string\" && eventName) {\n      return handlers[eventName] ? handlers[eventName].slice(0) : null;\n    }\n    copy = {};\n    for (prop in handlers) {\n      if (handlers.hasOwnProperty(prop) && handlers[prop]) {\n        copy[prop] = handlers[prop].slice(0);\n      }\n    }\n  }\n  return copy;\n};\nZeroClipboard.prototype.clip = function (elements) {\n  elements = _prepClip(elements);\n  for (var i = 0; i < elements.length; i++) {\n    if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {\n      if (!elements[i].zcClippingId) {\n        elements[i].zcClippingId = \"zcClippingId_\" + _elementIdCounter++;\n        _elementMeta[elements[i].zcClippingId] = [this.id];\n        if (_globalConfig.autoActivate === true) {\n          _addEventHandler(elements[i], \"mouseover\", _elementMouseOver);\n        }\n      } else if (_inArray(this.id, _elementMeta[elements[i].zcClippingId]) === -1) {\n        _elementMeta[elements[i].zcClippingId].push(this.id);\n      }\n      var clippedElements = _clientMeta[this.id].elements;\n      if (_inArray(elements[i], clippedElements) === -1) {\n        clippedElements.push(elements[i]);\n      }\n    }\n  }\n  return this;\n};\nZeroClipboard.prototype.unclip = function (elements) {\n  var meta = _clientMeta[this.id];\n  if (!meta) {\n    return this;\n  }\n  var clippedElements = meta.elements;\n  var arrayIndex;\n  if (typeof elements === \"undefined\") {\n    elements = clippedElements.slice(0);\n  } else {\n    elements = _prepClip(elements);\n  }\n  for (var i = elements.length; i--;) {\n    if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {\n      arrayIndex = 0;\n      while ((arrayIndex = _inArray(elements[i], clippedElements, arrayIndex)) !== -1) {\n        clippedElements.splice(arrayIndex, 1);\n      }\n      var clientIds = _elementMeta[elements[i].zcClippingId];\n      if (clientIds) {\n        arrayIndex = 0;\n        while ((arrayIndex = _inArray(this.id, clientIds, arrayIndex)) !== -1) {\n          clientIds.splice(arrayIndex, 1);\n        }\n        if (clientIds.length === 0) {\n          if (_globalConfig.autoActivate === true) {\n            _removeEventHandler(elements[i], \"mouseover\", _elementMouseOver);\n          }\n          delete elements[i].zcClippingId;\n        }\n      }\n    }\n  }\n  return this;\n};\nZeroClipboard.prototype.elements = function () {\n  var meta = _clientMeta[this.id];\n  return meta && meta.elements ? meta.elements.slice(0) : [];\n};\nvar _getAllClientsClippedToElement = function (element) {\n  var elementMetaId, clientIds, i, len, client, clients = [];\n  if (element && element.nodeType === 1 && (elementMetaId = element.zcClippingId) && _elementMeta.hasOwnProperty(elementMetaId)) {\n    clientIds = _elementMeta[elementMetaId];\n    if (clientIds && clientIds.length) {\n      for (i = 0, len = clientIds.length; i < len; i++) {\n        client = _clientMeta[clientIds[i]].instance;\n        if (client && client instanceof ZeroClipboard) {\n          clients.push(client);\n        }\n      }\n    }\n  }\n  return clients;\n};\n_globalConfig.hoverClass = \"zeroclipboard-is-hover\";\n_globalConfig.activeClass = \"zeroclipboard-is-active\";\nwindow.ZeroClipboard = ZeroClipboard;","/*!\r\n * UEditor\r\n * version: ueditor\r\n * build: Wed Aug 10 2016 11:06:16 GMT+0800 (CST)\r\n */\r\nimport './themes/default/css/ueditor.css';\r\nimport './third-party/zeroclipboard/ZeroClipboard';\r\nimport iframeStyleSrc from './themes/iframe.css?asFile'\r\n\r\n    // editor.js\r\n    UEDITOR_CONFIG = window.UEDITOR_CONFIG || {};\r\n\r\n    var baidu = window.baidu || {};\r\n\r\n    window.baidu = baidu;\r\n\r\n    window.UE = baidu.editor = window.UE || {};\r\n\r\n    UE.plugins = {};\r\n\r\n    UE.commands = {};\r\n\r\n    UE.instants = {};\r\n\r\n    UE.I18N = {};\r\n\r\n    UE._customizeUI = {};\r\n\r\n    UE.version = \"1.4.3\";\r\n\r\n    var dom = UE.dom = {};\r\n\r\n    // core/browser.js\r\n    /**\r\n     * 浏览器判断模块\r\n     * @file\r\n     * @module UE.browser\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 提供浏览器检测的模块\r\n     * @unfile\r\n     * @module UE.browser\r\n     */\r\n    var browser = UE.browser = function () {\r\n        // console.log(9999999999999,UE,9999999);\r\n        var agent = navigator.userAgent.toLowerCase(),\r\n            opera = window.opera,\r\n            browser = {\r\n                /**\r\n                 * @property {boolean} ie 检测当前浏览器是否为IE\r\n                 * @example\r\n                 * ```javascript\r\n                 * if ( UE.browser.ie ) {\r\n                 *     console.log( '当前浏览器是IE' );\r\n                 * }\r\n                 * ```\r\n                 */\r\n                ie: /(msie\\s|trident.*rv:)([\\w.]+)/.test(agent),\r\n\r\n                /**\r\n                 * @property {boolean} opera 检测当前浏览器是否为Opera\r\n                 * @example\r\n                 * ```javascript\r\n                 * if ( UE.browser.opera ) {\r\n                 *     console.log( '当前浏览器是Opera' );\r\n                 * }\r\n                 * ```\r\n                 */\r\n                opera: (!!opera && opera.version),\r\n\r\n                /**\r\n                 * @property {boolean} webkit 检测当前浏览器是否是webkit内核的浏览器\r\n                 * @example\r\n                 * ```javascript\r\n                 * if ( UE.browser.webkit ) {\r\n                 *     console.log( '当前浏览器是webkit内核浏览器' );\r\n                 * }\r\n                 * ```\r\n                 */\r\n                webkit: (agent.indexOf(' applewebkit/') > -1),\r\n\r\n                /**\r\n                 * @property {boolean} mac 检测当前浏览器是否是运行在mac平台下\r\n                 * @example\r\n                 * ```javascript\r\n                 * if ( UE.browser.mac ) {\r\n                 *     console.log( '当前浏览器运行在mac平台下' );\r\n                 * }\r\n                 * ```\r\n                 */\r\n                mac: (agent.indexOf('macintosh') > -1),\r\n\r\n                /**\r\n                 * @property {boolean} quirks 检测当前浏览器是否处于“怪异模式”下\r\n                 * @example\r\n                 * ```javascript\r\n                 * if ( UE.browser.quirks ) {\r\n                 *     console.log( '当前浏览器运行处于“怪异模式”' );\r\n                 * }\r\n                 * ```\r\n                 */\r\n                quirks: (document.compatMode == 'BackCompat')\r\n            };\r\n\r\n        /**\r\n        * @property {boolean} gecko 检测当前浏览器内核是否是gecko内核\r\n        * @example\r\n        * ```javascript\r\n        * if ( UE.browser.gecko ) {\r\n        *     console.log( '当前浏览器内核是gecko内核' );\r\n        * }\r\n        * ```\r\n        */\r\n        browser.gecko = (navigator.product == 'Gecko' && !browser.webkit && !browser.opera && !browser.ie);\r\n\r\n        var version = 0;\r\n\r\n        // Internet Explorer 6.0+\r\n        if (browser.ie) {\r\n\r\n            var v1 = agent.match(/(?:msie\\s([\\w.]+))/);\r\n            var v2 = agent.match(/(?:trident.*rv:([\\w.]+))/);\r\n            if (v1 && v2 && v1[1] && v2[1]) {\r\n                version = Math.max(v1[1] * 1, v2[1] * 1);\r\n            } else if (v1 && v1[1]) {\r\n                version = v1[1] * 1;\r\n            } else if (v2 && v2[1]) {\r\n                version = v2[1] * 1;\r\n            } else {\r\n                version = 0;\r\n            }\r\n\r\n            browser.ie11Compat = document.documentMode == 11;\r\n            /**\r\n             * @property { boolean } ie9Compat 检测浏览器模式是否为 IE9 兼容模式\r\n             * @warning 如果浏览器不是IE， 则该值为undefined\r\n             * @example\r\n             * ```javascript\r\n             * if ( UE.browser.ie9Compat ) {\r\n             *     console.log( '当前浏览器运行在IE9兼容模式下' );\r\n             * }\r\n             * ```\r\n             */\r\n            browser.ie9Compat = document.documentMode == 9;\r\n\r\n            /**\r\n             * @property { boolean } ie8 检测浏览器是否是IE8浏览器\r\n             * @warning 如果浏览器不是IE， 则该值为undefined\r\n             * @example\r\n             * ```javascript\r\n             * if ( UE.browser.ie8 ) {\r\n             *     console.log( '当前浏览器是IE8浏览器' );\r\n             * }\r\n             * ```\r\n             */\r\n            browser.ie8 = !!document.documentMode;\r\n\r\n            /**\r\n             * @property { boolean } ie8Compat 检测浏览器模式是否为 IE8 兼容模式\r\n             * @warning 如果浏览器不是IE， 则该值为undefined\r\n             * @example\r\n             * ```javascript\r\n             * if ( UE.browser.ie8Compat ) {\r\n             *     console.log( '当前浏览器运行在IE8兼容模式下' );\r\n             * }\r\n             * ```\r\n             */\r\n            browser.ie8Compat = document.documentMode == 8;\r\n\r\n            /**\r\n             * @property { boolean } ie7Compat 检测浏览器模式是否为 IE7 兼容模式\r\n             * @warning 如果浏览器不是IE， 则该值为undefined\r\n             * @example\r\n             * ```javascript\r\n             * if ( UE.browser.ie7Compat ) {\r\n             *     console.log( '当前浏览器运行在IE7兼容模式下' );\r\n             * }\r\n             * ```\r\n             */\r\n            browser.ie7Compat = ((version == 7 && !document.documentMode)\r\n                || document.documentMode == 7);\r\n\r\n            /**\r\n             * @property { boolean } ie6Compat 检测浏览器模式是否为 IE6 模式 或者怪异模式\r\n             * @warning 如果浏览器不是IE， 则该值为undefined\r\n             * @example\r\n             * ```javascript\r\n             * if ( UE.browser.ie6Compat ) {\r\n             *     console.log( '当前浏览器运行在IE6模式或者怪异模式下' );\r\n             * }\r\n             * ```\r\n             */\r\n            browser.ie6Compat = (version < 7 || browser.quirks);\r\n\r\n            browser.ie9above = version > 8;\r\n\r\n            browser.ie9below = version < 9;\r\n\r\n            browser.ie11above = version > 10;\r\n\r\n            browser.ie11below = version < 11;\r\n\r\n        }\r\n\r\n        // Gecko.\r\n        if (browser.gecko) {\r\n            var geckoRelease = agent.match(/rv:([\\d\\.]+)/);\r\n            if (geckoRelease) {\r\n                geckoRelease = geckoRelease[1].split('.');\r\n                version = geckoRelease[0] * 10000 + (geckoRelease[1] || 0) * 100 + (geckoRelease[2] || 0) * 1;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * @property { Number } chrome 检测当前浏览器是否为Chrome, 如果是，则返回Chrome的大版本号\r\n         * @warning 如果浏览器不是chrome， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.chrome ) {\r\n         *     console.log( '当前浏览器是Chrome' );\r\n         * }\r\n         * ```\r\n         */\r\n        if (/chrome\\/(\\d+\\.\\d)/i.test(agent)) {\r\n            browser.chrome = + RegExp['\\x241'];\r\n        }\r\n\r\n        /**\r\n         * @property { Number } safari 检测当前浏览器是否为Safari, 如果是，则返回Safari的大版本号\r\n         * @warning 如果浏览器不是safari， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.safari ) {\r\n         *     console.log( '当前浏览器是Safari' );\r\n         * }\r\n         * ```\r\n         */\r\n        if (/(\\d+\\.\\d)?(?:\\.\\d)?\\s+safari\\/?(\\d+\\.\\d+)?/i.test(agent) && !/chrome/i.test(agent)) {\r\n            browser.safari = + (RegExp['\\x241'] || RegExp['\\x242']);\r\n        }\r\n\r\n\r\n        // Opera 9.50+\r\n        if (browser.opera)\r\n            version = parseFloat(opera.version());\r\n\r\n        // WebKit 522+ (Safari 3+)\r\n        if (browser.webkit)\r\n            version = parseFloat(agent.match(/ applewebkit\\/(\\d+)/)[1]);\r\n\r\n        /**\r\n         * @property { Number } version 检测当前浏览器版本号\r\n         * @remind\r\n         * <ul>\r\n         *     <li>IE系列返回值为5,6,7,8,9,10等</li>\r\n         *     <li>gecko系列会返回10900，158900等</li>\r\n         *     <li>webkit系列会返回其build号 (如 522等)</li>\r\n         * </ul>\r\n         * @example\r\n         * ```javascript\r\n         * console.log( '当前浏览器版本号是： ' + UE.browser.version );\r\n         * ```\r\n         */\r\n        browser.version = version;\r\n\r\n        /**\r\n         * @property { boolean } isCompatible 检测当前浏览器是否能够与UEditor良好兼容\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.isCompatible ) {\r\n         *     console.log( '浏览器与UEditor能够良好兼容' );\r\n         * }\r\n         * ```\r\n         */\r\n        browser.isCompatible =\r\n            !browser.mobile && (\r\n                (browser.ie && version >= 6) ||\r\n                (browser.gecko && version >= 10801) ||\r\n                (browser.opera && version >= 9.5) ||\r\n                (browser.air && version >= 1) ||\r\n                (browser.webkit && version >= 522) ||\r\n                false);\r\n        return browser;\r\n    }();\r\n    //快捷方式\r\n    var ie = browser.ie,\r\n        webkit = browser.webkit,\r\n        gecko = browser.gecko,\r\n        opera = browser.opera;\r\n\r\n    // core/utils.js\r\n    /**\r\n     * 工具函数包\r\n     * @file\r\n     * @module UE.utils\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * UEditor封装使用的静态工具函数\r\n     * @module UE.utils\r\n     * @unfile\r\n     */\r\n\r\n    var utils = UE.utils = {\r\n\r\n        /**\r\n         * 用给定的迭代器遍历对象\r\n         * @method each\r\n         * @param { Object } obj 需要遍历的对象\r\n         * @param { Function } iterator 迭代器， 该方法接受两个参数， 第一个参数是当前所处理的value， 第二个参数是当前遍历对象的key\r\n         * @example\r\n         * ```javascript\r\n         * var demoObj = {\r\n         *     key1: 1,\r\n         *     key2: 2\r\n         * };\r\n         *\r\n         * //output: key1: 1, key2: 2\r\n         * UE.utils.each( demoObj, funciton ( value, key ) {\r\n         *\r\n         *     console.log( key + \":\" + value );\r\n         *\r\n         * } );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 用给定的迭代器遍历数组或类数组对象\r\n         * @method each\r\n         * @param { Array } array 需要遍历的数组或者类数组\r\n         * @param { Function } iterator 迭代器， 该方法接受两个参数， 第一个参数是当前所处理的value， 第二个参数是当前遍历对象的key\r\n         * @example\r\n         * ```javascript\r\n         * var divs = document.getElmentByTagNames( \"div\" );\r\n         *\r\n         * //output: 0: DIV, 1: DIV ...\r\n         * UE.utils.each( divs, funciton ( value, key ) {\r\n         *\r\n         *     console.log( key + \":\" + value.tagName );\r\n         *\r\n         * } );\r\n         * ```\r\n         */\r\n        each: function (obj, iterator, context) {\r\n            if (obj == null) return;\r\n            if (obj.length === +obj.length) {\r\n                for (var i = 0, l = obj.length; i < l; i++) {\r\n                    if (iterator.call(context, obj[i], i, obj) === false)\r\n                        return false;\r\n                }\r\n            } else {\r\n                for (var key in obj) {\r\n                    if (obj.hasOwnProperty(key)) {\r\n                        if (iterator.call(context, obj[key], key, obj) === false)\r\n                            return false;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 以给定对象作为原型创建一个新对象\r\n         * @method makeInstance\r\n         * @param { Object } protoObject 该对象将作为新创建对象的原型\r\n         * @return { Object } 新的对象， 该对象的原型是给定的protoObject对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var protoObject = { sayHello: function () { console.log('Hello UEditor!'); } };\r\n         *\r\n         * var newObject = UE.utils.makeInstance( protoObject );\r\n         * //output: Hello UEditor!\r\n         * newObject.sayHello();\r\n         * ```\r\n         */\r\n        makeInstance: function (obj) {\r\n            var noop = new Function();\r\n            noop.prototype = obj;\r\n            obj = new noop;\r\n            noop.prototype = null;\r\n            return obj;\r\n        },\r\n\r\n        /**\r\n         * 将source对象中的属性扩展到target对象上\r\n         * @method extend\r\n         * @remind 该方法将强制把source对象上的属性复制到target对象上\r\n         * @see UE.utils.extend(Object,Object,Boolean)\r\n         * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n         * @param { Object } source 源对象， 该对象的属性会被附加到target对象上\r\n         * @return { Object } 返回target对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var target = { name: 'target', sex: 1 },\r\n         *      source = { name: 'source', age: 17 };\r\n         *\r\n         * UE.utils.extend( target, source );\r\n         *\r\n         * //output: { name: 'source', sex: 1, age: 17 }\r\n         * console.log( target );\r\n         *\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 将source对象中的属性扩展到target对象上， 根据指定的isKeepTarget值决定是否保留目标对象中与\r\n         * 源对象属性名相同的属性值。\r\n         * @method extend\r\n         * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n         * @param { Object } source 源对象， 该对象的属性会被附加到target对象上\r\n         * @param { Boolean } isKeepTarget 是否保留目标对象中与源对象中属性名相同的属性\r\n         * @return { Object } 返回target对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var target = { name: 'target', sex: 1 },\r\n         *      source = { name: 'source', age: 17 };\r\n         *\r\n         * UE.utils.extend( target, source, true );\r\n         *\r\n         * //output: { name: 'target', sex: 1, age: 17 }\r\n         * console.log( target );\r\n         *\r\n         * ```\r\n         */\r\n        extend: function (t, s, b) {\r\n            if (s) {\r\n                for (var k in s) {\r\n                    if (!b || !t.hasOwnProperty(k)) {\r\n                        t[k] = s[k];\r\n                    }\r\n                }\r\n            }\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * 将给定的多个对象的属性复制到目标对象target上\r\n         * @method extend2\r\n         * @remind 该方法将强制把源对象上的属性复制到target对象上\r\n         * @remind 该方法支持两个及以上的参数， 从第二个参数开始， 其属性都会被复制到第一个参数上。 如果遇到同名的属性，\r\n         *          将会覆盖掉之前的值。\r\n         * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n         * @param { Object... } source 源对象， 支持多个对象， 该对象的属性会被附加到target对象上\r\n         * @return { Object } 返回target对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var target = {},\r\n         *     source1 = { name: 'source', age: 17 },\r\n         *     source2 = { title: 'dev' };\r\n         *\r\n         * UE.utils.extend2( target, source1, source2 );\r\n         *\r\n         * //output: { name: 'source', age: 17, title: 'dev' }\r\n         * console.log( target );\r\n         *\r\n         * ```\r\n         */\r\n        extend2: function (t) {\r\n            var a = arguments;\r\n            for (var i = 1; i < a.length; i++) {\r\n                var x = a[i];\r\n                for (var k in x) {\r\n                    if (!t.hasOwnProperty(k)) {\r\n                        t[k] = x[k];\r\n                    }\r\n                }\r\n            }\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * 模拟继承机制， 使得subClass继承自superClass\r\n         * @method inherits\r\n         * @param { Object } subClass 子类对象\r\n         * @param { Object } superClass 超类对象\r\n         * @warning 该方法只能让subClass继承超类的原型， subClass对象自身的属性和方法不会被继承\r\n         * @return { Object } 继承superClass后的子类对象\r\n         * @example\r\n         * ```javascript\r\n         * function SuperClass(){\r\n         *     this.name = \"小李\";\r\n         * }\r\n         *\r\n         * SuperClass.prototype = {\r\n         *     hello:function(str){\r\n         *         console.log(this.name + str);\r\n         *     }\r\n         * }\r\n         *\r\n         * function SubClass(){\r\n         *     this.name = \"小张\";\r\n         * }\r\n         *\r\n         * UE.utils.inherits(SubClass,SuperClass);\r\n         *\r\n         * var sub = new SubClass();\r\n         * //output: '小张早上好!\r\n         * sub.hello(\"早上好!\");\r\n         * ```\r\n         */\r\n        inherits: function (subClass, superClass) {\r\n            var oldP = subClass.prototype,\r\n                newP = utils.makeInstance(superClass.prototype);\r\n            utils.extend(newP, oldP, true);\r\n            subClass.prototype = newP;\r\n            return (newP.constructor = subClass);\r\n        },\r\n\r\n        /**\r\n         * 用指定的context对象作为函数fn的上下文\r\n         * @method bind\r\n         * @param { Function } fn 需要绑定上下文的函数对象\r\n         * @param { Object } content 函数fn新的上下文对象\r\n         * @return { Function } 一个新的函数， 该函数作为原始函数fn的代理， 将完成fn的上下文调换工作。\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var name = 'window',\r\n         *     newTest = null;\r\n         *\r\n         * function test () {\r\n         *     console.log( this.name );\r\n         * }\r\n         *\r\n         * newTest = UE.utils.bind( test, { name: 'object' } );\r\n         *\r\n         * //output: object\r\n         * newTest();\r\n         *\r\n         * //output: window\r\n         * test();\r\n         *\r\n         * ```\r\n         */\r\n        bind: function (fn, context) {\r\n            return function () {\r\n                return fn.apply(context, arguments);\r\n            };\r\n        },\r\n\r\n        /**\r\n         * 创建延迟指定时间后执行的函数fn\r\n         * @method defer\r\n         * @param { Function } fn 需要延迟执行的函数对象\r\n         * @param { int } delay 延迟的时间， 单位是毫秒\r\n         * @warning 该方法的时间控制是不精确的，仅仅只能保证函数的执行是在给定的时间之后，\r\n         *           而不能保证刚好到达延迟时间时执行。\r\n         * @return { Function } 目标函数fn的代理函数， 只有执行该函数才能起到延时效果\r\n         * @example\r\n         * ```javascript\r\n         * var start = 0;\r\n         *\r\n         * function test(){\r\n         *     console.log( new Date() - start );\r\n         * }\r\n         *\r\n         * var testDefer = UE.utils.defer( test, 1000 );\r\n         * //\r\n         * start = new Date();\r\n         * //output: (大约在1000毫秒之后输出) 1000\r\n         * testDefer();\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 创建延迟指定时间后执行的函数fn, 如果在延迟时间内再次执行该方法， 将会根据指定的exclusion的值，\r\n         * 决定是否取消前一次函数的执行， 如果exclusion的值为true， 则取消执行，反之，将继续执行前一个方法。\r\n         * @method defer\r\n         * @param { Function } fn 需要延迟执行的函数对象\r\n         * @param { int } delay 延迟的时间， 单位是毫秒\r\n         * @param { Boolean } exclusion 如果在延迟时间内再次执行该函数，该值将决定是否取消执行前一次函数的执行，\r\n         *                     值为true表示取消执行， 反之则将在执行前一次函数之后才执行本次函数调用。\r\n         * @warning 该方法的时间控制是不精确的，仅仅只能保证函数的执行是在给定的时间之后，\r\n         *           而不能保证刚好到达延迟时间时执行。\r\n         * @return { Function } 目标函数fn的代理函数， 只有执行该函数才能起到延时效果\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * function test(){\r\n         *     console.log(1);\r\n         * }\r\n         *\r\n         * var testDefer = UE.utils.defer( test, 1000, true );\r\n         *\r\n         * //output: (两次调用仅有一次输出) 1\r\n         * testDefer();\r\n         * testDefer();\r\n         * ```\r\n         */\r\n        defer: function (fn, delay, exclusion) {\r\n            var timerID;\r\n            return function () {\r\n                if (exclusion) {\r\n                    clearTimeout(timerID);\r\n                }\r\n                timerID = setTimeout(fn, delay);\r\n            };\r\n        },\r\n\r\n        /**\r\n         * 获取元素item在数组array中首次出现的位置, 如果未找到item， 则返回-1\r\n         * @method indexOf\r\n         * @remind 该方法的匹配过程使用的是恒等“===”\r\n         * @param { Array } array 需要查找的数组对象\r\n         * @param { * } item 需要在目标数组中查找的值\r\n         * @return { int } 返回item在目标数组array中首次出现的位置， 如果在数组中未找到item， 则返回-1\r\n         * @example\r\n         * ```javascript\r\n         * var item = 1,\r\n         *     arr = [ 3, 4, 6, 8, 1, 1, 2 ];\r\n         *\r\n         * //output: 4\r\n         * console.log( UE.utils.indexOf( arr, item ) );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 获取元素item数组array中首次出现的位置, 如果未找到item， 则返回-1。通过start的值可以指定搜索的起始位置。\r\n         * @method indexOf\r\n         * @remind 该方法的匹配过程使用的是恒等“===”\r\n         * @param { Array } array 需要查找的数组对象\r\n         * @param { * } item 需要在目标数组中查找的值\r\n         * @param { int } start 搜索的起始位置\r\n         * @return { int } 返回item在目标数组array中的start位置之后首次出现的位置， 如果在数组中未找到item， 则返回-1\r\n         * @example\r\n         * ```javascript\r\n         * var item = 1,\r\n         *     arr = [ 3, 4, 6, 8, 1, 2, 8, 3, 2, 1, 1, 4 ];\r\n         *\r\n         * //output: 9\r\n         * console.log( UE.utils.indexOf( arr, item, 5 ) );\r\n         * ```\r\n         */\r\n        indexOf: function (array, item, start) {\r\n            var index = -1;\r\n            start = this.isNumber(start) ? start : 0;\r\n            this.each(array, function (v, i) {\r\n                if (i >= start && v === item) {\r\n                    index = i;\r\n                    return false;\r\n                }\r\n            });\r\n            return index;\r\n        },\r\n\r\n        /**\r\n         * 移除数组array中所有的元素item\r\n         * @method removeItem\r\n         * @param { Array } array 要移除元素的目标数组\r\n         * @param { * } item 将要被移除的元素\r\n         * @remind 该方法的匹配过程使用的是恒等“===”\r\n         * @example\r\n         * ```javascript\r\n         * var arr = [ 4, 5, 7, 1, 3, 4, 6 ];\r\n         *\r\n         * UE.utils.removeItem( arr, 4 );\r\n         * //output: [ 5, 7, 1, 3, 6 ]\r\n         * console.log( arr );\r\n         *\r\n         * ```\r\n         */\r\n        removeItem: function (array, item) {\r\n            for (var i = 0, l = array.length; i < l; i++) {\r\n                if (array[i] === item) {\r\n                    array.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 删除字符串str的首尾空格\r\n         * @method trim\r\n         * @param { String } str 需要删除首尾空格的字符串\r\n         * @return { String } 删除了首尾的空格后的字符串\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var str = \" UEdtior \";\r\n         *\r\n         * //output: 9\r\n         * console.log( str.length );\r\n         *\r\n         * //output: 7\r\n         * console.log( UE.utils.trim( \" UEdtior \" ).length );\r\n         *\r\n         * //output: 9\r\n         * console.log( str.length );\r\n         *\r\n         *  ```\r\n         */\r\n        trim: function (str) {\r\n            return str.replace(/(^[ \\t\\n\\r]+)|([ \\t\\n\\r]+$)/g, '');\r\n        },\r\n\r\n        /**\r\n         * 将字符串str以','分隔成数组后，将该数组转换成哈希对象， 其生成的hash对象的key为数组中的元素， value为1\r\n         * @method listToMap\r\n         * @warning 该方法在生成的hash对象中，会为每一个key同时生成一个另一个全大写的key。\r\n         * @param { String } str 该字符串将被以','分割为数组， 然后进行转化\r\n         * @return { Object } 转化之后的hash对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //output: Object {UEdtior: 1, UEDTIOR: 1, Hello: 1, HELLO: 1}\r\n         * console.log( UE.utils.listToMap( 'UEdtior,Hello' ) );\r\n         *\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 将字符串数组转换成哈希对象， 其生成的hash对象的key为数组中的元素， value为1\r\n         * @method listToMap\r\n         * @warning 该方法在生成的hash对象中，会为每一个key同时生成一个另一个全大写的key。\r\n         * @param { Array } arr 字符串数组\r\n         * @return { Object } 转化之后的hash对象\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //output: Object {UEdtior: 1, UEDTIOR: 1, Hello: 1, HELLO: 1}\r\n         * console.log( UE.utils.listToMap( [ 'UEdtior', 'Hello' ] ) );\r\n         *\r\n         * ```\r\n         */\r\n        listToMap: function (list) {\r\n            if (!list) return {};\r\n            list = utils.isArray(list) ? list : list.split(',');\r\n            for (var i = 0, ci, obj = {}; ci = list[i++];) {\r\n                obj[ci.toUpperCase()] = obj[ci] = 1;\r\n            }\r\n            return obj;\r\n        },\r\n\r\n        /**\r\n         * 将str中的html符号转义,将转义“'，&，<，\"，>”五个字符\r\n         * @method unhtml\r\n         * @param { String } str 需要转义的字符串\r\n         * @return { String } 转义后的字符串\r\n         * @example\r\n         * ```javascript\r\n         * var html = '<body>&</body>';\r\n         *\r\n         * //output: &lt;body&gt;&amp;&lt;/body&gt;\r\n         * console.log( UE.utils.unhtml( html ) );\r\n         *\r\n         * ```\r\n         */\r\n        unhtml: function (str, reg) {\r\n            return str ? str.replace(reg || /[&<\">'](?:(amp|lt|quot|gt|#39|nbsp|#\\d+);)?/g, function (a, b) {\r\n                if (b) {\r\n                    return a;\r\n                } else {\r\n                    return {\r\n                        '<': '&lt;',\r\n                        '&': '&amp;',\r\n                        '\"': '&quot;',\r\n                        '>': '&gt;',\r\n                        \"'\": '&#39;'\r\n                    }[a]\r\n                }\r\n\r\n            }) : '';\r\n        },\r\n        /**\r\n         * 将url中的html字符转义， 仅转义  ', \", <, > 四个字符\r\n         * @param  { String } str 需要转义的字符串\r\n         * @param  { RegExp } reg 自定义的正则\r\n         * @return { String }     转义后的字符串\r\n         */\r\n        unhtmlForUrl: function (str, reg) {\r\n            return str ? str.replace(reg || /[<\">']/g, function (a) {\r\n                return {\r\n                    '<': '&lt;',\r\n                    '&': '&amp;',\r\n                    '\"': '&quot;',\r\n                    '>': '&gt;',\r\n                    \"'\": '&#39;'\r\n                }[a]\r\n\r\n            }) : '';\r\n        },\r\n\r\n        /**\r\n         * 将str中的转义字符还原成html字符\r\n         * @see UE.utils.unhtml(String);\r\n         * @method html\r\n         * @param { String } str 需要逆转义的字符串\r\n         * @return { String } 逆转义后的字符串\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var str = '&lt;body&gt;&amp;&lt;/body&gt;';\r\n         *\r\n         * //output: <body>&</body>\r\n         * console.log( UE.utils.html( str ) );\r\n         *\r\n         * ```\r\n         */\r\n        html: function (str) {\r\n            return str ? str.replace(/&((g|l|quo)t|amp|#39|nbsp);/g, function (m) {\r\n                return {\r\n                    '&lt;': '<',\r\n                    '&amp;': '&',\r\n                    '&quot;': '\"',\r\n                    '&gt;': '>',\r\n                    '&#39;': \"'\",\r\n                    '&nbsp;': ' '\r\n                }[m]\r\n            }) : '';\r\n        },\r\n\r\n        /**\r\n         * 将css样式转换为驼峰的形式\r\n         * @method cssStyleToDomStyle\r\n         * @param { String } cssName 需要转换的css样式名\r\n         * @return { String } 转换成驼峰形式后的css样式名\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var str = 'border-top';\r\n         *\r\n         * //output: borderTop\r\n         * console.log( UE.utils.cssStyleToDomStyle( str ) );\r\n         *\r\n         * ```\r\n         */\r\n        cssStyleToDomStyle: function () {\r\n            var test = document.createElement('div').style,\r\n                cache = {\r\n                    'float': test.cssFloat != undefined ? 'cssFloat' : test.styleFloat != undefined ? 'styleFloat' : 'float'\r\n                };\r\n\r\n            return function (cssName) {\r\n                return cache[cssName] || (cache[cssName] = cssName.toLowerCase().replace(/-./g, function (match) {\r\n                    return match.charAt(1).toUpperCase();\r\n                }));\r\n            };\r\n        }(),\r\n\r\n        /**\r\n         * 动态加载文件到doc中\r\n         * @method loadFile\r\n         * @param { DomDocument } document 需要加载资源文件的文档对象\r\n         * @param { Object } options 加载资源文件的属性集合， 取值请参考代码示例\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * UE.utils.loadFile( document, {\r\n         *     src:\"test.js\",\r\n         *     tag:\"script\",\r\n         *     type:\"text/javascript\",\r\n         *     defer:\"defer\"\r\n         * } );\r\n         *\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 动态加载文件到doc中，加载成功后执行的回调函数fn\r\n         * @method loadFile\r\n         * @param { DomDocument } document 需要加载资源文件的文档对象\r\n         * @param { Object } options 加载资源文件的属性集合， 该集合支持的值是script标签和style标签支持的所有属性。\r\n         * @param { Function } fn 资源文件加载成功之后执行的回调\r\n         * @warning 对于在同一个文档中多次加载同一URL的文件， 该方法会在第一次加载之后缓存该请求，\r\n         *           在此之后的所有同一URL的请求， 将会直接触发回调。\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * UE.utils.loadFile( document, {\r\n         *     src:\"test.js\",\r\n         *     tag:\"script\",\r\n         *     type:\"text/javascript\",\r\n         *     defer:\"defer\"\r\n         * }, function () {\r\n         *     console.log('加载成功');\r\n         * } );\r\n         *\r\n         * ```\r\n         */\r\n        loadFile: function () {\r\n            var tmpList = [];\r\n\r\n            function getItem(doc, obj) {\r\n                try {\r\n                    for (var i = 0, ci; ci = tmpList[i++];) {\r\n                        if (ci.doc === doc && ci.url == (obj.src || obj.href)) {\r\n                            return ci;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return function (doc, obj, fn) {\r\n                var item = getItem(doc, obj);\r\n                if (item) {\r\n                    if (item.ready) {\r\n                        fn && fn();\r\n                    } else {\r\n                        item.funs.push(fn)\r\n                    }\r\n                    return;\r\n                }\r\n                tmpList.push({\r\n                    doc: doc,\r\n                    url: obj.src || obj.href,\r\n                    funs: [fn]\r\n                });\r\n                if (!doc.body) {\r\n                    var html = [];\r\n                    for (var p in obj) {\r\n                        if (p == 'tag') continue;\r\n                        html.push(p + '=\"' + obj[p] + '\"')\r\n                    }\r\n                    doc.write('<' + obj.tag + ' ' + html.join(' ') + ' ></' + obj.tag + '>');\r\n                    return;\r\n                }\r\n                if (obj.id && doc.getElementById(obj.id)) {\r\n                    return;\r\n                }\r\n                var element = doc.createElement(obj.tag);\r\n                delete obj.tag;\r\n                for (var p in obj) {\r\n                    element.setAttribute(p, obj[p]);\r\n                }\r\n                element.onload = element.onreadystatechange = function () {\r\n                    if (!this.readyState || /loaded|complete/.test(this.readyState)) {\r\n                        item = getItem(doc, obj);\r\n                        if (item.funs.length > 0) {\r\n                            item.ready = 1;\r\n                            for (var fi; fi = item.funs.pop();) {\r\n                                fi();\r\n                            }\r\n                        }\r\n                        element.onload = element.onreadystatechange = null;\r\n                    }\r\n                };\r\n                element.onerror = function () {\r\n                    throw Error('The load ' + (obj.href || obj.src) + ' fails,check the url settings of file ueditor.config.js ')\r\n                };\r\n                // console.log(element,doc.getElementsByTagName(\"head\")[0],11111111);\r\n                doc.getElementsByTagName(\"head\")[0].appendChild(element);\r\n            }\r\n        }(),\r\n\r\n        /**\r\n         * 判断obj对象是否为空\r\n         * @method isEmptyObject\r\n         * @param { * } obj 需要判断的对象\r\n         * @remind 如果判断的对象是NULL， 将直接返回true， 如果是数组且为空， 返回true， 如果是字符串， 且字符串为空，\r\n         *          返回true， 如果是普通对象， 且该对象没有任何实例属性， 返回true\r\n         * @return { Boolean } 对象是否为空\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //output: true\r\n         * console.log( UE.utils.isEmptyObject( {} ) );\r\n         *\r\n         * //output: true\r\n         * console.log( UE.utils.isEmptyObject( [] ) );\r\n         *\r\n         * //output: true\r\n         * console.log( UE.utils.isEmptyObject( \"\" ) );\r\n         *\r\n         * //output: false\r\n         * console.log( UE.utils.isEmptyObject( { key: 1 } ) );\r\n         *\r\n         * //output: false\r\n         * console.log( UE.utils.isEmptyObject( [1] ) );\r\n         *\r\n         * //output: false\r\n         * console.log( UE.utils.isEmptyObject( \"1\" ) );\r\n         *\r\n         * ```\r\n         */\r\n        isEmptyObject: function (obj) {\r\n            if (obj == null) return true;\r\n            if (this.isArray(obj) || this.isString(obj)) return obj.length === 0;\r\n            for (var key in obj) if (obj.hasOwnProperty(key)) return false;\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * 把rgb格式的颜色值转换成16进制格式\r\n         * @method fixColor\r\n         * @param { String } rgb格式的颜色值\r\n         * @param { String }\r\n         * @example\r\n         * rgb(255,255,255)  => \"#ffffff\"\r\n         */\r\n        fixColor: function (name, value) {\r\n            if (/color/i.test(name) && /rgba?/.test(value)) {\r\n                var array = value.split(\",\");\r\n                if (array.length > 3)\r\n                    return \"\";\r\n                value = \"#\";\r\n                for (var i = 0, color; color = array[i++];) {\r\n                    color = parseInt(color.replace(/[^\\d]/gi, ''), 10).toString(16);\r\n                    value += color.length == 1 ? \"0\" + color : color;\r\n                }\r\n                value = value.toUpperCase();\r\n            }\r\n            return value;\r\n        },\r\n        /**\r\n         * 只针对border,padding,margin做了处理，因为性能问题\r\n         * @public\r\n         * @function\r\n         * @param {String}    val style字符串\r\n         */\r\n        optCss: function (val) {\r\n            var padding, margin, border;\r\n            val = val.replace(/(padding|margin|border)\\-([^:]+):([^;]+);?/gi, function (str, key, name, val) {\r\n                if (val.split(' ').length == 1) {\r\n                    switch (key) {\r\n                        case 'padding':\r\n                            !padding && (padding = {});\r\n                            padding[name] = val;\r\n                            return '';\r\n                        case 'margin':\r\n                            !margin && (margin = {});\r\n                            margin[name] = val;\r\n                            return '';\r\n                        case 'border':\r\n                            return val == 'initial' ? '' : str;\r\n                    }\r\n                }\r\n                return str;\r\n            });\r\n\r\n            function opt(obj, name) {\r\n                if (!obj) {\r\n                    return '';\r\n                }\r\n                var t = obj.top, b = obj.bottom, l = obj.left, r = obj.right, val = '';\r\n                if (!t || !l || !b || !r) {\r\n                    for (var p in obj) {\r\n                        val += ';' + name + '-' + p + ':' + obj[p] + ';';\r\n                    }\r\n                } else {\r\n                    val += ';' + name + ':' +\r\n                        (t == b && b == l && l == r ? t :\r\n                            t == b && l == r ? (t + ' ' + l) :\r\n                                l == r ? (t + ' ' + l + ' ' + b) : (t + ' ' + r + ' ' + b + ' ' + l)) + ';'\r\n                }\r\n                return val;\r\n            }\r\n\r\n            val += opt(padding, 'padding') + opt(margin, 'margin');\r\n            return val.replace(/^[ \\n\\r\\t;]*|[ \\n\\r\\t]*$/, '').replace(/;([ \\n\\r\\t]+)|\\1;/g, ';')\r\n                .replace(/(&((l|g)t|quot|#39))?;{2,}/g, function (a, b) {\r\n                    return b ? b + \";;\" : ';'\r\n                });\r\n        },\r\n\r\n        /**\r\n         * 克隆对象\r\n         * @method clone\r\n         * @param { Object } source 源对象\r\n         * @return { Object } source的一个副本\r\n         */\r\n\r\n        /**\r\n         * 深度克隆对象，将source的属性克隆到target对象， 会覆盖target重名的属性。\r\n         * @method clone\r\n         * @param { Object } source 源对象\r\n         * @param { Object } target 目标对象\r\n         * @return { Object } 附加了source对象所有属性的target对象\r\n         */\r\n        clone: function (source, target) {\r\n            var tmp;\r\n            target = target || {};\r\n            for (var i in source) {\r\n                if (source.hasOwnProperty(i)) {\r\n                    tmp = source[i];\r\n                    if (typeof tmp == 'object') {\r\n                        target[i] = utils.isArray(tmp) ? [] : {};\r\n                        utils.clone(source[i], target[i])\r\n                    } else {\r\n                        target[i] = tmp;\r\n                    }\r\n                }\r\n            }\r\n            return target;\r\n        },\r\n\r\n        /**\r\n         * 把cm／pt为单位的值转换为px为单位的值\r\n         * @method transUnitToPx\r\n         * @param { String } 待转换的带单位的字符串\r\n         * @return { String } 转换为px为计量单位的值的字符串\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //output: 500px\r\n         * console.log( UE.utils.transUnitToPx( '20cm' ) );\r\n         *\r\n         * //output: 27px\r\n         * console.log( UE.utils.transUnitToPx( '20pt' ) );\r\n         *\r\n         * ```\r\n         */\r\n        transUnitToPx: function (val) {\r\n            if (!/(pt|cm)/.test(val)) {\r\n                return val\r\n            }\r\n            var unit;\r\n            val.replace(/([\\d.]+)(\\w+)/, function (str, v, u) {\r\n                val = v;\r\n                unit = u;\r\n            });\r\n            switch (unit) {\r\n                case 'cm':\r\n                    val = parseFloat(val) * 25;\r\n                    break;\r\n                case 'pt':\r\n                    val = Math.round(parseFloat(val) * 96 / 72);\r\n            }\r\n            return val + (val ? 'px' : '');\r\n        },\r\n\r\n        /**\r\n         * 在dom树ready之后执行给定的回调函数\r\n         * @method domReady\r\n         * @remind 如果在执行该方法的时候， dom树已经ready， 那么回调函数将立刻执行\r\n         * @param { Function } fn dom树ready之后的回调函数\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * UE.utils.domReady( function () {\r\n         *\r\n         *     console.log('123');\r\n         *\r\n         * } );\r\n         *\r\n         * ```\r\n         */\r\n        domReady: function () {\r\n\r\n            var fnArr = [];\r\n\r\n            function doReady(doc) {\r\n                //确保onready只执行一次\r\n                doc.isReady = true;\r\n                for (var ci; ci = fnArr.pop(); ci()) {\r\n                }\r\n            }\r\n\r\n            return function (onready, win) {\r\n                win = win || window;\r\n                var doc = win.document;\r\n                onready && fnArr.push(onready);\r\n                if (doc.readyState === \"complete\") {\r\n                    doReady(doc);\r\n                } else {\r\n                    doc.isReady && doReady(doc);\r\n                    if (browser.ie && browser.version != 11) {\r\n                        (function () {\r\n                            if (doc.isReady) return;\r\n                            try {\r\n                                doc.documentElement.doScroll(\"left\");\r\n                            } catch (error) {\r\n                                setTimeout(arguments.callee, 0);\r\n                                return;\r\n                            }\r\n                            doReady(doc);\r\n                        })();\r\n                        win.attachEvent('onload', function () {\r\n                            doReady(doc)\r\n                        });\r\n                    } else {\r\n                        doc.addEventListener(\"DOMContentLoaded\", function () {\r\n                            doc.removeEventListener(\"DOMContentLoaded\", arguments.callee, false);\r\n                            doReady(doc);\r\n                        }, false);\r\n                        win.addEventListener('load', function () {\r\n                            doReady(doc)\r\n                        }, false);\r\n                    }\r\n                }\r\n\r\n            }\r\n        }(),\r\n\r\n        /**\r\n         * 动态添加css样式\r\n         * @method cssRule\r\n         * @param { String } 节点名称\r\n         * @grammar UE.utils.cssRule('添加的样式的节点名称',['样式'，'放到哪个document上'])\r\n         * @grammar UE.utils.cssRule('body','body{background:#ccc}') => null  //给body添加背景颜色\r\n         * @grammar UE.utils.cssRule('body') =>样式的字符串  //取得key值为body的样式的内容,如果没有找到key值先关的样式将返回空，例如刚才那个背景颜色，将返回 body{background:#ccc}\r\n         * @grammar UE.utils.cssRule('body',document) => 返回指定key的样式，并且指定是哪个document\r\n         * @grammar UE.utils.cssRule('body','') =>null //清空给定的key值的背景颜色\r\n         */\r\n        cssRule: browser.ie && browser.version != 11 ? function (key, style, doc) {\r\n            var indexList, index;\r\n            if (style === undefined || style && style.nodeType && style.nodeType == 9) {\r\n                //获取样式\r\n                doc = style && style.nodeType && style.nodeType == 9 ? style : (doc || document);\r\n                indexList = doc.indexList || (doc.indexList = {});\r\n                index = indexList[key];\r\n                if (index !== undefined) {\r\n                    return doc.styleSheets[index].cssText\r\n                }\r\n                return undefined;\r\n            }\r\n            doc = doc || document;\r\n            indexList = doc.indexList || (doc.indexList = {});\r\n            index = indexList[key];\r\n            //清除样式\r\n            if (style === '') {\r\n                if (index !== undefined) {\r\n                    doc.styleSheets[index].cssText = '';\r\n                    delete indexList[key];\r\n                    return true\r\n                }\r\n                return false;\r\n            }\r\n\r\n            //添加样式\r\n            if (index !== undefined) {\r\n                sheetStyle = doc.styleSheets[index];\r\n            } else {\r\n                sheetStyle = doc.createStyleSheet('', index = doc.styleSheets.length);\r\n                indexList[key] = index;\r\n            }\r\n            sheetStyle.cssText = style;\r\n        } : function (key, style, doc) {\r\n            var head, node;\r\n            if (style === undefined || style && style.nodeType && style.nodeType == 9) {\r\n                //获取样式\r\n                doc = style && style.nodeType && style.nodeType == 9 ? style : (doc || document);\r\n                node = doc.getElementById(key);\r\n                return node ? node.innerHTML : undefined;\r\n            }\r\n            doc = doc || document;\r\n            node = doc.getElementById(key);\r\n\r\n            //清除样式\r\n            if (style === '') {\r\n                if (node) {\r\n                    node.parentNode.removeChild(node);\r\n                    return true\r\n                }\r\n                return false;\r\n            }\r\n\r\n            //添加样式\r\n            if (node) {\r\n                node.innerHTML = style;\r\n            } else {\r\n                node = doc.createElement('style');\r\n                node.id = key;\r\n                node.innerHTML = style;\r\n                doc.getElementsByTagName('head')[0].appendChild(node);\r\n            }\r\n        },\r\n        sort: function (array, compareFn) {\r\n            compareFn = compareFn || function (item1, item2) { return item1.localeCompare(item2); };\r\n            for (var i = 0, len = array.length; i < len; i++) {\r\n                for (var j = i, length = array.length; j < length; j++) {\r\n                    if (compareFn(array[i], array[j]) > 0) {\r\n                        var t = array[i];\r\n                        array[i] = array[j];\r\n                        array[j] = t;\r\n                    }\r\n                }\r\n            }\r\n            return array;\r\n        },\r\n        serializeParam: function (json) {\r\n            var strArr = [];\r\n            for (var i in json) {\r\n                //忽略默认的几个参数\r\n                if (i == \"method\" || i == \"timeout\" || i == \"async\") continue;\r\n                //传递过来的对象和函数不在提交之列\r\n                if (!((typeof json[i]).toLowerCase() == \"function\" || (typeof json[i]).toLowerCase() == \"object\")) {\r\n                    strArr.push(encodeURIComponent(i) + \"=\" + encodeURIComponent(json[i]));\r\n                } else if (utils.isArray(json[i])) {\r\n                    //支持传数组内容\r\n                    for (var j = 0; j < json[i].length; j++) {\r\n                        strArr.push(encodeURIComponent(i) + \"[]=\" + encodeURIComponent(json[i][j]));\r\n                    }\r\n                }\r\n            }\r\n            return strArr.join(\"&\");\r\n        },\r\n        formatUrl: function (url) {\r\n            var u = url.replace(/&&/g, '&');\r\n            u = u.replace(/\\?&/g, '?');\r\n            u = u.replace(/&$/g, '');\r\n            u = u.replace(/&#/g, '#');\r\n            u = u.replace(/&+/g, '&');\r\n            return u;\r\n        },\r\n        isCrossDomainUrl: function (url) {\r\n            var a = document.createElement('a');\r\n            a.href = url;\r\n            if (browser.ie) {\r\n                a.href = a.href;\r\n            }\r\n            return !(a.protocol == location.protocol && a.hostname == location.hostname &&\r\n                (a.port == location.port || (a.port == '80' && location.port == '') || (a.port == '' && location.port == '80')));\r\n        },\r\n        clearEmptyAttrs: function (obj) {\r\n            for (var p in obj) {\r\n                if (obj[p] === '') {\r\n                    delete obj[p]\r\n                }\r\n            }\r\n            return obj;\r\n        },\r\n        str2json: function (s) {\r\n\r\n            if (!utils.isString(s)) return null;\r\n            if (window.JSON) {\r\n                return JSON.parse(s);\r\n            } else {\r\n                return (new Function(\"return \" + utils.trim(s || '')))();\r\n            }\r\n\r\n        },\r\n        json2str: (function () {\r\n\r\n            if (window.JSON) {\r\n\r\n                return JSON.stringify;\r\n\r\n            } else {\r\n\r\n                var escapeMap = {\r\n                    \"\\b\": '\\\\b',\r\n                    \"\\t\": '\\\\t',\r\n                    \"\\n\": '\\\\n',\r\n                    \"\\f\": '\\\\f',\r\n                    \"\\r\": '\\\\r',\r\n                    '\"': '\\\\\"',\r\n                    \"\\\\\": '\\\\\\\\'\r\n                };\r\n\r\n                function encodeString(source) {\r\n                    if (/[\"\\\\\\x00-\\x1f]/.test(source)) {\r\n                        source = source.replace(\r\n                            /[\"\\\\\\x00-\\x1f]/g,\r\n                            function (match) {\r\n                                var c = escapeMap[match];\r\n                                if (c) {\r\n                                    return c;\r\n                                }\r\n                                c = match.charCodeAt();\r\n                                return \"\\\\u00\"\r\n                                    + Math.floor(c / 16).toString(16)\r\n                                    + (c % 16).toString(16);\r\n                            });\r\n                    }\r\n                    return '\"' + source + '\"';\r\n                }\r\n\r\n                function encodeArray(source) {\r\n                    var result = [\"[\"],\r\n                        l = source.length,\r\n                        preComma, i, item;\r\n\r\n                    for (i = 0; i < l; i++) {\r\n                        item = source[i];\r\n\r\n                        switch (typeof item) {\r\n                            case \"undefined\":\r\n                            case \"function\":\r\n                            case \"unknown\":\r\n                                break;\r\n                            default:\r\n                                if (preComma) {\r\n                                    result.push(',');\r\n                                }\r\n                                result.push(utils.json2str(item));\r\n                                preComma = 1;\r\n                        }\r\n                    }\r\n                    result.push(\"]\");\r\n                    return result.join(\"\");\r\n                }\r\n\r\n                function pad(source) {\r\n                    return source < 10 ? '0' + source : source;\r\n                }\r\n\r\n                function encodeDate(source) {\r\n                    return '\"' + source.getFullYear() + \"-\"\r\n                        + pad(source.getMonth() + 1) + \"-\"\r\n                        + pad(source.getDate()) + \"T\"\r\n                        + pad(source.getHours()) + \":\"\r\n                        + pad(source.getMinutes()) + \":\"\r\n                        + pad(source.getSeconds()) + '\"';\r\n                }\r\n\r\n                return function (value) {\r\n                    switch (typeof value) {\r\n                        case 'undefined':\r\n                            return 'undefined';\r\n\r\n                        case 'number':\r\n                            return isFinite(value) ? String(value) : \"null\";\r\n\r\n                        case 'string':\r\n                            return encodeString(value);\r\n\r\n                        case 'boolean':\r\n                            return String(value);\r\n\r\n                        default:\r\n                            if (value === null) {\r\n                                return 'null';\r\n                            } else if (utils.isArray(value)) {\r\n                                return encodeArray(value);\r\n                            } else if (utils.isDate(value)) {\r\n                                return encodeDate(value);\r\n                            } else {\r\n                                var result = ['{'],\r\n                                    encode = utils.json2str,\r\n                                    preComma,\r\n                                    item;\r\n\r\n                                for (var key in value) {\r\n                                    if (Object.prototype.hasOwnProperty.call(value, key)) {\r\n                                        item = value[key];\r\n                                        switch (typeof item) {\r\n                                            case 'undefined':\r\n                                            case 'unknown':\r\n                                            case 'function':\r\n                                                break;\r\n                                            default:\r\n                                                if (preComma) {\r\n                                                    result.push(',');\r\n                                                }\r\n                                                preComma = 1;\r\n                                                result.push(encode(key) + ':' + encode(item));\r\n                                        }\r\n                                    }\r\n                                }\r\n                                result.push('}');\r\n                                return result.join('');\r\n                            }\r\n                    }\r\n                };\r\n            }\r\n\r\n        })()\r\n\r\n    };\r\n    /**\r\n     * 判断给定的对象是否是字符串\r\n     * @method isString\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是字符串\r\n     */\r\n\r\n    /**\r\n     * 判断给定的对象是否是数组\r\n     * @method isArray\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是数组\r\n     */\r\n\r\n    /**\r\n     * 判断给定的对象是否是一个Function\r\n     * @method isFunction\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是Function\r\n     */\r\n\r\n    /**\r\n     * 判断给定的对象是否是Number\r\n     * @method isNumber\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是Number\r\n     */\r\n\r\n    /**\r\n     * 判断给定的对象是否是一个正则表达式\r\n     * @method isRegExp\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是正则表达式\r\n     */\r\n\r\n    /**\r\n     * 判断给定的对象是否是一个普通对象\r\n     * @method isObject\r\n     * @param { * } object 需要判断的对象\r\n     * @return { Boolean } 给定的对象是否是普通对象\r\n     */\r\n    utils.each(['String', 'Function', 'Array', 'Number', 'RegExp', 'Object', 'Date'], function (v) {\r\n        UE.utils['is' + v] = function (obj) {\r\n            return Object.prototype.toString.apply(obj) == '[object ' + v + ']';\r\n        }\r\n    });\r\n\r\n\r\n    // core/EventBase.js\r\n    /**\r\n     * UE采用的事件基类\r\n     * @file\r\n     * @module UE\r\n     * @class EventBase\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @unfile\r\n     * @module UE\r\n     */\r\n\r\n    /**\r\n     * UE采用的事件基类，继承此类的对应类将获取addListener,removeListener,fireEvent方法。\r\n     * 在UE中，Editor以及所有ui实例都继承了该类，故可以在对应的ui对象以及editor对象上使用上述方法。\r\n     * @unfile\r\n     * @module UE\r\n     * @class EventBase\r\n     */\r\n\r\n    /**\r\n     * 通过此构造器，子类可以继承EventBase获取事件监听的方法\r\n     * @constructor\r\n     * @example\r\n     * ```javascript\r\n     * UE.EventBase.call(editor);\r\n     * ```\r\n     */\r\n    var EventBase = UE.EventBase = function () { };\r\n\r\n    EventBase.prototype = {\r\n\r\n        /**\r\n         * 注册事件监听器\r\n         * @method addListener\r\n         * @param { String } types 监听的事件名称，同时监听多个事件使用空格分隔\r\n         * @param { Function } fn 监听的事件被触发时，会执行该回调函数\r\n         * @waining 事件被触发时，监听的函数假如返回的值恒等于true，回调函数的队列中后面的函数将不执行\r\n         * @example\r\n         * ```javascript\r\n         * editor.addListener('selectionchange',function(){\r\n         *      console.log(\"选区已经变化！\");\r\n         * })\r\n         * editor.addListener('beforegetcontent aftergetcontent',function(type){\r\n         *         if(type == 'beforegetcontent'){\r\n         *             //do something\r\n         *         }else{\r\n         *             //do something\r\n         *         }\r\n         *         console.log(this.getContent) // this是注册的事件的编辑器实例\r\n         * })\r\n         * ```\r\n         * @see UE.EventBase:fireEvent(String)\r\n         */\r\n        addListener: function (types, listener) {\r\n            types = utils.trim(types).split(/\\s+/);\r\n            for (var i = 0, ti; ti = types[i++];) {\r\n                getListener(this, ti, true).push(listener);\r\n            }\r\n        },\r\n\r\n        on: function (types, listener) {\r\n            return this.addListener(types, listener);\r\n        },\r\n        off: function (types, listener) {\r\n            return this.removeListener(types, listener)\r\n        },\r\n        trigger: function () {\r\n            return this.fireEvent.apply(this, arguments);\r\n        },\r\n        /**\r\n         * 移除事件监听器\r\n         * @method removeListener\r\n         * @param { String } types 移除的事件名称，同时移除多个事件使用空格分隔\r\n         * @param { Function } fn 移除监听事件的函数引用\r\n         * @example\r\n         * ```javascript\r\n         * //changeCallback为方法体\r\n         * editor.removeListener(\"selectionchange\",changeCallback);\r\n         * ```\r\n         */\r\n        removeListener: function (types, listener) {\r\n            types = utils.trim(types).split(/\\s+/);\r\n            for (var i = 0, ti; ti = types[i++];) {\r\n                utils.removeItem(getListener(this, ti) || [], listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 触发事件\r\n         * @method fireEvent\r\n         * @param { String } types 触发的事件名称，同时触发多个事件使用空格分隔\r\n         * @remind 该方法会触发addListener\r\n         * @return { * } 返回触发事件的队列中，最后执行的回调函数的返回值\r\n         * @example\r\n         * ```javascript\r\n         * editor.fireEvent(\"selectionchange\");\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 触发事件\r\n         * @method fireEvent\r\n         * @param { String } types 触发的事件名称，同时触发多个事件使用空格分隔\r\n         * @param { *... } options 可选参数，可以传入一个或多个参数，会传给事件触发的回调函数\r\n         * @return { * } 返回触发事件的队列中，最后执行的回调函数的返回值\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * editor.addListener( \"selectionchange\", function ( type, arg1, arg2 ) {\r\n         *\r\n         *     console.log( arg1 + \" \" + arg2 );\r\n         *\r\n         * } );\r\n         *\r\n         * //触发selectionchange事件， 会执行上面的事件监听器\r\n         * //output: Hello World\r\n         * editor.fireEvent(\"selectionchange\", \"Hello\", \"World\");\r\n         * ```\r\n         */\r\n        fireEvent: function () {\r\n            var types = arguments[0];\r\n            types = utils.trim(types).split(' ');\r\n            for (var i = 0, ti; ti = types[i++];) {\r\n                var listeners = getListener(this, ti),\r\n                    r, t, k;\r\n                if (listeners) {\r\n                    k = listeners.length;\r\n                    while (k--) {\r\n                        if (!listeners[k]) continue;\r\n                        t = listeners[k].apply(this, arguments);\r\n                        if (t === true) {\r\n                            return t;\r\n                        }\r\n                        if (t !== undefined) {\r\n                            r = t;\r\n                        }\r\n                    }\r\n                }\r\n                if (t = this['on' + ti.toLowerCase()]) {\r\n                    r = t.apply(this, arguments);\r\n                }\r\n            }\r\n            return r;\r\n        }\r\n    };\r\n    /**\r\n     * 获得对象所拥有监听类型的所有监听器\r\n     * @unfile\r\n     * @module UE\r\n     * @since 1.2.6.1\r\n     * @method getListener\r\n     * @public\r\n     * @param { Object } obj  查询监听器的对象\r\n     * @param { String } type 事件类型\r\n     * @param { Boolean } force  为true且当前所有type类型的侦听器不存在时，创建一个空监听器数组\r\n     * @return { Array } 监听器数组\r\n     */\r\n    function getListener(obj, type, force) {\r\n        var allListeners;\r\n        type = type.toLowerCase();\r\n        return ((allListeners = (obj.__allListeners || force && (obj.__allListeners = {})))\r\n            && (allListeners[type] || force && (allListeners[type] = [])));\r\n    }\r\n\r\n\r\n\r\n    // core/dtd.js\r\n    ///import editor.js\r\n    ///import core/dom/dom.js\r\n    ///import core/utils.js\r\n    /**\r\n     * dtd html语义化的体现类\r\n     * @constructor\r\n     * @namespace dtd\r\n     */\r\n    var dtd = dom.dtd = (function () {\r\n        function _(s) {\r\n            for (var k in s) {\r\n                s[k.toUpperCase()] = s[k];\r\n            }\r\n            return s;\r\n        }\r\n        var X = utils.extend2;\r\n        var A = _({ isindex: 1, fieldset: 1 }),\r\n            B = _({ input: 1, button: 1, select: 1, textarea: 1, label: 1 }),\r\n            C = X(_({ a: 1 }), B),\r\n            D = X({ iframe: 1 }, C),\r\n            E = _({ hr: 1, ul: 1, menu: 1, div: 1, blockquote: 1, noscript: 1, table: 1, center: 1, address: 1, dir: 1, pre: 1, h5: 1, dl: 1, h4: 1, noframes: 1, h6: 1, ol: 1, h1: 1, h3: 1, h2: 1 }),\r\n            F = _({ ins: 1, del: 1, script: 1, style: 1 }),\r\n            G = X(_({ b: 1, acronym: 1, bdo: 1, 'var': 1, '#': 1, abbr: 1, code: 1, br: 1, i: 1, cite: 1, kbd: 1, u: 1, strike: 1, s: 1, tt: 1, strong: 1, q: 1, samp: 1, em: 1, dfn: 1, span: 1 }), F),\r\n            H = X(_({ sub: 1, img: 1, embed: 1, object: 1, sup: 1, basefont: 1, map: 1, applet: 1, font: 1, big: 1, small: 1 }), G),\r\n            I = X(_({ p: 1 }), H),\r\n            J = X(_({ iframe: 1 }), H, B),\r\n            K = _({ img: 1, embed: 1, noscript: 1, br: 1, kbd: 1, center: 1, button: 1, basefont: 1, h5: 1, h4: 1, samp: 1, h6: 1, ol: 1, h1: 1, h3: 1, h2: 1, form: 1, font: 1, '#': 1, select: 1, menu: 1, ins: 1, abbr: 1, label: 1, code: 1, table: 1, script: 1, cite: 1, input: 1, iframe: 1, strong: 1, textarea: 1, noframes: 1, big: 1, small: 1, span: 1, hr: 1, sub: 1, bdo: 1, 'var': 1, div: 1, object: 1, sup: 1, strike: 1, dir: 1, map: 1, dl: 1, applet: 1, del: 1, isindex: 1, fieldset: 1, ul: 1, b: 1, acronym: 1, a: 1, blockquote: 1, i: 1, u: 1, s: 1, tt: 1, address: 1, q: 1, pre: 1, p: 1, em: 1, dfn: 1 }),\r\n\r\n            L = X(_({ a: 0 }), J),//a不能被切开，所以把他\r\n            M = _({ tr: 1 }),\r\n            N = _({ '#': 1 }),\r\n            O = X(_({ param: 1 }), K),\r\n            P = X(_({ form: 1 }), A, D, E, I),\r\n            Q = _({ li: 1, ol: 1, ul: 1 }),\r\n            R = _({ style: 1, script: 1 }),\r\n            S = _({ base: 1, link: 1, meta: 1, title: 1 }),\r\n            T = X(S, R),\r\n            U = _({ head: 1, body: 1 }),\r\n            V = _({ html: 1 });\r\n\r\n        var block = _({ address: 1, blockquote: 1, center: 1, dir: 1, div: 1, dl: 1, fieldset: 1, form: 1, h1: 1, h2: 1, h3: 1, h4: 1, h5: 1, h6: 1, hr: 1, isindex: 1, menu: 1, noframes: 1, ol: 1, p: 1, pre: 1, table: 1, ul: 1 }),\r\n\r\n            empty = _({ area: 1, base: 1, basefont: 1, br: 1, col: 1, command: 1, dialog: 1, embed: 1, hr: 1, img: 1, input: 1, isindex: 1, keygen: 1, link: 1, meta: 1, param: 1, source: 1, track: 1, wbr: 1 });\r\n\r\n        return _({\r\n\r\n            // $ 表示自定的属性\r\n\r\n            // body外的元素列表.\r\n            $nonBodyContent: X(V, U, S),\r\n\r\n            //块结构元素列表\r\n            $block: block,\r\n\r\n            //内联元素列表\r\n            $inline: L,\r\n\r\n            $inlineWithA: X(_({ a: 1 }), L),\r\n\r\n            $body: X(_({ script: 1, style: 1 }), block),\r\n\r\n            $cdata: _({ script: 1, style: 1 }),\r\n\r\n            //自闭和元素\r\n            $empty: empty,\r\n\r\n            //不是自闭合，但不能让range选中里边\r\n            $nonChild: _({ iframe: 1, textarea: 1 }),\r\n            //列表元素列表\r\n            $listItem: _({ dd: 1, dt: 1, li: 1 }),\r\n\r\n            //列表根元素列表\r\n            $list: _({ ul: 1, ol: 1, dl: 1 }),\r\n\r\n            //不能认为是空的元素\r\n            $isNotEmpty: _({ table: 1, ul: 1, ol: 1, dl: 1, iframe: 1, area: 1, base: 1, col: 1, hr: 1, img: 1, embed: 1, input: 1, link: 1, meta: 1, param: 1, h1: 1, h2: 1, h3: 1, h4: 1, h5: 1, h6: 1 }),\r\n\r\n            //如果没有子节点就可以删除的元素列表，像span,a\r\n            $removeEmpty: _({ a: 1, abbr: 1, acronym: 1, address: 1, b: 1, bdo: 1, big: 1, cite: 1, code: 1, del: 1, dfn: 1, em: 1, font: 1, i: 1, ins: 1, label: 1, kbd: 1, q: 1, s: 1, samp: 1, small: 1, span: 1, strike: 1, strong: 1, sub: 1, sup: 1, tt: 1, u: 1, 'var': 1 }),\r\n\r\n            $removeEmptyBlock: _({ 'p': 1, 'div': 1 }),\r\n\r\n            //在table元素里的元素列表\r\n            $tableContent: _({ caption: 1, col: 1, colgroup: 1, tbody: 1, td: 1, tfoot: 1, th: 1, thead: 1, tr: 1, table: 1 }),\r\n            //不转换的标签\r\n            $notTransContent: _({ pre: 1, script: 1, style: 1, textarea: 1 }),\r\n            html: U,\r\n            head: T,\r\n            style: N,\r\n            script: N,\r\n            body: P,\r\n            base: {},\r\n            link: {},\r\n            meta: {},\r\n            title: N,\r\n            col: {},\r\n            tr: _({ td: 1, th: 1 }),\r\n            img: {},\r\n            embed: {},\r\n            colgroup: _({ thead: 1, col: 1, tbody: 1, tr: 1, tfoot: 1 }),\r\n            noscript: P,\r\n            td: P,\r\n            br: {},\r\n            th: P,\r\n            center: P,\r\n            kbd: L,\r\n            button: X(I, E),\r\n            basefont: {},\r\n            h5: L,\r\n            h4: L,\r\n            samp: L,\r\n            h6: L,\r\n            ol: Q,\r\n            h1: L,\r\n            h3: L,\r\n            option: N,\r\n            h2: L,\r\n            form: X(A, D, E, I),\r\n            select: _({ optgroup: 1, option: 1 }),\r\n            font: L,\r\n            ins: L,\r\n            menu: Q,\r\n            abbr: L,\r\n            label: L,\r\n            table: _({ thead: 1, col: 1, tbody: 1, tr: 1, colgroup: 1, caption: 1, tfoot: 1 }),\r\n            code: L,\r\n            tfoot: M,\r\n            cite: L,\r\n            li: P,\r\n            input: {},\r\n            iframe: P,\r\n            strong: L,\r\n            textarea: N,\r\n            noframes: P,\r\n            big: L,\r\n            small: L,\r\n            //trace:\r\n            span: _({ '#': 1, br: 1, b: 1, strong: 1, u: 1, i: 1, em: 1, sub: 1, sup: 1, strike: 1, span: 1 }),\r\n            hr: L,\r\n            dt: L,\r\n            sub: L,\r\n            optgroup: _({ option: 1 }),\r\n            param: {},\r\n            bdo: L,\r\n            'var': L,\r\n            div: P,\r\n            object: O,\r\n            sup: L,\r\n            dd: P,\r\n            strike: L,\r\n            area: {},\r\n            dir: Q,\r\n            map: X(_({ area: 1, form: 1, p: 1 }), A, F, E),\r\n            applet: O,\r\n            dl: _({ dt: 1, dd: 1 }),\r\n            del: L,\r\n            isindex: {},\r\n            fieldset: X(_({ legend: 1 }), K),\r\n            thead: M,\r\n            ul: Q,\r\n            acronym: L,\r\n            b: L,\r\n            a: X(_({ a: 1 }), J),\r\n            blockquote: X(_({ td: 1, tr: 1, tbody: 1, li: 1 }), P),\r\n            caption: L,\r\n            i: L,\r\n            u: L,\r\n            tbody: M,\r\n            s: L,\r\n            address: X(D, I),\r\n            tt: L,\r\n            legend: L,\r\n            q: L,\r\n            pre: X(G, C),\r\n            p: X(_({ 'a': 1 }), L),\r\n            em: L,\r\n            dfn: L\r\n        });\r\n    })();\r\n\r\n\r\n    // core/domUtils.js\r\n    /**\r\n     * Dom操作工具包\r\n     * @file\r\n     * @module UE.dom.domUtils\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * Dom操作工具包\r\n     * @unfile\r\n     * @module UE.dom.domUtils\r\n     */\r\n    function getDomNode(node, start, ltr, startFromChild, fn, guard) {\r\n        var tmpNode = startFromChild && node[start],\r\n            parent;\r\n        !tmpNode && (tmpNode = node[ltr]);\r\n        while (!tmpNode && (parent = (parent || node).parentNode)) {\r\n            if (parent.tagName == 'BODY' || guard && !guard(parent)) {\r\n                return null;\r\n            }\r\n            tmpNode = parent[ltr];\r\n        }\r\n        if (tmpNode && fn && !fn(tmpNode)) {\r\n            return getDomNode(tmpNode, start, ltr, false, fn);\r\n        }\r\n        return tmpNode;\r\n    }\r\n    var attrFix = ie && browser.version < 9 ? {\r\n        tabindex: \"tabIndex\",\r\n        readonly: \"readOnly\",\r\n        \"for\": \"htmlFor\",\r\n        \"class\": \"className\",\r\n        maxlength: \"maxLength\",\r\n        cellspacing: \"cellSpacing\",\r\n        cellpadding: \"cellPadding\",\r\n        rowspan: \"rowSpan\",\r\n        colspan: \"colSpan\",\r\n        usemap: \"useMap\",\r\n        frameborder: \"frameBorder\"\r\n    } : {\r\n            tabindex: \"tabIndex\",\r\n            readonly: \"readOnly\"\r\n        },\r\n        styleBlock = utils.listToMap([\r\n            '-webkit-box', '-moz-box', 'block',\r\n            'list-item', 'table', 'table-row-group',\r\n            'table-header-group', 'table-footer-group',\r\n            'table-row', 'table-column-group', 'table-column',\r\n            'table-cell', 'table-caption'\r\n        ]);\r\n    var domUtils = dom.domUtils = {\r\n        //节点常量\r\n        NODE_ELEMENT: 1,\r\n        NODE_DOCUMENT: 9,\r\n        NODE_TEXT: 3,\r\n        NODE_COMMENT: 8,\r\n        NODE_DOCUMENT_FRAGMENT: 11,\r\n\r\n        //位置关系\r\n        POSITION_IDENTICAL: 0,\r\n        POSITION_DISCONNECTED: 1,\r\n        POSITION_FOLLOWING: 2,\r\n        POSITION_PRECEDING: 4,\r\n        POSITION_IS_CONTAINED: 8,\r\n        POSITION_CONTAINS: 16,\r\n        //ie6使用其他的会有一段空白出现\r\n        fillChar: ie && browser.version == '6' ? '\\ufeff' : '\\u200B',\r\n        //-------------------------Node部分--------------------------------\r\n        keys: {\r\n        /*Backspace*/ 8: 1, /*Delete*/ 46: 1,\r\n        /*Shift*/ 16: 1, /*Ctrl*/ 17: 1, /*Alt*/ 18: 1,\r\n            37: 1, 38: 1, 39: 1, 40: 1,\r\n            13: 1 /*enter*/\r\n        },\r\n        /**\r\n         * 获取节点A相对于节点B的位置关系\r\n         * @method getPosition\r\n         * @param { Node } nodeA 需要查询位置关系的节点A\r\n         * @param { Node } nodeB 需要查询位置关系的节点B\r\n         * @return { Number } 节点A与节点B的关系\r\n         * @example\r\n         * ```javascript\r\n         * //output: 20\r\n         * var position = UE.dom.domUtils.getPosition( document.documentElement, document.body );\r\n         *\r\n         * switch ( position ) {\r\n         *\r\n         *      //0\r\n         *      case UE.dom.domUtils.POSITION_IDENTICAL:\r\n         *          console.log('元素相同');\r\n         *          break;\r\n         *      //1\r\n         *      case UE.dom.domUtils.POSITION_DISCONNECTED:\r\n         *          console.log('两个节点在不同的文档中');\r\n         *          break;\r\n         *      //2\r\n         *      case UE.dom.domUtils.POSITION_FOLLOWING:\r\n         *          console.log('节点A在节点B之后');\r\n         *          break;\r\n         *      //4\r\n         *      case UE.dom.domUtils.POSITION_PRECEDING;\r\n         *          console.log('节点A在节点B之前');\r\n         *          break;\r\n         *      //8\r\n         *      case UE.dom.domUtils.POSITION_IS_CONTAINED:\r\n         *          console.log('节点A被节点B包含');\r\n         *          break;\r\n         *      case 10:\r\n         *          console.log('节点A被节点B包含且节点A在节点B之后');\r\n         *          break;\r\n         *      //16\r\n         *      case UE.dom.domUtils.POSITION_CONTAINS:\r\n         *          console.log('节点A包含节点B');\r\n         *          break;\r\n         *      case 20:\r\n         *          console.log('节点A包含节点B且节点A在节点B之前');\r\n         *          break;\r\n         *\r\n         * }\r\n         * ```\r\n         */\r\n        getPosition: function (nodeA, nodeB) {\r\n            // 如果两个节点是同一个节点\r\n            if (nodeA === nodeB) {\r\n                // domUtils.POSITION_IDENTICAL\r\n                return 0;\r\n            }\r\n            var node,\r\n                parentsA = [nodeA],\r\n                parentsB = [nodeB];\r\n            node = nodeA;\r\n            while (node = node.parentNode) {\r\n                // 如果nodeB是nodeA的祖先节点\r\n                if (node === nodeB) {\r\n                    // domUtils.POSITION_IS_CONTAINED + domUtils.POSITION_FOLLOWING\r\n                    return 10;\r\n                }\r\n                parentsA.push(node);\r\n            }\r\n            node = nodeB;\r\n            while (node = node.parentNode) {\r\n                // 如果nodeA是nodeB的祖先节点\r\n                if (node === nodeA) {\r\n                    // domUtils.POSITION_CONTAINS + domUtils.POSITION_PRECEDING\r\n                    return 20;\r\n                }\r\n                parentsB.push(node);\r\n            }\r\n            parentsA.reverse();\r\n            parentsB.reverse();\r\n            if (parentsA[0] !== parentsB[0]) {\r\n                // domUtils.POSITION_DISCONNECTED\r\n                return 1;\r\n            }\r\n            var i = -1;\r\n            while (i++ , parentsA[i] === parentsB[i]) {\r\n            }\r\n            nodeA = parentsA[i];\r\n            nodeB = parentsB[i];\r\n            while (nodeA = nodeA.nextSibling) {\r\n                if (nodeA === nodeB) {\r\n                    // domUtils.POSITION_PRECEDING\r\n                    return 4\r\n                }\r\n            }\r\n            // domUtils.POSITION_FOLLOWING\r\n            return 2;\r\n        },\r\n\r\n        /**\r\n         * 检测节点node在父节点中的索引位置\r\n         * @method getNodeIndex\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Number } 该节点在父节点中的位置\r\n         * @see UE.dom.domUtils.getNodeIndex(Node,Boolean)\r\n         */\r\n\r\n        /**\r\n         * 检测节点node在父节点中的索引位置， 根据给定的mergeTextNode参数决定是否要合并多个连续的文本节点为一个节点\r\n         * @method getNodeIndex\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @param { Boolean } mergeTextNode 是否合并多个连续的文本节点为一个节点\r\n         * @return { Number } 该节点在父节点中的位置\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         *      var node = document.createElement(\"div\");\r\n         *\r\n         *      node.appendChild( document.createTextNode( \"hello\" ) );\r\n         *      node.appendChild( document.createTextNode( \"world\" ) );\r\n         *      node.appendChild( node = document.createElement( \"div\" ) );\r\n         *\r\n         *      //output: 2\r\n         *      console.log( UE.dom.domUtils.getNodeIndex( node ) );\r\n         *\r\n         *      //output: 1\r\n         *      console.log( UE.dom.domUtils.getNodeIndex( node, true ) );\r\n         *\r\n         * ```\r\n         */\r\n        getNodeIndex: function (node, ignoreTextNode) {\r\n            var preNode = node,\r\n                i = 0;\r\n            while (preNode = preNode.previousSibling) {\r\n                if (ignoreTextNode && preNode.nodeType == 3) {\r\n                    if (preNode.nodeType != preNode.nextSibling.nodeType) {\r\n                        i++;\r\n                    }\r\n                    continue;\r\n                }\r\n                i++;\r\n            }\r\n            return i;\r\n        },\r\n\r\n        /**\r\n         * 检测节点node是否在给定的document对象上\r\n         * @method inDoc\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @param { DomDocument } doc 需要检测的document对象\r\n         * @return { Boolean } 该节点node是否在给定的document的dom树上\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var node = document.createElement(\"div\");\r\n         *\r\n         * //output: false\r\n         * console.log( UE.do.domUtils.inDoc( node, document ) );\r\n         *\r\n         * document.body.appendChild( node );\r\n         *\r\n         * //output: true\r\n         * console.log( UE.do.domUtils.inDoc( node, document ) );\r\n         *\r\n         * ```\r\n         */\r\n        inDoc: function (node, doc) {\r\n            return domUtils.getPosition(node, doc) == 10;\r\n        },\r\n        /**\r\n         * 根据给定的过滤规则filterFn， 查找符合该过滤规则的node节点的第一个祖先节点，\r\n         * 查找的起点是给定node节点的父节点。\r\n         * @method findParent\r\n         * @param { Node } node 需要查找的节点\r\n         * @param { Function } filterFn 自定义的过滤方法。\r\n         * @warning 查找的终点是到body节点为止\r\n         * @remind 自定义的过滤方法filterFn接受一个Node对象作为参数， 该对象代表当前执行检测的祖先节点。 如果该\r\n         *          节点满足过滤条件， 则要求返回true， 这时将直接返回该节点作为findParent()的结果， 否则， 请返回false。\r\n         * @return { Node | Null } 如果找到符合过滤条件的节点， 就返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var filterNode = UE.dom.domUtils.findParent( document.body.firstChild, function ( node ) {\r\n         *\r\n         *     //由于查找的终点是body节点， 所以永远也不会匹配当前过滤器的条件， 即这里永远会返回false\r\n         *     return node.tagName === \"HTML\";\r\n         *\r\n         * } );\r\n         *\r\n         * //output: true\r\n         * console.log( filterNode === null );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 根据给定的过滤规则filterFn， 查找符合该过滤规则的node节点的第一个祖先节点，\r\n         * 如果includeSelf的值为true，则查找的起点是给定的节点node， 否则， 起点是node的父节点\r\n         * @method findParent\r\n         * @param { Node } node 需要查找的节点\r\n         * @param { Function } filterFn 自定义的过滤方法。\r\n         * @param { Boolean } includeSelf 查找过程是否包含自身\r\n         * @warning 查找的终点是到body节点为止\r\n         * @remind 自定义的过滤方法filterFn接受一个Node对象作为参数， 该对象代表当前执行检测的祖先节点。 如果该\r\n         *          节点满足过滤条件， 则要求返回true， 这时将直接返回该节点作为findParent()的结果， 否则， 请返回false。\r\n         * @remind 如果includeSelf为true， 则过滤器第一次执行时的参数会是节点本身。\r\n         *          反之， 过滤器第一次执行时的参数将是该节点的父节点。\r\n         * @return { Node | Null } 如果找到符合过滤条件的节点， 就返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *\r\n         *      <div id=\"test\">\r\n         *      </div>\r\n         *\r\n         *      <script type=\"text/javascript\">\r\n         *\r\n         *          //output: DIV, BODY\r\n         *          var filterNode = UE.dom.domUtils.findParent( document.getElementById( \"test\" ), function ( node ) {\r\n         *\r\n         *              console.log( node.tagName );\r\n         *              return false;\r\n         *\r\n         *          }, true );\r\n         *\r\n         *      </script>\r\n         * </body>\r\n         * ```\r\n         */\r\n        findParent: function (node, filterFn, includeSelf) {\r\n            if (node && !domUtils.isBody(node)) {\r\n                node = includeSelf ? node : node.parentNode;\r\n                while (node) {\r\n                    if (!filterFn || filterFn(node) || domUtils.isBody(node)) {\r\n                        return filterFn && !filterFn(node) && domUtils.isBody(node) ? null : node;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        /**\r\n         * 查找node的节点名为tagName的第一个祖先节点， 查找的起点是node节点的父节点。\r\n         * @method findParentByTagName\r\n         * @param { Node } node 需要查找的节点对象\r\n         * @param { Array } tagNames 需要查找的父节点的名称数组\r\n         * @warning 查找的终点是到body节点为止\r\n         * @return { Node | NULL } 如果找到符合条件的节点， 则返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var node = UE.dom.domUtils.findParentByTagName( document.getElementsByTagName(\"div\")[0], [ \"BODY\" ] );\r\n         * //output: BODY\r\n         * console.log( node.tagName );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 查找node的节点名为tagName的祖先节点， 如果includeSelf的值为true，则查找的起点是给定的节点node，\r\n         * 否则， 起点是node的父节点。\r\n         * @method findParentByTagName\r\n         * @param { Node } node 需要查找的节点对象\r\n         * @param { Array } tagNames 需要查找的父节点的名称数组\r\n         * @param { Boolean } includeSelf 查找过程是否包含node节点自身\r\n         * @warning 查找的终点是到body节点为止\r\n         * @return { Node | NULL } 如果找到符合条件的节点， 则返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var queryTarget = document.getElementsByTagName(\"div\")[0];\r\n         * var node = UE.dom.domUtils.findParentByTagName( queryTarget, [ \"DIV\" ], true );\r\n         * //output: true\r\n         * console.log( queryTarget === node );\r\n         * ```\r\n         */\r\n        findParentByTagName: function (node, tagNames, includeSelf, excludeFn) {\r\n            tagNames = utils.listToMap(utils.isArray(tagNames) ? tagNames : [tagNames]);\r\n            return domUtils.findParent(node, function (node) {\r\n                return tagNames[node.tagName] && !(excludeFn && excludeFn(node));\r\n            }, includeSelf);\r\n        },\r\n        /**\r\n         * 查找节点node的祖先节点集合， 查找的起点是给定节点的父节点，结果集中不包含给定的节点。\r\n         * @method findParents\r\n         * @param { Node } node 需要查找的节点对象\r\n         * @return { Array } 给定节点的祖先节点数组\r\n         * @grammar UE.dom.domUtils.findParents(node)  => Array  //返回一个祖先节点数组集合，不包含自身\r\n         * @grammar UE.dom.domUtils.findParents(node,includeSelf)  => Array  //返回一个祖先节点数组集合，includeSelf指定是否包含自身\r\n         * @grammar UE.dom.domUtils.findParents(node,includeSelf,filterFn)  => Array  //返回一个祖先节点数组集合，filterFn指定过滤条件，返回true的node将被选取\r\n         * @grammar UE.dom.domUtils.findParents(node,includeSelf,filterFn,closerFirst)  => Array  //返回一个祖先节点数组集合，closerFirst为true的话，node的直接父亲节点是数组的第0个\r\n         */\r\n\r\n        /**\r\n         * 查找节点node的祖先节点集合， 如果includeSelf的值为true，\r\n         * 则返回的结果集中允许出现当前给定的节点， 否则， 该节点不会出现在其结果集中。\r\n         * @method findParents\r\n         * @param { Node } node 需要查找的节点对象\r\n         * @param { Boolean } includeSelf 查找的结果中是否允许包含当前查找的节点对象\r\n         * @return { Array } 给定节点的祖先节点数组\r\n         */\r\n        findParents: function (node, includeSelf, filterFn, closerFirst) {\r\n            var parents = includeSelf && (filterFn && filterFn(node) || !filterFn) ? [node] : [];\r\n            while (node = domUtils.findParent(node, filterFn)) {\r\n                parents.push(node);\r\n            }\r\n            return closerFirst ? parents : parents.reverse();\r\n        },\r\n\r\n        /**\r\n         * 在节点node后面插入新节点newNode\r\n         * @method insertAfter\r\n         * @param { Node } node 目标节点\r\n         * @param { Node } newNode 新插入的节点， 该节点将置于目标节点之后\r\n         * @return { Node } 新插入的节点\r\n         */\r\n        insertAfter: function (node, newNode) {\r\n            return node.nextSibling ? node.parentNode.insertBefore(newNode, node.nextSibling) :\r\n                node.parentNode.appendChild(newNode);\r\n        },\r\n\r\n        /**\r\n         * 删除节点node及其下属的所有节点\r\n         * @method remove\r\n         * @param { Node } node 需要删除的节点对象\r\n         * @return { Node } 返回刚删除的节点对象\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">\r\n         *     <div id=\"child\">你好</div>\r\n         * </div>\r\n         * <script>\r\n         *     UE.dom.domUtils.remove( document.body, false );\r\n         *     //output: false\r\n         *     console.log( document.getElementById( \"child\" ) !== null );\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 删除节点node，并根据keepChildren的值决定是否保留子节点\r\n         * @method remove\r\n         * @param { Node } node 需要删除的节点对象\r\n         * @param { Boolean } keepChildren 是否需要保留子节点\r\n         * @return { Node } 返回刚删除的节点对象\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">\r\n         *     <div id=\"child\">你好</div>\r\n         * </div>\r\n         * <script>\r\n         *     UE.dom.domUtils.remove( document.body, true );\r\n         *     //output: true\r\n         *     console.log( document.getElementById( \"child\" ) !== null );\r\n         * </script>\r\n         * ```\r\n         */\r\n        remove: function (node, keepChildren) {\r\n            var parent = node.parentNode,\r\n                child;\r\n            if (parent) {\r\n                if (keepChildren && node.hasChildNodes()) {\r\n                    while (child = node.firstChild) {\r\n                        parent.insertBefore(child, node);\r\n                    }\r\n                }\r\n                parent.removeChild(node);\r\n            }\r\n            return node;\r\n        },\r\n\r\n        /**\r\n         * 取得node节点的下一个兄弟节点， 如果该节点其后没有兄弟节点， 则递归查找其父节点之后的第一个兄弟节点，\r\n         * 直到找到满足条件的节点或者递归到BODY节点之后才会结束。\r\n         * @method getNextDomNode\r\n         * @param { Node } node 需要获取其后的兄弟节点的节点对象\r\n         * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```html\r\n         *     <body>\r\n         *      <div id=\"test\">\r\n         *          <span></span>\r\n         *      </div>\r\n         *      <i>xxx</i>\r\n         * </body>\r\n         * <script>\r\n         *\r\n         *     //output: i节点\r\n         *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *      <div>\r\n         *          <span></span>\r\n         *          <i id=\"test\">xxx</i>\r\n         *      </div>\r\n         *      <b>xxx</b>\r\n         * </body>\r\n         * <script>\r\n         *\r\n         *     //由于id为test的i节点之后没有兄弟节点， 则查找其父节点（div）后面的兄弟节点\r\n         *     //output: b节点\r\n         *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 取得node节点的下一个兄弟节点， 如果startFromChild的值为ture，则先获取其子节点，\r\n         * 如果有子节点则直接返回第一个子节点；如果没有子节点或者startFromChild的值为false，\r\n         * 则执行<a href=\"#UE.dom.domUtils.getNextDomNode(Node)\">getNextDomNode(Node node)</a>的查找过程。\r\n         * @method getNextDomNode\r\n         * @param { Node } node 需要获取其后的兄弟节点的节点对象\r\n         * @param { Boolean } startFromChild 查找过程是否从其子节点开始\r\n         * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\r\n         * @see UE.dom.domUtils.getNextDomNode(Node)\r\n         */\r\n        getNextDomNode: function (node, startFromChild, filterFn, guard) {\r\n            return getDomNode(node, 'firstChild', 'nextSibling', startFromChild, filterFn, guard);\r\n        },\r\n        getPreDomNode: function (node, startFromChild, filterFn, guard) {\r\n            return getDomNode(node, 'lastChild', 'previousSibling', startFromChild, filterFn, guard);\r\n        },\r\n        /**\r\n         * 检测节点node是否属是UEditor定义的bookmark节点\r\n         * @method isBookmarkNode\r\n         * @private\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Boolean } 是否是bookmark节点\r\n         * @example\r\n         * ```html\r\n         * <span id=\"_baidu_bookmark_1\"></span>\r\n         * <script>\r\n         *      var bookmarkNode = document.getElementById(\"_baidu_bookmark_1\");\r\n         *      //output: true\r\n         *      console.log( UE.dom.domUtils.isBookmarkNode( bookmarkNode ) );\r\n         * </script>\r\n         * ```\r\n         */\r\n        isBookmarkNode: function (node) {\r\n            return node.nodeType == 1 && node.id && /^_baidu_bookmark_/i.test(node.id);\r\n        },\r\n        /**\r\n         * 获取节点node所属的window对象\r\n         * @method  getWindow\r\n         * @param { Node } node 节点对象\r\n         * @return { Window } 当前节点所属的window对象\r\n         * @example\r\n         * ```javascript\r\n         * //output: true\r\n         * console.log( UE.dom.domUtils.getWindow( document.body ) === window );\r\n         * ```\r\n         */\r\n        getWindow: function (node) {\r\n            var doc = node.ownerDocument || node;\r\n            return doc.defaultView || doc.parentWindow;\r\n        },\r\n        /**\r\n         * 获取离nodeA与nodeB最近的公共的祖先节点\r\n         * @method  getCommonAncestor\r\n         * @param { Node } nodeA 第一个节点\r\n         * @param { Node } nodeB 第二个节点\r\n         * @remind 如果给定的两个节点是同一个节点， 将直接返回该节点。\r\n         * @return { Node | NULL } 如果未找到公共节点， 返回NULL， 否则返回最近的公共祖先节点。\r\n         * @example\r\n         * ```javascript\r\n         * var commonAncestor = UE.dom.domUtils.getCommonAncestor( document.body, document.body.firstChild );\r\n         * //output: true\r\n         * console.log( commonAncestor.tagName.toLowerCase() === 'body' );\r\n         * ```\r\n         */\r\n        getCommonAncestor: function (nodeA, nodeB) {\r\n            if (nodeA === nodeB)\r\n                return nodeA;\r\n            var parentsA = [nodeA], parentsB = [nodeB], parent = nodeA, i = -1;\r\n            while (parent = parent.parentNode) {\r\n                if (parent === nodeB) {\r\n                    return parent;\r\n                }\r\n                parentsA.push(parent);\r\n            }\r\n            parent = nodeB;\r\n            while (parent = parent.parentNode) {\r\n                if (parent === nodeA)\r\n                    return parent;\r\n                parentsB.push(parent);\r\n            }\r\n            parentsA.reverse();\r\n            parentsB.reverse();\r\n            while (i++ , parentsA[i] === parentsB[i]) {\r\n            }\r\n            return i == 0 ? null : parentsA[i - 1];\r\n\r\n        },\r\n        /**\r\n         * 清除node节点左右连续为空的兄弟inline节点\r\n         * @method clearEmptySibling\r\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n         * 则这些兄弟节点将被删除\r\n         * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext)  //ignoreNext指定是否忽略右边空节点\r\n         * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext,ignorePre)  //ignorePre指定是否忽略左边空节点\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *     <div></div>\r\n         *     <span id=\"test\"></span>\r\n         *     <i></i>\r\n         *     <b></b>\r\n         *     <em>xxx</em>\r\n         *     <span></span>\r\n         * </body>\r\n         * <script>\r\n         *\r\n         *      UE.dom.domUtils.clearEmptySibling( document.getElementById( \"test\" ) );\r\n         *\r\n         *      //output: <div></div><span id=\"test\"></span><em>xxx</em><span></span>\r\n         *      console.log( document.body.innerHTML );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\r\n         * 则忽略对右边兄弟节点的操作。\r\n         * @method clearEmptySibling\r\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n         * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\r\n         * 则这些兄弟节点将被删除\r\n         * @see UE.dom.domUtils.clearEmptySibling(Node)\r\n         */\r\n\r\n        /**\r\n         * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\r\n         * 则忽略对右边兄弟节点的操作， 如果ignorePre的值为true，则忽略对左边兄弟节点的操作。\r\n         * @method clearEmptySibling\r\n         * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n         * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\r\n         * @param { Boolean } ignorePre 是否忽略忽略对左边的兄弟节点的操作\r\n         * 则这些兄弟节点将被删除\r\n         * @see UE.dom.domUtils.clearEmptySibling(Node)\r\n         */\r\n        clearEmptySibling: function (node, ignoreNext, ignorePre) {\r\n            function clear(next, dir) {\r\n                var tmpNode;\r\n                while (next && !domUtils.isBookmarkNode(next) && (domUtils.isEmptyInlineElement(next)\r\n                    //这里不能把空格算进来会吧空格干掉，出现文字间的空格丢掉了\r\n                    || !new RegExp('[^\\t\\n\\r' + domUtils.fillChar + ']').test(next.nodeValue))) {\r\n                    tmpNode = next[dir];\r\n                    domUtils.remove(next);\r\n                    next = tmpNode;\r\n                }\r\n            }\r\n            !ignoreNext && clear(node.nextSibling, 'nextSibling');\r\n            !ignorePre && clear(node.previousSibling, 'previousSibling');\r\n        },\r\n        /**\r\n         * 将一个文本节点textNode拆分成两个文本节点，offset指定拆分位置\r\n         * @method split\r\n         * @param { Node } textNode 需要拆分的文本节点对象\r\n         * @param { int } offset 需要拆分的位置， 位置计算从0开始\r\n         * @return { Node } 拆分后形成的新节点\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">abcdef</div>\r\n         * <script>\r\n         *      var newNode = UE.dom.domUtils.split( document.getElementById( \"test\" ).firstChild, 3 );\r\n         *      //output: def\r\n         *      console.log( newNode.nodeValue );\r\n         * </script>\r\n         * ```\r\n         */\r\n        split: function (node, offset) {\r\n            var doc = node.ownerDocument;\r\n            if (browser.ie && offset == node.nodeValue.length) {\r\n                var next = doc.createTextNode('');\r\n                return domUtils.insertAfter(node, next);\r\n            }\r\n            var retval = node.splitText(offset);\r\n            //ie8下splitText不会跟新childNodes,我们手动触发他的更新\r\n            if (browser.ie8) {\r\n                var tmpNode = doc.createTextNode('');\r\n                domUtils.insertAfter(retval, tmpNode);\r\n                domUtils.remove(tmpNode);\r\n            }\r\n            return retval;\r\n        },\r\n\r\n        /**\r\n         * 检测文本节点textNode是否为空节点（包括空格、换行、占位符等字符）\r\n         * @method  isWhitespace\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Boolean } 检测的节点是否为空\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">\r\n         *\r\n         * </div>\r\n         * <script>\r\n         *      //output: true\r\n         *      console.log( UE.dom.domUtils.isWhitespace( document.getElementById(\"test\").firstChild ) );\r\n         * </script>\r\n         * ```\r\n         */\r\n        isWhitespace: function (node) {\r\n            return !new RegExp('[^ \\t\\n\\r' + domUtils.fillChar + ']').test(node.nodeValue);\r\n        },\r\n        /**\r\n         * 获取元素element相对于viewport的位置坐标\r\n         * @method getXY\r\n         * @param { Node } element 需要计算位置的节点对象\r\n         * @return { Object } 返回形如{x:left,y:top}的一个key-value映射对象， 其中键x代表水平偏移距离，\r\n         *                          y代表垂直偏移距离。\r\n         *\r\n         * @example\r\n         * ```javascript\r\n         * var location = UE.dom.domUtils.getXY( document.getElementById(\"test\") );\r\n         * //output: test的坐标为: 12, 24\r\n         * console.log( 'test的坐标为： ', location.x, ',', location.y );\r\n         * ```\r\n         */\r\n        getXY: function (element) {\r\n            var x = 0, y = 0;\r\n            while (element.offsetParent) {\r\n                y += element.offsetTop;\r\n                x += element.offsetLeft;\r\n                element = element.offsetParent;\r\n            }\r\n            return { 'x': x, 'y': y };\r\n        },\r\n        /**\r\n         * 为元素element绑定原生DOM事件，type为事件类型，handler为处理函数\r\n         * @method on\r\n         * @param { Node } element 需要绑定事件的节点对象\r\n         * @param { String } type 绑定的事件类型\r\n         * @param { Function } handler 事件处理器\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.on(document.body,\"click\",function(e){\r\n         *     //e为事件对象，this为被点击元素对戏那个\r\n         * });\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 为元素element绑定原生DOM事件，type为事件类型，handler为处理函数\r\n         * @method on\r\n         * @param { Node } element 需要绑定事件的节点对象\r\n         * @param { Array } type 绑定的事件类型数组\r\n         * @param { Function } handler 事件处理器\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.on(document.body,[\"click\",\"mousedown\"],function(evt){\r\n         *     //evt为事件对象，this为被点击元素对象\r\n         * });\r\n         * ```\r\n         */\r\n        on: function (element, type, handler) {\r\n\r\n            var types = utils.isArray(type) ? type : utils.trim(type).split(/\\s+/),\r\n                k = types.length;\r\n            if (k) while (k--) {\r\n                type = types[k];\r\n                if (element.addEventListener) {\r\n                    element.addEventListener(type, handler, false);\r\n                } else {\r\n                    if (!handler._d) {\r\n                        handler._d = {\r\n                            els: []\r\n                        };\r\n                    }\r\n                    var key = type + handler.toString(), index = utils.indexOf(handler._d.els, element);\r\n                    if (!handler._d[key] || index == -1) {\r\n                        if (index == -1) {\r\n                            handler._d.els.push(element);\r\n                        }\r\n                        if (!handler._d[key]) {\r\n                            handler._d[key] = function (evt) {\r\n                                return handler.call(evt.srcElement, evt || window.event);\r\n                            };\r\n                        }\r\n\r\n\r\n                        element.attachEvent('on' + type, handler._d[key]);\r\n                    }\r\n                }\r\n            }\r\n            element = null;\r\n        },\r\n        /**\r\n         * 解除DOM事件绑定\r\n         * @method un\r\n         * @param { Node } element 需要解除事件绑定的节点对象\r\n         * @param { String } type 需要接触绑定的事件类型\r\n         * @param { Function } handler 对应的事件处理器\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.un(document.body,\"click\",function(evt){\r\n         *     //evt为事件对象，this为被点击元素对象\r\n         * });\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 解除DOM事件绑定\r\n         * @method un\r\n         * @param { Node } element 需要解除事件绑定的节点对象\r\n         * @param { Array } type 需要接触绑定的事件类型数组\r\n         * @param { Function } handler 对应的事件处理器\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.un(document.body, [\"click\",\"mousedown\"],function(evt){\r\n         *     //evt为事件对象，this为被点击元素对象\r\n         * });\r\n         * ```\r\n         */\r\n        un: function (element, type, handler) {\r\n            var types = utils.isArray(type) ? type : utils.trim(type).split(/\\s+/),\r\n                k = types.length;\r\n            if (k) while (k--) {\r\n                type = types[k];\r\n                if (element.removeEventListener) {\r\n                    element.removeEventListener(type, handler, false);\r\n                } else {\r\n                    var key = type + handler.toString();\r\n                    try {\r\n                        element.detachEvent('on' + type, handler._d ? handler._d[key] : handler);\r\n                    } catch (e) { }\r\n                    if (handler._d && handler._d[key]) {\r\n                        var index = utils.indexOf(handler._d.els, element);\r\n                        if (index != -1) {\r\n                            handler._d.els.splice(index, 1);\r\n                        }\r\n                        handler._d.els.length == 0 && delete handler._d[key];\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 比较节点nodeA与节点nodeB是否具有相同的标签名、属性名以及属性值\r\n         * @method  isSameElement\r\n         * @param { Node } nodeA 需要比较的节点\r\n         * @param { Node } nodeB 需要比较的节点\r\n         * @return { Boolean } 两个节点是否具有相同的标签名、属性名以及属性值\r\n         * @example\r\n         * ```html\r\n         * <span style=\"font-size:12px\">ssss</span>\r\n         * <span style=\"font-size:12px\">bbbbb</span>\r\n         * <span style=\"font-size:13px\">ssss</span>\r\n         * <span style=\"font-size:14px\">bbbbb</span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var nodes = document.getElementsByTagName( \"span\" );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isSameElement( nodes[0], nodes[1] ) );\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.isSameElement( nodes[2], nodes[3] ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        isSameElement: function (nodeA, nodeB) {\r\n            if (nodeA.tagName != nodeB.tagName) {\r\n                return false;\r\n            }\r\n            var thisAttrs = nodeA.attributes,\r\n                otherAttrs = nodeB.attributes;\r\n            if (!ie && thisAttrs.length != otherAttrs.length) {\r\n                return false;\r\n            }\r\n            var attrA, attrB, al = 0, bl = 0;\r\n            for (var i = 0; attrA = thisAttrs[i++];) {\r\n                if (attrA.nodeName == 'style') {\r\n                    if (attrA.specified) {\r\n                        al++;\r\n                    }\r\n                    if (domUtils.isSameStyle(nodeA, nodeB)) {\r\n                        continue;\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n                if (ie) {\r\n                    if (attrA.specified) {\r\n                        al++;\r\n                        attrB = otherAttrs.getNamedItem(attrA.nodeName);\r\n                    } else {\r\n                        continue;\r\n                    }\r\n                } else {\r\n                    attrB = nodeB.attributes[attrA.nodeName];\r\n                }\r\n                if (!attrB.specified || attrA.nodeValue != attrB.nodeValue) {\r\n                    return false;\r\n                }\r\n            }\r\n            // 有可能attrB的属性包含了attrA的属性之外还有自己的属性\r\n            if (ie) {\r\n                for (i = 0; attrB = otherAttrs[i++];) {\r\n                    if (attrB.specified) {\r\n                        bl++;\r\n                    }\r\n                }\r\n                if (al != bl) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * 判断节点nodeA与节点nodeB的元素的style属性是否一致\r\n         * @method isSameStyle\r\n         * @param { Node } nodeA 需要比较的节点\r\n         * @param { Node } nodeB 需要比较的节点\r\n         * @return { Boolean } 两个节点是否具有相同的style属性值\r\n         * @example\r\n         * ```html\r\n         * <span style=\"font-size:12px\">ssss</span>\r\n         * <span style=\"font-size:12px\">bbbbb</span>\r\n         * <span style=\"font-size:13px\">ssss</span>\r\n         * <span style=\"font-size:14px\">bbbbb</span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var nodes = document.getElementsByTagName( \"span\" );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isSameStyle( nodes[0], nodes[1] ) );\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.isSameStyle( nodes[2], nodes[3] ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        isSameStyle: function (nodeA, nodeB) {\r\n            var styleA = nodeA.style.cssText.replace(/( ?; ?)/g, ';').replace(/( ?: ?)/g, ':'),\r\n                styleB = nodeB.style.cssText.replace(/( ?; ?)/g, ';').replace(/( ?: ?)/g, ':');\r\n            if (browser.opera) {\r\n                styleA = nodeA.style;\r\n                styleB = nodeB.style;\r\n                if (styleA.length != styleB.length)\r\n                    return false;\r\n                for (var p in styleA) {\r\n                    if (/^(\\d+|csstext)$/i.test(p)) {\r\n                        continue;\r\n                    }\r\n                    if (styleA[p] != styleB[p]) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            if (!styleA || !styleB) {\r\n                return styleA == styleB;\r\n            }\r\n            styleA = styleA.split(';');\r\n            styleB = styleB.split(';');\r\n            if (styleA.length != styleB.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0, ci; ci = styleA[i++];) {\r\n                if (utils.indexOf(styleB, ci) == -1) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        /**\r\n         * 检查节点node是否为block元素\r\n         * @method isBlockElm\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Boolean } 是否是block元素节点\r\n         * @warning 该方法的判断规则如下： 如果该元素原本是block元素， 则不论该元素当前的css样式是什么都会返回true；\r\n         *          否则，检测该元素的css样式， 如果该元素当前是block元素， 则返回true。 其余情况下都返回false。\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test1\" style=\"display: block\"></span>\r\n         * <span id=\"test2\"></span>\r\n         * <div id=\"test3\" style=\"display: inline\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test1\") ) );\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test2\") ) );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test3\") ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        isBlockElm: function (node) {\r\n            return node.nodeType == 1 && (dtd.$block[node.tagName] || styleBlock[domUtils.getComputedStyle(node, 'display')]) && !dtd.$nonChild[node.tagName];\r\n        },\r\n        /**\r\n         * 检测node节点是否为body节点\r\n         * @method isBody\r\n         * @param { Element } node 需要检测的dom元素\r\n         * @return { Boolean } 给定的元素是否是body元素\r\n         * @example\r\n         * ```javascript\r\n         * //output: true\r\n         * console.log( UE.dom.domUtils.isBody( document.body ) );\r\n         * ```\r\n         */\r\n        isBody: function (node) {\r\n            return node && node.nodeType == 1 && node.tagName.toLowerCase() == 'body';\r\n        },\r\n        /**\r\n         * 以node节点为分界，将该节点的指定祖先节点parent拆分成两个独立的节点，\r\n         * 拆分形成的两个节点之间是node节点\r\n         * @method breakParent\r\n         * @param { Node } node 作为分界的节点对象\r\n         * @param { Node } parent 该节点必须是node节点的祖先节点， 且是block节点。\r\n         * @return { Node } 给定的node分界节点\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         *      var node = document.createElement(\"span\"),\r\n         *          wrapNode = document.createElement( \"div\" ),\r\n         *          parent = document.createElement(\"p\");\r\n         *\r\n         *      parent.appendChild( node );\r\n         *      wrapNode.appendChild( parent );\r\n         *\r\n         *      //拆分前\r\n         *      //output: <p><span></span></p>\r\n         *      console.log( wrapNode.innerHTML );\r\n         *\r\n         *\r\n         *      UE.dom.domUtils.breakParent( node, parent );\r\n         *      //拆分后\r\n         *      //output: <p></p><span></span><p></p>\r\n         *      console.log( wrapNode.innerHTML );\r\n         *\r\n         * ```\r\n         */\r\n        breakParent: function (node, parent) {\r\n            var tmpNode,\r\n                parentClone = node,\r\n                clone = node,\r\n                leftNodes,\r\n                rightNodes;\r\n            do {\r\n                parentClone = parentClone.parentNode;\r\n                if (leftNodes) {\r\n                    tmpNode = parentClone.cloneNode(false);\r\n                    tmpNode.appendChild(leftNodes);\r\n                    leftNodes = tmpNode;\r\n                    tmpNode = parentClone.cloneNode(false);\r\n                    tmpNode.appendChild(rightNodes);\r\n                    rightNodes = tmpNode;\r\n                } else {\r\n                    leftNodes = parentClone.cloneNode(false);\r\n                    rightNodes = leftNodes.cloneNode(false);\r\n                }\r\n                while (tmpNode = clone.previousSibling) {\r\n                    leftNodes.insertBefore(tmpNode, leftNodes.firstChild);\r\n                }\r\n                while (tmpNode = clone.nextSibling) {\r\n                    rightNodes.appendChild(tmpNode);\r\n                }\r\n                clone = parentClone;\r\n            } while (parent !== parentClone);\r\n            tmpNode = parent.parentNode;\r\n            tmpNode.insertBefore(leftNodes, parent);\r\n            tmpNode.insertBefore(rightNodes, parent);\r\n            tmpNode.insertBefore(node, rightNodes);\r\n            domUtils.remove(parent);\r\n            return node;\r\n        },\r\n        /**\r\n         * 检查节点node是否是空inline节点\r\n         * @method  isEmptyInlineElement\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Number }  如果给定的节点是空的inline节点， 则返回1, 否则返回0。\r\n         * @example\r\n         * ```html\r\n         * <b><i></i></b> => 1\r\n         * <b><i></i><u></u></b> => 1\r\n         * <b></b> => 1\r\n         * <b>xx<i></i></b> => 0\r\n         * ```\r\n         */\r\n        isEmptyInlineElement: function (node) {\r\n            if (node.nodeType != 1 || !dtd.$removeEmpty[node.tagName]) {\r\n                return 0;\r\n            }\r\n            node = node.firstChild;\r\n            while (node) {\r\n                //如果是创建的bookmark就跳过\r\n                if (domUtils.isBookmarkNode(node)) {\r\n                    return 0;\r\n                }\r\n                if (node.nodeType == 1 && !domUtils.isEmptyInlineElement(node) ||\r\n                    node.nodeType == 3 && !domUtils.isWhitespace(node)\r\n                ) {\r\n                    return 0;\r\n                }\r\n                node = node.nextSibling;\r\n            }\r\n            return 1;\r\n\r\n        },\r\n\r\n        /**\r\n         * 删除node节点下首尾两端的空白文本子节点\r\n         * @method trimWhiteTextNode\r\n         * @param { Element } node 需要执行删除操作的元素对象\r\n         * @example\r\n         * ```javascript\r\n         *      var node = document.createElement(\"div\");\r\n         *\r\n         *      node.appendChild( document.createTextNode( \"\" ) );\r\n         *\r\n         *      node.appendChild( document.createElement(\"div\") );\r\n         *\r\n         *      node.appendChild( document.createTextNode( \"\" ) );\r\n         *\r\n         *      //3\r\n         *      console.log( node.childNodes.length );\r\n         *\r\n         *      UE.dom.domUtils.trimWhiteTextNode( node );\r\n         *\r\n         *      //1\r\n         *      console.log( node.childNodes.length );\r\n         * ```\r\n         */\r\n        trimWhiteTextNode: function (node) {\r\n            function remove(dir) {\r\n                var child;\r\n                while ((child = node[dir]) && child.nodeType == 3 && domUtils.isWhitespace(child)) {\r\n                    node.removeChild(child);\r\n                }\r\n            }\r\n            remove('firstChild');\r\n            remove('lastChild');\r\n        },\r\n\r\n        /**\r\n         * 合并node节点下相同的子节点\r\n         * @name mergeChild\r\n         * @desc\r\n         * UE.dom.domUtils.mergeChild(node,tagName) //tagName要合并的子节点的标签\r\n         * @example\r\n         * <p><span style=\"font-size:12px;\">xx<span style=\"font-size:12px;\">aa</span>xx</span></p>\r\n         * ==> UE.dom.domUtils.mergeChild(node,'span')\r\n         * <p><span style=\"font-size:12px;\">xxaaxx</span></p>\r\n         */\r\n        mergeChild: function (node, tagName, attrs) {\r\n            var list = domUtils.getElementsByTagName(node, node.tagName.toLowerCase());\r\n            for (var i = 0, ci; ci = list[i++];) {\r\n                if (!ci.parentNode || domUtils.isBookmarkNode(ci)) {\r\n                    continue;\r\n                }\r\n                //span单独处理\r\n                if (ci.tagName.toLowerCase() == 'span') {\r\n                    if (node === ci.parentNode) {\r\n                        domUtils.trimWhiteTextNode(node);\r\n                        if (node.childNodes.length == 1) {\r\n                            node.style.cssText = ci.style.cssText + \";\" + node.style.cssText;\r\n                            domUtils.remove(ci, true);\r\n                            continue;\r\n                        }\r\n                    }\r\n                    ci.style.cssText = node.style.cssText + ';' + ci.style.cssText;\r\n                    if (attrs) {\r\n                        var style = attrs.style;\r\n                        if (style) {\r\n                            style = style.split(';');\r\n                            for (var j = 0, s; s = style[j++];) {\r\n                                ci.style[utils.cssStyleToDomStyle(s.split(':')[0])] = s.split(':')[1];\r\n                            }\r\n                        }\r\n                    }\r\n                    if (domUtils.isSameStyle(ci, node)) {\r\n                        domUtils.remove(ci, true);\r\n                    }\r\n                    continue;\r\n                }\r\n                if (domUtils.isSameElement(node, ci)) {\r\n                    domUtils.remove(ci, true);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 原生方法getElementsByTagName的封装\r\n         * @method getElementsByTagName\r\n         * @param { Node } node 目标节点对象\r\n         * @param { String } tagName 需要查找的节点的tagName， 多个tagName以空格分割\r\n         * @return { Array } 符合条件的节点集合\r\n         */\r\n        getElementsByTagName: function (node, name, filter) {\r\n            if (filter && utils.isString(filter)) {\r\n                var className = filter;\r\n                filter = function (node) { return domUtils.hasClass(node, className) }\r\n            }\r\n            name = utils.trim(name).replace(/[ ]{2,}/g, ' ').split(' ');\r\n            var arr = [];\r\n            for (var n = 0, ni; ni = name[n++];) {\r\n                var list = node.getElementsByTagName(ni);\r\n                for (var i = 0, ci; ci = list[i++];) {\r\n                    if (!filter || filter(ci))\r\n                        arr.push(ci);\r\n                }\r\n            }\r\n\r\n            return arr;\r\n        },\r\n        /**\r\n         * 将节点node提取到父节点上\r\n         * @method mergeToParent\r\n         * @param { Element } node 需要提取的元素对象\r\n         * @example\r\n         * ```html\r\n         * <div id=\"parent\">\r\n         *     <div id=\"sub\">\r\n         *         <span id=\"child\"></span>\r\n         *     </div>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var child = document.getElementById( \"child\" );\r\n         *\r\n         *     //output: sub\r\n         *     console.log( child.parentNode.id );\r\n         *\r\n         *     UE.dom.domUtils.mergeToParent( child );\r\n         *\r\n         *     //output: parent\r\n         *     console.log( child.parentNode.id );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        mergeToParent: function (node) {\r\n            var parent = node.parentNode;\r\n            while (parent && dtd.$removeEmpty[parent.tagName]) {\r\n                if (parent.tagName == node.tagName || parent.tagName == 'A') {//针对a标签单独处理\r\n                    domUtils.trimWhiteTextNode(parent);\r\n                    //span需要特殊处理  不处理这样的情况 <span stlye=\"color:#fff\">xxx<span style=\"color:#ccc\">xxx</span>xxx</span>\r\n                    if (parent.tagName == 'SPAN' && !domUtils.isSameStyle(parent, node)\r\n                        || (parent.tagName == 'A' && node.tagName == 'SPAN')) {\r\n                        if (parent.childNodes.length > 1 || parent !== node.parentNode) {\r\n                            node.style.cssText = parent.style.cssText + \";\" + node.style.cssText;\r\n                            parent = parent.parentNode;\r\n                            continue;\r\n                        } else {\r\n                            parent.style.cssText += \";\" + node.style.cssText;\r\n                            //trace:952 a标签要保持下划线\r\n                            if (parent.tagName == 'A') {\r\n                                parent.style.textDecoration = 'underline';\r\n                            }\r\n                        }\r\n                    }\r\n                    if (parent.tagName != 'A') {\r\n                        parent === node.parentNode && domUtils.remove(node, true);\r\n                        break;\r\n                    }\r\n                }\r\n                parent = parent.parentNode;\r\n            }\r\n        },\r\n        /**\r\n         * 合并节点node的左右兄弟节点\r\n         * @method mergeSibling\r\n         * @param { Element } node 需要合并的目标节点\r\n         * @example\r\n         * ```html\r\n         * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n         *\r\n         * <script>\r\n         *     var demoNode = document.getElementById(\"test\");\r\n         *     UE.dom.domUtils.mergeSibling( demoNode );\r\n         *     //output: xxxxoooxxxx\r\n         *     console.log( demoNode.innerHTML );\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 合并节点node的左右兄弟节点， 可以根据给定的条件选择是否忽略合并左节点。\r\n         * @method mergeSibling\r\n         * @param { Element } node 需要合并的目标节点\r\n         * @param { Boolean } ignorePre 是否忽略合并左节点\r\n         * @example\r\n         * ```html\r\n         * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n         *\r\n         * <script>\r\n         *     var demoNode = document.getElementById(\"test\");\r\n         *     UE.dom.domUtils.mergeSibling( demoNode, true );\r\n         *     //output: oooxxxx\r\n         *     console.log( demoNode.innerHTML );\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 合并节点node的左右兄弟节点，可以根据给定的条件选择是否忽略合并左右节点。\r\n         * @method mergeSibling\r\n         * @param { Element } node 需要合并的目标节点\r\n         * @param { Boolean } ignorePre 是否忽略合并左节点\r\n         * @param { Boolean } ignoreNext 是否忽略合并右节点\r\n         * @remind 如果同时忽略左右节点， 则该操作什么也不会做\r\n         * @example\r\n         * ```html\r\n         * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n         *\r\n         * <script>\r\n         *     var demoNode = document.getElementById(\"test\");\r\n         *     UE.dom.domUtils.mergeSibling( demoNode, false, true );\r\n         *     //output: xxxxooo\r\n         *     console.log( demoNode.innerHTML );\r\n         * </script>\r\n         * ```\r\n         */\r\n        mergeSibling: function (node, ignorePre, ignoreNext) {\r\n            function merge(rtl, start, node) {\r\n                var next;\r\n                if ((next = node[rtl]) && !domUtils.isBookmarkNode(next) && next.nodeType == 1 && domUtils.isSameElement(node, next)) {\r\n                    while (next.firstChild) {\r\n                        if (start == 'firstChild') {\r\n                            node.insertBefore(next.lastChild, node.firstChild);\r\n                        } else {\r\n                            node.appendChild(next.firstChild);\r\n                        }\r\n                    }\r\n                    domUtils.remove(next);\r\n                }\r\n            }\r\n            !ignorePre && merge('previousSibling', 'firstChild', node);\r\n            !ignoreNext && merge('nextSibling', 'lastChild', node);\r\n        },\r\n\r\n        /**\r\n         * 设置节点node及其子节点不会被选中\r\n         * @method unSelectable\r\n         * @param { Element } node 需要执行操作的dom元素\r\n         * @remind 执行该操作后的节点， 将不能被鼠标选中\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.unSelectable( document.body );\r\n         * ```\r\n         */\r\n        unSelectable: ie && browser.ie9below || browser.opera ? function (node) {\r\n            //for ie9\r\n            node.onselectstart = function () {\r\n                return false;\r\n            };\r\n            node.onclick = node.onkeyup = node.onkeydown = function () {\r\n                return false;\r\n            };\r\n            node.unselectable = 'on';\r\n            node.setAttribute(\"unselectable\", \"on\");\r\n            for (var i = 0, ci; ci = node.all[i++];) {\r\n                switch (ci.tagName.toLowerCase()) {\r\n                    case 'iframe':\r\n                    case 'textarea':\r\n                    case 'input':\r\n                    case 'select':\r\n                        break;\r\n                    default:\r\n                        ci.unselectable = 'on';\r\n                        node.setAttribute(\"unselectable\", \"on\");\r\n                }\r\n            }\r\n        } : function (node) {\r\n            node.style.MozUserSelect =\r\n                node.style.webkitUserSelect =\r\n                node.style.msUserSelect =\r\n                node.style.KhtmlUserSelect = 'none';\r\n        },\r\n        /**\r\n         * 删除节点node上的指定属性名称的属性\r\n         * @method  removeAttributes\r\n         * @param { Node } node 需要删除属性的节点对象\r\n         * @param { String } attrNames 可以是空格隔开的多个属性名称，该操作将会依次删除相应的属性\r\n         * @example\r\n         * ```html\r\n         * <div id=\"wrap\">\r\n         *      <span style=\"font-size:14px;\" id=\"test\" name=\"followMe\">xxxxx</span>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     UE.dom.domUtils.removeAttributes( document.getElementById( \"test\" ), \"id name\" );\r\n         *\r\n         *     //output: <span style=\"font-size:14px;\">xxxxx</span>\r\n         *     console.log( document.getElementById(\"wrap\").innerHTML );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 删除节点node上的指定属性名称的属性\r\n         * @method  removeAttributes\r\n         * @param { Node } node 需要删除属性的节点对象\r\n         * @param { Array } attrNames 需要删除的属性名数组\r\n         * @example\r\n         * ```html\r\n         * <div id=\"wrap\">\r\n         *      <span style=\"font-size:14px;\" id=\"test\" name=\"followMe\">xxxxx</span>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     UE.dom.domUtils.removeAttributes( document.getElementById( \"test\" ), [\"id\", \"name\"] );\r\n         *\r\n         *     //output: <span style=\"font-size:14px;\">xxxxx</span>\r\n         *     console.log( document.getElementById(\"wrap\").innerHTML );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        removeAttributes: function (node, attrNames) {\r\n            attrNames = utils.isArray(attrNames) ? attrNames : utils.trim(attrNames).replace(/[ ]{2,}/g, ' ').split(' ');\r\n            for (var i = 0, ci; ci = attrNames[i++];) {\r\n                ci = attrFix[ci] || ci;\r\n                switch (ci) {\r\n                    case 'className':\r\n                        node[ci] = '';\r\n                        break;\r\n                    case 'style':\r\n                        node.style.cssText = '';\r\n                        var val = node.getAttributeNode('style');\r\n                        !browser.ie && val && node.removeAttributeNode(val);\r\n                }\r\n                node.removeAttribute(ci);\r\n            }\r\n        },\r\n        /**\r\n         * 在doc下创建一个标签名为tag，属性为attrs的元素\r\n         * @method createElement\r\n         * @param { DomDocument } doc 新创建的元素属于该document节点创建\r\n         * @param { String } tagName 需要创建的元素的标签名\r\n         * @param { Object } attrs 新创建的元素的属性key-value集合\r\n         * @return { Element } 新创建的元素对象\r\n         * @example\r\n         * ```javascript\r\n         * var ele = UE.dom.domUtils.createElement( document, 'div', {\r\n         *     id: 'test'\r\n         * } );\r\n         *\r\n         * //output: DIV\r\n         * console.log( ele.tagName );\r\n         *\r\n         * //output: test\r\n         * console.log( ele.id );\r\n         *\r\n         * ```\r\n         */\r\n        createElement: function (doc, tag, attrs) {\r\n            return domUtils.setAttributes(doc.createElement(tag), attrs)\r\n        },\r\n        /**\r\n         * 为节点node添加属性attrs，attrs为属性键值对\r\n         * @method setAttributes\r\n         * @param { Element } node 需要设置属性的元素对象\r\n         * @param { Object } attrs 需要设置的属性名-值对\r\n         * @return { Element } 设置属性的元素对象\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\"></span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var testNode = UE.dom.domUtils.setAttributes( document.getElementById( \"test\" ), {\r\n         *         id: 'demo'\r\n         *     } );\r\n         *\r\n         *     //output: demo\r\n         *     console.log( testNode.id );\r\n         *\r\n         * </script>\r\n         *\r\n         */\r\n        setAttributes: function (node, attrs) {\r\n            for (var attr in attrs) {\r\n                if (attrs.hasOwnProperty(attr)) {\r\n                    var value = attrs[attr];\r\n                    switch (attr) {\r\n                        case 'class':\r\n                            //ie下要这样赋值，setAttribute不起作用\r\n                            node.className = value;\r\n                            break;\r\n                        case 'style':\r\n                            node.style.cssText = node.style.cssText + \";\" + value;\r\n                            break;\r\n                        case 'innerHTML':\r\n                            node[attr] = value;\r\n                            break;\r\n                        case 'value':\r\n                            node.value = value;\r\n                            break;\r\n                        default:\r\n                            node.setAttribute(attrFix[attr] || attr, value);\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        },\r\n\r\n        /**\r\n         * 获取元素element经过计算后的样式值\r\n         * @method getComputedStyle\r\n         * @param { Element } element 需要获取样式的元素对象\r\n         * @param { String } styleName 需要获取的样式名\r\n         * @return { String } 获取到的样式值\r\n         * @example\r\n         * ```html\r\n         * <style type=\"text/css\">\r\n         *      #test {\r\n         *          font-size: 15px;\r\n         *      }\r\n         * </style>\r\n         *\r\n         * <span id=\"test\"></span>\r\n         *\r\n         * <script>\r\n         *     //output: 15px\r\n         *     console.log( UE.dom.domUtils.getComputedStyle( document.getElementById( \"test\" ), 'font-size' ) );\r\n         * </script>\r\n         * ```\r\n         */\r\n        getComputedStyle: function (element, styleName) {\r\n            //一下的属性单独处理\r\n            var pros = 'width height top left';\r\n\r\n            if (pros.indexOf(styleName) > -1) {\r\n                return element['offset' + styleName.replace(/^\\w/, function (s) { return s.toUpperCase() })] + 'px';\r\n            }\r\n            //忽略文本节点\r\n            if (element.nodeType == 3) {\r\n                element = element.parentNode;\r\n            }\r\n            //ie下font-size若body下定义了font-size，则从currentStyle里会取到这个font-size. 取不到实际值，故此修改.\r\n            if (browser.ie && browser.version < 9 && styleName == 'font-size' && !element.style.fontSize &&\r\n                !dtd.$empty[element.tagName] && !dtd.$nonChild[element.tagName]) {\r\n                var span = element.ownerDocument.createElement('span');\r\n                span.style.cssText = 'padding:0;border:0;font-family:simsun;';\r\n                span.innerHTML = '.';\r\n                element.appendChild(span);\r\n                var result = span.offsetHeight;\r\n                element.removeChild(span);\r\n                span = null;\r\n                return result + 'px';\r\n            }\r\n            try {\r\n                var value = domUtils.getStyle(element, styleName) ||\r\n                    (window.getComputedStyle ? domUtils.getWindow(element).getComputedStyle(element, '').getPropertyValue(styleName) :\r\n                        (element.currentStyle || element.style)[utils.cssStyleToDomStyle(styleName)]);\r\n\r\n            } catch (e) {\r\n                return \"\";\r\n            }\r\n            return utils.transUnitToPx(utils.fixColor(styleName, value));\r\n        },\r\n        /**\r\n         * 删除元素element指定的className\r\n         * @method removeClasses\r\n         * @param { Element } ele 需要删除class的元素节点\r\n         * @param { String } classNames 需要删除的className， 多个className之间以空格分开\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\" class=\"test1 test2 test3\">xxx</span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var testNode = document.getElementById( \"test\" );\r\n         *     UE.dom.domUtils.removeClasses( testNode, \"test1 test2\" );\r\n         *\r\n         *     //output: test3\r\n         *     console.log( testNode.className );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 删除元素element指定的className\r\n         * @method removeClasses\r\n         * @param { Element } ele 需要删除class的元素节点\r\n         * @param { Array } classNames 需要删除的className数组\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\" class=\"test1 test2 test3\">xxx</span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var testNode = document.getElementById( \"test\" );\r\n         *     UE.dom.domUtils.removeClasses( testNode, [\"test1\", \"test2\"] );\r\n         *\r\n         *     //output: test3\r\n         *     console.log( testNode.className );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        removeClasses: function (elm, classNames) {\r\n            classNames = utils.isArray(classNames) ? classNames :\r\n                utils.trim(classNames).replace(/[ ]{2,}/g, ' ').split(' ');\r\n            for (var i = 0, ci, cls = elm.className; ci = classNames[i++];) {\r\n                cls = cls.replace(new RegExp('\\\\b' + ci + '\\\\b'), '')\r\n            }\r\n            cls = utils.trim(cls).replace(/[ ]{2,}/g, ' ');\r\n            if (cls) {\r\n                elm.className = cls;\r\n            } else {\r\n                domUtils.removeAttributes(elm, ['class']);\r\n            }\r\n        },\r\n        /**\r\n         * 给元素element添加className\r\n         * @method addClass\r\n         * @param { Node } ele 需要增加className的元素\r\n         * @param { String } classNames 需要添加的className， 多个className之间以空格分割\r\n         * @remind 相同的类名不会被重复添加\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\" class=\"cls1 cls2\"></span>\r\n         *\r\n         * <script>\r\n         *     var testNode = document.getElementById(\"test\");\r\n         *\r\n         *     UE.dom.domUtils.addClass( testNode, \"cls2 cls3 cls4\" );\r\n         *\r\n         *     //output: cl1 cls2 cls3 cls4\r\n         *     console.log( testNode.className );\r\n         *\r\n         * <script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 给元素element添加className\r\n         * @method addClass\r\n         * @param { Node } ele 需要增加className的元素\r\n         * @param { Array } classNames 需要添加的className的数组\r\n         * @remind 相同的类名不会被重复添加\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\" class=\"cls1 cls2\"></span>\r\n         *\r\n         * <script>\r\n         *     var testNode = document.getElementById(\"test\");\r\n         *\r\n         *     UE.dom.domUtils.addClass( testNode, [\"cls2\", \"cls3\", \"cls4\"] );\r\n         *\r\n         *     //output: cl1 cls2 cls3 cls4\r\n         *     console.log( testNode.className );\r\n         *\r\n         * <script>\r\n         * ```\r\n         */\r\n        addClass: function (elm, classNames) {\r\n            if (!elm) return;\r\n            classNames = utils.trim(classNames).replace(/[ ]{2,}/g, ' ').split(' ');\r\n            for (var i = 0, ci, cls = elm.className; ci = classNames[i++];) {\r\n                if (!new RegExp('\\\\b' + ci + '\\\\b').test(cls)) {\r\n                    cls += ' ' + ci;\r\n                }\r\n            }\r\n            elm.className = utils.trim(cls);\r\n        },\r\n        /**\r\n         * 判断元素element是否包含给定的样式类名className\r\n         * @method hasClass\r\n         * @param { Node } ele 需要检测的元素\r\n         * @param { String } classNames 需要检测的className， 多个className之间用空格分割\r\n         * @return { Boolean } 元素是否包含所有给定的className\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test1\" class=\"cls1 cls2\"></span>\r\n         *\r\n         * <script>\r\n         *     var test1 = document.getElementById(\"test1\");\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.hasClass( test1, \"cls2 cls1 cls3\" ) );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.hasClass( test1, \"cls2 cls1\" ) );\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 判断元素element是否包含给定的样式类名className\r\n         * @method hasClass\r\n         * @param { Node } ele 需要检测的元素\r\n         * @param { Array } classNames 需要检测的className数组\r\n         * @return { Boolean } 元素是否包含所有给定的className\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test1\" class=\"cls1 cls2\"></span>\r\n         *\r\n         * <script>\r\n         *     var test1 = document.getElementById(\"test1\");\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.hasClass( test1, [ \"cls2\", \"cls1\", \"cls3\" ] ) );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.hasClass( test1, [ \"cls2\", \"cls1\" ]) );\r\n         * </script>\r\n         * ```\r\n         */\r\n        hasClass: function (element, className) {\r\n            if (utils.isRegExp(className)) {\r\n                return className.test(element.className)\r\n            }\r\n            className = utils.trim(className).replace(/[ ]{2,}/g, ' ').split(' ');\r\n            for (var i = 0, ci, cls = element.className; ci = className[i++];) {\r\n                if (!new RegExp('\\\\b' + ci + '\\\\b', 'i').test(cls)) {\r\n                    return false;\r\n                }\r\n            }\r\n            return i - 1 == className.length;\r\n        },\r\n\r\n        /**\r\n         * 阻止事件默认行为\r\n         * @method preventDefault\r\n         * @param { Event } evt 需要阻止默认行为的事件对象\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.preventDefault( evt );\r\n         * ```\r\n         */\r\n        preventDefault: function (evt) {\r\n            evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\r\n        },\r\n        /**\r\n         * 删除元素element指定的样式\r\n         * @method removeStyle\r\n         * @param { Element } element 需要删除样式的元素\r\n         * @param { String } styleName 需要删除的样式名\r\n         * @example\r\n         * ```html\r\n         * <span id=\"test\" style=\"color: red; background: blue;\"></span>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var testNode = document.getElementById(\"test\");\r\n         *\r\n         *     UE.dom.domUtils.removeStyle( testNode, 'color' );\r\n         *\r\n         *     //output: background: blue;\r\n         *     console.log( testNode.style.cssText );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        removeStyle: function (element, name) {\r\n            if (browser.ie) {\r\n                //针对color先单独处理一下\r\n                if (name == 'color') {\r\n                    name = '(^|;)' + name;\r\n                }\r\n                element.style.cssText = element.style.cssText.replace(new RegExp(name + '[^:]*:[^;]+;?', 'ig'), '')\r\n            } else {\r\n                if (element.style.removeProperty) {\r\n                    element.style.removeProperty(name);\r\n                } else {\r\n                    element.style.removeAttribute(utils.cssStyleToDomStyle(name));\r\n                }\r\n            }\r\n\r\n\r\n            if (!element.style.cssText) {\r\n                domUtils.removeAttributes(element, ['style']);\r\n            }\r\n        },\r\n        /**\r\n         * 获取元素element的style属性的指定值\r\n         * @method getStyle\r\n         * @param { Element } element 需要获取属性值的元素\r\n         * @param { String } styleName 需要获取的style的名称\r\n         * @warning 该方法仅获取元素style属性中所标明的值\r\n         * @return { String } 该元素包含指定的style属性值\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\" style=\"color: red;\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *      var testNode = document.getElementById( \"test\" );\r\n         *\r\n         *      //output: red\r\n         *      console.log( UE.dom.domUtils.getStyle( testNode, \"color\" ) );\r\n         *\r\n         *      //output: \"\"\r\n         *      console.log( UE.dom.domUtils.getStyle( testNode, \"background\" ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        getStyle: function (element, name) {\r\n            var value = element.style[utils.cssStyleToDomStyle(name)];\r\n            return utils.fixColor(name, value);\r\n        },\r\n        /**\r\n         * 为元素element设置样式属性值\r\n         * @method setStyle\r\n         * @param { Element } element 需要设置样式的元素\r\n         * @param { String } styleName 样式名\r\n         * @param { String } styleValue 样式值\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *      var testNode = document.getElementById( \"test\" );\r\n         *\r\n         *      //output: \"\"\r\n         *      console.log( testNode.style.color );\r\n         *\r\n         *      UE.dom.domUtils.setStyle( testNode, 'color', 'red' );\r\n         *      //output: \"red\"\r\n         *      console.log( testNode.style.color );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        setStyle: function (element, name, value) {\r\n            element.style[utils.cssStyleToDomStyle(name)] = value;\r\n            if (!utils.trim(element.style.cssText)) {\r\n                this.removeAttributes(element, 'style')\r\n            }\r\n        },\r\n        /**\r\n         * 为元素element设置多个样式属性值\r\n         * @method setStyles\r\n         * @param { Element } element 需要设置样式的元素\r\n         * @param { Object } styles 样式名值对\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *      var testNode = document.getElementById( \"test\" );\r\n         *\r\n         *      //output: \"\"\r\n         *      console.log( testNode.style.color );\r\n         *\r\n         *      UE.dom.domUtils.setStyles( testNode, {\r\n         *          'color': 'red'\r\n         *      } );\r\n         *      //output: \"red\"\r\n         *      console.log( testNode.style.color );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        setStyles: function (element, styles) {\r\n            for (var name in styles) {\r\n                if (styles.hasOwnProperty(name)) {\r\n                    domUtils.setStyle(element, name, styles[name]);\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * 删除_moz_dirty属性\r\n         * @private\r\n         * @method removeDirtyAttr\r\n         */\r\n        removeDirtyAttr: function (node) {\r\n            for (var i = 0, ci, nodes = node.getElementsByTagName('*'); ci = nodes[i++];) {\r\n                ci.removeAttribute('_moz_dirty');\r\n            }\r\n            node.removeAttribute('_moz_dirty');\r\n        },\r\n        /**\r\n         * 获取子节点的数量\r\n         * @method getChildCount\r\n         * @param { Element } node 需要检测的元素\r\n         * @return { Number } 给定的node元素的子节点数量\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">\r\n         *      <span></span>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: 3\r\n         *     console.log( UE.dom.domUtils.getChildCount( document.getElementById(\"test\") ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 根据给定的过滤规则， 获取符合条件的子节点的数量\r\n         * @method getChildCount\r\n         * @param { Element } node 需要检测的元素\r\n         * @param { Function } fn 过滤器， 要求对符合条件的子节点返回true， 反之则要求返回false\r\n         * @return { Number } 符合过滤条件的node元素的子节点数量\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\">\r\n         *      <span></span>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: 1\r\n         *     console.log( UE.dom.domUtils.getChildCount( document.getElementById(\"test\"), function ( node ) {\r\n         *\r\n         *         return node.nodeType === 1;\r\n         *\r\n         *     } ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        getChildCount: function (node, fn) {\r\n            var count = 0, first = node.firstChild;\r\n            fn = fn || function () {\r\n                return 1;\r\n            };\r\n            while (first) {\r\n                if (fn(first)) {\r\n                    count++;\r\n                }\r\n                first = first.nextSibling;\r\n            }\r\n            return count;\r\n        },\r\n\r\n        /**\r\n         * 判断给定节点是否为空节点\r\n         * @method isEmptyNode\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Boolean } 节点是否为空\r\n         * @example\r\n         * ```javascript\r\n         * UE.dom.domUtils.isEmptyNode( document.body );\r\n         * ```\r\n         */\r\n        isEmptyNode: function (node) {\r\n            return !node.firstChild || domUtils.getChildCount(node, function (node) {\r\n                return !domUtils.isBr(node) && !domUtils.isBookmarkNode(node) && !domUtils.isWhitespace(node)\r\n            }) == 0\r\n        },\r\n        clearSelectedArr: function (nodes) {\r\n            var node;\r\n            while (node = nodes.pop()) {\r\n                domUtils.removeAttributes(node, ['class']);\r\n            }\r\n        },\r\n        /**\r\n         * 将显示区域滚动到指定节点的位置\r\n         * @method scrollToView\r\n         * @param    {Node}   node    节点\r\n         * @param    {window}   win      window对象\r\n         * @param    {Number}    offsetTop    距离上方的偏移量\r\n         */\r\n        scrollToView: function (node, win, offsetTop) {\r\n            var getViewPaneSize = function () {\r\n                var doc = win.document,\r\n                    mode = doc.compatMode == 'CSS1Compat';\r\n                return {\r\n                    width: (mode ? doc.documentElement.clientWidth : doc.body.clientWidth) || 0,\r\n                    height: (mode ? doc.documentElement.clientHeight : doc.body.clientHeight) || 0\r\n                };\r\n            },\r\n                getScrollPosition = function (win) {\r\n                    if ('pageXOffset' in win) {\r\n                        return {\r\n                            x: win.pageXOffset || 0,\r\n                            y: win.pageYOffset || 0\r\n                        };\r\n                    }\r\n                    else {\r\n                        var doc = win.document;\r\n                        return {\r\n                            x: doc.documentElement.scrollLeft || doc.body.scrollLeft || 0,\r\n                            y: doc.documentElement.scrollTop || doc.body.scrollTop || 0\r\n                        };\r\n                    }\r\n                };\r\n            var winHeight = getViewPaneSize().height, offset = winHeight * -1 + offsetTop;\r\n            offset += (node.offsetHeight || 0);\r\n            var elementPosition = domUtils.getXY(node);\r\n            offset += elementPosition.y;\r\n            var currentScroll = getScrollPosition(win).y;\r\n            // offset += 50;\r\n            if (offset > currentScroll || offset < currentScroll - winHeight) {\r\n                win.scrollTo(0, offset + (offset < 0 ? -20 : 20));\r\n            }\r\n        },\r\n        /**\r\n         * 判断给定节点是否为br\r\n         * @method isBr\r\n         * @param { Node } node 需要判断的节点对象\r\n         * @return { Boolean } 给定的节点是否是br节点\r\n         */\r\n        isBr: function (node) {\r\n            return node.nodeType == 1 && node.tagName == 'BR';\r\n        },\r\n        /**\r\n         * 判断给定的节点是否是一个“填充”节点\r\n         * @private\r\n         * @method isFillChar\r\n         * @param { Node } node 需要判断的节点\r\n         * @param { Boolean } isInStart 是否从节点内容的开始位置匹配\r\n         * @returns { Boolean } 节点是否是填充节点\r\n         */\r\n        isFillChar: function (node, isInStart) {\r\n            if (node.nodeType != 3)\r\n                return false;\r\n            var text = node.nodeValue;\r\n            if (isInStart) {\r\n                return new RegExp('^' + domUtils.fillChar).test(text)\r\n            }\r\n            return !text.replace(new RegExp(domUtils.fillChar, 'g'), '').length\r\n        },\r\n        isStartInblock: function (range) {\r\n            var tmpRange = range.cloneRange(),\r\n                flag = 0,\r\n                start = tmpRange.startContainer,\r\n                tmp;\r\n            if (start.nodeType == 1 && start.childNodes[tmpRange.startOffset]) {\r\n                start = start.childNodes[tmpRange.startOffset];\r\n                var pre = start.previousSibling;\r\n                while (pre && domUtils.isFillChar(pre)) {\r\n                    start = pre;\r\n                    pre = pre.previousSibling;\r\n                }\r\n            }\r\n            if (this.isFillChar(start, true) && tmpRange.startOffset == 1) {\r\n                tmpRange.setStartBefore(start);\r\n                start = tmpRange.startContainer;\r\n            }\r\n\r\n            while (start && domUtils.isFillChar(start)) {\r\n                tmp = start;\r\n                start = start.previousSibling\r\n            }\r\n            if (tmp) {\r\n                tmpRange.setStartBefore(tmp);\r\n                start = tmpRange.startContainer;\r\n            }\r\n            if (start.nodeType == 1 && domUtils.isEmptyNode(start) && tmpRange.startOffset == 1) {\r\n                tmpRange.setStart(start, 0).collapse(true);\r\n            }\r\n            while (!tmpRange.startOffset) {\r\n                start = tmpRange.startContainer;\r\n                if (domUtils.isBlockElm(start) || domUtils.isBody(start)) {\r\n                    flag = 1;\r\n                    break;\r\n                }\r\n                var pre = tmpRange.startContainer.previousSibling,\r\n                    tmpNode;\r\n                if (!pre) {\r\n                    tmpRange.setStartBefore(tmpRange.startContainer);\r\n                } else {\r\n                    while (pre && domUtils.isFillChar(pre)) {\r\n                        tmpNode = pre;\r\n                        pre = pre.previousSibling;\r\n                    }\r\n                    if (tmpNode) {\r\n                        tmpRange.setStartBefore(tmpNode);\r\n                    } else {\r\n                        tmpRange.setStartBefore(tmpRange.startContainer);\r\n                    }\r\n                }\r\n            }\r\n            return flag && !domUtils.isBody(tmpRange.startContainer) ? 1 : 0;\r\n        },\r\n\r\n        /**\r\n         * 判断给定的元素是否是一个空元素\r\n         * @method isEmptyBlock\r\n         * @param { Element } node 需要判断的元素\r\n         * @return { Boolean } 是否是空元素\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"></div>\r\n         *\r\n         * <script>\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isEmptyBlock( document.getElementById(\"test\") ) );\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 根据指定的判断规则判断给定的元素是否是一个空元素\r\n         * @method isEmptyBlock\r\n         * @param { Element } node 需要判断的元素\r\n         * @param { RegExp } reg 对内容执行判断的正则表达式对象\r\n         * @return { Boolean } 是否是空元素\r\n         */\r\n        isEmptyBlock: function (node, reg) {\r\n            if (node.nodeType != 1)\r\n                return 0;\r\n            reg = reg || new RegExp('[ \\xa0\\t\\r\\n' + domUtils.fillChar + ']', 'g');\r\n\r\n            if (node[browser.ie ? 'innerText' : 'textContent'].replace(reg, '').length > 0) {\r\n                return 0;\r\n            }\r\n            for (var n in dtd.$isNotEmpty) {\r\n                if (node.getElementsByTagName(n).length) {\r\n                    return 0;\r\n                }\r\n            }\r\n            return 1;\r\n        },\r\n\r\n        /**\r\n         * 移动元素使得该元素的位置移动指定的偏移量的距离\r\n         * @method setViewportOffset\r\n         * @param { Element } element 需要设置偏移量的元素\r\n         * @param { Object } offset 偏移量， 形如{ left: 100, top: 50 }的一个键值对， 表示该元素将在\r\n         *                                  现有的位置上向水平方向偏移offset.left的距离， 在竖直方向上偏移\r\n         *                                  offset.top的距离\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\" style=\"top: 100px; left: 50px; position: absolute;\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var testNode = document.getElementById(\"test\");\r\n         *\r\n         *     UE.dom.domUtils.setViewportOffset( testNode, {\r\n         *         left: 200,\r\n         *         top: 50\r\n         *     } );\r\n         *\r\n         *     //output: top: 300px; left: 100px; position: absolute;\r\n         *     console.log( testNode.style.cssText );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        setViewportOffset: function (element, offset) {\r\n            var left = parseInt(element.style.left) | 0;\r\n            var top = parseInt(element.style.top) | 0;\r\n            var rect = element.getBoundingClientRect();\r\n            var offsetLeft = offset.left - rect.left;\r\n            var offsetTop = offset.top - rect.top;\r\n            if (offsetLeft) {\r\n                element.style.left = left + offsetLeft + 'px';\r\n            }\r\n            if (offsetTop) {\r\n                element.style.top = top + offsetTop + 'px';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 用“填充字符”填充节点\r\n         * @method fillNode\r\n         * @private\r\n         * @param { DomDocument } doc 填充的节点所在的docment对象\r\n         * @param { Node } node 需要填充的节点对象\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"></div>\r\n         *\r\n         * <script>\r\n         *     var testNode = document.getElementById(\"test\");\r\n         *\r\n         *     //output: 0\r\n         *     console.log( testNode.childNodes.length );\r\n         *\r\n         *     UE.dom.domUtils.fillNode( document, testNode );\r\n         *\r\n         *     //output: 1\r\n         *     console.log( testNode.childNodes.length );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        fillNode: function (doc, node) {\r\n            var tmpNode = browser.ie ? doc.createTextNode(domUtils.fillChar) : doc.createElement('br');\r\n            node.innerHTML = '';\r\n            node.appendChild(tmpNode);\r\n        },\r\n\r\n        /**\r\n         * 把节点src的所有子节点追加到另一个节点tag上去\r\n         * @method moveChild\r\n         * @param { Node } src 源节点， 该节点下的所有子节点将被移除\r\n         * @param { Node } tag 目标节点， 从源节点移除的子节点将被追加到该节点下\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test1\">\r\n         *      <span></span>\r\n         * </div>\r\n         * <div id=\"test2\">\r\n         *     <div></div>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var test1 = document.getElementById(\"test1\"),\r\n         *         test2 = document.getElementById(\"test2\");\r\n         *\r\n         *     UE.dom.domUtils.moveChild( test1, test2 );\r\n         *\r\n         *     //output: \"\"（空字符串）\r\n         *     console.log( test1.innerHTML );\r\n         *\r\n         *     //output: \"<div></div><span></span>\"\r\n         *     console.log( test2.innerHTML );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 把节点src的所有子节点移动到另一个节点tag上去, 可以通过dir参数控制附加的行为是“追加”还是“插入顶部”\r\n         * @method moveChild\r\n         * @param { Node } src 源节点， 该节点下的所有子节点将被移除\r\n         * @param { Node } tag 目标节点， 从源节点移除的子节点将被附加到该节点下\r\n         * @param { Boolean } dir 附加方式， 如果为true， 则附加进去的节点将被放到目标节点的顶部， 反之，则放到末尾\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test1\">\r\n         *      <span></span>\r\n         * </div>\r\n         * <div id=\"test2\">\r\n         *     <div></div>\r\n         * </div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     var test1 = document.getElementById(\"test1\"),\r\n         *         test2 = document.getElementById(\"test2\");\r\n         *\r\n         *     UE.dom.domUtils.moveChild( test1, test2, true );\r\n         *\r\n         *     //output: \"\"（空字符串）\r\n         *     console.log( test1.innerHTML );\r\n         *\r\n         *     //output: \"<span></span><div></div>\"\r\n         *     console.log( test2.innerHTML );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        moveChild: function (src, tag, dir) {\r\n            while (src.firstChild) {\r\n                if (dir && tag.firstChild) {\r\n                    tag.insertBefore(src.lastChild, tag.firstChild);\r\n                } else {\r\n                    tag.appendChild(src.firstChild);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * 判断节点的标签上是否不存在任何属性\r\n         * @method hasNoAttributes\r\n         * @private\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @return { Boolean } 节点是否不包含任何属性\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"><span>xxxx</span></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: false\r\n         *     console.log( UE.dom.domUtils.hasNoAttributes( document.getElementById(\"test\") ) );\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.hasNoAttributes( document.getElementById(\"test\").firstChild ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        hasNoAttributes: function (node) {\r\n            return browser.ie ? /^<\\w+\\s*?>/.test(node.outerHTML) : node.attributes.length == 0;\r\n        },\r\n\r\n        /**\r\n         * 检测节点是否是UEditor所使用的辅助节点\r\n         * @method isCustomeNode\r\n         * @private\r\n         * @param { Node } node 需要检测的节点\r\n         * @remind 辅助节点是指编辑器要完成工作临时添加的节点， 在输出的时候将会从编辑器内移除， 不会影响最终的结果。\r\n         * @return { Boolean } 给定的节点是否是一个辅助节点\r\n         */\r\n        isCustomeNode: function (node) {\r\n            return node.nodeType == 1 && node.getAttribute('_ue_custom_node_');\r\n        },\r\n\r\n        /**\r\n         * 检测节点的标签是否是给定的标签\r\n         * @method isTagNode\r\n         * @param { Node } node 需要检测的节点对象\r\n         * @param { String } tagName 标签\r\n         * @return { Boolean } 节点的标签是否是给定的标签\r\n         * @example\r\n         * ```html\r\n         * <div id=\"test\"></div>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: true\r\n         *     console.log( UE.dom.domUtils.isTagNode( document.getElementById(\"test\"), \"div\" ) );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */\r\n        isTagNode: function (node, tagNames) {\r\n            return node.nodeType == 1 && new RegExp('\\\\b' + node.tagName + '\\\\b', 'i').test(tagNames)\r\n        },\r\n\r\n        /**\r\n         * 给定一个节点数组，在通过指定的过滤器过滤后， 获取其中满足过滤条件的第一个节点\r\n         * @method filterNodeList\r\n         * @param { Array } nodeList 需要过滤的节点数组\r\n         * @param { Function } fn 过滤器， 对符合条件的节点， 执行结果返回true， 反之则返回false\r\n         * @return { Node | NULL } 如果找到符合过滤条件的节点， 则返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var divNodes = document.getElementsByTagName(\"div\");\r\n         * divNodes = [].slice.call( divNodes, 0 );\r\n         *\r\n         * //output: null\r\n         * console.log( UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n         *     return node.tagName.toLowerCase() !== 'div';\r\n         * } ) );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 给定一个节点数组nodeList和一组标签名tagNames， 获取其中能够匹配标签名的节点集合中的第一个节点\r\n         * @method filterNodeList\r\n         * @param { Array } nodeList 需要过滤的节点数组\r\n         * @param { String } tagNames 需要匹配的标签名， 多个标签名之间用空格分割\r\n         * @return { Node | NULL } 如果找到标签名匹配的节点， 则返回该节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var divNodes = document.getElementsByTagName(\"div\");\r\n         * divNodes = [].slice.call( divNodes, 0 );\r\n         *\r\n         * //output: null\r\n         * console.log( UE.dom.domUtils.filterNodeList( divNodes, 'a span' ) );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 给定一个节点数组，在通过指定的过滤器过滤后， 如果参数forAll为true， 则会返回所有满足过滤\r\n         * 条件的节点集合， 否则， 返回满足条件的节点集合中的第一个节点\r\n         * @method filterNodeList\r\n         * @param { Array } nodeList 需要过滤的节点数组\r\n         * @param { Function } fn 过滤器， 对符合条件的节点， 执行结果返回true， 反之则返回false\r\n         * @param { Boolean } forAll 是否返回整个节点数组, 如果该参数为false， 则返回节点集合中的第一个节点\r\n         * @return { Array | Node | NULL } 如果找到符合过滤条件的节点， 则根据参数forAll的值决定返回满足\r\n         *                                      过滤条件的节点数组或第一个节点， 否则返回NULL\r\n         * @example\r\n         * ```javascript\r\n         * var divNodes = document.getElementsByTagName(\"div\");\r\n         * divNodes = [].slice.call( divNodes, 0 );\r\n         *\r\n         * //output: 3（假定有3个div）\r\n         * console.log( divNodes.length );\r\n         *\r\n         * var nodes = UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n         *     return node.tagName.toLowerCase() === 'div';\r\n         * }, true );\r\n         *\r\n         * //output: 3\r\n         * console.log( nodes.length );\r\n         *\r\n         * var node = UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n         *     return node.tagName.toLowerCase() === 'div';\r\n         * }, false );\r\n         *\r\n         * //output: div\r\n         * console.log( node.nodeName );\r\n         * ```\r\n         */\r\n        filterNodeList: function (nodelist, filter, forAll) {\r\n            var results = [];\r\n            if (!utils.isFunction(filter)) {\r\n                var str = filter;\r\n                filter = function (n) {\r\n                    return utils.indexOf(utils.isArray(str) ? str : str.split(' '), n.tagName.toLowerCase()) != -1\r\n                };\r\n            }\r\n            utils.each(nodelist, function (n) {\r\n                filter(n) && results.push(n)\r\n            });\r\n            return results.length == 0 ? null : results.length == 1 || !forAll ? results[0] : results\r\n        },\r\n\r\n        /**\r\n         * 查询给定的range选区是否在给定的node节点内，且在该节点的最末尾\r\n         * @method isInNodeEndBoundary\r\n         * @param { UE.dom.Range } rng 需要判断的range对象， 该对象的startContainer不能为NULL\r\n         * @param node 需要检测的节点对象\r\n         * @return { Number } 如果给定的选取range对象是在node内部的最末端， 则返回1, 否则返回0\r\n         */\r\n        isInNodeEndBoundary: function (rng, node) {\r\n            var start = rng.startContainer;\r\n            if (start.nodeType == 3 && rng.startOffset != start.nodeValue.length) {\r\n                return 0;\r\n            }\r\n            if (start.nodeType == 1 && rng.startOffset != start.childNodes.length) {\r\n                return 0;\r\n            }\r\n            while (start !== node) {\r\n                if (start.nextSibling) {\r\n                    return 0\r\n                };\r\n                start = start.parentNode;\r\n            }\r\n            return 1;\r\n        },\r\n        isBoundaryNode: function (node, dir) {\r\n            var tmp;\r\n            while (!domUtils.isBody(node)) {\r\n                tmp = node;\r\n                node = node.parentNode;\r\n                if (tmp !== node[dir]) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        fillHtml: browser.ie11below ? '&nbsp;' : '<br/>'\r\n    };\r\n    var fillCharReg = new RegExp(domUtils.fillChar, 'g');\r\n\r\n    // core/Range.js\r\n    /**\r\n     * Range封装\r\n     * @file\r\n     * @module UE.dom\r\n     * @class Range\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * dom操作封装\r\n     * @unfile\r\n     * @module UE.dom\r\n     */\r\n\r\n    /**\r\n     * Range实现类，本类是UEditor底层核心类，封装不同浏览器之间的Range操作。\r\n     * @unfile\r\n     * @module UE.dom\r\n     * @class Range\r\n     */\r\n\r\n\r\n    (function () {\r\n        var guid = 0,\r\n            fillChar = domUtils.fillChar,\r\n            fillData;\r\n\r\n        /**\r\n         * 更新range的collapse状态\r\n         * @param  {Range}   range    range对象\r\n         */\r\n        function updateCollapse(range) {\r\n            range.collapsed =\r\n                range.startContainer && range.endContainer &&\r\n                range.startContainer === range.endContainer &&\r\n                range.startOffset == range.endOffset;\r\n        }\r\n\r\n        function selectOneNode(rng) {\r\n            return !rng.collapsed && rng.startContainer.nodeType == 1 && rng.startContainer === rng.endContainer && rng.endOffset - rng.startOffset == 1\r\n        }\r\n        function setEndPoint(toStart, node, offset, range) {\r\n            //如果node是自闭合标签要处理\r\n            if (node.nodeType == 1 && (dtd.$empty[node.tagName] || dtd.$nonChild[node.tagName])) {\r\n                offset = domUtils.getNodeIndex(node) + (toStart ? 0 : 1);\r\n                node = node.parentNode;\r\n            }\r\n            if (toStart) {\r\n                range.startContainer = node;\r\n                range.startOffset = offset;\r\n                if (!range.endContainer) {\r\n                    range.collapse(true);\r\n                }\r\n            } else {\r\n                range.endContainer = node;\r\n                range.endOffset = offset;\r\n                if (!range.startContainer) {\r\n                    range.collapse(false);\r\n                }\r\n            }\r\n            updateCollapse(range);\r\n            return range;\r\n        }\r\n\r\n        function execContentsAction(range, action) {\r\n            //调整边界\r\n            //range.includeBookmark();\r\n            var start = range.startContainer,\r\n                end = range.endContainer,\r\n                startOffset = range.startOffset,\r\n                endOffset = range.endOffset,\r\n                doc = range.document,\r\n                frag = doc.createDocumentFragment(),\r\n                tmpStart, tmpEnd;\r\n            if (start.nodeType == 1) {\r\n                start = start.childNodes[startOffset] || (tmpStart = start.appendChild(doc.createTextNode('')));\r\n            }\r\n            if (end.nodeType == 1) {\r\n                end = end.childNodes[endOffset] || (tmpEnd = end.appendChild(doc.createTextNode('')));\r\n            }\r\n            if (start === end && start.nodeType == 3) {\r\n                frag.appendChild(doc.createTextNode(start.substringData(startOffset, endOffset - startOffset)));\r\n                //is not clone\r\n                if (action) {\r\n                    start.deleteData(startOffset, endOffset - startOffset);\r\n                    range.collapse(true);\r\n                }\r\n                return frag;\r\n            }\r\n            var current, currentLevel, clone = frag,\r\n                startParents = domUtils.findParents(start, true), endParents = domUtils.findParents(end, true);\r\n            for (var i = 0; startParents[i] == endParents[i];) {\r\n                i++;\r\n            }\r\n            for (var j = i, si; si = startParents[j]; j++) {\r\n                current = si.nextSibling;\r\n                if (si == start) {\r\n                    if (!tmpStart) {\r\n                        if (range.startContainer.nodeType == 3) {\r\n                            clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset)));\r\n                            //is not clone\r\n                            if (action) {\r\n                                start.deleteData(startOffset, start.nodeValue.length - startOffset);\r\n                            }\r\n                        } else {\r\n                            clone.appendChild(!action ? start.cloneNode(true) : start);\r\n                        }\r\n                    }\r\n                } else {\r\n                    currentLevel = si.cloneNode(false);\r\n                    clone.appendChild(currentLevel);\r\n                }\r\n                while (current) {\r\n                    if (current === end || current === endParents[j]) {\r\n                        break;\r\n                    }\r\n                    si = current.nextSibling;\r\n                    clone.appendChild(!action ? current.cloneNode(true) : current);\r\n                    current = si;\r\n                }\r\n                clone = currentLevel;\r\n            }\r\n            clone = frag;\r\n            if (!startParents[i]) {\r\n                clone.appendChild(startParents[i - 1].cloneNode(false));\r\n                clone = clone.firstChild;\r\n            }\r\n            for (var j = i, ei; ei = endParents[j]; j++) {\r\n                current = ei.previousSibling;\r\n                if (ei == end) {\r\n                    if (!tmpEnd && range.endContainer.nodeType == 3) {\r\n                        clone.appendChild(doc.createTextNode(end.substringData(0, endOffset)));\r\n                        //is not clone\r\n                        if (action) {\r\n                            end.deleteData(0, endOffset);\r\n                        }\r\n                    }\r\n                } else {\r\n                    currentLevel = ei.cloneNode(false);\r\n                    clone.appendChild(currentLevel);\r\n                }\r\n                //如果两端同级，右边第一次已经被开始做了\r\n                if (j != i || !startParents[i]) {\r\n                    while (current) {\r\n                        if (current === start) {\r\n                            break;\r\n                        }\r\n                        ei = current.previousSibling;\r\n                        clone.insertBefore(!action ? current.cloneNode(true) : current, clone.firstChild);\r\n                        current = ei;\r\n                    }\r\n                }\r\n                clone = currentLevel;\r\n            }\r\n            if (action) {\r\n                range.setStartBefore(!endParents[i] ? endParents[i - 1] : !startParents[i] ? startParents[i - 1] : endParents[i]).collapse(true);\r\n            }\r\n            tmpStart && domUtils.remove(tmpStart);\r\n            tmpEnd && domUtils.remove(tmpEnd);\r\n            return frag;\r\n        }\r\n\r\n        /**\r\n         * 创建一个跟document绑定的空的Range实例\r\n         * @constructor\r\n         * @param { Document } document 新建的选区所属的文档对象\r\n         */\r\n\r\n        /**\r\n         * @property { Node } startContainer 当前Range的开始边界的容器节点, 可以是一个元素节点或者是文本节点\r\n         */\r\n\r\n        /**\r\n         * @property { Node } startOffset 当前Range的开始边界容器节点的偏移量, 如果是元素节点，\r\n         *                              该值就是childNodes中的第几个节点， 如果是文本节点就是文本内容的第几个字符\r\n         */\r\n\r\n        /**\r\n         * @property { Node } endContainer 当前Range的结束边界的容器节点, 可以是一个元素节点或者是文本节点\r\n         */\r\n\r\n        /**\r\n         * @property { Node } endOffset 当前Range的结束边界容器节点的偏移量, 如果是元素节点，\r\n         *                              该值就是childNodes中的第几个节点， 如果是文本节点就是文本内容的第几个字符\r\n         */\r\n\r\n        /**\r\n         * @property { Boolean } collapsed 当前Range是否闭合\r\n         * @default true\r\n         * @remind Range是闭合的时候， startContainer === endContainer && startOffset === endOffset\r\n         */\r\n\r\n        /**\r\n         * @property { Document } document 当前Range所属的Document对象\r\n         * @remind 不同range的的document属性可以是不同的\r\n         */\r\n        var Range = dom.Range = function (document) {\r\n            var me = this;\r\n            me.startContainer =\r\n                me.startOffset =\r\n                me.endContainer =\r\n                me.endOffset = null;\r\n            me.document = document;\r\n            me.collapsed = true;\r\n        };\r\n\r\n        /**\r\n         * 删除fillData\r\n         * @param doc\r\n         * @param excludeNode\r\n         */\r\n        function removeFillData(doc, excludeNode) {\r\n            try {\r\n                if (fillData && domUtils.inDoc(fillData, doc)) {\r\n                    if (!fillData.nodeValue.replace(fillCharReg, '').length) {\r\n                        var tmpNode = fillData.parentNode;\r\n                        domUtils.remove(fillData);\r\n                        while (tmpNode && domUtils.isEmptyInlineElement(tmpNode) &&\r\n                            //safari的contains有bug\r\n                            (browser.safari ? !(domUtils.getPosition(tmpNode, excludeNode) & domUtils.POSITION_CONTAINS) : !tmpNode.contains(excludeNode))\r\n                        ) {\r\n                            fillData = tmpNode.parentNode;\r\n                            domUtils.remove(tmpNode);\r\n                            tmpNode = fillData;\r\n                        }\r\n                    } else {\r\n                        fillData.nodeValue = fillData.nodeValue.replace(fillCharReg, '');\r\n                    }\r\n                }\r\n            } catch (e) {\r\n            }\r\n        }\r\n\r\n        /**\r\n         * @param node\r\n         * @param dir\r\n         */\r\n        function mergeSibling(node, dir) {\r\n            var tmpNode;\r\n            node = node[dir];\r\n            while (node && domUtils.isFillChar(node)) {\r\n                tmpNode = node[dir];\r\n                domUtils.remove(node);\r\n                node = tmpNode;\r\n            }\r\n        }\r\n\r\n        Range.prototype = {\r\n\r\n            /**\r\n             * 克隆选区的内容到一个DocumentFragment里\r\n             * @method cloneContents\r\n             * @return { DocumentFragment | NULL } 如果选区是闭合的将返回null， 否则， 返回包含所clone内容的DocumentFragment元素\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *      <!-- 中括号表示选区 -->\r\n             *      <b>x<i>x[x</i>xx]x</b>\r\n             *\r\n             *      <script>\r\n             *          //range是已选中的选区\r\n             *          var fragment = range.cloneContents(),\r\n             *              node = document.createElement(\"div\");\r\n             *\r\n             *          node.appendChild( fragment );\r\n             *\r\n             *          //output: <i>x</i>xx\r\n             *          console.log( node.innerHTML );\r\n             *\r\n             *      </script>\r\n             * </body>\r\n             * ```\r\n             */\r\n            cloneContents: function () {\r\n                return this.collapsed ? null : execContentsAction(this, 0);\r\n            },\r\n\r\n            /**\r\n             * 删除当前选区范围中的所有内容\r\n             * @method deleteContents\r\n             * @remind 执行完该操作后， 当前Range对象变成了闭合状态\r\n             * @return { UE.dom.Range } 当前操作的Range对象\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *      <!-- 中括号表示选区 -->\r\n             *      <b>x<i>x[x</i>xx]x</b>\r\n             *\r\n             *      <script>\r\n             *          //range是已选中的选区\r\n             *          range.deleteContents();\r\n             *\r\n             *          //竖线表示闭合后的选区位置\r\n             *          //output: <b>x<i>x</i>|x</b>\r\n             *          console.log( document.body.innerHTML );\r\n             *\r\n             *          //此时， range的各项属性为\r\n             *          //output: B\r\n             *          console.log( range.startContainer.tagName );\r\n             *          //output: 2\r\n             *          console.log( range.startOffset );\r\n             *          //output: B\r\n             *          console.log( range.endContainer.tagName );\r\n             *          //output: 2\r\n             *          console.log( range.endOffset );\r\n             *          //output: true\r\n             *          console.log( range.collapsed );\r\n             *\r\n             *      </script>\r\n             * </body>\r\n             * ```\r\n             */\r\n            deleteContents: function () {\r\n                var txt;\r\n                if (!this.collapsed) {\r\n                    execContentsAction(this, 1);\r\n                }\r\n                if (browser.webkit) {\r\n                    txt = this.startContainer;\r\n                    if (txt.nodeType == 3 && !txt.nodeValue.length) {\r\n                        this.setStartBefore(txt).collapse(true);\r\n                        domUtils.remove(txt);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 将当前选区的内容提取到一个DocumentFragment里\r\n             * @method extractContents\r\n             * @remind 执行该操作后， 选区将变成闭合状态\r\n             * @warning 执行该操作后， 原来选区所选中的内容将从dom树上剥离出来\r\n             * @return { DocumentFragment } 返回包含所提取内容的DocumentFragment对象\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *      <!-- 中括号表示选区 -->\r\n             *      <b>x<i>x[x</i>xx]x</b>\r\n             *\r\n             *      <script>\r\n             *          //range是已选中的选区\r\n             *          var fragment = range.extractContents(),\r\n             *              node = document.createElement( \"div\" );\r\n             *\r\n             *          node.appendChild( fragment );\r\n             *\r\n             *          //竖线表示闭合后的选区位置\r\n             *\r\n             *          //output: <b>x<i>x</i>|x</b>\r\n             *          console.log( document.body.innerHTML );\r\n             *          //output: <i>x</i>xx\r\n             *          console.log( node.innerHTML );\r\n             *\r\n             *          //此时， range的各项属性为\r\n             *          //output: B\r\n             *          console.log( range.startContainer.tagName );\r\n             *          //output: 2\r\n             *          console.log( range.startOffset );\r\n             *          //output: B\r\n             *          console.log( range.endContainer.tagName );\r\n             *          //output: 2\r\n             *          console.log( range.endOffset );\r\n             *          //output: true\r\n             *          console.log( range.collapsed );\r\n             *\r\n             *      </script>\r\n             * </body>\r\n             */\r\n            extractContents: function () {\r\n                return this.collapsed ? null : execContentsAction(this, 2);\r\n            },\r\n\r\n            /**\r\n             * 设置Range的开始容器节点和偏移量\r\n             * @method  setStart\r\n             * @remind 如果给定的节点是元素节点，那么offset指的是其子元素中索引为offset的元素，\r\n             *          如果是文本节点，那么offset指的是其文本内容的第offset个字符\r\n             * @remind 如果提供的容器节点是一个不能包含子元素的节点， 则该选区的开始容器将被设置\r\n             *          为该节点的父节点， 此时， 其距离开始容器的偏移量也变成了该节点在其父节点\r\n             *          中的索引\r\n             * @param { Node } node 将被设为当前选区开始边界容器的节点对象\r\n             * @param { int } offset 选区的开始位置偏移量\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区 -->\r\n             * <b>xxx<i>x<span>xx</span>xx<em>xx</em>xxx</i>[xxx]</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.setStart( document.getElementsByTagName(\"i\")[0], 1 );\r\n             *\r\n             *     //此时， 选区变成了\r\n             *     //<b>xxx<i>x[<span>xx</span>xx<em>xx</em>xxx</i>xxx]</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区 -->\r\n             * <b>xxx<img>[xx]x</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.setStart( document.getElementsByTagName(\"img\")[0], 3 );\r\n             *\r\n             *     //此时， 选区变成了\r\n             *     //<b>xxx[<img>xx]x</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            setStart: function (node, offset) {\r\n                return setEndPoint(true, node, offset, this);\r\n            },\r\n\r\n            /**\r\n             * 设置Range的结束容器和偏移量\r\n             * @method  setEnd\r\n             * @param { Node } node 作为当前选区结束边界容器的节点对象\r\n             * @param { int } offset 结束边界的偏移量\r\n             * @see UE.dom.Range:setStart(Node,int)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setEnd: function (node, offset) {\r\n                return setEndPoint(false, node, offset, this);\r\n            },\r\n\r\n            /**\r\n             * 将Range开始位置设置到node节点之后\r\n             * @method  setStartAfter\r\n             * @remind 该操作将会把给定节点的父节点作为range的开始容器， 且偏移量是该节点在其父节点中的位置索引+1\r\n             * @param { Node } node 选区的开始边界将紧接着该节点之后\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>xx[x</span>xxx]</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.setStartAfter( document.getElementsByTagName(\"i\")[0] );\r\n             *\r\n             *     //结果选区\r\n             *     //<b>xx<i>xxx</i>[<span>xxx</span>xxx]</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            setStartAfter: function (node) {\r\n                return this.setStart(node.parentNode, domUtils.getNodeIndex(node) + 1);\r\n            },\r\n\r\n            /**\r\n             * 将Range开始位置设置到node节点之前\r\n             * @method  setStartBefore\r\n             * @remind 该操作将会把给定节点的父节点作为range的开始容器， 且偏移量是该节点在其父节点中的位置索引\r\n             * @param { Node } node 新的选区开始位置在该节点之前\r\n             * @see UE.dom.Range:setStartAfter(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setStartBefore: function (node) {\r\n                return this.setStart(node.parentNode, domUtils.getNodeIndex(node));\r\n            },\r\n\r\n            /**\r\n             * 将Range结束位置设置到node节点之后\r\n             * @method  setEndAfter\r\n             * @remind 该操作将会把给定节点的父节点作为range的结束容器， 且偏移量是该节点在其父节点中的位置索引+1\r\n             * @param { Node } node 目标节点\r\n             * @see UE.dom.Range:setStartAfter(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>[xx<i>xxx</i><span>xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.setStartAfter( document.getElementsByTagName(\"span\")[0] );\r\n             *\r\n             *     //结果选区\r\n             *     //<b>[xx<i>xxx</i><span>xxx</span>]xxx</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            setEndAfter: function (node) {\r\n                return this.setEnd(node.parentNode, domUtils.getNodeIndex(node) + 1);\r\n            },\r\n\r\n            /**\r\n             * 将Range结束位置设置到node节点之前\r\n             * @method  setEndBefore\r\n             * @remind 该操作将会把给定节点的父节点作为range的结束容器， 且偏移量是该节点在其父节点中的位置索引\r\n             * @param { Node } node 目标节点\r\n             * @see UE.dom.Range:setEndAfter(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setEndBefore: function (node) {\r\n                return this.setEnd(node.parentNode, domUtils.getNodeIndex(node));\r\n            },\r\n\r\n            /**\r\n             * 设置Range的开始位置到node节点内的第一个子节点之前\r\n             * @method  setStartAtFirst\r\n             * @remind 选区的开始容器将变成给定的节点， 且偏移量为0\r\n             * @remind 如果给定的节点是元素节点， 则该节点必须是允许包含子节点的元素。\r\n             * @param { Node } node 目标节点\r\n             * @see UE.dom.Range:setStartBefore(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.setStartAtFirst( document.getElementsByTagName(\"i\")[0] );\r\n             *\r\n             *     //结果选区\r\n             *     //<b>xx<i>[xxx</i><span>xx]x</span>xxx</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            setStartAtFirst: function (node) {\r\n                return this.setStart(node, 0);\r\n            },\r\n\r\n            /**\r\n             * 设置Range的开始位置到node节点内的最后一个节点之后\r\n             * @method setStartAtLast\r\n             * @remind 选区的开始容器将变成给定的节点， 且偏移量为该节点的子节点数\r\n             * @remind 如果给定的节点是元素节点， 则该节点必须是允许包含子节点的元素。\r\n             * @param { Node } node 目标节点\r\n             * @see UE.dom.Range:setStartAtFirst(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setStartAtLast: function (node) {\r\n                return this.setStart(node, node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length);\r\n            },\r\n\r\n            /**\r\n             * 设置Range的结束位置到node节点内的第一个节点之前\r\n             * @method  setEndAtFirst\r\n             * @param { Node } node 目标节点\r\n             * @remind 选区的结束容器将变成给定的节点， 且偏移量为0\r\n             * @remind node必须是一个元素节点， 且必须是允许包含子节点的元素。\r\n             * @see UE.dom.Range:setStartAtFirst(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setEndAtFirst: function (node) {\r\n                return this.setEnd(node, 0);\r\n            },\r\n\r\n            /**\r\n             * 设置Range的结束位置到node节点内的最后一个节点之后\r\n             * @method  setEndAtLast\r\n             * @param { Node } node 目标节点\r\n             * @remind 选区的结束容器将变成给定的节点， 且偏移量为该节点的子节点数量\r\n             * @remind node必须是一个元素节点， 且必须是允许包含子节点的元素。\r\n             * @see UE.dom.Range:setStartAtFirst(Node)\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            setEndAtLast: function (node) {\r\n                return this.setEnd(node, node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length);\r\n            },\r\n\r\n            /**\r\n             * 选中给定节点\r\n             * @method  selectNode\r\n             * @remind 此时， 选区的开始容器和结束容器都是该节点的父节点， 其startOffset是该节点在父节点中的位置索引，\r\n             *          而endOffset为startOffset+1\r\n             * @param { Node } node 需要选中的节点\r\n             * @return { UE.dom.Range } 当前range对象，此时的range仅包含当前给定的节点对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.selectNode( document.getElementsByTagName(\"i\")[0] );\r\n             *\r\n             *     //结果选区\r\n             *     //<b>xx[<i>xxx</i>]<span>xxx</span>xxx</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            selectNode: function (node) {\r\n                return this.setStartBefore(node).setEndAfter(node);\r\n            },\r\n\r\n            /**\r\n             * 选中给定节点内部的所有节点\r\n             * @method  selectNodeContents\r\n             * @remind 此时， 选区的开始容器和结束容器都是该节点， 其startOffset为0，\r\n             *          而endOffset是该节点的子节点数。\r\n             * @param { Node } node 目标节点， 当前range将包含该节点内的所有节点\r\n             * @return { UE.dom.Range } 当前range对象， 此时range仅包含给定节点的所有子节点\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.selectNode( document.getElementsByTagName(\"b\")[0] );\r\n             *\r\n             *     //结果选区\r\n             *     //<b>[xx<i>xxx</i><span>xxx</span>xxx]</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            selectNodeContents: function (node) {\r\n                return this.setStart(node, 0).setEndAtLast(node);\r\n            },\r\n\r\n            /**\r\n             * clone当前Range对象\r\n             * @method  cloneRange\r\n             * @remind 返回的range是一个全新的range对象， 其内部所有属性与当前被clone的range相同。\r\n             * @return { UE.dom.Range } 当前range对象的一个副本\r\n             */\r\n            cloneRange: function () {\r\n                var me = this;\r\n                return new Range(me.document).setStart(me.startContainer, me.startOffset).setEnd(me.endContainer, me.endOffset);\r\n\r\n            },\r\n\r\n            /**\r\n             * 向当前选区的结束处闭合选区\r\n             * @method  collapse\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.collapse();\r\n             *\r\n             *     //结果选区\r\n             *     //“|”表示选区已闭合\r\n             *     //<b>xx<i>xxx</i><span>xx|x</span>xxx</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 闭合当前选区，根据给定的toStart参数项决定是向当前选区开始处闭合还是向结束处闭合，\r\n             * 如果toStart的值为true，则向开始位置闭合， 反之，向结束位置闭合。\r\n             * @method  collapse\r\n             * @param { Boolean } toStart 是否向选区开始处闭合\r\n             * @return { UE.dom.Range } 当前range对象，此时range对象处于闭合状态\r\n             * @see UE.dom.Range:collapse()\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行操作\r\n             *     range.collapse( true );\r\n             *\r\n             *     //结果选区\r\n             *     //“|”表示选区已闭合\r\n             *     //<b>xx<i>xxx</i><span>|xxx</span>xxx</b>\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            collapse: function (toStart) {\r\n                var me = this;\r\n                if (toStart) {\r\n                    me.endContainer = me.startContainer;\r\n                    me.endOffset = me.startOffset;\r\n                } else {\r\n                    me.startContainer = me.endContainer;\r\n                    me.startOffset = me.endOffset;\r\n                }\r\n                me.collapsed = true;\r\n                return me;\r\n            },\r\n\r\n            /**\r\n             * 调整range的开始位置和结束位置，使其\"收缩\"到最小的位置\r\n             * @method  shrinkBoundary\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             * <span>xx<b>xx[</b>xxxxx]</span> => <span>xx<b>xx</b>[xxxxx]</span>\r\n             * ```\r\n             *\r\n             * @example\r\n             * ```html\r\n             * <!-- 选区示例 -->\r\n             * <b>x[xx</b><i>]xxx</i>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //执行收缩\r\n             *     range.shrinkBoundary();\r\n             *\r\n             *     //结果选区\r\n             *     //<b>x[xx]</b><i>xxx</i>\r\n             * </script>\r\n             * ```\r\n             *\r\n             * @example\r\n             * ```html\r\n             * [<b><i>xxxx</i>xxxxxxx</b>] => <b><i>[xxxx</i>xxxxxxx]</b>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 调整range的开始位置和结束位置，使其\"收缩\"到最小的位置，\r\n             * 如果ignoreEnd的值为true，则忽略对结束位置的调整\r\n             * @method  shrinkBoundary\r\n             * @param { Boolean } ignoreEnd 是否忽略对结束位置的调整\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @see UE.dom.domUtils.Range:shrinkBoundary()\r\n             */\r\n            shrinkBoundary: function (ignoreEnd) {\r\n                var me = this, child,\r\n                    collapsed = me.collapsed;\r\n                function check(node) {\r\n                    return node.nodeType == 1 && !domUtils.isBookmarkNode(node) && !dtd.$empty[node.tagName] && !dtd.$nonChild[node.tagName]\r\n                }\r\n                while (me.startContainer.nodeType == 1 //是element\r\n                    && (child = me.startContainer.childNodes[me.startOffset]) //子节点也是element\r\n                    && check(child)) {\r\n                    me.setStart(child, 0);\r\n                }\r\n                if (collapsed) {\r\n                    return me.collapse(true);\r\n                }\r\n                if (!ignoreEnd) {\r\n                    while (me.endContainer.nodeType == 1//是element\r\n                        && me.endOffset > 0 //如果是空元素就退出 endOffset=0那么endOffst-1为负值，childNodes[endOffset]报错\r\n                        && (child = me.endContainer.childNodes[me.endOffset - 1]) //子节点也是element\r\n                        && check(child)) {\r\n                        me.setEnd(child, child.childNodes.length);\r\n                    }\r\n                }\r\n                return me;\r\n            },\r\n\r\n            /**\r\n             * 获取离当前选区内包含的所有节点最近的公共祖先节点，\r\n             * @method  getCommonAncestor\r\n             * @remind 返回的公共祖先节点一定不是range自身的容器节点， 但有可能是一个文本节点\r\n             * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n             * @example\r\n             * ```html\r\n             * //选区示例\r\n             * <span>xxx<b>x[x<em>xx]x</em>xxx</b>xx</span>\r\n             * <script>\r\n             *\r\n             *     var node = range.getCommonAncestor();\r\n             *\r\n             *     //公共祖先节点是： b节点\r\n             *     //输出： B\r\n             *     console.log(node.tagName);\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 获取当前选区所包含的所有节点的公共祖先节点， 可以根据给定的参数 includeSelf 决定获取到\r\n             * 的公共祖先节点是否可以是当前选区的startContainer或endContainer节点， 如果 includeSelf\r\n             * 的取值为true， 则返回的节点可以是自身的容器节点， 否则， 则不能是容器节点\r\n             * @method  getCommonAncestor\r\n             * @param { Boolean } includeSelf 是否允许获取到的公共祖先节点是当前range对象的容器节点\r\n             * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n             * @see UE.dom.Range:getCommonAncestor()\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *\r\n             *     <!-- 选区示例 -->\r\n             *     <b>xxx<i>xxxx<span>xx[x</span>xx]x</i>xxxxxxx</b>\r\n             *\r\n             *     <script>\r\n             *\r\n             *         var node = range.getCommonAncestor( false );\r\n             *\r\n             *         //这里的公共祖先节点是B而不是I， 是因为参数限制了获取到的节点不能是容器节点\r\n             *         //output: B\r\n             *         console.log( node.tagName );\r\n             *\r\n             *     </script>\r\n             *\r\n             * </body>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 获取当前选区所包含的所有节点的公共祖先节点， 可以根据给定的参数 includeSelf 决定获取到\r\n             * 的公共祖先节点是否可以是当前选区的startContainer或endContainer节点， 如果 includeSelf\r\n             * 的取值为true， 则返回的节点可以是自身的容器节点， 否则， 则不能是容器节点； 同时可以根据\r\n             * ignoreTextNode 参数的取值决定是否忽略类型为文本节点的祖先节点。\r\n             * @method  getCommonAncestor\r\n             * @param { Boolean } includeSelf 是否允许获取到的公共祖先节点是当前range对象的容器节点\r\n             * @param { Boolean } ignoreTextNode 获取祖先节点的过程中是否忽略类型为文本节点的祖先节点\r\n             * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n             * @see UE.dom.Range:getCommonAncestor()\r\n             * @see UE.dom.Range:getCommonAncestor(Boolean)\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *\r\n             *     <!-- 选区示例 -->\r\n             *     <b>xxx<i>xxxx<span>x[x]x</span>xxx</i>xxxxxxx</b>\r\n             *\r\n             *     <script>\r\n             *\r\n             *         var node = range.getCommonAncestor( true, false );\r\n             *\r\n             *         //output: SPAN\r\n             *         console.log( node.tagName );\r\n             *\r\n             *     </script>\r\n             *\r\n             * </body>\r\n             * ```\r\n             */\r\n            getCommonAncestor: function (includeSelf, ignoreTextNode) {\r\n                var me = this,\r\n                    start = me.startContainer,\r\n                    end = me.endContainer;\r\n                if (start === end) {\r\n                    if (includeSelf && selectOneNode(this)) {\r\n                        start = start.childNodes[me.startOffset];\r\n                        if (start.nodeType == 1)\r\n                            return start;\r\n                    }\r\n                    //只有在上来就相等的情况下才会出现是文本的情况\r\n                    return ignoreTextNode && start.nodeType == 3 ? start.parentNode : start;\r\n                }\r\n                return domUtils.getCommonAncestor(start, end);\r\n            },\r\n\r\n            /**\r\n             * 调整当前Range的开始和结束边界容器，如果是容器节点是文本节点,就调整到包含该文本节点的父节点上\r\n             * @method trimBoundary\r\n             * @remind 该操作有可能会引起文本节点被切开\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             *\r\n             * //选区示例\r\n             * <b>xxx<i>[xxxxx]</i>xxx</b>\r\n             *\r\n             * <script>\r\n             *     //未调整前， 选区的开始容器和结束都是文本节点\r\n             *     //执行调整\r\n             *     range.trimBoundary();\r\n             *\r\n             *     //调整之后， 容器节点变成了i节点\r\n             *     //<b>xxx[<i>xxxxx</i>]xxx</b>\r\n             * </script>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 调整当前Range的开始和结束边界容器，如果是容器节点是文本节点,就调整到包含该文本节点的父节点上，\r\n             * 可以根据 ignoreEnd 参数的值决定是否调整对结束边界的调整\r\n             * @method trimBoundary\r\n             * @param { Boolean } ignoreEnd 是否忽略对结束边界的调整\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             *\r\n             * //选区示例\r\n             * <b>xxx<i>[xxxxx]</i>xxx</b>\r\n             *\r\n             * <script>\r\n             *     //未调整前， 选区的开始容器和结束都是文本节点\r\n             *     //执行调整\r\n             *     range.trimBoundary( true );\r\n             *\r\n             *     //调整之后， 开始容器节点变成了i节点\r\n             *     //但是， 结束容器没有发生变化\r\n             *     //<b>xxx[<i>xxxxx]</i>xxx</b>\r\n             * </script>\r\n             * ```\r\n             */\r\n            trimBoundary: function (ignoreEnd) {\r\n                this.txtToElmBoundary();\r\n                var start = this.startContainer,\r\n                    offset = this.startOffset,\r\n                    collapsed = this.collapsed,\r\n                    end = this.endContainer;\r\n                if (start.nodeType == 3) {\r\n                    if (offset == 0) {\r\n                        this.setStartBefore(start);\r\n                    } else {\r\n                        if (offset >= start.nodeValue.length) {\r\n                            this.setStartAfter(start);\r\n                        } else {\r\n                            var textNode = domUtils.split(start, offset);\r\n                            //跟新结束边界\r\n                            if (start === end) {\r\n                                this.setEnd(textNode, this.endOffset - offset);\r\n                            } else if (start.parentNode === end) {\r\n                                this.endOffset += 1;\r\n                            }\r\n                            this.setStartBefore(textNode);\r\n                        }\r\n                    }\r\n                    if (collapsed) {\r\n                        return this.collapse(true);\r\n                    }\r\n                }\r\n                if (!ignoreEnd) {\r\n                    offset = this.endOffset;\r\n                    end = this.endContainer;\r\n                    if (end.nodeType == 3) {\r\n                        if (offset == 0) {\r\n                            this.setEndBefore(end);\r\n                        } else {\r\n                            offset < end.nodeValue.length && domUtils.split(end, offset);\r\n                            this.setEndAfter(end);\r\n                        }\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 如果选区在文本的边界上，就扩展选区到文本的父节点上, 如果当前选区是闭合的， 则什么也不做\r\n             * @method txtToElmBoundary\r\n             * @remind 该操作不会修改dom节点\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n\r\n            /**\r\n             * 如果选区在文本的边界上，就扩展选区到文本的父节点上, 如果当前选区是闭合的， 则根据参数项\r\n             * ignoreCollapsed 的值决定是否执行该调整\r\n             * @method txtToElmBoundary\r\n             * @param { Boolean } ignoreCollapsed 是否忽略选区的闭合状态， 如果该参数取值为true， 则\r\n             *                      不论选区是否闭合， 都会执行该操作， 反之， 则不会对闭合的选区执行该操作\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            txtToElmBoundary: function (ignoreCollapsed) {\r\n                function adjust(r, c) {\r\n                    var container = r[c + 'Container'],\r\n                        offset = r[c + 'Offset'];\r\n                    if (container.nodeType == 3) {\r\n                        if (!offset) {\r\n                            r['set' + c.replace(/(\\w)/, function (a) {\r\n                                return a.toUpperCase();\r\n                            }) + 'Before'](container);\r\n                        } else if (offset >= container.nodeValue.length) {\r\n                            r['set' + c.replace(/(\\w)/, function (a) {\r\n                                return a.toUpperCase();\r\n                            }) + 'After'](container);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (ignoreCollapsed || !this.collapsed) {\r\n                    adjust(this, 'start');\r\n                    adjust(this, 'end');\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 在当前选区的开始位置前插入节点，新插入的节点会被该range包含\r\n             * @method  insertNode\r\n             * @param { Node } node 需要插入的节点\r\n             * @remind 插入的节点可以是一个DocumentFragment依次插入多个节点\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            insertNode: function (node) {\r\n                var first = node, length = 1;\r\n                if (node.nodeType == 11) {\r\n                    first = node.firstChild;\r\n                    length = node.childNodes.length;\r\n                }\r\n                this.trimBoundary(true);\r\n                var start = this.startContainer,\r\n                    offset = this.startOffset;\r\n                var nextNode = start.childNodes[offset];\r\n                if (nextNode) {\r\n                    start.insertBefore(node, nextNode);\r\n                } else {\r\n                    start.appendChild(node);\r\n                }\r\n                if (first.parentNode === this.endContainer) {\r\n                    this.endOffset = this.endOffset + length;\r\n                }\r\n                return this.setStartBefore(first);\r\n            },\r\n\r\n            /**\r\n             * 闭合选区到当前选区的开始位置， 并且定位光标到闭合后的位置\r\n             * @method  setCursor\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @see UE.dom.Range:collapse()\r\n             */\r\n\r\n            /**\r\n             * 闭合选区，可以根据参数toEnd的值控制选区是向前闭合还是向后闭合， 并且定位光标到闭合后的位置。\r\n             * @method  setCursor\r\n             * @param { Boolean } toEnd 是否向后闭合， 如果为true， 则闭合选区时， 将向结束容器方向闭合，\r\n             *                      反之，则向开始容器方向闭合\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @see UE.dom.Range:collapse(Boolean)\r\n             */\r\n            setCursor: function (toEnd, noFillData) {\r\n                return this.collapse(!toEnd).select(noFillData);\r\n            },\r\n\r\n            /**\r\n             * 创建当前range的一个书签，记录下当前range的位置，方便当dom树改变时，还能找回原来的选区位置\r\n             * @method createBookmark\r\n             * @param { Boolean } serialize 控制返回的标记位置是对当前位置的引用还是ID，如果该值为true，则\r\n             *                              返回标记位置的ID， 反之则返回标记位置节点的引用\r\n             * @return { Object } 返回一个书签记录键值对， 其包含的key有： start => 开始标记的ID或者引用，\r\n             *                          end => 结束标记的ID或引用， id => 当前标记的类型， 如果为true，则表示\r\n             *                          返回的记录的类型为ID， 反之则为引用\r\n             */\r\n            createBookmark: function (serialize, same) {\r\n                var endNode,\r\n                    startNode = this.document.createElement('span');\r\n                startNode.style.cssText = 'display:none;line-height:0px;';\r\n                startNode.appendChild(this.document.createTextNode('\\u200D'));\r\n                startNode.id = '_baidu_bookmark_start_' + (same ? '' : guid++);\r\n\r\n                if (!this.collapsed) {\r\n                    endNode = startNode.cloneNode(true);\r\n                    endNode.id = '_baidu_bookmark_end_' + (same ? '' : guid++);\r\n                }\r\n                this.insertNode(startNode);\r\n                if (endNode) {\r\n                    this.collapse().insertNode(endNode).setEndBefore(endNode);\r\n                }\r\n                this.setStartAfter(startNode);\r\n                return {\r\n                    start: serialize ? startNode.id : startNode,\r\n                    end: endNode ? serialize ? endNode.id : endNode : null,\r\n                    id: serialize\r\n                }\r\n            },\r\n\r\n            /**\r\n             *  调整当前range的边界到书签位置，并删除该书签对象所标记的位置内的节点\r\n             *  @method  moveToBookmark\r\n             *  @param { BookMark } bookmark createBookmark所创建的标签对象\r\n             *  @return { UE.dom.Range } 当前range对象\r\n             *  @see UE.dom.Range:createBookmark(Boolean)\r\n             */\r\n            moveToBookmark: function (bookmark) {\r\n                var start = bookmark.id ? this.document.getElementById(bookmark.start) : bookmark.start,\r\n                    end = bookmark.end && bookmark.id ? this.document.getElementById(bookmark.end) : bookmark.end;\r\n                this.setStartBefore(start);\r\n                domUtils.remove(start);\r\n                if (end) {\r\n                    this.setEndBefore(end);\r\n                    domUtils.remove(end);\r\n                } else {\r\n                    this.collapse(true);\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 调整range的边界，使其\"放大\"到最近的父节点\r\n             * @method  enlarge\r\n             * @remind 会引起选区的变化\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n\r\n            /**\r\n             * 调整range的边界，使其\"放大\"到最近的父节点，根据参数 toBlock 的取值， 可以\r\n             * 要求扩大之后的父节点是block节点\r\n             * @method  enlarge\r\n             * @param { Boolean } toBlock 是否要求扩大之后的父节点必须是block节点\r\n             * @return { UE.dom.Range } 当前range对象\r\n             */\r\n            enlarge: function (toBlock, stopFn) {\r\n                var isBody = domUtils.isBody,\r\n                    pre, node, tmp = this.document.createTextNode('');\r\n                if (toBlock) {\r\n                    node = this.startContainer;\r\n                    if (node.nodeType == 1) {\r\n                        if (node.childNodes[this.startOffset]) {\r\n                            pre = node = node.childNodes[this.startOffset]\r\n                        } else {\r\n                            node.appendChild(tmp);\r\n                            pre = node = tmp;\r\n                        }\r\n                    } else {\r\n                        pre = node;\r\n                    }\r\n                    while (1) {\r\n                        if (domUtils.isBlockElm(node)) {\r\n                            node = pre;\r\n                            while ((pre = node.previousSibling) && !domUtils.isBlockElm(pre)) {\r\n                                node = pre;\r\n                            }\r\n                            this.setStartBefore(node);\r\n                            break;\r\n                        }\r\n                        pre = node;\r\n                        node = node.parentNode;\r\n                    }\r\n                    node = this.endContainer;\r\n                    if (node.nodeType == 1) {\r\n                        if (pre = node.childNodes[this.endOffset]) {\r\n                            node.insertBefore(tmp, pre);\r\n                        } else {\r\n                            node.appendChild(tmp);\r\n                        }\r\n                        pre = node = tmp;\r\n                    } else {\r\n                        pre = node;\r\n                    }\r\n                    while (1) {\r\n                        if (domUtils.isBlockElm(node)) {\r\n                            node = pre;\r\n                            while ((pre = node.nextSibling) && !domUtils.isBlockElm(pre)) {\r\n                                node = pre;\r\n                            }\r\n                            this.setEndAfter(node);\r\n                            break;\r\n                        }\r\n                        pre = node;\r\n                        node = node.parentNode;\r\n                    }\r\n                    if (tmp.parentNode === this.endContainer) {\r\n                        this.endOffset--;\r\n                    }\r\n                    domUtils.remove(tmp);\r\n                }\r\n\r\n                // 扩展边界到最大\r\n                if (!this.collapsed) {\r\n                    while (this.startOffset == 0) {\r\n                        if (stopFn && stopFn(this.startContainer)) {\r\n                            break;\r\n                        }\r\n                        if (isBody(this.startContainer)) {\r\n                            break;\r\n                        }\r\n                        this.setStartBefore(this.startContainer);\r\n                    }\r\n                    while (this.endOffset == (this.endContainer.nodeType == 1 ? this.endContainer.childNodes.length : this.endContainer.nodeValue.length)) {\r\n                        if (stopFn && stopFn(this.endContainer)) {\r\n                            break;\r\n                        }\r\n                        if (isBody(this.endContainer)) {\r\n                            break;\r\n                        }\r\n                        this.setEndAfter(this.endContainer);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n            enlargeToBlockElm: function (ignoreEnd) {\r\n                while (!domUtils.isBlockElm(this.startContainer)) {\r\n                    this.setStartBefore(this.startContainer);\r\n                }\r\n                if (!ignoreEnd) {\r\n                    while (!domUtils.isBlockElm(this.endContainer)) {\r\n                        this.setEndAfter(this.endContainer);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n            /**\r\n             * 调整Range的边界，使其\"缩小\"到最合适的位置\r\n             * @method adjustmentBoundary\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @see UE.dom.Range:shrinkBoundary()\r\n             */\r\n            adjustmentBoundary: function () {\r\n                if (!this.collapsed) {\r\n                    while (!domUtils.isBody(this.startContainer) &&\r\n                        this.startOffset == this.startContainer[this.startContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length &&\r\n                        this.startContainer[this.startContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length\r\n                    ) {\r\n\r\n                        this.setStartAfter(this.startContainer);\r\n                    }\r\n                    while (!domUtils.isBody(this.endContainer) && !this.endOffset &&\r\n                        this.endContainer[this.endContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length\r\n                    ) {\r\n                        this.setEndBefore(this.endContainer);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 给range选区中的内容添加给定的inline标签\r\n             * @method applyInlineStyle\r\n             * @param { String } tagName 需要添加的标签名\r\n             * @example\r\n             * ```html\r\n             * <p>xxxx[xxxx]x</p>  ==>  range.applyInlineStyle(\"strong\")  ==>  <p>xxxx[<strong>xxxx</strong>]x</p>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 给range选区中的内容添加给定的inline标签， 并且为标签附加上一些初始化属性。\r\n             * @method applyInlineStyle\r\n             * @param { String } tagName 需要添加的标签名\r\n             * @param { Object } attrs 跟随新添加的标签的属性\r\n             * @return { UE.dom.Range } 当前选区\r\n             * @example\r\n             * ```html\r\n             * <p>xxxx[xxxx]x</p>\r\n             *\r\n             * ==>\r\n             *\r\n             * <!-- 执行操作 -->\r\n             * range.applyInlineStyle(\"strong\",{\"style\":\"font-size:12px\"})\r\n             *\r\n             * ==>\r\n             *\r\n             * <p>xxxx[<strong style=\"font-size:12px\">xxxx</strong>]x</p>\r\n             * ```\r\n             */\r\n            applyInlineStyle: function (tagName, attrs, list) {\r\n                if (this.collapsed) return this;\r\n                this.trimBoundary().enlarge(false,\r\n                    function (node) {\r\n                        return node.nodeType == 1 && domUtils.isBlockElm(node)\r\n                    }).adjustmentBoundary();\r\n                var bookmark = this.createBookmark(),\r\n                    end = bookmark.end,\r\n                    filterFn = function (node) {\r\n                        return node.nodeType == 1 ? node.tagName.toLowerCase() != 'br' : !domUtils.isWhitespace(node);\r\n                    },\r\n                    current = domUtils.getNextDomNode(bookmark.start, false, filterFn),\r\n                    node,\r\n                    pre,\r\n                    range = this.cloneRange();\r\n                while (current && (domUtils.getPosition(current, end) & domUtils.POSITION_PRECEDING)) {\r\n                    if (current.nodeType == 3 || dtd[tagName][current.tagName]) {\r\n                        range.setStartBefore(current);\r\n                        node = current;\r\n                        while (node && (node.nodeType == 3 || dtd[tagName][node.tagName]) && node !== end) {\r\n                            pre = node;\r\n                            node = domUtils.getNextDomNode(node, node.nodeType == 1, null, function (parent) {\r\n                                return dtd[tagName][parent.tagName];\r\n                            });\r\n                        }\r\n                        var frag = range.setEndAfter(pre).extractContents(), elm;\r\n                        if (list && list.length > 0) {\r\n                            var level, top;\r\n                            top = level = list[0].cloneNode(false);\r\n                            for (var i = 1, ci; ci = list[i++];) {\r\n                                level.appendChild(ci.cloneNode(false));\r\n                                level = level.firstChild;\r\n                            }\r\n                            elm = level;\r\n                        } else {\r\n                            elm = range.document.createElement(tagName);\r\n                        }\r\n                        if (attrs) {\r\n                            domUtils.setAttributes(elm, attrs);\r\n                        }\r\n                        elm.appendChild(frag);\r\n                        range.insertNode(list ? top : elm);\r\n                        //处理下滑线在a上的情况\r\n                        var aNode;\r\n                        if (tagName == 'span' && attrs.style && /text\\-decoration/.test(attrs.style) && (aNode = domUtils.findParentByTagName(elm, 'a', true))) {\r\n                            domUtils.setAttributes(aNode, attrs);\r\n                            domUtils.remove(elm, true);\r\n                            elm = aNode;\r\n                        } else {\r\n                            domUtils.mergeSibling(elm);\r\n                            domUtils.clearEmptySibling(elm);\r\n                        }\r\n                        //去除子节点相同的\r\n                        domUtils.mergeChild(elm, attrs);\r\n                        current = domUtils.getNextDomNode(elm, false, filterFn);\r\n                        domUtils.mergeToParent(elm);\r\n                        if (node === end) {\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        current = domUtils.getNextDomNode(current, true, filterFn);\r\n                    }\r\n                }\r\n                return this.moveToBookmark(bookmark);\r\n            },\r\n\r\n            /**\r\n             * 移除当前选区内指定的inline标签，但保留其中的内容\r\n             * @method removeInlineStyle\r\n             * @param { String } tagName 需要移除的标签名\r\n             * @return { UE.dom.Range } 当前的range对象\r\n             * @example\r\n             * ```html\r\n             * xx[x<span>xxx<em>yyy</em>zz]z</span>  => range.removeInlineStyle([\"em\"])  => xx[x<span>xxxyyyzz]z</span>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 移除当前选区内指定的一组inline标签，但保留其中的内容\r\n             * @method removeInlineStyle\r\n             * @param { Array } tagNameArr 需要移除的标签名的数组\r\n             * @return { UE.dom.Range } 当前的range对象\r\n             * @see UE.dom.Range:removeInlineStyle(String)\r\n             */\r\n            removeInlineStyle: function (tagNames) {\r\n                if (this.collapsed) return this;\r\n                tagNames = utils.isArray(tagNames) ? tagNames : [tagNames];\r\n                this.shrinkBoundary().adjustmentBoundary();\r\n                var start = this.startContainer, end = this.endContainer;\r\n                while (1) {\r\n                    if (start.nodeType == 1) {\r\n                        if (utils.indexOf(tagNames, start.tagName.toLowerCase()) > -1) {\r\n                            break;\r\n                        }\r\n                        if (start.tagName.toLowerCase() == 'body') {\r\n                            start = null;\r\n                            break;\r\n                        }\r\n                    }\r\n                    start = start.parentNode;\r\n                }\r\n                while (1) {\r\n                    if (end.nodeType == 1) {\r\n                        if (utils.indexOf(tagNames, end.tagName.toLowerCase()) > -1) {\r\n                            break;\r\n                        }\r\n                        if (end.tagName.toLowerCase() == 'body') {\r\n                            end = null;\r\n                            break;\r\n                        }\r\n                    }\r\n                    end = end.parentNode;\r\n                }\r\n                var bookmark = this.createBookmark(),\r\n                    frag,\r\n                    tmpRange;\r\n                if (start) {\r\n                    tmpRange = this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start);\r\n                    frag = tmpRange.extractContents();\r\n                    tmpRange.insertNode(frag);\r\n                    domUtils.clearEmptySibling(start, true);\r\n                    start.parentNode.insertBefore(bookmark.start, start);\r\n                }\r\n                if (end) {\r\n                    tmpRange = this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end);\r\n                    frag = tmpRange.extractContents();\r\n                    tmpRange.insertNode(frag);\r\n                    domUtils.clearEmptySibling(end, false, true);\r\n                    end.parentNode.insertBefore(bookmark.end, end.nextSibling);\r\n                }\r\n                var current = domUtils.getNextDomNode(bookmark.start, false, function (node) {\r\n                    return node.nodeType == 1;\r\n                }), next;\r\n                while (current && current !== bookmark.end) {\r\n                    next = domUtils.getNextDomNode(current, true, function (node) {\r\n                        return node.nodeType == 1;\r\n                    });\r\n                    if (utils.indexOf(tagNames, current.tagName.toLowerCase()) > -1) {\r\n                        domUtils.remove(current, true);\r\n                    }\r\n                    current = next;\r\n                }\r\n                return this.moveToBookmark(bookmark);\r\n            },\r\n\r\n            /**\r\n             * 获取当前选中的自闭合的节点\r\n             * @method  getClosedNode\r\n             * @return { Node | NULL } 如果当前选中的是自闭合节点， 则返回该节点， 否则返回NULL\r\n             */\r\n            getClosedNode: function () {\r\n                var node;\r\n                if (!this.collapsed) {\r\n                    var range = this.cloneRange().adjustmentBoundary().shrinkBoundary();\r\n                    if (selectOneNode(range)) {\r\n                        var child = range.startContainer.childNodes[range.startOffset];\r\n                        if (child && child.nodeType == 1 && (dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName])) {\r\n                            node = child;\r\n                        }\r\n                    }\r\n                }\r\n                return node;\r\n            },\r\n\r\n            /**\r\n             * 在页面上高亮range所表示的选区\r\n             * @method select\r\n             * @return { UE.dom.Range } 返回当前Range对象\r\n             */\r\n            //这里不区分ie9以上，trace:3824\r\n            select: browser.ie ? function (noFillData, textRange) {\r\n                var nativeRange;\r\n                if (!this.collapsed)\r\n                    this.shrinkBoundary();\r\n                var node = this.getClosedNode();\r\n                if (node && !textRange) {\r\n                    try {\r\n                        nativeRange = this.document.body.createControlRange();\r\n                        nativeRange.addElement(node);\r\n                        nativeRange.select();\r\n                    } catch (e) { }\r\n                    return this;\r\n                }\r\n                var bookmark = this.createBookmark(),\r\n                    start = bookmark.start,\r\n                    end;\r\n                nativeRange = this.document.body.createTextRange();\r\n                nativeRange.moveToElementText(start);\r\n                nativeRange.moveStart('character', 1);\r\n                if (!this.collapsed) {\r\n                    var nativeRangeEnd = this.document.body.createTextRange();\r\n                    end = bookmark.end;\r\n                    nativeRangeEnd.moveToElementText(end);\r\n                    nativeRange.setEndPoint('EndToEnd', nativeRangeEnd);\r\n                } else {\r\n                    if (!noFillData && this.startContainer.nodeType != 3) {\r\n                        //使用<span>|x<span>固定住光标\r\n                        var tmpText = this.document.createTextNode(fillChar),\r\n                            tmp = this.document.createElement('span');\r\n                        tmp.appendChild(this.document.createTextNode(fillChar));\r\n                        start.parentNode.insertBefore(tmp, start);\r\n                        start.parentNode.insertBefore(tmpText, start);\r\n                        //当点b,i,u时，不能清除i上边的b\r\n                        removeFillData(this.document, tmpText);\r\n                        fillData = tmpText;\r\n                        mergeSibling(tmp, 'previousSibling');\r\n                        mergeSibling(start, 'nextSibling');\r\n                        nativeRange.moveStart('character', -1);\r\n                        nativeRange.collapse(true);\r\n                    }\r\n                }\r\n                this.moveToBookmark(bookmark);\r\n                tmp && domUtils.remove(tmp);\r\n                //IE在隐藏状态下不支持range操作，catch一下\r\n                try {\r\n                    nativeRange.select();\r\n                } catch (e) {\r\n                }\r\n                return this;\r\n            } : function (notInsertFillData) {\r\n                function checkOffset(rng) {\r\n\r\n                    function check(node, offset, dir) {\r\n                        if (node.nodeType == 3 && node.nodeValue.length < offset) {\r\n                            rng[dir + 'Offset'] = node.nodeValue.length\r\n                        }\r\n                    }\r\n                    check(rng.startContainer, rng.startOffset, 'start');\r\n                    check(rng.endContainer, rng.endOffset, 'end');\r\n                }\r\n                var win = domUtils.getWindow(this.document),\r\n                    sel = win.getSelection(),\r\n                    txtNode;\r\n                //FF下关闭自动长高时滚动条在关闭dialog时会跳\r\n                //ff下如果不body.focus将不能定位闭合光标到编辑器内\r\n                browser.gecko ? this.document.body.focus() : win.focus();\r\n                if (sel) {\r\n                    sel.removeAllRanges();\r\n                    // trace:870 chrome/safari后边是br对于闭合得range不能定位 所以去掉了判断\r\n                    // this.startContainer.nodeType != 3 &&! ((child = this.startContainer.childNodes[this.startOffset]) && child.nodeType == 1 && child.tagName == 'BR'\r\n                    if (this.collapsed && !notInsertFillData) {\r\n                        //                    //opear如果没有节点接着，原生的不能够定位,不能在body的第一级插入空白节点\r\n                        //                    if (notInsertFillData && browser.opera && !domUtils.isBody(this.startContainer) && this.startContainer.nodeType == 1) {\r\n                        //                        var tmp = this.document.createTextNode('');\r\n                        //                        this.insertNode(tmp).setStart(tmp, 0).collapse(true);\r\n                        //                    }\r\n                        //\r\n                        //处理光标落在文本节点的情况\r\n                        //处理以下的情况\r\n                        //<b>|xxxx</b>\r\n                        //<b>xxxx</b>|xxxx\r\n                        //xxxx<b>|</b>\r\n                        var start = this.startContainer, child = start;\r\n                        if (start.nodeType == 1) {\r\n                            child = start.childNodes[this.startOffset];\r\n\r\n                        }\r\n                        if (!(start.nodeType == 3 && this.startOffset) &&\r\n                            (child ?\r\n                                (!child.previousSibling || child.previousSibling.nodeType != 3)\r\n                                :\r\n                                (!start.lastChild || start.lastChild.nodeType != 3)\r\n                            )\r\n                        ) {\r\n                            txtNode = this.document.createTextNode(fillChar);\r\n                            //跟着前边走\r\n                            this.insertNode(txtNode);\r\n                            removeFillData(this.document, txtNode);\r\n                            mergeSibling(txtNode, 'previousSibling');\r\n                            mergeSibling(txtNode, 'nextSibling');\r\n                            fillData = txtNode;\r\n                            this.setStart(txtNode, browser.webkit ? 1 : 0).collapse(true);\r\n                        }\r\n                    }\r\n                    var nativeRange = this.document.createRange();\r\n                    if (this.collapsed && browser.opera && this.startContainer.nodeType == 1) {\r\n                        var child = this.startContainer.childNodes[this.startOffset];\r\n                        if (!child) {\r\n                            //往前靠拢\r\n                            child = this.startContainer.lastChild;\r\n                            if (child && domUtils.isBr(child)) {\r\n                                this.setStartBefore(child).collapse(true);\r\n                            }\r\n                        } else {\r\n                            //向后靠拢\r\n                            while (child && domUtils.isBlockElm(child)) {\r\n                                if (child.nodeType == 1 && child.childNodes[0]) {\r\n                                    child = child.childNodes[0]\r\n                                } else {\r\n                                    break;\r\n                                }\r\n                            }\r\n                            child && this.setStartBefore(child).collapse(true)\r\n                        }\r\n\r\n                    }\r\n                    //是createAddress最后一位算的不准，现在这里进行微调\r\n                    checkOffset(this);\r\n                    nativeRange.setStart(this.startContainer, this.startOffset);\r\n                    nativeRange.setEnd(this.endContainer, this.endOffset);\r\n                    sel.addRange(nativeRange);\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * 滚动到当前range开始的位置\r\n             * @method scrollToView\r\n             * @param { Window } win 当前range对象所属的window对象\r\n             * @return { UE.dom.Range } 当前Range对象\r\n             */\r\n\r\n            /**\r\n             * 滚动到距离当前range开始位置 offset 的位置处\r\n             * @method scrollToView\r\n             * @param { Window } win 当前range对象所属的window对象\r\n             * @param { Number } offset 距离range开始位置处的偏移量， 如果为正数， 则向下偏移， 反之， 则向上偏移\r\n             * @return { UE.dom.Range } 当前Range对象\r\n             */\r\n            scrollToView: function (win, offset) {\r\n                win = win ? window : domUtils.getWindow(this.document);\r\n                var me = this,\r\n                    span = me.document.createElement('span');\r\n                //trace:717\r\n                span.innerHTML = '&nbsp;';\r\n                me.cloneRange().insertNode(span);\r\n                domUtils.scrollToView(span, win, offset);\r\n                domUtils.remove(span);\r\n                return me;\r\n            },\r\n\r\n            /**\r\n             * 判断当前选区内容是否占位符\r\n             * @private\r\n             * @method inFillChar\r\n             * @return { Boolean } 如果是占位符返回true，否则返回false\r\n             */\r\n            inFillChar: function () {\r\n                var start = this.startContainer;\r\n                if (this.collapsed && start.nodeType == 3\r\n                    && start.nodeValue.replace(new RegExp('^' + domUtils.fillChar), '').length + 1 == start.nodeValue.length\r\n                ) {\r\n                    return true;\r\n                }\r\n                return false;\r\n            },\r\n\r\n            /**\r\n             * 保存\r\n             * @method createAddress\r\n             * @private\r\n             * @return { Boolean } 返回开始和结束的位置\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *     <p>\r\n             *         aaaa\r\n             *         <em>\r\n             *             <!-- 选区开始 -->\r\n             *             bbbb\r\n             *             <!-- 选区结束 -->\r\n             *         </em>\r\n             *     </p>\r\n             *\r\n             *     <script>\r\n             *         //output: {startAddress:[0,1,0,0],endAddress:[0,1,0,4]}\r\n             *         console.log( range.createAddress() );\r\n             *     </script>\r\n             * </body>\r\n             * ```\r\n             */\r\n            createAddress: function (ignoreEnd, ignoreTxt) {\r\n                var addr = {}, me = this;\r\n\r\n                function getAddress(isStart) {\r\n                    var node = isStart ? me.startContainer : me.endContainer;\r\n                    var parents = domUtils.findParents(node, true, function (node) { return !domUtils.isBody(node) }),\r\n                        addrs = [];\r\n                    for (var i = 0, ci; ci = parents[i++];) {\r\n                        addrs.push(domUtils.getNodeIndex(ci, ignoreTxt));\r\n                    }\r\n                    var firstIndex = 0;\r\n\r\n                    if (ignoreTxt) {\r\n                        if (node.nodeType == 3) {\r\n                            var tmpNode = node.previousSibling;\r\n                            while (tmpNode && tmpNode.nodeType == 3) {\r\n                                firstIndex += tmpNode.nodeValue.replace(fillCharReg, '').length;\r\n                                tmpNode = tmpNode.previousSibling;\r\n                            }\r\n                            firstIndex += (isStart ? me.startOffset : me.endOffset)// - (fillCharReg.test(node.nodeValue) ? 1 : 0 )\r\n                        } else {\r\n                            node = node.childNodes[isStart ? me.startOffset : me.endOffset];\r\n                            if (node) {\r\n                                firstIndex = domUtils.getNodeIndex(node, ignoreTxt);\r\n                            } else {\r\n                                node = isStart ? me.startContainer : me.endContainer;\r\n                                var first = node.firstChild;\r\n                                while (first) {\r\n                                    if (domUtils.isFillChar(first)) {\r\n                                        first = first.nextSibling;\r\n                                        continue;\r\n                                    }\r\n                                    firstIndex++;\r\n                                    if (first.nodeType == 3) {\r\n                                        while (first && first.nodeType == 3) {\r\n                                            first = first.nextSibling;\r\n                                        }\r\n                                    } else {\r\n                                        first = first.nextSibling;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    } else {\r\n                        firstIndex = isStart ? domUtils.isFillChar(node) ? 0 : me.startOffset : me.endOffset\r\n                    }\r\n                    if (firstIndex < 0) {\r\n                        firstIndex = 0;\r\n                    }\r\n                    addrs.push(firstIndex);\r\n                    return addrs;\r\n                }\r\n                addr.startAddress = getAddress(true);\r\n                if (!ignoreEnd) {\r\n                    addr.endAddress = me.collapsed ? [].concat(addr.startAddress) : getAddress();\r\n                }\r\n                return addr;\r\n            },\r\n\r\n            /**\r\n             * 保存\r\n             * @method createAddress\r\n             * @private\r\n             * @return { Boolean } 返回开始和结束的位置\r\n             * @example\r\n             * ```html\r\n             * <body>\r\n             *     <p>\r\n             *         aaaa\r\n             *         <em>\r\n             *             <!-- 选区开始 -->\r\n             *             bbbb\r\n             *             <!-- 选区结束 -->\r\n             *         </em>\r\n             *     </p>\r\n             *\r\n             *     <script>\r\n             *         var range = editor.selection.getRange();\r\n             *         range.moveToAddress({startAddress:[0,1,0,0],endAddress:[0,1,0,4]});\r\n             *         range.select();\r\n             *         //output: 'bbbb'\r\n             *         console.log(editor.selection.getText());\r\n             *     </script>\r\n             * </body>\r\n             * ```\r\n             */\r\n            moveToAddress: function (addr, ignoreEnd) {\r\n                var me = this;\r\n                function getNode(address, isStart) {\r\n                    var tmpNode = me.document.body,\r\n                        parentNode, offset;\r\n                    for (var i = 0, ci, l = address.length; i < l; i++) {\r\n                        ci = address[i];\r\n                        parentNode = tmpNode;\r\n                        tmpNode = tmpNode.childNodes[ci];\r\n                        if (!tmpNode) {\r\n                            offset = ci;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (isStart) {\r\n                        if (tmpNode) {\r\n                            me.setStartBefore(tmpNode)\r\n                        } else {\r\n                            me.setStart(parentNode, offset)\r\n                        }\r\n                    } else {\r\n                        if (tmpNode) {\r\n                            me.setEndBefore(tmpNode)\r\n                        } else {\r\n                            me.setEnd(parentNode, offset)\r\n                        }\r\n                    }\r\n                }\r\n                getNode(addr.startAddress, true);\r\n                !ignoreEnd && addr.endAddress && getNode(addr.endAddress);\r\n                return me;\r\n            },\r\n\r\n            /**\r\n             * 判断给定的Range对象是否和当前Range对象表示的是同一个选区\r\n             * @method equals\r\n             * @param { UE.dom.Range } 需要判断的Range对象\r\n             * @return { Boolean } 如果给定的Range对象与当前Range对象表示的是同一个选区， 则返回true， 否则返回false\r\n             */\r\n            equals: function (rng) {\r\n                for (var p in this) {\r\n                    if (this.hasOwnProperty(p)) {\r\n                        if (this[p] !== rng[p])\r\n                            return false\r\n                    }\r\n                }\r\n                return true;\r\n\r\n            },\r\n\r\n            /**\r\n             * 遍历range内的节点。每当遍历一个节点时， 都会执行参数项 doFn 指定的函数， 该函数的接受当前遍历的节点\r\n             * 作为其参数。\r\n             * @method traversal\r\n             * @param { Function }  doFn 对每个遍历的节点要执行的方法， 该方法接受当前遍历的节点作为其参数\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @example\r\n             * ```html\r\n             *\r\n             * <body>\r\n             *\r\n             *     <!-- 选区开始 -->\r\n             *     <span></span>\r\n             *     <a></a>\r\n             *     <!-- 选区结束 -->\r\n             * </body>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //output: <span></span><a></a>\r\n             *     console.log( range.cloneContents() );\r\n             *\r\n             *     range.traversal( function ( node ) {\r\n             *\r\n             *         if ( node.nodeType === 1 ) {\r\n             *             node.className = \"test\";\r\n             *         }\r\n             *\r\n             *     } );\r\n             *\r\n             *     //output: <span class=\"test\"></span><a class=\"test\"></a>\r\n             *     console.log( range.cloneContents() );\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 遍历range内的节点。\r\n             * 每当遍历一个节点时， 都会执行参数项 doFn 指定的函数， 该函数的接受当前遍历的节点\r\n             * 作为其参数。\r\n             * 可以通过参数项 filterFn 来指定一个过滤器， 只有符合该过滤器过滤规则的节点才会触\r\n             * 发doFn函数的执行\r\n             * @method traversal\r\n             * @param { Function } doFn 对每个遍历的节点要执行的方法， 该方法接受当前遍历的节点作为其参数\r\n             * @param { Function } filterFn 过滤器， 该函数接受当前遍历的节点作为参数， 如果该节点满足过滤\r\n             *                      规则， 请返回true， 该节点会触发doFn， 否则， 请返回false， 则该节点不\r\n             *                      会触发doFn。\r\n             * @return { UE.dom.Range } 当前range对象\r\n             * @see UE.dom.Range:traversal(Function)\r\n             * @example\r\n             * ```html\r\n             *\r\n             * <body>\r\n             *\r\n             *     <!-- 选区开始 -->\r\n             *     <span></span>\r\n             *     <a></a>\r\n             *     <!-- 选区结束 -->\r\n             * </body>\r\n             *\r\n             * <script>\r\n             *\r\n             *     //output: <span></span><a></a>\r\n             *     console.log( range.cloneContents() );\r\n             *\r\n             *     range.traversal( function ( node ) {\r\n             *\r\n             *         node.className = \"test\";\r\n             *\r\n             *     }, function ( node ) {\r\n             *          return node.nodeType === 1;\r\n             *     } );\r\n             *\r\n             *     //output: <span class=\"test\"></span><a class=\"test\"></a>\r\n             *     console.log( range.cloneContents() );\r\n             *\r\n             * </script>\r\n             * ```\r\n             */\r\n            traversal: function (doFn, filterFn) {\r\n                if (this.collapsed)\r\n                    return this;\r\n                var bookmark = this.createBookmark(),\r\n                    end = bookmark.end,\r\n                    current = domUtils.getNextDomNode(bookmark.start, false, filterFn);\r\n                while (current && current !== end && (domUtils.getPosition(current, end) & domUtils.POSITION_PRECEDING)) {\r\n                    var tmpNode = domUtils.getNextDomNode(current, false, filterFn);\r\n                    doFn(current);\r\n                    current = tmpNode;\r\n                }\r\n                return this.moveToBookmark(bookmark);\r\n            }\r\n        };\r\n    })();\r\n\r\n    // core/Selection.js\r\n    /**\r\n     * 选集\r\n     * @file\r\n     * @module UE.dom\r\n     * @class Selection\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 选区集合\r\n     * @unfile\r\n     * @module UE.dom\r\n     * @class Selection\r\n     */\r\n    (function () {\r\n\r\n        function getBoundaryInformation(range, start) {\r\n            var getIndex = domUtils.getNodeIndex;\r\n            range = range.duplicate();\r\n            range.collapse(start);\r\n            var parent = range.parentElement();\r\n            //如果节点里没有子节点，直接退出\r\n            if (!parent.hasChildNodes()) {\r\n                return { container: parent, offset: 0 };\r\n            }\r\n            var siblings = parent.children,\r\n                child,\r\n                testRange = range.duplicate(),\r\n                startIndex = 0, endIndex = siblings.length - 1, index = -1,\r\n                distance;\r\n            while (startIndex <= endIndex) {\r\n                index = Math.floor((startIndex + endIndex) / 2);\r\n                child = siblings[index];\r\n                testRange.moveToElementText(child);\r\n                var position = testRange.compareEndPoints('StartToStart', range);\r\n                if (position > 0) {\r\n                    endIndex = index - 1;\r\n                } else if (position < 0) {\r\n                    startIndex = index + 1;\r\n                } else {\r\n                    //trace:1043\r\n                    return { container: parent, offset: getIndex(child) };\r\n                }\r\n            }\r\n            if (index == -1) {\r\n                testRange.moveToElementText(parent);\r\n                testRange.setEndPoint('StartToStart', range);\r\n                distance = testRange.text.replace(/(\\r\\n|\\r)/g, '\\n').length;\r\n                siblings = parent.childNodes;\r\n                if (!distance) {\r\n                    child = siblings[siblings.length - 1];\r\n                    return { container: child, offset: child.nodeValue.length };\r\n                }\r\n\r\n                var i = siblings.length;\r\n                while (distance > 0) {\r\n                    distance -= siblings[--i].nodeValue.length;\r\n                }\r\n                return { container: siblings[i], offset: -distance };\r\n            }\r\n            testRange.collapse(position > 0);\r\n            testRange.setEndPoint(position > 0 ? 'StartToStart' : 'EndToStart', range);\r\n            distance = testRange.text.replace(/(\\r\\n|\\r)/g, '\\n').length;\r\n            if (!distance) {\r\n                return dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName] ?\r\n                    { container: parent, offset: getIndex(child) + (position > 0 ? 0 : 1) } :\r\n                    { container: child, offset: position > 0 ? 0 : child.childNodes.length }\r\n            }\r\n            while (distance > 0) {\r\n                try {\r\n                    var pre = child;\r\n                    child = child[position > 0 ? 'previousSibling' : 'nextSibling'];\r\n                    distance -= child.nodeValue.length;\r\n                } catch (e) {\r\n                    return { container: parent, offset: getIndex(pre) };\r\n                }\r\n            }\r\n            return { container: child, offset: position > 0 ? -distance : child.nodeValue.length + distance }\r\n        }\r\n\r\n        /**\r\n         * 将ieRange转换为Range对象\r\n         * @param {Range}   ieRange    ieRange对象\r\n         * @param {Range}   range      Range对象\r\n         * @return  {Range}  range       返回转换后的Range对象\r\n         */\r\n        function transformIERangeToRange(ieRange, range) {\r\n            if (ieRange.item) {\r\n                range.selectNode(ieRange.item(0));\r\n            } else {\r\n                var bi = getBoundaryInformation(ieRange, true);\r\n                range.setStart(bi.container, bi.offset);\r\n                if (ieRange.compareEndPoints('StartToEnd', ieRange) != 0) {\r\n                    bi = getBoundaryInformation(ieRange, false);\r\n                    range.setEnd(bi.container, bi.offset);\r\n                }\r\n            }\r\n            return range;\r\n        }\r\n\r\n        /**\r\n         * 获得ieRange\r\n         * @param {Selection} sel    Selection对象\r\n         * @return {ieRange}    得到ieRange\r\n         */\r\n        function _getIERange(sel) {\r\n            var ieRange;\r\n            //ie下有可能报错\r\n            try {\r\n                ieRange = sel.getNative().createRange();\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n            var el = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\r\n            if ((el.ownerDocument || el) === sel.document) {\r\n                return ieRange;\r\n            }\r\n            return null;\r\n        }\r\n\r\n        var Selection = dom.Selection = function (doc) {\r\n            var me = this, iframe;\r\n            me.document = doc;\r\n            if (browser.ie9below) {\r\n                iframe = domUtils.getWindow(doc).frameElement;\r\n                domUtils.on(iframe, 'beforedeactivate', function () {\r\n                    me._bakIERange = me.getIERange();\r\n                });\r\n                domUtils.on(iframe, 'activate', function () {\r\n                    try {\r\n                        if (!_getIERange(me) && me._bakIERange) {\r\n                            me._bakIERange.select();\r\n                        }\r\n                    } catch (ex) {\r\n                    }\r\n                    me._bakIERange = null;\r\n                });\r\n            }\r\n            iframe = doc = null;\r\n        };\r\n\r\n        Selection.prototype = {\r\n\r\n            rangeInBody: function (rng, txtRange) {\r\n                var node = browser.ie9below || txtRange ? rng.item ? rng.item() : rng.parentElement() : rng.startContainer;\r\n\r\n                return node === this.document.body || domUtils.inDoc(node, this.document);\r\n            },\r\n\r\n            /**\r\n             * 获取原生seleciton对象\r\n             * @method getNative\r\n             * @return { Object } 获得selection对象\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getNative();\r\n             * ```\r\n             */\r\n            getNative: function () {\r\n                var doc = this.document;\r\n                try {\r\n                    return !doc ? null : browser.ie9below ? doc.selection : domUtils.getWindow(doc).getSelection();\r\n                } catch (e) {\r\n                    return null;\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 获得ieRange\r\n             * @method getIERange\r\n             * @return { Object } 返回ie原生的Range\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getIERange();\r\n             * ```\r\n             */\r\n            getIERange: function () {\r\n                var ieRange = _getIERange(this);\r\n                if (!ieRange) {\r\n                    if (this._bakIERange) {\r\n                        return this._bakIERange;\r\n                    }\r\n                }\r\n                return ieRange;\r\n            },\r\n\r\n            /**\r\n             * 缓存当前选区的range和选区的开始节点\r\n             * @method cache\r\n             */\r\n            cache: function () {\r\n                this.clear();\r\n                this._cachedRange = this.getRange();\r\n                this._cachedStartElement = this.getStart();\r\n                this._cachedStartElementPath = this.getStartElementPath();\r\n            },\r\n\r\n            /**\r\n             * 获取选区开始位置的父节点到body\r\n             * @method getStartElementPath\r\n             * @return { Array } 返回父节点集合\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getStartElementPath();\r\n             * ```\r\n             */\r\n            getStartElementPath: function () {\r\n                if (this._cachedStartElementPath) {\r\n                    return this._cachedStartElementPath;\r\n                }\r\n                var start = this.getStart();\r\n                if (start) {\r\n                    return domUtils.findParents(start, true, null, true)\r\n                }\r\n                return [];\r\n            },\r\n\r\n            /**\r\n             * 清空缓存\r\n             * @method clear\r\n             */\r\n            clear: function () {\r\n                this._cachedStartElementPath = this._cachedRange = this._cachedStartElement = null;\r\n            },\r\n\r\n            /**\r\n             * 编辑器是否得到了选区\r\n             * @method isFocus\r\n             */\r\n            isFocus: function () {\r\n                try {\r\n                    if (browser.ie9below) {\r\n\r\n                        var nativeRange = _getIERange(this);\r\n                        return !!(nativeRange && this.rangeInBody(nativeRange));\r\n                    } else {\r\n                        return !!this.getNative().rangeCount;\r\n                    }\r\n                } catch (e) {\r\n                    return false;\r\n                }\r\n\r\n            },\r\n\r\n            /**\r\n             * 获取选区对应的Range\r\n             * @method getRange\r\n             * @return { Object } 得到Range对象\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getRange();\r\n             * ```\r\n             */\r\n            getRange: function () {\r\n                var me = this;\r\n                function optimze(range) {\r\n                    var child = me.document.body.firstChild,\r\n                        collapsed = range.collapsed;\r\n                    while (child && child.firstChild) {\r\n                        range.setStart(child, 0);\r\n                        child = child.firstChild;\r\n                    }\r\n                    if (!range.startContainer) {\r\n                        range.setStart(me.document.body, 0)\r\n                    }\r\n                    if (collapsed) {\r\n                        range.collapse(true);\r\n                    }\r\n                }\r\n\r\n                if (me._cachedRange != null) {\r\n                    return this._cachedRange;\r\n                }\r\n                var range = new baidu.editor.dom.Range(me.document);\r\n\r\n                if (browser.ie9below) {\r\n                    var nativeRange = me.getIERange();\r\n                    if (nativeRange) {\r\n                        //备份的_bakIERange可能已经实效了，dom树发生了变化比如从源码模式切回来，所以try一下，实效就放到body开始位置\r\n                        try {\r\n                            transformIERangeToRange(nativeRange, range);\r\n                        } catch (e) {\r\n                            optimze(range);\r\n                        }\r\n\r\n                    } else {\r\n                        optimze(range);\r\n                    }\r\n                } else {\r\n                    var sel = me.getNative();\r\n                    if (sel && sel.rangeCount) {\r\n                        var firstRange = sel.getRangeAt(0);\r\n                        var lastRange = sel.getRangeAt(sel.rangeCount - 1);\r\n                        range.setStart(firstRange.startContainer, firstRange.startOffset).setEnd(lastRange.endContainer, lastRange.endOffset);\r\n                        if (range.collapsed && domUtils.isBody(range.startContainer) && !range.startOffset) {\r\n                            optimze(range);\r\n                        }\r\n                    } else {\r\n                        //trace:1734 有可能已经不在dom树上了，标识的节点\r\n                        if (this._bakRange && domUtils.inDoc(this._bakRange.startContainer, this.document)) {\r\n                            return this._bakRange;\r\n                        }\r\n                        optimze(range);\r\n                    }\r\n                }\r\n                return this._bakRange = range;\r\n            },\r\n\r\n            /**\r\n             * 获取开始元素，用于状态反射\r\n             * @method getStart\r\n             * @return { Element } 获得开始元素\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getStart();\r\n             * ```\r\n             */\r\n            getStart: function () {\r\n                if (this._cachedStartElement) {\r\n                    return this._cachedStartElement;\r\n                }\r\n                var range = browser.ie9below ? this.getIERange() : this.getRange(),\r\n                    tmpRange,\r\n                    start, tmp, parent;\r\n                if (browser.ie9below) {\r\n                    if (!range) {\r\n                        //todo 给第一个值可能会有问题\r\n                        return this.document.body.firstChild;\r\n                    }\r\n                    //control元素\r\n                    if (range.item) {\r\n                        return range.item(0);\r\n                    }\r\n                    tmpRange = range.duplicate();\r\n                    //修正ie下<b>x</b>[xx] 闭合后 <b>x|</b>xx\r\n                    tmpRange.text.length > 0 && tmpRange.moveStart('character', 1);\r\n                    tmpRange.collapse(1);\r\n                    start = tmpRange.parentElement();\r\n                    parent = tmp = range.parentElement();\r\n                    while (tmp = tmp.parentNode) {\r\n                        if (tmp == start) {\r\n                            start = parent;\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    range.shrinkBoundary();\r\n                    start = range.startContainer;\r\n                    if (start.nodeType == 1 && start.hasChildNodes()) {\r\n                        start = start.childNodes[Math.min(start.childNodes.length - 1, range.startOffset)];\r\n                    }\r\n                    if (start.nodeType == 3) {\r\n                        return start.parentNode;\r\n                    }\r\n                }\r\n                return start;\r\n            },\r\n\r\n            /**\r\n             * 得到选区中的文本\r\n             * @method getText\r\n             * @return { String } 选区中包含的文本\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.getText();\r\n             * ```\r\n             */\r\n            getText: function () {\r\n                var nativeSel, nativeRange;\r\n                if (this.isFocus() && (nativeSel = this.getNative())) {\r\n                    nativeRange = browser.ie9below ? nativeSel.createRange() : nativeSel.getRangeAt(0);\r\n                    return browser.ie9below ? nativeRange.text : nativeRange.toString();\r\n                }\r\n                return '';\r\n            },\r\n\r\n            /**\r\n             * 清除选区\r\n             * @method clearRange\r\n             * @example\r\n             * ```javascript\r\n             * editor.selection.clearRange();\r\n             * ```\r\n             */\r\n            clearRange: function () {\r\n                this.getNative()[browser.ie9below ? 'empty' : 'removeAllRanges']();\r\n            }\r\n        };\r\n    })();\r\n\r\n    // core/Editor.js\r\n    /**\r\n     * 编辑器主类，包含编辑器提供的大部分公用接口\r\n     * @file\r\n     * @module UE\r\n     * @class Editor\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @unfile\r\n     * @module UE\r\n     */\r\n\r\n    /**\r\n     * UEditor的核心类，为用户提供与编辑器交互的接口。\r\n     * @unfile\r\n     * @module UE\r\n     * @class Editor\r\n     */\r\n\r\n    (function () {\r\n        var uid = 0, _selectionChangeTimer;\r\n\r\n        /**\r\n         * 获取编辑器的html内容，赋值到编辑器所在表单的textarea文本域里面\r\n         * @private\r\n         * @method setValue\r\n         * @param { UE.Editor } editor 编辑器事例\r\n         */\r\n        function setValue(form, editor) {\r\n            var textarea;\r\n            if (editor.textarea) {\r\n                if (utils.isString(editor.textarea)) {\r\n                    for (var i = 0, ti, tis = domUtils.getElementsByTagName(form, 'textarea'); ti = tis[i++];) {\r\n                        if (ti.id == 'ueditor_textarea_' + editor.options.textarea) {\r\n                            textarea = ti;\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    textarea = editor.textarea;\r\n                }\r\n            }\r\n            if (!textarea) {\r\n                form.appendChild(textarea = domUtils.createElement(document, 'textarea', {\r\n                    'name': editor.options.textarea,\r\n                    'id': 'ueditor_textarea_' + editor.options.textarea,\r\n                    'style': \"display:none\"\r\n                }));\r\n                //不要产生多个textarea\r\n                editor.textarea = textarea;\r\n            }\r\n            !textarea.getAttribute('name') && textarea.setAttribute('name', editor.options.textarea);\r\n            textarea.value = editor.hasContents() ?\r\n                (editor.options.allHtmlEnabled ? editor.getAllHtml() : editor.getContent(null, null, true)) :\r\n                ''\r\n        }\r\n        function loadPlugins(me) {\r\n            //初始化插件\r\n            for (var pi in UE.plugins) {\r\n                UE.plugins[pi].call(me);\r\n            }\r\n\r\n        }\r\n        function checkCurLang(I18N) {\r\n            for (var lang in I18N) {\r\n                return lang\r\n            }\r\n        }\r\n\r\n        function langReadied(me) {\r\n            me.langIsReady = true;\r\n\r\n            me.fireEvent(\"langReady\");\r\n        }\r\n\r\n        /**\r\n         * 编辑器准备就绪后会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event ready\r\n         * @remind render方法执行完成之后,会触发该事件\r\n         * @remind\r\n         * @example\r\n         * ```javascript\r\n         * editor.addListener( 'ready', function( editor ) {\r\n         *     editor.execCommand( 'focus' ); //编辑器家在完成后，让编辑器拿到焦点\r\n         * } );\r\n         * ```\r\n         */\r\n        /**\r\n         * 执行destroy方法,会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event destroy\r\n         * @see UE.Editor:destroy()\r\n         */\r\n        /**\r\n         * 执行reset方法,会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event reset\r\n         * @see UE.Editor:reset()\r\n         */\r\n        /**\r\n         * 执行focus方法,会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event focus\r\n         * @see UE.Editor:focus(Boolean)\r\n         */\r\n        /**\r\n         * 语言加载完成会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event langReady\r\n         */\r\n        /**\r\n         * 运行命令之后会触发该命令\r\n         * @module UE\r\n         * @class Editor\r\n         * @event beforeExecCommand\r\n         */\r\n        /**\r\n         * 运行命令之后会触发该命令\r\n         * @module UE\r\n         * @class Editor\r\n         * @event afterExecCommand\r\n         */\r\n        /**\r\n         * 运行命令之前会触发该命令\r\n         * @module UE\r\n         * @class Editor\r\n         * @event firstBeforeExecCommand\r\n         */\r\n        /**\r\n         * 在getContent方法执行之前会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event beforeGetContent\r\n         * @see UE.Editor:getContent()\r\n         */\r\n        /**\r\n         * 在getContent方法执行之后会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event afterGetContent\r\n         * @see UE.Editor:getContent()\r\n         */\r\n        /**\r\n         * 在getAllHtml方法执行时会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event getAllHtml\r\n         * @see UE.Editor:getAllHtml()\r\n         */\r\n        /**\r\n         * 在setContent方法执行之前会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event beforeSetContent\r\n         * @see UE.Editor:setContent(String)\r\n         */\r\n        /**\r\n         * 在setContent方法执行之后会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event afterSetContent\r\n         * @see UE.Editor:setContent(String)\r\n         */\r\n        /**\r\n         * 每当编辑器内部选区发生改变时，将触发该事件\r\n         * @event selectionchange\r\n         * @warning 该事件的触发非常频繁，不建议在该事件的处理过程中做重量级的处理\r\n         * @example\r\n         * ```javascript\r\n         * editor.addListener( 'selectionchange', function( editor ) {\r\n         *     console.log('选区发生改变');\r\n         * }\r\n         */\r\n        /**\r\n         * 在所有selectionchange的监听函数执行之前，会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event beforeSelectionChange\r\n         * @see UE.Editor:selectionchange\r\n         */\r\n        /**\r\n         * 在所有selectionchange的监听函数执行完之后，会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event afterSelectionChange\r\n         * @see UE.Editor:selectionchange\r\n         */\r\n        /**\r\n         * 编辑器内容发生改变时会触发该事件\r\n         * @module UE\r\n         * @class Editor\r\n         * @event contentChange\r\n         */\r\n\r\n\r\n        /**\r\n         * 以默认参数构建一个编辑器实例\r\n         * @constructor\r\n         * @remind 通过 改构造方法实例化的编辑器,不带ui层.需要render到一个容器,编辑器实例才能正常渲染到页面\r\n         * @example\r\n         * ```javascript\r\n         * var editor = new UE.Editor();\r\n         * editor.execCommand('blod');\r\n         * ```\r\n         * @see UE.Config\r\n         */\r\n\r\n        /**\r\n         * 以给定的参数集合创建一个编辑器实例，对于未指定的参数，将应用默认参数。\r\n         * @constructor\r\n         * @remind 通过 改构造方法实例化的编辑器,不带ui层.需要render到一个容器,编辑器实例才能正常渲染到页面\r\n         * @param { Object } setting 创建编辑器的参数\r\n         * @example\r\n         * ```javascript\r\n         * var editor = new UE.Editor();\r\n         * editor.execCommand('blod');\r\n         * ```\r\n         * @see UE.Config\r\n         */\r\n        var Editor = UE.Editor = function (options) {\r\n            var me = this;\r\n            me.uid = uid++;\r\n            EventBase.call(me);\r\n            me.commands = {};\r\n            me.options = utils.extend(utils.clone(options || {}), UEDITOR_CONFIG, true);\r\n            me.shortcutkeys = {};\r\n            me.inputRules = [];\r\n            me.outputRules = [];\r\n            //设置默认的常用属性\r\n            me.setOpt(Editor.defaultOptions(me));\r\n\r\n            /* 尝试异步加载后台配置 */\r\n            me.loadServerConfig();\r\n\r\n            if (!utils.isEmptyObject(UE.I18N)) {\r\n                //修改默认的语言类型\r\n                me.options.lang = checkCurLang(UE.I18N);\r\n                UE.plugin.load(me);\r\n                langReadied(me);\r\n\r\n            } else {\r\n                utils.loadFile(document, {\r\n                    src: me.options.langPath + me.options.lang + \"/\" + me.options.lang + \".js\",\r\n                    tag: \"script\",\r\n                    type: \"text/javascript\",\r\n                    defer: \"defer\"\r\n                }, function () {\r\n                    UE.plugin.load(me);\r\n                    langReadied(me);\r\n                });\r\n            }\r\n\r\n            UE.instants['ueditorInstant' + me.uid] = me;\r\n        };\r\n        Editor.prototype = {\r\n            registerCommand: function (name, obj) {\r\n                this.commands[name] = obj;\r\n            },\r\n            /**\r\n             * 编辑器对外提供的监听ready事件的接口， 通过调用该方法，达到的效果与监听ready事件是一致的\r\n             * @method ready\r\n             * @param { Function } fn 编辑器ready之后所执行的回调, 如果在注册事件之前编辑器已经ready，将会\r\n             * 立即触发该回调。\r\n             * @remind 需要等待编辑器加载完成后才能执行的代码,可以使用该方法传入\r\n             * @example\r\n             * ```javascript\r\n             * editor.ready( function( editor ) {\r\n             *     editor.setContent('初始化完毕');\r\n             * } );\r\n             * ```\r\n             * @see UE.Editor.event:ready\r\n             */\r\n            ready: function (fn) {\r\n                var me = this;\r\n                if (fn) {\r\n                    me.isReady ? fn.apply(me) : me.addListener('ready', fn);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 该方法是提供给插件里面使用，设置配置项默认值\r\n             * @method setOpt\r\n             * @warning 三处设置配置项的优先级: 实例化时传入参数 > setOpt()设置 > config文件里设置\r\n             * @warning 该方法仅供编辑器插件内部和编辑器初始化时调用，其他地方不能调用。\r\n             * @param { String } key 编辑器的可接受的选项名称\r\n             * @param { * } val  该选项可接受的值\r\n             * @example\r\n             * ```javascript\r\n             * editor.setOpt( 'initContent', '欢迎使用编辑器' );\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 该方法是提供给插件里面使用，以{key:value}集合的方式设置插件内用到的配置项默认值\r\n             * @method setOpt\r\n             * @warning 三处设置配置项的优先级: 实例化时传入参数 > setOpt()设置 > config文件里设置\r\n             * @warning 该方法仅供编辑器插件内部和编辑器初始化时调用，其他地方不能调用。\r\n             * @param { Object } options 将要设置的选项的键值对对象\r\n             * @example\r\n             * ```javascript\r\n             * editor.setOpt( {\r\n             *     'initContent': '欢迎使用编辑器'\r\n             * } );\r\n             * ```\r\n             */\r\n            setOpt: function (key, val) {\r\n                var obj = {};\r\n                if (utils.isString(key)) {\r\n                    obj[key] = val\r\n                } else {\r\n                    obj = key;\r\n                }\r\n                utils.extend(this.options, obj, true);\r\n            },\r\n            getOpt: function (key) {\r\n                return this.options[key]\r\n            },\r\n            /**\r\n             * 销毁编辑器实例，使用textarea代替\r\n             * @method destroy\r\n             * @example\r\n             * ```javascript\r\n             * editor.destroy();\r\n             * ```\r\n             */\r\n            destroy: function () {\r\n\r\n                var me = this;\r\n                me.fireEvent('destroy');\r\n                var container = me.container.parentNode;\r\n                var textarea = me.textarea;\r\n                if (!textarea) {\r\n                    textarea = document.createElement('textarea');\r\n                    container.parentNode.insertBefore(textarea, container);\r\n                } else {\r\n                    textarea.style.display = ''\r\n                }\r\n\r\n                textarea.style.width = me.iframe.offsetWidth + 'px';\r\n                textarea.style.height = me.iframe.offsetHeight + 'px';\r\n                textarea.value = me.getContent();\r\n                textarea.id = me.key;\r\n                container.innerHTML = '';\r\n                domUtils.remove(container);\r\n                var key = me.key;\r\n                //trace:2004\r\n                for (var p in me) {\r\n                    if (me.hasOwnProperty(p)) {\r\n                        delete this[p];\r\n                    }\r\n                }\r\n                UE.delEditor(key);\r\n            },\r\n\r\n            /**\r\n             * 渲染编辑器的DOM到指定容器\r\n             * @method render\r\n             * @param { String } containerId 指定一个容器ID\r\n             * @remind 执行该方法,会触发ready事件\r\n             * @warning 必须且只能调用一次\r\n             */\r\n\r\n            /**\r\n             * 渲染编辑器的DOM到指定容器\r\n             * @method render\r\n             * @param { Element } containerDom 直接指定容器对象\r\n             * @remind 执行该方法,会触发ready事件\r\n             * @warning 必须且只能调用一次\r\n             */\r\n            render: function (container) {\r\n                var me = this,\r\n                    options = me.options,\r\n                    getStyleValue = function (attr) {\r\n                        return parseInt(domUtils.getComputedStyle(container, attr));\r\n                    };\r\n                if (utils.isString(container)) {\r\n                    container = document.getElementById(container);\r\n                }\r\n                if (container) {\r\n                    if (options.initialFrameWidth) {\r\n                        options.minFrameWidth = options.initialFrameWidth\r\n                    } else {\r\n                        options.minFrameWidth = options.initialFrameWidth = container.offsetWidth;\r\n                    }\r\n                    if (options.initialFrameHeight) {\r\n                        options.minFrameHeight = options.initialFrameHeight\r\n                    } else {\r\n                        options.initialFrameHeight = options.minFrameHeight = container.offsetHeight;\r\n                    }\r\n\r\n                    container.style.width = /%$/.test(options.initialFrameWidth) ? '100%' : options.initialFrameWidth -\r\n                        getStyleValue(\"padding-left\") - getStyleValue(\"padding-right\") + 'px';\r\n                    container.style.height = /%$/.test(options.initialFrameHeight) ? '100%' : options.initialFrameHeight -\r\n                        getStyleValue(\"padding-top\") - getStyleValue(\"padding-bottom\") + 'px';\r\n\r\n                    container.style.zIndex = options.zIndex;\r\n\r\n                    var html = (ie && browser.version < 9 ? '' : '<!DOCTYPE html>') +\r\n                        '<html xmlns=\\'http://www.w3.org/1999/xhtml\\' class=\\'view\\' ><head>' +\r\n                        '<style type=\\'text/css\\'>' +\r\n                        //设置四周的留边\r\n                        '.view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\\n' +\r\n                        //设置默认字体和字号\r\n                        //font-family不能呢随便改，在safari下fillchar会有解析问题\r\n                        'body{margin:8px;font-family:sans-serif;font-size:16px;}' +\r\n                        //设置段落间距\r\n                        'p{margin:5px 0;}</style>' +\r\n                        (options.iframeCssUrl ? '<link rel=\\'stylesheet\\' type=\\'text/css\\' href=\\'' + utils.unhtml(options.iframeCssUrl) + '\\'/>' : '') +\r\n                        (options.initialStyle ? '<style>' + options.initialStyle + '</style>' : '') +\r\n                        '</head><body class=\\'view\\' ></body>' +\r\n                        '<script type=\\'text/javascript\\' ' + (ie ? 'defer=\\'defer\\'' : '') + ' id=\\'_initialScript\\'>' +\r\n                        'setTimeout(function(){editor = window.parent.UE.instants[\\'ueditorInstant' + me.uid + '\\'];editor._setup(document);},0);' +\r\n                        'var _tmpScript = document.getElementById(\\'_initialScript\\');_tmpScript.parentNode.removeChild(_tmpScript);</script></html>';\r\n                    container.appendChild(domUtils.createElement(document, 'iframe', {\r\n                        id: 'ueditor_' + me.uid,\r\n                        width: \"100%\",\r\n                        height: \"100%\",\r\n                        frameborder: \"0\",\r\n                        //先注释掉了，加的原因忘记了，但开启会直接导致全屏模式下内容多时不会出现滚动条\r\n                        //                    scrolling :'no',\r\n                        src: 'javascript:void(function(){document.open();' + (options.customDomain && document.domain != location.hostname ? 'document.domain=\"' + document.domain + '\";' : '') +\r\n                            'document.write(\"' + html + '\");document.close();}())'\r\n                    }));\r\n                    container.style.overflow = 'hidden';\r\n                    //解决如果是给定的百分比，会导致高度算不对的问题\r\n                    setTimeout(function () {\r\n                        if (/%$/.test(options.initialFrameWidth)) {\r\n                            options.minFrameWidth = options.initialFrameWidth = container.offsetWidth;\r\n                            //如果这里给定宽度，会导致ie在拖动窗口大小时，编辑区域不随着变化\r\n                            //                        container.style.width = options.initialFrameWidth + 'px';\r\n                        }\r\n                        if (/%$/.test(options.initialFrameHeight)) {\r\n                            options.minFrameHeight = options.initialFrameHeight = container.offsetHeight;\r\n                            container.style.height = options.initialFrameHeight + 'px';\r\n                        }\r\n                    })\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 编辑器初始化\r\n             * @method _setup\r\n             * @private\r\n             * @param { Element } doc 编辑器Iframe中的文档对象\r\n             */\r\n            _setup: function (doc) {\r\n\r\n                var me = this,\r\n                    options = me.options;\r\n                if (ie) {\r\n                    doc.body.disabled = true;\r\n                    doc.body.contentEditable = true;\r\n                    doc.body.disabled = false;\r\n                } else {\r\n                    doc.body.contentEditable = true;\r\n                }\r\n                doc.body.spellcheck = false;\r\n                me.document = doc;\r\n                me.window = doc.defaultView || doc.parentWindow;\r\n                me.iframe = me.window.frameElement;\r\n                me.body = doc.body;\r\n                me.selection = new dom.Selection(doc);\r\n                //gecko初始化就能得到range,无法判断isFocus了\r\n                var geckoSel;\r\n                if (browser.gecko && (geckoSel = this.selection.getNative())) {\r\n                    geckoSel.removeAllRanges();\r\n                }\r\n                this._initEvents();\r\n                //为form提交提供一个隐藏的textarea\r\n                for (var form = this.iframe.parentNode; !domUtils.isBody(form); form = form.parentNode) {\r\n                    if (form.tagName == 'FORM') {\r\n                        me.form = form;\r\n                        if (me.options.autoSyncData) {\r\n                            domUtils.on(me.window, 'blur', function () {\r\n                                setValue(form, me);\r\n                            });\r\n                        } else {\r\n                            domUtils.on(form, 'submit', function () {\r\n                                setValue(this, me);\r\n                            });\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (options.initialContent) {\r\n                    if (options.autoClearinitialContent) {\r\n                        var oldExecCommand = me.execCommand;\r\n                        me.execCommand = function () {\r\n                            me.fireEvent('firstBeforeExecCommand');\r\n                            return oldExecCommand.apply(me, arguments);\r\n                        };\r\n                        this._setDefaultContent(options.initialContent);\r\n                    } else\r\n                        this.setContent(options.initialContent, false, true);\r\n                }\r\n\r\n                //编辑器不能为空内容\r\n\r\n                if (domUtils.isEmptyNode(me.body)) {\r\n                    me.body.innerHTML = '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                }\r\n                //如果要求focus, 就把光标定位到内容开始\r\n                if (options.focus) {\r\n                    setTimeout(function () {\r\n                        me.focus(me.options.focusInEnd);\r\n                        //如果自动清除开着，就不需要做selectionchange;\r\n                        !me.options.autoClearinitialContent && me._selectionChange();\r\n                    }, 0);\r\n                }\r\n                if (!me.container) {\r\n                    me.container = this.iframe.parentNode;\r\n                }\r\n                if (options.fullscreen && me.ui) {\r\n                    me.ui.setFullScreen(true);\r\n                }\r\n\r\n                try {\r\n                    me.document.execCommand('2D-position', false, false);\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    me.document.execCommand('enableInlineTableEditing', false, false);\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    me.document.execCommand('enableObjectResizing', false, false);\r\n                } catch (e) {\r\n                }\r\n\r\n                //挂接快捷键\r\n                me._bindshortcutKeys();\r\n                me.isReady = 1;\r\n                me.fireEvent('ready');\r\n                options.onready && options.onready.call(me);\r\n                if (!browser.ie9below) {\r\n                    domUtils.on(me.window, ['blur', 'focus'], function (e) {\r\n                        //chrome下会出现alt+tab切换时，导致选区位置不对\r\n                        if (e.type == 'blur') {\r\n                            me._bakRange = me.selection.getRange();\r\n                            try {\r\n                                me._bakNativeRange = me.selection.getNative().getRangeAt(0);\r\n                                me.selection.getNative().removeAllRanges();\r\n                            } catch (e) {\r\n                                me._bakNativeRange = null;\r\n                            }\r\n\r\n                        } else {\r\n                            try {\r\n                                me._bakRange && me._bakRange.select();\r\n                            } catch (e) {\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                //trace:1518 ff3.6body不够寛，会导致点击空白处无法获得焦点\r\n                if (browser.gecko && browser.version <= 10902) {\r\n                    //修复ff3.6初始化进来，不能点击获得焦点\r\n                    me.body.contentEditable = false;\r\n                    setTimeout(function () {\r\n                        me.body.contentEditable = true;\r\n                    }, 100);\r\n                    setInterval(function () {\r\n                        me.body.style.height = me.iframe.offsetHeight - 20 + 'px'\r\n                    }, 100)\r\n                }\r\n\r\n                !options.isShow && me.setHide();\r\n                options.readonly && me.setDisabled();\r\n            },\r\n\r\n            /**\r\n             * 同步数据到编辑器所在的form\r\n             * 从编辑器的容器节点向上查找form元素，若找到，就同步编辑内容到找到的form里，为提交数据做准备，主要用于是手动提交的情况\r\n             * 后台取得数据的键值，使用你容器上的name属性，如果没有就使用参数里的textarea项\r\n             * @method sync\r\n             * @example\r\n             * ```javascript\r\n             * editor.sync();\r\n             * form.sumbit(); //form变量已经指向了form元素\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 根据传入的formId，在页面上查找要同步数据的表单，若找到，就同步编辑内容到找到的form里，为提交数据做准备\r\n             * 后台取得数据的键值，该键值默认使用给定的编辑器容器的name属性，如果没有name属性则使用参数项里给定的“textarea”项\r\n             * @method sync\r\n             * @param { String } formID 指定一个要同步数据的form的id,编辑器的数据会同步到你指定form下\r\n             */\r\n            sync: function (formId) {\r\n                var me = this,\r\n                    form = formId ? document.getElementById(formId) :\r\n                        domUtils.findParent(me.iframe.parentNode, function (node) {\r\n                            return node.tagName == 'FORM'\r\n                        }, true);\r\n                form && setValue(form, me);\r\n            },\r\n\r\n            /**\r\n             * 设置编辑器高度\r\n             * @method setHeight\r\n             * @remind 当配置项autoHeightEnabled为真时,该方法无效\r\n             * @param { Number } number 设置的高度值，纯数值，不带单位\r\n             * @example\r\n             * ```javascript\r\n             * editor.setHeight(number);\r\n             * ```\r\n             */\r\n            setHeight: function (height, notSetHeight) {\r\n                if (height !== parseInt(this.iframe.parentNode.style.height)) {\r\n                    this.iframe.parentNode.style.height = height + 'px';\r\n                }\r\n                !notSetHeight && (this.options.minFrameHeight = this.options.initialFrameHeight = height);\r\n                this.body.style.height = height + 'px';\r\n                !notSetHeight && this.trigger('setHeight')\r\n            },\r\n\r\n            /**\r\n             * 为编辑器的编辑命令提供快捷键\r\n             * 这个接口是为插件扩展提供的接口,主要是为新添加的插件，如果需要添加快捷键，所提供的接口\r\n             * @method addshortcutkey\r\n             * @param { Object } keyset 命令名和快捷键键值对对象，多个按钮的快捷键用“＋”分隔\r\n             * @example\r\n             * ```javascript\r\n             * editor.addshortcutkey({\r\n             *     \"Bold\" : \"ctrl+66\",//^B\r\n             *     \"Italic\" : \"ctrl+73\", //^I\r\n             * });\r\n             * ```\r\n             */\r\n            /**\r\n             * 这个接口是为插件扩展提供的接口,主要是为新添加的插件，如果需要添加快捷键，所提供的接口\r\n             * @method addshortcutkey\r\n             * @param { String } cmd 触发快捷键时，响应的命令\r\n             * @param { String } keys 快捷键的字符串，多个按钮用“＋”分隔\r\n             * @example\r\n             * ```javascript\r\n             * editor.addshortcutkey(\"Underline\", \"ctrl+85\"); //^U\r\n             * ```\r\n             */\r\n            addshortcutkey: function (cmd, keys) {\r\n                var obj = {};\r\n                if (keys) {\r\n                    obj[cmd] = keys\r\n                } else {\r\n                    obj = cmd;\r\n                }\r\n                utils.extend(this.shortcutkeys, obj)\r\n            },\r\n\r\n            /**\r\n             * 对编辑器设置keydown事件监听，绑定快捷键和命令，当快捷键组合触发成功，会响应对应的命令\r\n             * @method _bindshortcutKeys\r\n             * @private\r\n             */\r\n            _bindshortcutKeys: function () {\r\n                var me = this, shortcutkeys = this.shortcutkeys;\r\n                me.addListener('keydown', function (type, e) {\r\n                    var keyCode = e.keyCode || e.which;\r\n                    for (var i in shortcutkeys) {\r\n                        var tmp = shortcutkeys[i].split(',');\r\n                        for (var t = 0, ti; ti = tmp[t++];) {\r\n                            ti = ti.split(':');\r\n                            var key = ti[0], param = ti[1];\r\n                            if (/^(ctrl)(\\+shift)?\\+(\\d+)$/.test(key.toLowerCase()) || /^(\\d+)$/.test(key)) {\r\n                                if (((RegExp.$1 == 'ctrl' ? (e.ctrlKey || e.metaKey) : 0)\r\n                                    && (RegExp.$2 != \"\" ? e[RegExp.$2.slice(1) + \"Key\"] : 1)\r\n                                    && keyCode == RegExp.$3\r\n                                ) ||\r\n                                    keyCode == RegExp.$1\r\n                                ) {\r\n                                    if (me.queryCommandState(i, param) != -1)\r\n                                        me.execCommand(i, param);\r\n                                    domUtils.preventDefault(e);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * 获取编辑器的内容\r\n             * @method getContent\r\n             * @warning 该方法获取到的是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n             * @return { String } 编辑器的内容字符串, 如果编辑器的内容为空，或者是空的标签内容（如:”&lt;p&gt;&lt;br/&gt;&lt;/p&gt;“）， 则返回空字符串\r\n             * @example\r\n             * ```javascript\r\n             * //编辑器html内容:<p>1<strong>2<em>34</em>5</strong>6</p>\r\n             * var content = editor.getContent(); //返回值:<p>1<strong>2<em>34</em>5</strong>6</p>\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 获取编辑器的内容。 可以通过参数定义编辑器内置的判空规则\r\n             * @method getContent\r\n             * @param { Function } fn 自定的判空规则， 要求该方法返回一个boolean类型的值，\r\n             *                      代表当前编辑器的内容是否空，\r\n             *                      如果返回true， 则该方法将直接返回空字符串；如果返回false，则编辑器将返回\r\n             *                      经过内置过滤规则处理后的内容。\r\n             * @remind 该方法在处理包含有初始化内容的时候能起到很好的作用。\r\n             * @warning 该方法获取到的是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n             * @return { String } 编辑器的内容字符串\r\n             * @example\r\n             * ```javascript\r\n             * // editor 是一个编辑器的实例\r\n             * var content = editor.getContent( function ( editor ) {\r\n             *      return editor.body.innerHTML === '欢迎使用UEditor'; //返回空字符串\r\n             * } );\r\n             * ```\r\n             */\r\n            getContent: function (cmd, fn, notSetCursor, ignoreBlank, formatter) {\r\n                var me = this;\r\n                if (cmd && utils.isFunction(cmd)) {\r\n                    fn = cmd;\r\n                    cmd = '';\r\n                }\r\n                if (fn ? !fn() : !this.hasContents()) {\r\n                    return '';\r\n                }\r\n                me.fireEvent('beforegetcontent');\r\n                var root = UE.htmlparser(me.body.innerHTML, ignoreBlank);\r\n                me.filterOutputRule(root);\r\n                me.fireEvent('aftergetcontent', cmd, root);\r\n                return root.toHtml(formatter);\r\n            },\r\n\r\n            /**\r\n             * 取得完整的html代码，可以直接显示成完整的html文档\r\n             * @method getAllHtml\r\n             * @return { String } 编辑器的内容html文档字符串\r\n             * @eaxmple\r\n             * ```javascript\r\n             * editor.getAllHtml(); //返回格式大致是: <html><head>...</head><body>...</body></html>\r\n             * ```\r\n             */\r\n            getAllHtml: function () {\r\n                var me = this,\r\n                    headHtml = [],\r\n                    html = '';\r\n                me.fireEvent('getAllHtml', headHtml);\r\n                if (browser.ie && browser.version > 8) {\r\n                    var headHtmlForIE9 = '';\r\n                    utils.each(me.document.styleSheets, function (si) {\r\n                        headHtmlForIE9 += (si.href ? '<link rel=\"stylesheet\" type=\"text/css\" href=\"' + si.href + '\" />' : '<style>' + si.cssText + '</style>');\r\n                    });\r\n                    utils.each(me.document.getElementsByTagName('script'), function (si) {\r\n                        headHtmlForIE9 += si.outerHTML;\r\n                    });\r\n\r\n                }\r\n                return '<html><head>' + (me.options.charset ? '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=' + me.options.charset + '\"/>' : '')\r\n                    + (headHtmlForIE9 || me.document.getElementsByTagName('head')[0].innerHTML) + headHtml.join('\\n') + '</head>'\r\n                    + '<body ' + (ie && browser.version < 9 ? 'class=\"view\"' : '') + '>' + me.getContent(null, null, true) + '</body></html>';\r\n            },\r\n\r\n            /**\r\n             * 得到编辑器的纯文本内容，但会保留段落格式\r\n             * @method getPlainTxt\r\n             * @return { String } 编辑器带段落格式的纯文本内容字符串\r\n             * @example\r\n             * ```javascript\r\n             * //编辑器html内容:<p><strong>1</strong></p><p><strong>2</strong></p>\r\n             * console.log(editor.getPlainTxt()); //输出:\"1\\n2\\n\r\n             * ```\r\n             */\r\n            getPlainTxt: function () {\r\n                var reg = new RegExp(domUtils.fillChar, 'g'),\r\n                    html = this.body.innerHTML.replace(/[\\n\\r]/g, '');//ie要先去了\\n在处理\r\n                html = html.replace(/<(p|div)[^>]*>(<br\\/?>|&nbsp;)<\\/\\1>/gi, '\\n')\r\n                    .replace(/<br\\/?>/gi, '\\n')\r\n                    .replace(/<[^>/]+>/g, '')\r\n                    .replace(/(\\n)?<\\/([^>]+)>/g, function (a, b, c) {\r\n                        return dtd.$block[c] ? '\\n' : b ? b : '';\r\n                    });\r\n                //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\r\n                return html.replace(reg, '').replace(/\\u00a0/g, ' ').replace(/&nbsp;/g, ' ');\r\n            },\r\n\r\n            /**\r\n             * 获取编辑器中的纯文本内容,没有段落格式\r\n             * @method getContentTxt\r\n             * @return { String } 编辑器不带段落格式的纯文本内容字符串\r\n             * @example\r\n             * ```javascript\r\n             * //编辑器html内容:<p><strong>1</strong></p><p><strong>2</strong></p>\r\n             * console.log(editor.getPlainTxt()); //输出:\"12\r\n             * ```\r\n             */\r\n            getContentTxt: function () {\r\n                var reg = new RegExp(domUtils.fillChar, 'g');\r\n                //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\r\n                return this.body[browser.ie ? 'innerText' : 'textContent'].replace(reg, '').replace(/\\u00a0/g, ' ');\r\n            },\r\n\r\n            /**\r\n             * 设置编辑器的内容，可修改编辑器当前的html内容\r\n             * @method setContent\r\n             * @warning 通过该方法插入的内容，是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n             * @warning 该方法会触发selectionchange事件\r\n             * @param { String } html 要插入的html内容\r\n             * @example\r\n             * ```javascript\r\n             * editor.getContent('<p>test</p>');\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 设置编辑器的内容，可修改编辑器当前的html内容\r\n             * @method setContent\r\n             * @warning 通过该方法插入的内容，是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n             * @warning 该方法会触发selectionchange事件\r\n             * @param { String } html 要插入的html内容\r\n             * @param { Boolean } isAppendTo 若传入true，不清空原来的内容，在最后插入内容，否则，清空内容再插入\r\n             * @example\r\n             * ```javascript\r\n             * //假设设置前的编辑器内容是 <p>old text</p>\r\n             * editor.setContent('<p>new text</p>', true); //插入的结果是<p>old text</p><p>new text</p>\r\n             * ```\r\n             */\r\n            setContent: function (html, isAppendTo, notFireSelectionchange) {\r\n                var me = this;\r\n                // console.log(this,this.body,html,isAppendTo,'SSSSSSSS');\r\n                me.fireEvent('beforesetcontent', html);\r\n                var root = UE.htmlparser(html);\r\n                me.filterInputRule(root);\r\n                html = root.toHtml();\r\n                // console.log(me,me.body,UE.Editor);\r\n\r\n                me.body.innerHTML = (isAppendTo ? me.body.innerHTML : '') + html;\r\n\r\n\r\n                function isCdataDiv(node) {\r\n                    return node.tagName == 'DIV' && node.getAttribute('cdata_tag');\r\n                }\r\n                //给文本或者inline节点套p标签\r\n                if (me.options.enterTag == 'p') {\r\n\r\n                    var child = this.body.firstChild, tmpNode;\r\n                    if (!child || child.nodeType == 1 &&\r\n                        (dtd.$cdata[child.tagName] || isCdataDiv(child) ||\r\n                            domUtils.isCustomeNode(child)\r\n                        )\r\n                        && child === this.body.lastChild) {\r\n                        this.body.innerHTML = '<p>' + (browser.ie ? '&nbsp;' : '<br/>') + '</p>' + this.body.innerHTML;\r\n\r\n                    } else {\r\n                        var p = me.document.createElement('p');\r\n                        while (child) {\r\n                            while (child && (child.nodeType == 3 || child.nodeType == 1 && dtd.p[child.tagName] && !dtd.$cdata[child.tagName])) {\r\n                                tmpNode = child.nextSibling;\r\n                                p.appendChild(child);\r\n                                child = tmpNode;\r\n                            }\r\n                            if (p.firstChild) {\r\n                                if (!child) {\r\n                                    me.body.appendChild(p);\r\n                                    break;\r\n                                } else {\r\n                                    child.parentNode.insertBefore(p, child);\r\n                                    p = me.document.createElement('p');\r\n                                }\r\n                            }\r\n                            child = child.nextSibling;\r\n                        }\r\n                    }\r\n                }\r\n                me.fireEvent('aftersetcontent');\r\n                me.fireEvent('contentchange');\r\n\r\n                !notFireSelectionchange && me._selectionChange();\r\n                //清除保存的选区\r\n                me._bakRange = me._bakIERange = me._bakNativeRange = null;\r\n                //trace:1742 setContent后gecko能得到焦点问题\r\n                var geckoSel;\r\n                if (browser.gecko && (geckoSel = this.selection.getNative())) {\r\n                    geckoSel.removeAllRanges();\r\n                }\r\n                if (me.options.autoSyncData) {\r\n                    me.form && setValue(me.form, me);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 让编辑器获得焦点，默认focus到编辑器头部\r\n             * @method focus\r\n             * @example\r\n             * ```javascript\r\n             * editor.focus()\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 让编辑器获得焦点，toEnd确定focus位置\r\n             * @method focus\r\n             * @param { Boolean } toEnd 默认focus到编辑器头部，toEnd为true时focus到内容尾部\r\n             * @example\r\n             * ```javascript\r\n             * editor.focus(true)\r\n             * ```\r\n             */\r\n            focus: function (toEnd) {\r\n                try {\r\n                    var me = this,\r\n                        rng = me.selection.getRange();\r\n                    if (toEnd) {\r\n                        var node = me.body.lastChild;\r\n                        if (node && node.nodeType == 1 && !dtd.$empty[node.tagName]) {\r\n                            if (domUtils.isEmptyBlock(node)) {\r\n                                rng.setStartAtFirst(node)\r\n                            } else {\r\n                                rng.setStartAtLast(node)\r\n                            }\r\n                            rng.collapse(true);\r\n                        }\r\n                        rng.setCursor(true);\r\n                    } else {\r\n                        if (!rng.collapsed && domUtils.isBody(rng.startContainer) && rng.startOffset == 0) {\r\n\r\n                            var node = me.body.firstChild;\r\n                            if (node && node.nodeType == 1 && !dtd.$empty[node.tagName]) {\r\n                                rng.setStartAtFirst(node).collapse(true);\r\n                            }\r\n                        }\r\n\r\n                        rng.select(true);\r\n\r\n                    }\r\n                    this.fireEvent('focus selectionchange');\r\n                } catch (e) {\r\n                }\r\n\r\n            },\r\n            isFocus: function () {\r\n                return this.selection.isFocus();\r\n            },\r\n            blur: function () {\r\n                var sel = this.selection.getNative();\r\n                if (sel.empty && browser.ie) {\r\n                    var nativeRng = document.body.createTextRange();\r\n                    nativeRng.moveToElementText(document.body);\r\n                    nativeRng.collapse(true);\r\n                    nativeRng.select();\r\n                    sel.empty()\r\n                } else {\r\n                    sel.removeAllRanges()\r\n                }\r\n\r\n                //this.fireEvent('blur selectionchange');\r\n            },\r\n            /**\r\n             * 初始化UE事件及部分事件代理\r\n             * @method _initEvents\r\n             * @private\r\n             */\r\n            _initEvents: function () {\r\n                var me = this,\r\n                    doc = me.document,\r\n                    win = me.window;\r\n                me._proxyDomEvent = utils.bind(me._proxyDomEvent, me);\r\n                domUtils.on(doc, ['click', 'contextmenu', 'mousedown', 'keydown', 'keyup', 'keypress', 'mouseup', 'mouseover', 'mouseout', 'selectstart'], me._proxyDomEvent);\r\n                domUtils.on(win, ['focus', 'blur'], me._proxyDomEvent);\r\n                domUtils.on(me.body, 'drop', function (e) {\r\n                    //阻止ff下默认的弹出新页面打开图片\r\n                    if (browser.gecko && e.stopPropagation) { e.stopPropagation(); }\r\n                    me.fireEvent('contentchange')\r\n                });\r\n                domUtils.on(doc, ['mouseup', 'keydown'], function (evt) {\r\n                    //特殊键不触发selectionchange\r\n                    if (evt.type == 'keydown' && (evt.ctrlKey || evt.metaKey || evt.shiftKey || evt.altKey)) {\r\n                        return;\r\n                    }\r\n                    if (evt.button == 2) return;\r\n                    me._selectionChange(250, evt);\r\n                });\r\n            },\r\n            /**\r\n             * 触发事件代理\r\n             * @method _proxyDomEvent\r\n             * @private\r\n             * @return { * } fireEvent的返回值\r\n             * @see UE.EventBase:fireEvent(String)\r\n             */\r\n            _proxyDomEvent: function (evt) {\r\n                if (this.fireEvent('before' + evt.type.replace(/^on/, '').toLowerCase()) === false) {\r\n                    return false;\r\n                }\r\n                if (this.fireEvent(evt.type.replace(/^on/, ''), evt) === false) {\r\n                    return false;\r\n                }\r\n                return this.fireEvent('after' + evt.type.replace(/^on/, '').toLowerCase())\r\n            },\r\n            /**\r\n             * 变化选区\r\n             * @method _selectionChange\r\n             * @private\r\n             */\r\n            _selectionChange: function (delay, evt) {\r\n                var me = this;\r\n                //有光标才做selectionchange 为了解决未focus时点击source不能触发更改工具栏状态的问题（source命令notNeedUndo=1）\r\n                //            if ( !me.selection.isFocus() ){\r\n                //                return;\r\n                //            }\r\n\r\n\r\n                var hackForMouseUp = false;\r\n                var mouseX, mouseY;\r\n                if (browser.ie && browser.version < 9 && evt && evt.type == 'mouseup') {\r\n                    var range = this.selection.getRange();\r\n                    if (!range.collapsed) {\r\n                        hackForMouseUp = true;\r\n                        mouseX = evt.clientX;\r\n                        mouseY = evt.clientY;\r\n                    }\r\n                }\r\n                clearTimeout(_selectionChangeTimer);\r\n                _selectionChangeTimer = setTimeout(function () {\r\n                    if (!me.selection || !me.selection.getNative()) {\r\n                        return;\r\n                    }\r\n                    //修复一个IE下的bug: 鼠标点击一段已选择的文本中间时，可能在mouseup后的一段时间内取到的range是在selection的type为None下的错误值.\r\n                    //IE下如果用户是拖拽一段已选择文本，则不会触发mouseup事件，所以这里的特殊处理不会对其有影响\r\n                    var ieRange;\r\n                    if (hackForMouseUp && me.selection.getNative().type == 'None') {\r\n                        ieRange = me.document.body.createTextRange();\r\n                        try {\r\n                            ieRange.moveToPoint(mouseX, mouseY);\r\n                        } catch (ex) {\r\n                            ieRange = null;\r\n                        }\r\n                    }\r\n                    var bakGetIERange;\r\n                    if (ieRange) {\r\n                        bakGetIERange = me.selection.getIERange;\r\n                        me.selection.getIERange = function () {\r\n                            return ieRange;\r\n                        };\r\n                    }\r\n                    me.selection.cache();\r\n                    if (bakGetIERange) {\r\n                        me.selection.getIERange = bakGetIERange;\r\n                    }\r\n                    if (me.selection._cachedRange && me.selection._cachedStartElement) {\r\n                        me.fireEvent('beforeselectionchange');\r\n                        // 第二个参数causeByUi为true代表由用户交互造成的selectionchange.\r\n                        me.fireEvent('selectionchange', !!evt);\r\n                        me.fireEvent('afterselectionchange');\r\n                        me.selection.clear();\r\n                    }\r\n                }, delay || 50);\r\n            },\r\n\r\n            /**\r\n             * 执行编辑命令\r\n             * @method _callCmdFn\r\n             * @private\r\n             * @param { String } fnName 函数名称\r\n             * @param { * } args 传给命令函数的参数\r\n             * @return { * } 返回命令函数运行的返回值\r\n             */\r\n            _callCmdFn: function (fnName, args) {\r\n                var cmdName = args[0].toLowerCase(),\r\n                    cmd, cmdFn;\r\n                cmd = this.commands[cmdName] || UE.commands[cmdName];\r\n                cmdFn = cmd && cmd[fnName];\r\n                //没有querycommandstate或者没有command的都默认返回0\r\n                if ((!cmd || !cmdFn) && fnName == 'queryCommandState') {\r\n                    return 0;\r\n                } else if (cmdFn) {\r\n                    return cmdFn.apply(this, args);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 执行编辑命令cmdName，完成富文本编辑效果\r\n             * @method execCommand\r\n             * @param { String } cmdName 需要执行的命令\r\n             * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n             * @return { * } 返回命令函数运行的返回值\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand(cmdName);\r\n             * ```\r\n             */\r\n            execCommand: function (cmdName) {\r\n                cmdName = cmdName.toLowerCase();\r\n                var me = this,\r\n                    result,\r\n                    cmd = me.commands[cmdName] || UE.commands[cmdName];\r\n                if (!cmd || !cmd.execCommand) {\r\n                    return null;\r\n                }\r\n                if (!cmd.notNeedUndo && !me.__hasEnterExecCommand) {\r\n                    me.__hasEnterExecCommand = true;\r\n                    if (me.queryCommandState.apply(me, arguments) != -1) {\r\n                        me.fireEvent('saveScene');\r\n                        me.fireEvent.apply(me, ['beforeexeccommand', cmdName].concat(arguments));\r\n                        result = this._callCmdFn('execCommand', arguments);\r\n                        //保存场景时，做了内容对比，再看是否进行contentchange触发，这里多触发了一次，去掉\r\n                        //                    (!cmd.ignoreContentChange && !me._ignoreContentChange) && me.fireEvent('contentchange');\r\n                        me.fireEvent.apply(me, ['afterexeccommand', cmdName].concat(arguments));\r\n                        me.fireEvent('saveScene');\r\n                    }\r\n                    me.__hasEnterExecCommand = false;\r\n                } else {\r\n                    result = this._callCmdFn('execCommand', arguments);\r\n                    (!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange) && me.fireEvent('contentchange')\r\n                }\r\n                (!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange) && me._selectionChange();\r\n                return result;\r\n            },\r\n\r\n            /**\r\n             * 根据传入的command命令，查选编辑器当前的选区，返回命令的状态\r\n             * @method  queryCommandState\r\n             * @param { String } cmdName 需要查询的命令名称\r\n             * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n             * @return { Number } number 返回放前命令的状态，返回值三种情况：(-1|0|1)\r\n             * @example\r\n             * ```javascript\r\n             * editor.queryCommandState(cmdName)  => (-1|0|1)\r\n             * ```\r\n             * @see COMMAND.LIST\r\n             */\r\n            queryCommandState: function (cmdName) {\r\n                return this._callCmdFn('queryCommandState', arguments);\r\n            },\r\n\r\n            /**\r\n             * 根据传入的command命令，查选编辑器当前的选区，根据命令返回相关的值\r\n             * @method queryCommandValue\r\n             * @param { String } cmdName 需要查询的命令名称\r\n             * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n             * @remind 只有部分插件有此方法\r\n             * @return { * } 返回每个命令特定的当前状态值\r\n             * @grammar editor.queryCommandValue(cmdName)  =>  {*}\r\n             * @see COMMAND.LIST\r\n             */\r\n            queryCommandValue: function (cmdName) {\r\n                return this._callCmdFn('queryCommandValue', arguments);\r\n            },\r\n\r\n            /**\r\n             * 检查编辑区域中是否有内容\r\n             * @method  hasContents\r\n             * @remind 默认有文本内容，或者有以下节点都不认为是空\r\n             * table,ul,ol,dl,iframe,area,base,col,hr,img,embed,input,link,meta,param\r\n             * @return { Boolean } 检查有内容返回true，否则返回false\r\n             * @example\r\n             * ```javascript\r\n             * editor.hasContents()\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 检查编辑区域中是否有内容，若包含参数tags中的节点类型，直接返回true\r\n             * @method  hasContents\r\n             * @param { Array } tags 传入数组判断时用到的节点类型\r\n             * @return { Boolean } 若文档中包含tags数组里对应的tag，返回true，否则返回false\r\n             * @example\r\n             * ```javascript\r\n             * editor.hasContents(['span']);\r\n             * ```\r\n             */\r\n            hasContents: function (tags) {\r\n                if (tags) {\r\n                    for (var i = 0, ci; ci = tags[i++];) {\r\n                        if (this.document.getElementsByTagName(ci).length > 0) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                if (!domUtils.isEmptyBlock(this.body)) {\r\n                    return true\r\n                }\r\n                //随时添加,定义的特殊标签如果存在，不能认为是空\r\n                tags = ['div'];\r\n                for (i = 0; ci = tags[i++];) {\r\n                    var nodes = domUtils.getElementsByTagName(this.document, ci);\r\n                    for (var n = 0, cn; cn = nodes[n++];) {\r\n                        if (domUtils.isCustomeNode(cn)) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            },\r\n\r\n            /**\r\n             * 重置编辑器，可用来做多个tab使用同一个编辑器实例\r\n             * @method  reset\r\n             * @remind 此方法会清空编辑器内容，清空回退列表，会触发reset事件\r\n             * @example\r\n             * ```javascript\r\n             * editor.reset()\r\n             * ```\r\n             */\r\n            reset: function () {\r\n                this.fireEvent('reset');\r\n            },\r\n\r\n            /**\r\n             * 设置当前编辑区域可以编辑\r\n             * @method setEnabled\r\n             * @example\r\n             * ```javascript\r\n             * editor.setEnabled()\r\n             * ```\r\n             */\r\n            setEnabled: function () {\r\n                var me = this, range;\r\n                if (me.body.contentEditable == 'false') {\r\n                    me.body.contentEditable = true;\r\n                    range = me.selection.getRange();\r\n                    //有可能内容丢失了\r\n                    try {\r\n                        range.moveToBookmark(me.lastBk);\r\n                        delete me.lastBk\r\n                    } catch (e) {\r\n                        range.setStartAtFirst(me.body).collapse(true)\r\n                    }\r\n                    range.select(true);\r\n                    if (me.bkqueryCommandState) {\r\n                        me.queryCommandState = me.bkqueryCommandState;\r\n                        delete me.bkqueryCommandState;\r\n                    }\r\n                    if (me.bkqueryCommandValue) {\r\n                        me.queryCommandValue = me.bkqueryCommandValue;\r\n                        delete me.bkqueryCommandValue;\r\n                    }\r\n                    me.fireEvent('selectionchange');\r\n                }\r\n            },\r\n            enable: function () {\r\n                return this.setEnabled();\r\n            },\r\n\r\n            /** 设置当前编辑区域不可编辑\r\n             * @method setDisabled\r\n             */\r\n\r\n            /** 设置当前编辑区域不可编辑,except中的命令除外\r\n             * @method setDisabled\r\n             * @param { String } except 例外命令的字符串\r\n             * @remind 即使设置了disable，此处配置的例外命令仍然可以执行\r\n             * @example\r\n             * ```javascript\r\n             * editor.setDisabled('bold'); //禁用工具栏中除加粗之外的所有功能\r\n             * ```\r\n             */\r\n\r\n            /** 设置当前编辑区域不可编辑,except中的命令除外\r\n             * @method setDisabled\r\n             * @param { Array } except 例外命令的字符串数组，数组中的命令仍然可以执行\r\n             * @remind 即使设置了disable，此处配置的例外命令仍然可以执行\r\n             * @example\r\n             * ```javascript\r\n             * editor.setDisabled(['bold','insertimage']); //禁用工具栏中除加粗和插入图片之外的所有功能\r\n             * ```\r\n             */\r\n            setDisabled: function (except) {\r\n                var me = this;\r\n                except = except ? utils.isArray(except) ? except : [except] : [];\r\n                if (me.body.contentEditable == 'true') {\r\n                    if (!me.lastBk) {\r\n                        me.lastBk = me.selection.getRange().createBookmark(true);\r\n                    }\r\n                    me.body.contentEditable = false;\r\n                    me.bkqueryCommandState = me.queryCommandState;\r\n                    me.bkqueryCommandValue = me.queryCommandValue;\r\n                    me.queryCommandState = function (type) {\r\n                        if (utils.indexOf(except, type) != -1) {\r\n                            return me.bkqueryCommandState.apply(me, arguments);\r\n                        }\r\n                        return -1;\r\n                    };\r\n                    me.queryCommandValue = function (type) {\r\n                        if (utils.indexOf(except, type) != -1) {\r\n                            return me.bkqueryCommandValue.apply(me, arguments);\r\n                        }\r\n                        return null;\r\n                    };\r\n                    me.fireEvent('selectionchange');\r\n                }\r\n            },\r\n            disable: function (except) {\r\n                return this.setDisabled(except);\r\n            },\r\n\r\n            /**\r\n             * 设置默认内容\r\n             * @method _setDefaultContent\r\n             * @private\r\n             * @param  { String } cont 要存入的内容\r\n             */\r\n            _setDefaultContent: function () {\r\n                function clear() {\r\n                    var me = this;\r\n                    if (me.document.getElementById('initContent')) {\r\n                        me.body.innerHTML = '<p>' + (ie ? '' : '<br/>') + '</p>';\r\n                        me.removeListener('firstBeforeExecCommand focus', clear);\r\n                        setTimeout(function () {\r\n                            me.focus();\r\n                            me._selectionChange();\r\n                        }, 0)\r\n                    }\r\n                }\r\n\r\n                return function (cont) {\r\n                    var me = this;\r\n                    me.body.innerHTML = '<p id=\"initContent\">' + cont + '</p>';\r\n\r\n                    me.addListener('firstBeforeExecCommand focus', clear);\r\n                }\r\n            }(),\r\n\r\n            /**\r\n             * 显示编辑器\r\n             * @method setShow\r\n             * @example\r\n             * ```javascript\r\n             * editor.setShow()\r\n             * ```\r\n             */\r\n            setShow: function () {\r\n                var me = this, range = me.selection.getRange();\r\n                if (me.container.style.display == 'none') {\r\n                    //有可能内容丢失了\r\n                    try {\r\n                        range.moveToBookmark(me.lastBk);\r\n                        delete me.lastBk\r\n                    } catch (e) {\r\n                        range.setStartAtFirst(me.body).collapse(true)\r\n                    }\r\n                    //ie下focus实效，所以做了个延迟\r\n                    setTimeout(function () {\r\n                        range.select(true);\r\n                    }, 100);\r\n                    me.container.style.display = '';\r\n                }\r\n\r\n            },\r\n            show: function () {\r\n                return this.setShow();\r\n            },\r\n            /**\r\n             * 隐藏编辑器\r\n             * @method setHide\r\n             * @example\r\n             * ```javascript\r\n             * editor.setHide()\r\n             * ```\r\n             */\r\n            setHide: function () {\r\n                var me = this;\r\n                if (!me.lastBk) {\r\n                    me.lastBk = me.selection.getRange().createBookmark(true);\r\n                }\r\n                me.container.style.display = 'none'\r\n            },\r\n            hide: function () {\r\n                return this.setHide();\r\n            },\r\n\r\n            /**\r\n             * 根据指定的路径，获取对应的语言资源\r\n             * @method getLang\r\n             * @param { String } path 路径根据的是lang目录下的语言文件的路径结构\r\n             * @return { Object | String } 根据路径返回语言资源的Json格式对象或者语言字符串\r\n             * @example\r\n             * ```javascript\r\n             * editor.getLang('contextMenu.delete'); //如果当前是中文，那返回是的是'删除'\r\n             * ```\r\n             */\r\n            getLang: function (path) {\r\n                // console.log(path,this.options.lang,UE.I18N,11111111);\r\n                var lang = UE.I18N[this.options.lang];\r\n                if (!lang) {\r\n                    throw Error(\"not import language file\");\r\n                }\r\n                path = (path || \"\").split(\".\");\r\n                for (var i = 0, ci; ci = path[i++];) {\r\n                    lang = lang[ci];\r\n                    if (!lang) break;\r\n                }\r\n                //console.log(path,lang,444444444444);\r\n                return lang;\r\n            },\r\n\r\n            /**\r\n             * 计算编辑器html内容字符串的长度\r\n             * @method  getContentLength\r\n             * @return { Number } 返回计算的长度\r\n             * @example\r\n             * ```javascript\r\n             * //编辑器html内容<p><strong>132</strong></p>\r\n             * editor.getContentLength() //返回27\r\n             * ```\r\n             */\r\n            /**\r\n             * 计算编辑器当前纯文本内容的长度\r\n             * @method  getContentLength\r\n             * @param { Boolean } ingoneHtml 传入true时，只按照纯文本来计算\r\n             * @return { Number } 返回计算的长度，内容中有hr/img/iframe标签，长度加1\r\n             * @example\r\n             * ```javascript\r\n             * //编辑器html内容<p><strong>132</strong></p>\r\n             * editor.getContentLength() //返回3\r\n             * ```\r\n             */\r\n            getContentLength: function (ingoneHtml, tagNames) {\r\n                var count = this.getContent(false, false, true).length;\r\n                if (ingoneHtml) {\r\n                    tagNames = (tagNames || []).concat(['hr', 'img', 'iframe']);\r\n                    count = this.getContentTxt().replace(/[\\t\\r\\n]+/g, '').length;\r\n                    for (var i = 0, ci; ci = tagNames[i++];) {\r\n                        count += this.document.getElementsByTagName(ci).length;\r\n                    }\r\n                }\r\n                return count;\r\n            },\r\n\r\n            /**\r\n             * 注册输入过滤规则\r\n             * @method  addInputRule\r\n             * @param { Function } rule 要添加的过滤规则\r\n             * @example\r\n             * ```javascript\r\n             * editor.addInputRule(function(root){\r\n             *   $.each(root.getNodesByTagName('div'),function(i,node){\r\n             *       node.tagName=\"p\";\r\n             *   });\r\n             * });\r\n             * ```\r\n             */\r\n            addInputRule: function (rule) {\r\n                this.inputRules.push(rule);\r\n            },\r\n\r\n            /**\r\n             * 执行注册的过滤规则\r\n             * @method  filterInputRule\r\n             * @param { UE.uNode } root 要过滤的uNode节点\r\n             * @remind 执行editor.setContent方法和执行'inserthtml'命令后，会运行该过滤函数\r\n             * @example\r\n             * ```javascript\r\n             * editor.filterInputRule(editor.body);\r\n             * ```\r\n             * @see UE.Editor:addInputRule\r\n             */\r\n            filterInputRule: function (root) {\r\n                for (var i = 0, ci; ci = this.inputRules[i++];) {\r\n                    ci.call(this, root)\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 注册输出过滤规则\r\n             * @method  addOutputRule\r\n             * @param { Function } rule 要添加的过滤规则\r\n             * @example\r\n             * ```javascript\r\n             * editor.addOutputRule(function(root){\r\n             *   $.each(root.getNodesByTagName('p'),function(i,node){\r\n             *       node.tagName=\"div\";\r\n             *   });\r\n             * });\r\n             * ```\r\n             */\r\n            addOutputRule: function (rule) {\r\n                this.outputRules.push(rule)\r\n            },\r\n\r\n            /**\r\n             * 根据输出过滤规则，过滤编辑器内容\r\n             * @method  filterOutputRule\r\n             * @remind 执行editor.getContent方法的时候，会先运行该过滤函数\r\n             * @param { UE.uNode } root 要过滤的uNode节点\r\n             * @example\r\n             * ```javascript\r\n             * editor.filterOutputRule(editor.body);\r\n             * ```\r\n             * @see UE.Editor:addOutputRule\r\n             */\r\n            filterOutputRule: function (root) {\r\n                for (var i = 0, ci; ci = this.outputRules[i++];) {\r\n                    ci.call(this, root)\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 根据action名称获取请求的路径\r\n             * @method  getActionUrl\r\n             * @remind 假如没有设置serverUrl,会根据imageUrl设置默认的controller路径\r\n             * @param { String } action action名称\r\n             * @example\r\n             * ```javascript\r\n             * editor.getActionUrl('config'); //返回 \"/ueditor/php/controller.php?action=config\"\r\n             * editor.getActionUrl('image'); //返回 \"/ueditor/php/controller.php?action=uplaodimage\"\r\n             * editor.getActionUrl('scrawl'); //返回 \"/ueditor/php/controller.php?action=uplaodscrawl\"\r\n             * editor.getActionUrl('imageManager'); //返回 \"/ueditor/php/controller.php?action=listimage\"\r\n             * ```\r\n             */\r\n            getActionUrl: function (action) {\r\n                var actionName = this.getOpt(action) || action,\r\n                    imageUrl = this.getOpt('imageUrl'),\r\n                    serverUrl = this.getOpt('serverUrl');\r\n\r\n                if (!serverUrl && imageUrl) {\r\n                    serverUrl = imageUrl.replace(/^(.*[\\/]).+([\\.].+)$/, '$1controller$2');\r\n                }\r\n                if (action == 'uploadimage' || action == 'uploadscrawl' || action == 'uploadimage') {\r\n                    return '/goodstaxiAdmin/imagecs/uploadImage';\r\n                }/* else if (action == 'uploadvideo') {\r\n                return '/goodstaxiAdmin/imagecs/uploadImage';\r\n            } else {\r\n                return this._bkGetActionUrl.call(this, action);\r\n            }*/\r\n                if (serverUrl) {\r\n                    serverUrl = serverUrl + (serverUrl.indexOf('?') == -1 ? '?' : '&') + 'action=' + (actionName || '');\r\n                    return utils.formatUrl(serverUrl);\r\n                } else {\r\n                    return '';\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(Editor, EventBase);\r\n    })();\r\n\r\n\r\n    // core/Editor.defaultoptions.js\r\n    //维护编辑器一下默认的不在插件中的配置项\r\n    UE.Editor.defaultOptions = function (editor) {\r\n\r\n        var _url = editor.options.UEDITOR_HOME_URL;\r\n        return {\r\n            isShow: true,\r\n            initialContent: '',\r\n            initialStyle: '',\r\n            autoClearinitialContent: false,\r\n            iframeCssUrl: iframeStyleSrc,\r\n            textarea: 'editorValue',\r\n            focus: false,\r\n            focusInEnd: true,\r\n            autoClearEmptyNode: true,\r\n            fullscreen: false,\r\n            readonly: false,\r\n            zIndex: 999,\r\n            imagePopup: true,\r\n            enterTag: 'p',\r\n            customDomain: false,\r\n            lang: 'zh-cn',\r\n            langPath: _url + 'lang/',\r\n            theme: 'default',\r\n            themePath: _url + 'themes/',\r\n            allHtmlEnabled: false,\r\n            scaleEnabled: false,\r\n            tableNativeEditInFF: false,\r\n            autoSyncData: true,\r\n            fileNameFormat: '{time}{rand:6}'\r\n        }\r\n    };\r\n\r\n    // core/loadconfig.js\r\n    (function () {\r\n\r\n        UE.Editor.prototype.loadServerConfig = function () {\r\n            var me = this;\r\n            setTimeout(function () {\r\n                try {\r\n                    me.options.imageUrl && me.setOpt('serverUrl', me.options.imageUrl.replace(/^(.*[\\/]).+([\\.].+)$/, '$1controller$2'));\r\n\r\n                    var configUrl = me.getActionUrl('config'),\r\n                        isJsonp = utils.isCrossDomainUrl(configUrl);\r\n\r\n                    /* 发出ajax请求 */\r\n                    me._serverConfigLoaded = false;\r\n                    // console.log(configUrl,999999999999999999);\r\n                    configUrl && UE.ajax.request(configUrl, {\r\n                        'method': 'GET',\r\n                        'dataType': isJsonp ? 'jsonp' : '',\r\n                        'onsuccess': function (r) {\r\n                            try {\r\n                                var config = isJsonp ? r : eval(\"(\" + r.responseText + \")\");\r\n                                utils.extend(me.options, config);\r\n                                me.fireEvent('serverConfigLoaded');\r\n                                me._serverConfigLoaded = true;\r\n                            } catch (e) {\r\n                                // console.log(r,1111111111111);\r\n                                showErrorMsg(me.getLang('loadconfigFormatError'));\r\n                            }\r\n                        },\r\n                        'onerror': function () {\r\n                            // console.log(2222222222222);\r\n                            showErrorMsg(me.getLang('loadconfigHttpError'));\r\n                        }\r\n                    });\r\n                } catch (e) {\r\n                    // console.log(3333333333333333333);\r\n                    showErrorMsg(me.getLang('loadconfigError'));\r\n                }\r\n            });\r\n\r\n            function showErrorMsg(msg) {\r\n                console && console.error(msg);\r\n                //me.fireEvent('showMessage', {\r\n                //    'title': msg,\r\n                //    'type': 'error'\r\n                //});\r\n            }\r\n        };\r\n\r\n        UE.Editor.prototype.isServerConfigLoaded = function () {\r\n            var me = this;\r\n            return me._serverConfigLoaded || false;\r\n        };\r\n\r\n        UE.Editor.prototype.afterConfigReady = function (handler) {\r\n            if (!handler || !utils.isFunction(handler)) return;\r\n            var me = this;\r\n            var readyHandler = function () {\r\n                handler.apply(me, arguments);\r\n                me.removeListener('serverConfigLoaded', readyHandler);\r\n            };\r\n\r\n            if (me.isServerConfigLoaded()) {\r\n                handler.call(me, 'serverConfigLoaded');\r\n            } else {\r\n                me.addListener('serverConfigLoaded', readyHandler);\r\n            }\r\n        };\r\n\r\n    })();\r\n\r\n\r\n    // core/ajax.js\r\n    /**\r\n     * @file\r\n     * @module UE.ajax\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 提供对ajax请求的支持\r\n     * @module UE.ajax\r\n     */\r\n    UE.ajax = function () {\r\n\r\n        //创建一个ajaxRequest对象\r\n        var fnStr = 'XMLHttpRequest()';\r\n        try {\r\n            new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n            fnStr = 'ActiveXObject(\\'Msxml2.XMLHTTP\\')';\r\n        } catch (e) {\r\n            try {\r\n                new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n                fnStr = 'ActiveXObject(\\'Microsoft.XMLHTTP\\')'\r\n            } catch (e) {\r\n            }\r\n        }\r\n        var creatAjaxRequest = new Function('return new ' + fnStr);\r\n\r\n\r\n        /**\r\n         * 将json参数转化成适合ajax提交的参数列表\r\n         * @param json\r\n         */\r\n        function json2str(json) {\r\n            var strArr = [];\r\n            for (var i in json) {\r\n                //忽略默认的几个参数\r\n                if (i == \"method\" || i == \"timeout\" || i == \"async\" || i == \"dataType\" || i == \"callback\") continue;\r\n                //忽略控制\r\n                if (json[i] == undefined || json[i] == null) continue;\r\n                //传递过来的对象和函数不在提交之列\r\n                if (!((typeof json[i]).toLowerCase() == \"function\" || (typeof json[i]).toLowerCase() == \"object\")) {\r\n                    strArr.push(encodeURIComponent(i) + \"=\" + encodeURIComponent(json[i]));\r\n                } else if (utils.isArray(json[i])) {\r\n                    //支持传数组内容\r\n                    for (var j = 0; j < json[i].length; j++) {\r\n                        strArr.push(encodeURIComponent(i) + \"[]=\" + encodeURIComponent(json[i][j]));\r\n                    }\r\n                }\r\n            }\r\n            return strArr.join(\"&\");\r\n        }\r\n\r\n        function doAjax(url, ajaxOptions) {\r\n            var xhr = creatAjaxRequest(),\r\n                //是否超时\r\n                timeIsOut = false,\r\n                //默认参数\r\n                defaultAjaxOptions = {\r\n                    method: \"POST\",\r\n                    timeout: 5000,\r\n                    async: true,\r\n                    data: {},//需要传递对象的话只能覆盖\r\n                    onsuccess: function () {\r\n                    },\r\n                    onerror: function () {\r\n                    }\r\n                };\r\n\r\n            if (typeof url === \"object\") {\r\n                ajaxOptions = url;\r\n                url = ajaxOptions.url;\r\n            }\r\n            if (!xhr || !url) return;\r\n            var ajaxOpts = ajaxOptions ? utils.extend(defaultAjaxOptions, ajaxOptions) : defaultAjaxOptions;\r\n\r\n            var submitStr = json2str(ajaxOpts);  // { name:\"Jim\",city:\"Beijing\" } --> \"name=Jim&city=Beijing\"\r\n            //如果用户直接通过data参数传递json对象过来，则也要将此json对象转化为字符串\r\n            if (!utils.isEmptyObject(ajaxOpts.data)) {\r\n                submitStr += (submitStr ? \"&\" : \"\") + json2str(ajaxOpts.data);\r\n            }\r\n            //超时检测\r\n            var timerID = setTimeout(function () {\r\n                if (xhr.readyState != 4) {\r\n                    timeIsOut = true;\r\n                    xhr.abort();\r\n                    clearTimeout(timerID);\r\n                }\r\n            }, ajaxOpts.timeout);\r\n\r\n            var method = ajaxOpts.method.toUpperCase();\r\n            var str = url + (url.indexOf(\"?\") == -1 ? \"?\" : \"&\") + (method == \"POST\" ? \"\" : submitStr + \"&noCache=\" + +new Date);\r\n            // console.log(str,223333333333333);\r\n            xhr.open(method, str, ajaxOpts.async);\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState == 4) {\r\n                    if (!timeIsOut && xhr.status == 200) {\r\n                        ajaxOpts.onsuccess(xhr);\r\n                    } else {\r\n                        ajaxOpts.onerror(xhr);\r\n                    }\r\n                }\r\n            };\r\n            if (method == \"POST\") {\r\n                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n                xhr.send(submitStr);\r\n            } else {\r\n                xhr.send(null);\r\n            }\r\n        }\r\n\r\n        function doJsonp(url, opts) {\r\n\r\n            var successhandler = opts.onsuccess || function () { },\r\n                scr = document.createElement('SCRIPT'),\r\n                options = opts || {},\r\n                charset = options['charset'],\r\n                callbackField = options['jsonp'] || 'callback',\r\n                callbackFnName,\r\n                timeOut = options['timeOut'] || 0,\r\n                timer,\r\n                reg = new RegExp('(\\\\?|&)' + callbackField + '=([^&]*)'),\r\n                matches;\r\n\r\n            if (utils.isFunction(successhandler)) {\r\n                callbackFnName = 'bd__editor__' + Math.floor(Math.random() * 2147483648).toString(36);\r\n                window[callbackFnName] = getCallBack(0);\r\n            } else if (utils.isString(successhandler)) {\r\n                callbackFnName = successhandler;\r\n            } else {\r\n                if (matches = reg.exec(url)) {\r\n                    callbackFnName = matches[2];\r\n                }\r\n            }\r\n\r\n            url = url.replace(reg, '\\x241' + callbackField + '=' + callbackFnName);\r\n\r\n            if (url.search(reg) < 0) {\r\n                url += (url.indexOf('?') < 0 ? '?' : '&') + callbackField + '=' + callbackFnName;\r\n            }\r\n\r\n            var queryStr = json2str(opts);  // { name:\"Jim\",city:\"Beijing\" } --> \"name=Jim&city=Beijing\"\r\n            //如果用户直接通过data参数传递json对象过来，则也要将此json对象转化为字符串\r\n            if (!utils.isEmptyObject(opts.data)) {\r\n                queryStr += (queryStr ? \"&\" : \"\") + json2str(opts.data);\r\n            }\r\n            if (queryStr) {\r\n                url = url.replace(/\\?/, '?' + queryStr + '&');\r\n            }\r\n\r\n            scr.onerror = getCallBack(1);\r\n            if (timeOut) {\r\n                timer = setTimeout(getCallBack(1), timeOut);\r\n            }\r\n            createScriptTag(scr, url, charset);\r\n\r\n            function createScriptTag(scr, url, charset) {\r\n                scr.setAttribute('type', 'text/javascript');\r\n                scr.setAttribute('defer', 'defer');\r\n                charset && scr.setAttribute('charset', charset);\r\n                scr.setAttribute('src', url);\r\n                document.getElementsByTagName('head')[0].appendChild(scr);\r\n            }\r\n\r\n            function getCallBack(onTimeOut) {\r\n                return function () {\r\n                    try {\r\n                        if (onTimeOut) {\r\n                            options.onerror && options.onerror();\r\n                        } else {\r\n                            try {\r\n                                clearTimeout(timer);\r\n                                successhandler.apply(window, arguments);\r\n                            } catch (e) { }\r\n                        }\r\n                    } catch (exception) {\r\n                        options.onerror && options.onerror.call(window, exception);\r\n                    } finally {\r\n                        options.oncomplete && options.oncomplete.apply(window, arguments);\r\n                        scr.parentNode && scr.parentNode.removeChild(scr);\r\n                        window[callbackFnName] = null;\r\n                        try {\r\n                            delete window[callbackFnName];\r\n                        } catch (e) { }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            /**\r\n             * 根据给定的参数项，向指定的url发起一个ajax请求。 ajax请求完成后，会根据请求结果调用相应回调： 如果请求\r\n             * 成功， 则调用onsuccess回调， 失败则调用 onerror 回调\r\n             * @method request\r\n             * @param { URLString } url ajax请求的url地址\r\n             * @param { Object } ajaxOptions ajax请求选项的键值对，支持的选项如下：\r\n             * @example\r\n             * ```javascript\r\n             * //向sayhello.php发起一个异步的Ajax GET请求, 请求超时时间为10s， 请求完成后执行相应的回调。\r\n             * UE.ajax.requeset( 'sayhello.php', {\r\n             *\r\n             *     //请求方法。可选值： 'GET', 'POST'，默认值是'POST'\r\n             *     method: 'GET',\r\n             *\r\n             *     //超时时间。 默认为5000， 单位是ms\r\n             *     timeout: 10000,\r\n             *\r\n             *     //是否是异步请求。 true为异步请求， false为同步请求\r\n             *     async: true,\r\n             *\r\n             *     //请求携带的数据。如果请求为GET请求， data会经过stringify后附加到请求url之后。\r\n             *     data: {\r\n             *         name: 'ueditor'\r\n             *     },\r\n             *\r\n             *     //请求成功后的回调， 该回调接受当前的XMLHttpRequest对象作为参数。\r\n             *     onsuccess: function ( xhr ) {\r\n             *         console.log( xhr.responseText );\r\n             *     },\r\n             *\r\n             *     //请求失败或者超时后的回调。\r\n             *     onerror: function ( xhr ) {\r\n             *          alert( 'Ajax请求失败' );\r\n             *     }\r\n             *\r\n             * } );\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 根据给定的参数项发起一个ajax请求， 参数项里必须包含一个url地址。 ajax请求完成后，会根据请求结果调用相应回调： 如果请求\r\n             * 成功， 则调用onsuccess回调， 失败则调用 onerror 回调。\r\n             * @method request\r\n             * @warning 如果在参数项里未提供一个key为“url”的地址值，则该请求将直接退出。\r\n             * @param { Object } ajaxOptions ajax请求选项的键值对，支持的选项如下：\r\n             * @example\r\n             * ```javascript\r\n             *\r\n             * //向sayhello.php发起一个异步的Ajax POST请求, 请求超时时间为5s， 请求完成后不执行任何回调。\r\n             * UE.ajax.requeset( 'sayhello.php', {\r\n             *\r\n             *     //请求的地址， 该项是必须的。\r\n             *     url: 'sayhello.php'\r\n             *\r\n             * } );\r\n             * ```\r\n             */\r\n            request: function (url, opts) {\r\n                if (opts && opts.dataType == 'jsonp') {\r\n                    doJsonp(url, opts);\r\n                } else {\r\n                    doAjax(url, opts);\r\n                }\r\n            },\r\n            getJSONP: function (url, data, fn) {\r\n                var opts = {\r\n                    'data': data,\r\n                    'oncomplete': fn\r\n                };\r\n                doJsonp(url, opts);\r\n            }\r\n        };\r\n\r\n\r\n    }();\r\n\r\n\r\n    // core/filterword.js\r\n    /**\r\n     * UE过滤word的静态方法\r\n     * @file\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @module UE\r\n     */\r\n\r\n\r\n    /**\r\n     * 根据传入html字符串过滤word\r\n     * @module UE\r\n     * @since 1.2.6.1\r\n     * @method filterWord\r\n     * @param { String } html html字符串\r\n     * @return { String } 已过滤后的结果字符串\r\n     * @example\r\n     * ```javascript\r\n     * UE.filterWord(html);\r\n     * ```\r\n     */\r\n    var filterWord = UE.filterWord = function () {\r\n\r\n        //是否是word过来的内容\r\n        function isWordDocument(str) {\r\n            return /(class=\"?Mso|style=\"[^\"]*\\bmso\\-|w:WordDocument|<(v|o):|lang=)/ig.test(str);\r\n        }\r\n        //去掉小数\r\n        function transUnit(v) {\r\n            v = v.replace(/[\\d.]+\\w+/g, function (m) {\r\n                return utils.transUnitToPx(m);\r\n            });\r\n            return v;\r\n        }\r\n\r\n        function filterPasteWord(str) {\r\n            return str.replace(/[\\t\\r\\n]+/g, ' ')\r\n                .replace(/<!--[\\s\\S]*?-->/ig, \"\")\r\n                //转换图片\r\n                .replace(/<v:shape [^>]*>[\\s\\S]*?.<\\/v:shape>/gi, function (str) {\r\n                    //opera能自己解析出image所这里直接返回空\r\n                    if (browser.opera) {\r\n                        return '';\r\n                    }\r\n                    try {\r\n                        //有可能是bitmap占为图，无用，直接过滤掉，主要体现在粘贴excel表格中\r\n                        if (/Bitmap/i.test(str)) {\r\n                            return '';\r\n                        }\r\n                        var width = str.match(/width:([ \\d.]*p[tx])/i)[1],\r\n                            height = str.match(/height:([ \\d.]*p[tx])/i)[1],\r\n                            src = str.match(/src=\\s*\"([^\"]*)\"/i)[1];\r\n                        return '<img width=\"' + transUnit(width) + '\" height=\"' + transUnit(height) + '\" src=\"' + src + '\" />';\r\n                    } catch (e) {\r\n                        return '';\r\n                    }\r\n                })\r\n                //针对wps添加的多余标签处理\r\n                .replace(/<\\/?div[^>]*>/g, '')\r\n                //去掉多余的属性\r\n                .replace(/v:\\w+=([\"']?)[^'\"]+\\1/g, '')\r\n                .replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|xml|meta|link|style|\\w+:\\w+)(?=[\\s\\/>]))[^>]*>/gi, \"\")\r\n                .replace(/<p [^>]*class=\"?MsoHeading\"?[^>]*>(.*?)<\\/p>/gi, \"<p><strong>$1</strong></p>\")\r\n                //去掉多余的属性\r\n                .replace(/\\s+(class|lang|align)\\s*=\\s*(['\"]?)([\\w-]+)\\2/ig, function (str, name, marks, val) {\r\n                    //保留list的标示\r\n                    return name == 'class' && val == 'MsoListParagraph' ? str : ''\r\n                })\r\n                //清除多余的font/span不能匹配&nbsp;有可能是空格\r\n                .replace(/<(font|span)[^>]*>(\\s*)<\\/\\1>/gi, function (a, b, c) {\r\n                    return c.replace(/[\\t\\r\\n ]+/g, ' ')\r\n                })\r\n                //处理style的问题\r\n                .replace(/(<[a-z][^>]*)\\sstyle=([\"'])([^\\2]*?)\\2/gi, function (str, tag, tmp, style) {\r\n                    var n = [],\r\n                        s = style.replace(/^\\s+|\\s+$/, '')\r\n                            .replace(/&#39;/g, '\\'')\r\n                            .replace(/&quot;/gi, \"'\")\r\n                            .replace(/[\\d.]+(cm|pt)/g, function (str) {\r\n                                return utils.transUnitToPx(str)\r\n                            })\r\n                            .split(/;\\s*/g);\r\n\r\n                    for (var i = 0, v; v = s[i]; i++) {\r\n\r\n                        var name, value,\r\n                            parts = v.split(\":\");\r\n\r\n                        if (parts.length == 2) {\r\n                            name = parts[0].toLowerCase();\r\n                            value = parts[1].toLowerCase();\r\n                            if (/^(background)\\w*/.test(name) && value.replace(/(initial|\\s)/g, '').length == 0\r\n                                ||\r\n                                /^(margin)\\w*/.test(name) && /^0\\w+$/.test(value)\r\n                            ) {\r\n                                continue;\r\n                            }\r\n\r\n                            switch (name) {\r\n                                case \"mso-padding-alt\":\r\n                                case \"mso-padding-top-alt\":\r\n                                case \"mso-padding-right-alt\":\r\n                                case \"mso-padding-bottom-alt\":\r\n                                case \"mso-padding-left-alt\":\r\n                                case \"mso-margin-alt\":\r\n                                case \"mso-margin-top-alt\":\r\n                                case \"mso-margin-right-alt\":\r\n                                case \"mso-margin-bottom-alt\":\r\n                                case \"mso-margin-left-alt\":\r\n                                //ie下会出现挤到一起的情况\r\n                                //case \"mso-table-layout-alt\":\r\n                                case \"mso-height\":\r\n                                case \"mso-width\":\r\n                                case \"mso-vertical-align-alt\":\r\n                                    //trace:1819 ff下会解析出padding在table上\r\n                                    if (!/<table/.test(tag))\r\n                                        n[i] = name.replace(/^mso-|-alt$/g, \"\") + \":\" + transUnit(value);\r\n                                    continue;\r\n                                case \"horiz-align\":\r\n                                    n[i] = \"text-align:\" + value;\r\n                                    continue;\r\n\r\n                                case \"vert-align\":\r\n                                    n[i] = \"vertical-align:\" + value;\r\n                                    continue;\r\n\r\n                                case \"font-color\":\r\n                                case \"mso-foreground\":\r\n                                    n[i] = \"color:\" + value;\r\n                                    continue;\r\n\r\n                                case \"mso-background\":\r\n                                case \"mso-highlight\":\r\n                                    n[i] = \"background:\" + value;\r\n                                    continue;\r\n\r\n                                case \"mso-default-height\":\r\n                                    n[i] = \"min-height:\" + transUnit(value);\r\n                                    continue;\r\n\r\n                                case \"mso-default-width\":\r\n                                    n[i] = \"min-width:\" + transUnit(value);\r\n                                    continue;\r\n\r\n                                case \"mso-padding-between-alt\":\r\n                                    n[i] = \"border-collapse:separate;border-spacing:\" + transUnit(value);\r\n                                    continue;\r\n\r\n                                case \"text-line-through\":\r\n                                    if ((value == \"single\") || (value == \"double\")) {\r\n                                        n[i] = \"text-decoration:line-through\";\r\n                                    }\r\n                                    continue;\r\n                                case \"mso-zero-height\":\r\n                                    if (value == \"yes\") {\r\n                                        n[i] = \"display:none\";\r\n                                    }\r\n                                    continue;\r\n                                //                                case 'background':\r\n                                //                                    break;\r\n                                case 'margin':\r\n                                    if (!/[1-9]/.test(value)) {\r\n                                        continue;\r\n                                    }\r\n\r\n                            }\r\n\r\n                            if (/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)\r\n                                ||\r\n                                /text\\-indent|padding|margin/.test(name) && /\\-[\\d.]+/.test(value)\r\n                            ) {\r\n                                continue;\r\n                            }\r\n\r\n                            n[i] = name + \":\" + parts[1];\r\n                        }\r\n                    }\r\n                    return tag + (n.length ? ' style=\"' + n.join(';').replace(/;{2,}/g, ';') + '\"' : '');\r\n                })\r\n\r\n\r\n        }\r\n\r\n        return function (html) {\r\n            return (isWordDocument(html) ? filterPasteWord(html) : html);\r\n        };\r\n    }();\r\n\r\n    // core/node.js\r\n    /**\r\n     * 编辑器模拟的节点类\r\n     * @file\r\n     * @module UE\r\n     * @class uNode\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @unfile\r\n     * @module UE\r\n     */\r\n\r\n    (function () {\r\n\r\n        /**\r\n         * 编辑器模拟的节点类\r\n         * @unfile\r\n         * @module UE\r\n         * @class uNode\r\n         */\r\n\r\n        /**\r\n         * 通过一个键值对，创建一个uNode对象\r\n         * @constructor\r\n         * @param { Object } attr 传入要创建的uNode的初始属性\r\n         * @example\r\n         * ```javascript\r\n         * var node = new uNode({\r\n         *     type:'element',\r\n         *     tagName:'span',\r\n         *     attrs:{style:'font-size:14px;'}\r\n         * }\r\n         * ```\r\n         */\r\n        var uNode = UE.uNode = function (obj) {\r\n            this.type = obj.type;\r\n            this.data = obj.data;\r\n            this.tagName = obj.tagName;\r\n            this.parentNode = obj.parentNode;\r\n            this.attrs = obj.attrs || {};\r\n            this.children = obj.children;\r\n        };\r\n\r\n        var notTransAttrs = {\r\n            'href': 1,\r\n            'src': 1,\r\n            '_src': 1,\r\n            '_href': 1,\r\n            'cdata_data': 1\r\n        };\r\n\r\n        var notTransTagName = {\r\n            style: 1,\r\n            script: 1\r\n        };\r\n\r\n        var indentChar = '    ',\r\n            breakChar = '\\n';\r\n\r\n        function insertLine(arr, current, begin) {\r\n            arr.push(breakChar);\r\n            return current + (begin ? 1 : -1);\r\n        }\r\n\r\n        function insertIndent(arr, current) {\r\n            //插入缩进\r\n            for (var i = 0; i < current; i++) {\r\n                arr.push(indentChar);\r\n            }\r\n        }\r\n\r\n        //创建uNode的静态方法\r\n        //支持标签和html\r\n        uNode.createElement = function (html) {\r\n            if (/[<>]/.test(html)) {\r\n                return UE.htmlparser(html).children[0]\r\n            } else {\r\n                return new uNode({\r\n                    type: 'element',\r\n                    children: [],\r\n                    tagName: html\r\n                })\r\n            }\r\n        };\r\n        uNode.createText = function (data, noTrans) {\r\n            return new UE.uNode({\r\n                type: 'text',\r\n                'data': noTrans ? data : utils.unhtml(data || '')\r\n            })\r\n        };\r\n        function nodeToHtml(node, arr, formatter, current) {\r\n            switch (node.type) {\r\n                case 'root':\r\n                    for (var i = 0, ci; ci = node.children[i++];) {\r\n                        //插入新行\r\n                        if (formatter && ci.type == 'element' && !dtd.$inlineWithA[ci.tagName] && i > 1) {\r\n                            insertLine(arr, current, true);\r\n                            insertIndent(arr, current)\r\n                        }\r\n                        nodeToHtml(ci, arr, formatter, current)\r\n                    }\r\n                    break;\r\n                case 'text':\r\n                    isText(node, arr);\r\n                    break;\r\n                case 'element':\r\n                    isElement(node, arr, formatter, current);\r\n                    break;\r\n                case 'comment':\r\n                    isComment(node, arr, formatter);\r\n            }\r\n            return arr;\r\n        }\r\n\r\n        function isText(node, arr) {\r\n            if (node.parentNode.tagName == 'pre') {\r\n                //源码模式下输入html标签，不能做转换处理，直接输出\r\n                arr.push(node.data)\r\n            } else {\r\n                arr.push(notTransTagName[node.parentNode.tagName] ? utils.html(node.data) : node.data.replace(/[ ]{2}/g, ' &nbsp;'))\r\n            }\r\n\r\n        }\r\n\r\n        function isElement(node, arr, formatter, current) {\r\n            var attrhtml = '';\r\n            if (node.attrs) {\r\n                attrhtml = [];\r\n                var attrs = node.attrs;\r\n                for (var a in attrs) {\r\n                    //这里就针对\r\n                    //<p>'<img src='http://nsclick.baidu.com/u.gif?&asdf=\\\"sdf&asdfasdfs;asdf'></p>\r\n                    //这里边的\\\"做转换，要不用innerHTML直接被截断了，属性src\r\n                    //有可能做的不够\r\n                    attrhtml.push(a + (attrs[a] !== undefined ? '=\"' + (notTransAttrs[a] ? utils.html(attrs[a]).replace(/[\"]/g, function (a) {\r\n                        return '&quot;'\r\n                    }) : utils.unhtml(attrs[a])) + '\"' : ''))\r\n                }\r\n                attrhtml = attrhtml.join(' ');\r\n            }\r\n            arr.push('<' + node.tagName +\r\n                (attrhtml ? ' ' + attrhtml : '') +\r\n                (dtd.$empty[node.tagName] ? '\\/' : '') + '>'\r\n            );\r\n            //插入新行\r\n            if (formatter && !dtd.$inlineWithA[node.tagName] && node.tagName != 'pre') {\r\n                if (node.children && node.children.length) {\r\n                    current = insertLine(arr, current, true);\r\n                    insertIndent(arr, current)\r\n                }\r\n\r\n            }\r\n            if (node.children && node.children.length) {\r\n                for (var i = 0, ci; ci = node.children[i++];) {\r\n                    if (formatter && ci.type == 'element' && !dtd.$inlineWithA[ci.tagName] && i > 1) {\r\n                        insertLine(arr, current);\r\n                        insertIndent(arr, current)\r\n                    }\r\n                    nodeToHtml(ci, arr, formatter, current)\r\n                }\r\n            }\r\n            if (!dtd.$empty[node.tagName]) {\r\n                if (formatter && !dtd.$inlineWithA[node.tagName] && node.tagName != 'pre') {\r\n\r\n                    if (node.children && node.children.length) {\r\n                        current = insertLine(arr, current);\r\n                        insertIndent(arr, current)\r\n                    }\r\n                }\r\n                arr.push('<\\/' + node.tagName + '>');\r\n            }\r\n\r\n        }\r\n\r\n        function isComment(node, arr) {\r\n            arr.push('<!--' + node.data + '-->');\r\n        }\r\n\r\n        function getNodeById(root, id) {\r\n            var node;\r\n            if (root.type == 'element' && root.getAttr('id') == id) {\r\n                return root;\r\n            }\r\n            if (root.children && root.children.length) {\r\n                for (var i = 0, ci; ci = root.children[i++];) {\r\n                    if (node = getNodeById(ci, id)) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function getNodesByTagName(node, tagName, arr) {\r\n            if (node.type == 'element' && node.tagName == tagName) {\r\n                arr.push(node);\r\n            }\r\n            if (node.children && node.children.length) {\r\n                for (var i = 0, ci; ci = node.children[i++];) {\r\n                    getNodesByTagName(ci, tagName, arr)\r\n                }\r\n            }\r\n        }\r\n        function nodeTraversal(root, fn) {\r\n            if (root.children && root.children.length) {\r\n                for (var i = 0, ci; ci = root.children[i];) {\r\n                    nodeTraversal(ci, fn);\r\n                    //ci被替换的情况，这里就不再走 fn了\r\n                    if (ci.parentNode) {\r\n                        if (ci.children && ci.children.length) {\r\n                            fn(ci)\r\n                        }\r\n                        if (ci.parentNode) i++\r\n                    }\r\n                }\r\n            } else {\r\n                fn(root)\r\n            }\r\n\r\n        }\r\n        uNode.prototype = {\r\n\r\n            /**\r\n             * 当前节点对象，转换成html文本\r\n             * @method toHtml\r\n             * @return { String } 返回转换后的html字符串\r\n             * @example\r\n             * ```javascript\r\n             * node.toHtml();\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 当前节点对象，转换成html文本\r\n             * @method toHtml\r\n             * @param { Boolean } formatter 是否格式化返回值\r\n             * @return { String } 返回转换后的html字符串\r\n             * @example\r\n             * ```javascript\r\n             * node.toHtml( true );\r\n             * ```\r\n             */\r\n            toHtml: function (formatter) {\r\n                var arr = [];\r\n                nodeToHtml(this, arr, formatter, 0);\r\n                return arr.join('')\r\n            },\r\n\r\n            /**\r\n             * 获取节点的html内容\r\n             * @method innerHTML\r\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n             * @return { String } 返回节点的html内容\r\n             * @example\r\n             * ```javascript\r\n             * var htmlstr = node.innerHTML();\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 设置节点的html内容\r\n             * @method innerHTML\r\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n             * @param { String } htmlstr 传入要设置的html内容\r\n             * @return { UE.uNode } 返回节点本身\r\n             * @example\r\n             * ```javascript\r\n             * node.innerHTML('<span>text</span>');\r\n             * ```\r\n             */\r\n            innerHTML: function (htmlstr) {\r\n                if (this.type != 'element' || dtd.$empty[this.tagName]) {\r\n                    return this;\r\n                }\r\n                if (utils.isString(htmlstr)) {\r\n                    if (this.children) {\r\n                        for (var i = 0, ci; ci = this.children[i++];) {\r\n                            ci.parentNode = null;\r\n                        }\r\n                    }\r\n                    this.children = [];\r\n                    var tmpRoot = UE.htmlparser(htmlstr);\r\n                    for (var i = 0, ci; ci = tmpRoot.children[i++];) {\r\n                        this.children.push(ci);\r\n                        ci.parentNode = this;\r\n                    }\r\n                    return this;\r\n                } else {\r\n                    var tmpRoot = new UE.uNode({\r\n                        type: 'root',\r\n                        children: this.children\r\n                    });\r\n                    return tmpRoot.toHtml();\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 获取节点的纯文本内容\r\n             * @method innerText\r\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n             * @return { String } 返回节点的存文本内容\r\n             * @example\r\n             * ```javascript\r\n             * var textStr = node.innerText();\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 设置节点的纯文本内容\r\n             * @method innerText\r\n             * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n             * @param { String } textStr 传入要设置的文本内容\r\n             * @return { UE.uNode } 返回节点本身\r\n             * @example\r\n             * ```javascript\r\n             * node.innerText('<span>text</span>');\r\n             * ```\r\n             */\r\n            innerText: function (textStr, noTrans) {\r\n                if (this.type != 'element' || dtd.$empty[this.tagName]) {\r\n                    return this;\r\n                }\r\n                if (textStr) {\r\n                    if (this.children) {\r\n                        for (var i = 0, ci; ci = this.children[i++];) {\r\n                            ci.parentNode = null;\r\n                        }\r\n                    }\r\n                    this.children = [];\r\n                    this.appendChild(uNode.createText(textStr, noTrans));\r\n                    return this;\r\n                } else {\r\n                    return this.toHtml().replace(/<[^>]+>/g, '');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 获取当前对象的data属性\r\n             * @method getData\r\n             * @return { Object } 若节点的type值是elemenet，返回空字符串，否则返回节点的data属性\r\n             * @example\r\n             * ```javascript\r\n             * node.getData();\r\n             * ```\r\n             */\r\n            getData: function () {\r\n                if (this.type == 'element')\r\n                    return '';\r\n                return this.data\r\n            },\r\n\r\n            /**\r\n             * 获取当前节点下的第一个子节点\r\n             * @method firstChild\r\n             * @return { UE.uNode } 返回第一个子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.firstChild(); //返回第一个子节点\r\n             * ```\r\n             */\r\n            firstChild: function () {\r\n                //            if (this.type != 'element' || dtd.$empty[this.tagName]) {\r\n                //                return this;\r\n                //            }\r\n                return this.children ? this.children[0] : null;\r\n            },\r\n\r\n            /**\r\n             * 获取当前节点下的最后一个子节点\r\n             * @method lastChild\r\n             * @return { UE.uNode } 返回最后一个子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.lastChild(); //返回最后一个子节点\r\n             * ```\r\n             */\r\n            lastChild: function () {\r\n                //            if (this.type != 'element' || dtd.$empty[this.tagName] ) {\r\n                //                return this;\r\n                //            }\r\n                return this.children ? this.children[this.children.length - 1] : null;\r\n            },\r\n\r\n            /**\r\n             * 获取和当前节点有相同父亲节点的前一个节点\r\n             * @method previousSibling\r\n             * @return { UE.uNode } 返回前一个节点\r\n             * @example\r\n             * ```javascript\r\n             * node.children[2].previousSibling(); //返回子节点node.children[1]\r\n             * ```\r\n             */\r\n            previousSibling: function () {\r\n                var parent = this.parentNode;\r\n                for (var i = 0, ci; ci = parent.children[i]; i++) {\r\n                    if (ci === this) {\r\n                        return i == 0 ? null : parent.children[i - 1];\r\n                    }\r\n                }\r\n\r\n            },\r\n\r\n            /**\r\n             * 获取和当前节点有相同父亲节点的后一个节点\r\n             * @method nextSibling\r\n             * @return { UE.uNode } 返回后一个节点,找不到返回null\r\n             * @example\r\n             * ```javascript\r\n             * node.children[2].nextSibling(); //如果有，返回子节点node.children[3]\r\n             * ```\r\n             */\r\n            nextSibling: function () {\r\n                var parent = this.parentNode;\r\n                for (var i = 0, ci; ci = parent.children[i++];) {\r\n                    if (ci === this) {\r\n                        return parent.children[i];\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 用新的节点替换当前节点\r\n             * @method replaceChild\r\n             * @param { UE.uNode } target 要替换成该节点参数\r\n             * @param { UE.uNode } source 要被替换掉的节点\r\n             * @return { UE.uNode } 返回替换之后的节点对象\r\n             * @example\r\n             * ```javascript\r\n             * node.replaceChild(newNode, childNode); //用newNode替换childNode,childNode是node的子节点\r\n             * ```\r\n             */\r\n            replaceChild: function (target, source) {\r\n                if (this.children) {\r\n                    if (target.parentNode) {\r\n                        target.parentNode.removeChild(target);\r\n                    }\r\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\r\n                        if (ci === source) {\r\n                            this.children.splice(i, 1, target);\r\n                            source.parentNode = null;\r\n                            target.parentNode = this;\r\n                            return target;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 在节点的子节点列表最后位置插入一个节点\r\n             * @method appendChild\r\n             * @param { UE.uNode } node 要插入的节点\r\n             * @return { UE.uNode } 返回刚插入的子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.appendChild( newNode ); //在node内插入子节点newNode\r\n             * ```\r\n             */\r\n            appendChild: function (node) {\r\n                if (this.type == 'root' || (this.type == 'element' && !dtd.$empty[this.tagName])) {\r\n                    if (!this.children) {\r\n                        this.children = []\r\n                    }\r\n                    if (node.parentNode) {\r\n                        node.parentNode.removeChild(node);\r\n                    }\r\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\r\n                        if (ci === node) {\r\n                            this.children.splice(i, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n                    this.children.push(node);\r\n                    node.parentNode = this;\r\n                    return node;\r\n                }\r\n\r\n\r\n            },\r\n\r\n            /**\r\n             * 在传入节点的前面插入一个节点\r\n             * @method insertBefore\r\n             * @param { UE.uNode } target 要插入的节点\r\n             * @param { UE.uNode } source 在该参数节点前面插入\r\n             * @return { UE.uNode } 返回刚插入的子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.parentNode.insertBefore(newNode, node); //在node节点后面插入newNode\r\n             * ```\r\n             */\r\n            insertBefore: function (target, source) {\r\n                if (this.children) {\r\n                    if (target.parentNode) {\r\n                        target.parentNode.removeChild(target);\r\n                    }\r\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\r\n                        if (ci === source) {\r\n                            this.children.splice(i, 0, target);\r\n                            target.parentNode = this;\r\n                            return target;\r\n                        }\r\n                    }\r\n\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 在传入节点的后面插入一个节点\r\n             * @method insertAfter\r\n             * @param { UE.uNode } target 要插入的节点\r\n             * @param { UE.uNode } source 在该参数节点后面插入\r\n             * @return { UE.uNode } 返回刚插入的子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.parentNode.insertAfter(newNode, node); //在node节点后面插入newNode\r\n             * ```\r\n             */\r\n            insertAfter: function (target, source) {\r\n                if (this.children) {\r\n                    if (target.parentNode) {\r\n                        target.parentNode.removeChild(target);\r\n                    }\r\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\r\n                        if (ci === source) {\r\n                            this.children.splice(i + 1, 0, target);\r\n                            target.parentNode = this;\r\n                            return target;\r\n                        }\r\n\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 从当前节点的子节点列表中，移除节点\r\n             * @method removeChild\r\n             * @param { UE.uNode } node 要移除的节点引用\r\n             * @param { Boolean } keepChildren 是否保留移除节点的子节点，若传入true，自动把移除节点的子节点插入到移除的位置\r\n             * @return { * } 返回刚移除的子节点\r\n             * @example\r\n             * ```javascript\r\n             * node.removeChild(childNode,true); //在node的子节点列表中移除child节点，并且吧child的子节点插入到移除的位置\r\n             * ```\r\n             */\r\n            removeChild: function (node, keepChildren) {\r\n                if (this.children) {\r\n                    for (var i = 0, ci; ci = this.children[i]; i++) {\r\n                        if (ci === node) {\r\n                            this.children.splice(i, 1);\r\n                            ci.parentNode = null;\r\n                            if (keepChildren && ci.children && ci.children.length) {\r\n                                for (var j = 0, cj; cj = ci.children[j]; j++) {\r\n                                    this.children.splice(i + j, 0, cj);\r\n                                    cj.parentNode = this;\r\n\r\n                                }\r\n                            }\r\n                            return ci;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 获取当前节点所代表的元素属性，即获取attrs对象下的属性值\r\n             * @method getAttr\r\n             * @param { String } attrName 要获取的属性名称\r\n             * @return { * } 返回attrs对象下的属性值\r\n             * @example\r\n             * ```javascript\r\n             * node.getAttr('title');\r\n             * ```\r\n             */\r\n            getAttr: function (attrName) {\r\n                return this.attrs && this.attrs[attrName.toLowerCase()]\r\n            },\r\n\r\n            /**\r\n             * 设置当前节点所代表的元素属性，即设置attrs对象下的属性值\r\n             * @method setAttr\r\n             * @param { String } attrName 要设置的属性名称\r\n             * @param { * } attrVal 要设置的属性值，类型视设置的属性而定\r\n             * @return { * } 返回attrs对象下的属性值\r\n             * @example\r\n             * ```javascript\r\n             * node.setAttr('title','标题');\r\n             * ```\r\n             */\r\n            setAttr: function (attrName, attrVal) {\r\n                if (!attrName) {\r\n                    delete this.attrs;\r\n                    return;\r\n                }\r\n                if (!this.attrs) {\r\n                    this.attrs = {};\r\n                }\r\n                if (utils.isObject(attrName)) {\r\n                    for (var a in attrName) {\r\n                        if (!attrName[a]) {\r\n                            delete this.attrs[a]\r\n                        } else {\r\n                            this.attrs[a.toLowerCase()] = attrName[a];\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (!attrVal) {\r\n                        delete this.attrs[attrName]\r\n                    } else {\r\n                        this.attrs[attrName.toLowerCase()] = attrVal;\r\n                    }\r\n\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 获取当前节点在父节点下的位置索引\r\n             * @method getIndex\r\n             * @return { Number } 返回索引数值，如果没有父节点，返回-1\r\n             * @example\r\n             * ```javascript\r\n             * node.getIndex();\r\n             * ```\r\n             */\r\n            getIndex: function () {\r\n                var parent = this.parentNode;\r\n                for (var i = 0, ci; ci = parent.children[i]; i++) {\r\n                    if (ci === this) {\r\n                        return i;\r\n                    }\r\n                }\r\n                return -1;\r\n            },\r\n\r\n            /**\r\n             * 在当前节点下，根据id查找节点\r\n             * @method getNodeById\r\n             * @param { String } id 要查找的id\r\n             * @return { UE.uNode } 返回找到的节点\r\n             * @example\r\n             * ```javascript\r\n             * node.getNodeById('textId');\r\n             * ```\r\n             */\r\n            getNodeById: function (id) {\r\n                var node;\r\n                if (this.children && this.children.length) {\r\n                    for (var i = 0, ci; ci = this.children[i++];) {\r\n                        if (node = getNodeById(ci, id)) {\r\n                            return node;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * 在当前节点下，根据元素名称查找节点列表\r\n             * @method getNodesByTagName\r\n             * @param { String } tagNames 要查找的元素名称\r\n             * @return { Array } 返回找到的节点列表\r\n             * @example\r\n             * ```javascript\r\n             * node.getNodesByTagName('span');\r\n             * ```\r\n             */\r\n            getNodesByTagName: function (tagNames) {\r\n                tagNames = utils.trim(tagNames).replace(/[ ]{2,}/g, ' ').split(' ');\r\n                var arr = [], me = this;\r\n                utils.each(tagNames, function (tagName) {\r\n                    if (me.children && me.children.length) {\r\n                        for (var i = 0, ci; ci = me.children[i++];) {\r\n                            getNodesByTagName(ci, tagName, arr)\r\n                        }\r\n                    }\r\n                });\r\n                return arr;\r\n            },\r\n\r\n            /**\r\n             * 根据样式名称，获取节点的样式值\r\n             * @method getStyle\r\n             * @param { String } name 要获取的样式名称\r\n             * @return { String } 返回样式值\r\n             * @example\r\n             * ```javascript\r\n             * node.getStyle('font-size');\r\n             * ```\r\n             */\r\n            getStyle: function (name) {\r\n                var cssStyle = this.getAttr('style');\r\n                if (!cssStyle) {\r\n                    return ''\r\n                }\r\n                var reg = new RegExp('(^|;)\\\\s*' + name + ':([^;]+)', 'i');\r\n                var match = cssStyle.match(reg);\r\n                if (match && match[0]) {\r\n                    return match[2]\r\n                }\r\n                return '';\r\n            },\r\n\r\n            /**\r\n             * 给节点设置样式\r\n             * @method setStyle\r\n             * @param { String } name 要设置的的样式名称\r\n             * @param { String } val 要设置的的样值\r\n             * @example\r\n             * ```javascript\r\n             * node.setStyle('font-size', '12px');\r\n             * ```\r\n             */\r\n            setStyle: function (name, val) {\r\n                function exec(name, val) {\r\n                    var reg = new RegExp('(^|;)\\\\s*' + name + ':([^;]+;?)', 'gi');\r\n                    cssStyle = cssStyle.replace(reg, '$1');\r\n                    if (val) {\r\n                        cssStyle = name + ':' + utils.unhtml(val) + ';' + cssStyle\r\n                    }\r\n\r\n                }\r\n\r\n                var cssStyle = this.getAttr('style');\r\n                if (!cssStyle) {\r\n                    cssStyle = '';\r\n                }\r\n                if (utils.isObject(name)) {\r\n                    for (var a in name) {\r\n                        exec(a, name[a])\r\n                    }\r\n                } else {\r\n                    exec(name, val)\r\n                }\r\n                this.setAttr('style', utils.trim(cssStyle))\r\n            },\r\n\r\n            /**\r\n             * 传入一个函数，递归遍历当前节点下的所有节点\r\n             * @method traversal\r\n             * @param { Function } fn 遍历到节点的时，传入节点作为参数，运行此函数\r\n             * @example\r\n             * ```javascript\r\n             * traversal(node, function(){\r\n             *     console.log(node.type);\r\n             * });\r\n             * ```\r\n             */\r\n            traversal: function (fn) {\r\n                if (this.children && this.children.length) {\r\n                    nodeTraversal(this, fn);\r\n                }\r\n                return this;\r\n            }\r\n        }\r\n    })();\r\n\r\n\r\n    // core/htmlparser.js\r\n    /**\r\n     * html字符串转换成uNode节点\r\n     * @file\r\n     * @module UE\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @unfile\r\n     * @module UE\r\n     */\r\n\r\n    /**\r\n     * html字符串转换成uNode节点的静态方法\r\n     * @method htmlparser\r\n     * @param { String } htmlstr 要转换的html代码\r\n     * @param { Boolean } ignoreBlank 若设置为true，转换的时候忽略\\n\\r\\t等空白字符\r\n     * @return { uNode } 给定的html片段转换形成的uNode对象\r\n     * @example\r\n     * ```javascript\r\n     * var root = UE.htmlparser('<p><b>htmlparser</b></p>', true);\r\n     * ```\r\n     */\r\n\r\n    var htmlparser = UE.htmlparser = function (htmlstr, ignoreBlank) {\r\n        //todo 原来的方式  [^\"'<>\\/] 有\\/就不能配对上 <TD vAlign=top background=../AAA.JPG> 这样的标签了\r\n        //先去掉了，加上的原因忘了，这里先记录\r\n        var re_tag = /<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)-->)|(?:([^\\s\\/<>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'<>])*)\\/?>))/g,\r\n            re_attr = /([\\w\\-:.]+)(?:(?:\\s*=\\s*(?:(?:\"([^\"]*)\")|(?:'([^']*)')|([^\\s>]+)))|(?=\\s|$))/g;\r\n\r\n        //ie下取得的html可能会有\\n存在，要去掉，在处理replace(/[\\t\\r\\n]*/g,'');代码高量的\\n不能去除\r\n        var allowEmptyTags = {\r\n            b: 1, code: 1, i: 1, u: 1, strike: 1, s: 1, tt: 1, strong: 1, q: 1, samp: 1, em: 1, span: 1,\r\n            sub: 1, img: 1, sup: 1, font: 1, big: 1, small: 1, iframe: 1, a: 1, br: 1, pre: 1\r\n        };\r\n        htmlstr = htmlstr.replace(new RegExp(domUtils.fillChar, 'g'), '');\r\n        if (!ignoreBlank) {\r\n            htmlstr = htmlstr.replace(new RegExp('[\\\\r\\\\t\\\\n' + (ignoreBlank ? '' : ' ') + ']*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>[\\\\r\\\\t\\\\n' + (ignoreBlank ? '' : ' ') + ']*', 'g'), function (a, b) {\r\n                //br暂时单独处理\r\n                if (b && allowEmptyTags[b.toLowerCase()]) {\r\n                    return a.replace(/(^[\\n\\r]+)|([\\n\\r]+$)/g, '');\r\n                }\r\n                return a.replace(new RegExp('^[\\\\r\\\\n' + (ignoreBlank ? '' : ' ') + ']+'), '').replace(new RegExp('[\\\\r\\\\n' + (ignoreBlank ? '' : ' ') + ']+$'), '');\r\n            });\r\n        }\r\n\r\n        var notTransAttrs = {\r\n            'href': 1,\r\n            'src': 1\r\n        };\r\n\r\n        var uNode = UE.uNode,\r\n            needParentNode = {\r\n                'td': 'tr',\r\n                'tr': ['tbody', 'thead', 'tfoot'],\r\n                'tbody': 'table',\r\n                'th': 'tr',\r\n                'thead': 'table',\r\n                'tfoot': 'table',\r\n                'caption': 'table',\r\n                'li': ['ul', 'ol'],\r\n                'dt': 'dl',\r\n                'dd': 'dl',\r\n                'option': 'select'\r\n            },\r\n            needChild = {\r\n                'ol': 'li',\r\n                'ul': 'li'\r\n            };\r\n\r\n        function text(parent, data) {\r\n\r\n            if (needChild[parent.tagName]) {\r\n                var tmpNode = uNode.createElement(needChild[parent.tagName]);\r\n                parent.appendChild(tmpNode);\r\n                tmpNode.appendChild(uNode.createText(data));\r\n                parent = tmpNode;\r\n            } else {\r\n\r\n                parent.appendChild(uNode.createText(data));\r\n            }\r\n        }\r\n\r\n        function element(parent, tagName, htmlattr) {\r\n            var needParentTag;\r\n            if (needParentTag = needParentNode[tagName]) {\r\n                var tmpParent = parent, hasParent;\r\n                while (tmpParent.type != 'root') {\r\n                    if (utils.isArray(needParentTag) ? utils.indexOf(needParentTag, tmpParent.tagName) != -1 : needParentTag == tmpParent.tagName) {\r\n                        parent = tmpParent;\r\n                        hasParent = true;\r\n                        break;\r\n                    }\r\n                    tmpParent = tmpParent.parentNode;\r\n                }\r\n                if (!hasParent) {\r\n                    parent = element(parent, utils.isArray(needParentTag) ? needParentTag[0] : needParentTag)\r\n                }\r\n            }\r\n            //按dtd处理嵌套\r\n            //        if(parent.type != 'root' && !dtd[parent.tagName][tagName])\r\n            //            parent = parent.parentNode;\r\n            var elm = new uNode({\r\n                parentNode: parent,\r\n                type: 'element',\r\n                tagName: tagName.toLowerCase(),\r\n                //是自闭合的处理一下\r\n                children: dtd.$empty[tagName] ? null : []\r\n            });\r\n            //如果属性存在，处理属性\r\n            if (htmlattr) {\r\n                var attrs = {}, match;\r\n                while (match = re_attr.exec(htmlattr)) {\r\n                    attrs[match[1].toLowerCase()] = notTransAttrs[match[1].toLowerCase()] ? (match[2] || match[3] || match[4]) : utils.unhtml(match[2] || match[3] || match[4])\r\n                }\r\n                elm.attrs = attrs;\r\n            }\r\n            //trace:3970\r\n            //        //如果parent下不能放elm\r\n            //        if(dtd.$inline[parent.tagName] && dtd.$block[elm.tagName] && !dtd[parent.tagName][elm.tagName]){\r\n            //            parent = parent.parentNode;\r\n            //            elm.parentNode = parent;\r\n            //        }\r\n            parent.children.push(elm);\r\n            //如果是自闭合节点返回父亲节点\r\n            return dtd.$empty[tagName] ? parent : elm\r\n        }\r\n\r\n        function comment(parent, data) {\r\n            parent.children.push(new uNode({\r\n                type: 'comment',\r\n                data: data,\r\n                parentNode: parent\r\n            }));\r\n        }\r\n\r\n        var match, currentIndex = 0, nextIndex = 0;\r\n        //设置根节点\r\n        var root = new uNode({\r\n            type: 'root',\r\n            children: []\r\n        });\r\n        var currentParent = root;\r\n\r\n        while (match = re_tag.exec(htmlstr)) {\r\n            currentIndex = match.index;\r\n            try {\r\n                if (currentIndex > nextIndex) {\r\n                    //text node\r\n                    text(currentParent, htmlstr.slice(nextIndex, currentIndex));\r\n                }\r\n                if (match[3]) {\r\n\r\n                    if (dtd.$cdata[currentParent.tagName]) {\r\n                        text(currentParent, match[0]);\r\n                    } else {\r\n                        //start tag\r\n                        currentParent = element(currentParent, match[3].toLowerCase(), match[4]);\r\n                    }\r\n\r\n\r\n                } else if (match[1]) {\r\n                    if (currentParent.type != 'root') {\r\n                        if (dtd.$cdata[currentParent.tagName] && !dtd.$cdata[match[1]]) {\r\n                            text(currentParent, match[0]);\r\n                        } else {\r\n                            var tmpParent = currentParent;\r\n                            while (currentParent.type == 'element' && currentParent.tagName != match[1].toLowerCase()) {\r\n                                currentParent = currentParent.parentNode;\r\n                                if (currentParent.type == 'root') {\r\n                                    currentParent = tmpParent;\r\n                                    throw 'break'\r\n                                }\r\n                            }\r\n                            //end tag\r\n                            currentParent = currentParent.parentNode;\r\n                        }\r\n\r\n                    }\r\n\r\n                } else if (match[2]) {\r\n                    //comment\r\n                    comment(currentParent, match[2])\r\n                }\r\n            } catch (e) { }\r\n\r\n            nextIndex = re_tag.lastIndex;\r\n\r\n        }\r\n        //如果结束是文本，就有可能丢掉，所以这里手动判断一下\r\n        //例如 <li>sdfsdfsdf<li>sdfsdfsdfsdf\r\n        if (nextIndex < htmlstr.length) {\r\n            text(currentParent, htmlstr.slice(nextIndex));\r\n        }\r\n        return root;\r\n    };\r\n\r\n\r\n    // core/filternode.js\r\n    /**\r\n     * UE过滤节点的静态方法\r\n     * @file\r\n     */\r\n\r\n    /**\r\n     * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n     * @module UE\r\n     */\r\n\r\n\r\n    /**\r\n     * 根据传入节点和过滤规则过滤相应节点\r\n     * @module UE\r\n     * @since 1.2.6.1\r\n     * @method filterNode\r\n     * @param { Object } root 指定root节点\r\n     * @param { Object } rules 过滤规则json对象\r\n     * @example\r\n     * ```javascript\r\n     * UE.filterNode(root,editor.options.filterRules);\r\n     * ```\r\n     */\r\n    var filterNode = UE.filterNode = function () {\r\n        function filterNode(node, rules) {\r\n            switch (node.type) {\r\n                case 'text':\r\n                    break;\r\n                case 'element':\r\n                    var val;\r\n                    if (val = rules[node.tagName]) {\r\n                        if (val === '-') {\r\n                            node.parentNode.removeChild(node)\r\n                        } else if (utils.isFunction(val)) {\r\n                            var parentNode = node.parentNode,\r\n                                index = node.getIndex();\r\n                            val(node);\r\n                            if (node.parentNode) {\r\n                                if (node.children) {\r\n                                    for (var i = 0, ci; ci = node.children[i];) {\r\n                                        filterNode(ci, rules);\r\n                                        if (ci.parentNode) {\r\n                                            i++;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                for (var i = index, ci; ci = parentNode.children[i];) {\r\n                                    filterNode(ci, rules);\r\n                                    if (ci.parentNode) {\r\n                                        i++;\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n\r\n                        } else {\r\n                            var attrs = val['$'];\r\n                            if (attrs && node.attrs) {\r\n                                var tmpAttrs = {}, tmpVal;\r\n                                for (var a in attrs) {\r\n                                    tmpVal = node.getAttr(a);\r\n                                    //todo 只先对style单独处理\r\n                                    if (a == 'style' && utils.isArray(attrs[a])) {\r\n                                        var tmpCssStyle = [];\r\n                                        utils.each(attrs[a], function (v) {\r\n                                            var tmp;\r\n                                            if (tmp = node.getStyle(v)) {\r\n                                                tmpCssStyle.push(v + ':' + tmp);\r\n                                            }\r\n                                        });\r\n                                        tmpVal = tmpCssStyle.join(';')\r\n                                    }\r\n                                    if (tmpVal) {\r\n                                        tmpAttrs[a] = tmpVal;\r\n                                    }\r\n\r\n                                }\r\n                                node.attrs = tmpAttrs;\r\n                            }\r\n                            if (node.children) {\r\n                                for (var i = 0, ci; ci = node.children[i];) {\r\n                                    filterNode(ci, rules);\r\n                                    if (ci.parentNode) {\r\n                                        i++;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    } else {\r\n                        //如果不在名单里扣出子节点并删除该节点,cdata除外\r\n                        if (dtd.$cdata[node.tagName]) {\r\n                            node.parentNode.removeChild(node)\r\n                        } else {\r\n                            var parentNode = node.parentNode,\r\n                                index = node.getIndex();\r\n                            node.parentNode.removeChild(node, true);\r\n                            for (var i = index, ci; ci = parentNode.children[i];) {\r\n                                filterNode(ci, rules);\r\n                                if (ci.parentNode) {\r\n                                    i++;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'comment':\r\n                    node.parentNode.removeChild(node)\r\n            }\r\n\r\n        }\r\n        return function (root, rules) {\r\n            if (utils.isEmptyObject(rules)) {\r\n                return root;\r\n            }\r\n            var val;\r\n            if (val = rules['-']) {\r\n                utils.each(val.split(' '), function (k) {\r\n                    rules[k] = '-'\r\n                })\r\n            }\r\n            for (var i = 0, ci; ci = root.children[i];) {\r\n                filterNode(ci, rules);\r\n                if (ci.parentNode) {\r\n                    i++;\r\n                }\r\n            }\r\n            return root;\r\n        }\r\n    }();\r\n\r\n    // core/plugin.js\r\n    /**\r\n     * Created with JetBrains PhpStorm.\r\n     * User: campaign\r\n     * Date: 10/8/13\r\n     * Time: 6:15 PM\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n    UE.plugin = function () {\r\n        var _plugins = {};\r\n        return {\r\n            register: function (pluginName, fn, oldOptionName, afterDisabled) {\r\n                if (oldOptionName && utils.isFunction(oldOptionName)) {\r\n                    afterDisabled = oldOptionName;\r\n                    oldOptionName = null\r\n                }\r\n                _plugins[pluginName] = {\r\n                    optionName: oldOptionName || pluginName,\r\n                    execFn: fn,\r\n                    //当插件被禁用时执行\r\n                    afterDisabled: afterDisabled\r\n                }\r\n            },\r\n            load: function (editor) {\r\n                utils.each(_plugins, function (plugin) {\r\n                    var _export = plugin.execFn.call(editor);\r\n                    if (editor.options[plugin.optionName] !== false) {\r\n                        if (_export) {\r\n                            //后边需要再做扩展\r\n                            utils.each(_export, function (v, k) {\r\n                                switch (k.toLowerCase()) {\r\n                                    case 'shortcutkey':\r\n                                        editor.addshortcutkey(v);\r\n                                        break;\r\n                                    case 'bindevents':\r\n                                        utils.each(v, function (fn, eventName) {\r\n                                            editor.addListener(eventName, fn);\r\n                                        });\r\n                                        break;\r\n                                    case 'bindmultievents':\r\n                                        utils.each(utils.isArray(v) ? v : [v], function (event) {\r\n                                            var types = utils.trim(event.type).split(/\\s+/);\r\n                                            utils.each(types, function (eventName) {\r\n                                                editor.addListener(eventName, event.handler);\r\n                                            });\r\n                                        });\r\n                                        break;\r\n                                    case 'commands':\r\n                                        utils.each(v, function (execFn, execName) {\r\n                                            editor.commands[execName] = execFn\r\n                                        });\r\n                                        break;\r\n                                    case 'outputrule':\r\n                                        editor.addOutputRule(v);\r\n                                        break;\r\n                                    case 'inputrule':\r\n                                        editor.addInputRule(v);\r\n                                        break;\r\n                                    case 'defaultoptions':\r\n                                        editor.setOpt(v)\r\n                                }\r\n                            })\r\n                        }\r\n\r\n                    } else if (plugin.afterDisabled) {\r\n                        plugin.afterDisabled.call(editor)\r\n                    }\r\n\r\n                });\r\n                //向下兼容\r\n                utils.each(UE.plugins, function (plugin) {\r\n                    plugin.call(editor);\r\n                });\r\n            },\r\n            run: function (pluginName, editor) {\r\n                var plugin = _plugins[pluginName];\r\n                if (plugin) {\r\n                    plugin.exeFn.call(editor)\r\n                }\r\n            }\r\n        }\r\n    }();\r\n\r\n    // core/keymap.js\r\n    var keymap = UE.keymap = {\r\n        'Backspace': 8,\r\n        'Tab': 9,\r\n        'Enter': 13,\r\n\r\n        'Shift': 16,\r\n        'Control': 17,\r\n        'Alt': 18,\r\n        'CapsLock': 20,\r\n\r\n        'Esc': 27,\r\n\r\n        'Spacebar': 32,\r\n\r\n        'PageUp': 33,\r\n        'PageDown': 34,\r\n        'End': 35,\r\n        'Home': 36,\r\n\r\n        'Left': 37,\r\n        'Up': 38,\r\n        'Right': 39,\r\n        'Down': 40,\r\n\r\n        'Insert': 45,\r\n\r\n        'Del': 46,\r\n\r\n        'NumLock': 144,\r\n\r\n        'Cmd': 91,\r\n\r\n        '=': 187,\r\n        '-': 189,\r\n\r\n        \"b\": 66,\r\n        'i': 73,\r\n        //回退\r\n        'z': 90,\r\n        'y': 89,\r\n        //粘贴\r\n        'v': 86,\r\n        'x': 88,\r\n\r\n        's': 83,\r\n\r\n        'n': 78\r\n    };\r\n\r\n    // core/localstorage.js\r\n    //存储媒介封装\r\n    var LocalStorage = UE.LocalStorage = (function () {\r\n\r\n        var storage = window.localStorage || getUserData() || null,\r\n            LOCAL_FILE = 'localStorage';\r\n\r\n        return {\r\n\r\n            saveLocalData: function (key, data) {\r\n\r\n                if (storage && data) {\r\n                    storage.setItem(key, data);\r\n                    return true;\r\n                }\r\n\r\n                return false;\r\n\r\n            },\r\n\r\n            getLocalData: function (key) {\r\n\r\n                if (storage) {\r\n                    return storage.getItem(key);\r\n                }\r\n\r\n                return null;\r\n\r\n            },\r\n\r\n            removeItem: function (key) {\r\n\r\n                storage && storage.removeItem(key);\r\n\r\n            }\r\n\r\n        };\r\n\r\n        function getUserData() {\r\n\r\n            var container = document.createElement(\"div\");\r\n            container.style.display = \"none\";\r\n\r\n            if (!container.addBehavior) {\r\n                return null;\r\n            }\r\n\r\n            container.addBehavior(\"#default#userdata\");\r\n\r\n            return {\r\n\r\n                getItem: function (key) {\r\n\r\n                    var result = null;\r\n\r\n                    try {\r\n                        document.body.appendChild(container);\r\n                        container.load(LOCAL_FILE);\r\n                        result = container.getAttribute(key);\r\n                        document.body.removeChild(container);\r\n                    } catch (e) {\r\n                    }\r\n\r\n                    return result;\r\n\r\n                },\r\n\r\n                setItem: function (key, value) {\r\n\r\n                    document.body.appendChild(container);\r\n                    container.setAttribute(key, value);\r\n                    container.save(LOCAL_FILE);\r\n                    document.body.removeChild(container);\r\n\r\n                },\r\n\r\n                //// 暂时没有用到\r\n                //clear: function () {\r\n                //\r\n                //    var expiresTime = new Date();\r\n                //    expiresTime.setFullYear(expiresTime.getFullYear() - 1);\r\n                //    document.body.appendChild(container);\r\n                //    container.expires = expiresTime.toUTCString();\r\n                //    container.save(LOCAL_FILE);\r\n                //    document.body.removeChild(container);\r\n                //\r\n                //},\r\n\r\n                removeItem: function (key) {\r\n\r\n                    document.body.appendChild(container);\r\n                    container.removeAttribute(key);\r\n                    container.save(LOCAL_FILE);\r\n                    document.body.removeChild(container);\r\n\r\n                }\r\n\r\n            };\r\n\r\n        }\r\n\r\n    })();\r\n\r\n    (function () {\r\n\r\n        var ROOTKEY = 'ueditor_preference';\r\n\r\n        UE.Editor.prototype.setPreferences = function (key, value) {\r\n            var obj = {};\r\n            if (utils.isString(key)) {\r\n                obj[key] = value;\r\n            } else {\r\n                obj = key;\r\n            }\r\n            var data = LocalStorage.getLocalData(ROOTKEY);\r\n            if (data && (data = utils.str2json(data))) {\r\n                utils.extend(data, obj);\r\n            } else {\r\n                data = obj;\r\n            }\r\n            data && LocalStorage.saveLocalData(ROOTKEY, utils.json2str(data));\r\n        };\r\n\r\n        UE.Editor.prototype.getPreferences = function (key) {\r\n            var data = LocalStorage.getLocalData(ROOTKEY);\r\n            if (data && (data = utils.str2json(data))) {\r\n                return key ? data[key] : data\r\n            }\r\n            return null;\r\n        };\r\n\r\n        UE.Editor.prototype.removePreferences = function (key) {\r\n            var data = LocalStorage.getLocalData(ROOTKEY);\r\n            if (data && (data = utils.str2json(data))) {\r\n                data[key] = undefined;\r\n                delete data[key]\r\n            }\r\n            data && LocalStorage.saveLocalData(ROOTKEY, utils.json2str(data));\r\n        };\r\n\r\n    })();\r\n\r\n\r\n    // plugins/defaultfilter.js\r\n    ///import core\r\n    ///plugin 编辑器默认的过滤转换机制\r\n\r\n    UE.plugins['defaultfilter'] = function () {\r\n        var me = this;\r\n        me.setOpt({\r\n            'allowDivTransToP': true,\r\n            'disabledTableInTable': true\r\n        });\r\n        //默认的过滤处理\r\n        //进入编辑器的内容处理\r\n        me.addInputRule(function (root) {\r\n            var allowDivTransToP = this.options.allowDivTransToP;\r\n            var val;\r\n            function tdParent(node) {\r\n                while (node && node.type == 'element') {\r\n                    if (node.tagName == 'td') {\r\n                        return true;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                return false;\r\n            }\r\n            //进行默认的处理\r\n            root.traversal(function (node) {\r\n                if (node.type == 'element') {\r\n                    if (!dtd.$cdata[node.tagName] && me.options.autoClearEmptyNode && dtd.$inline[node.tagName] && !dtd.$empty[node.tagName] && (!node.attrs || utils.isEmptyObject(node.attrs))) {\r\n                        if (!node.firstChild()) node.parentNode.removeChild(node);\r\n                        else if (node.tagName == 'span' && (!node.attrs || utils.isEmptyObject(node.attrs))) {\r\n                            node.parentNode.removeChild(node, true)\r\n                        }\r\n                        return;\r\n                    }\r\n                    switch (node.tagName) {\r\n                        case 'style':\r\n                        case 'script':\r\n                            node.setAttr({\r\n                                cdata_tag: node.tagName,\r\n                                cdata_data: (node.innerHTML() || ''),\r\n                                '_ue_custom_node_': 'true'\r\n                            });\r\n                            node.tagName = 'div';\r\n                            node.innerHTML('');\r\n                            break;\r\n                        case 'a':\r\n                            if (val = node.getAttr('href')) {\r\n                                node.setAttr('_href', val)\r\n                            }\r\n                            break;\r\n                        case 'img':\r\n                            //todo base64暂时去掉，后边做远程图片上传后，干掉这个\r\n                            if (val = node.getAttr('src')) {\r\n                                if (/^data:/.test(val)) {\r\n                                    node.parentNode.removeChild(node);\r\n                                    break;\r\n                                }\r\n                            }\r\n                            node.setAttr('_src', node.getAttr('src'));\r\n                            break;\r\n                        case 'span':\r\n                            if (browser.webkit && (val = node.getStyle('white-space'))) {\r\n                                if (/nowrap|normal/.test(val)) {\r\n                                    node.setStyle('white-space', '');\r\n                                    if (me.options.autoClearEmptyNode && utils.isEmptyObject(node.attrs)) {\r\n                                        node.parentNode.removeChild(node, true)\r\n                                    }\r\n                                }\r\n                            }\r\n                            val = node.getAttr('id');\r\n                            if (val && /^_baidu_bookmark_/i.test(val)) {\r\n                                node.parentNode.removeChild(node)\r\n                            }\r\n                            break;\r\n                        case 'p':\r\n                            if (val = node.getAttr('align')) {\r\n                                node.setAttr('align');\r\n                                node.setStyle('text-align', val)\r\n                            }\r\n                            //trace:3431\r\n                            //                        var cssStyle = node.getAttr('style');\r\n                            //                        if (cssStyle) {\r\n                            //                            cssStyle = cssStyle.replace(/(margin|padding)[^;]+/g, '');\r\n                            //                            node.setAttr('style', cssStyle)\r\n                            //\r\n                            //                        }\r\n                            //p标签不允许嵌套\r\n                            utils.each(node.children, function (n) {\r\n                                if (n.type == 'element' && n.tagName == 'p') {\r\n                                    var next = n.nextSibling();\r\n                                    node.parentNode.insertAfter(n, node);\r\n                                    var last = n;\r\n                                    while (next) {\r\n                                        var tmp = next.nextSibling();\r\n                                        node.parentNode.insertAfter(next, last);\r\n                                        last = next;\r\n                                        next = tmp;\r\n                                    }\r\n                                    return false;\r\n                                }\r\n                            });\r\n                            if (!node.firstChild()) {\r\n                                node.innerHTML(browser.ie ? '&nbsp;' : '<br/>')\r\n                            }\r\n                            break;\r\n                        case 'div':\r\n                            if (node.getAttr('cdata_tag')) {\r\n                                break;\r\n                            }\r\n                            //针对代码这里不处理插入代码的div\r\n                            val = node.getAttr('class');\r\n                            if (val && /^line number\\d+/.test(val)) {\r\n                                break;\r\n                            }\r\n                            if (!allowDivTransToP) {\r\n                                break;\r\n                            }\r\n                            var tmpNode, p = UE.uNode.createElement('p');\r\n                            while (tmpNode = node.firstChild()) {\r\n                                if (tmpNode.type == 'text' || !UE.dom.dtd.$block[tmpNode.tagName]) {\r\n                                    p.appendChild(tmpNode);\r\n                                } else {\r\n                                    if (p.firstChild()) {\r\n                                        node.parentNode.insertBefore(p, node);\r\n                                        p = UE.uNode.createElement('p');\r\n                                    } else {\r\n                                        node.parentNode.insertBefore(tmpNode, node);\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (p.firstChild()) {\r\n                                node.parentNode.insertBefore(p, node);\r\n                            }\r\n                            node.parentNode.removeChild(node);\r\n                            break;\r\n                        case 'dl':\r\n                            node.tagName = 'ul';\r\n                            break;\r\n                        case 'dt':\r\n                        case 'dd':\r\n                            node.tagName = 'li';\r\n                            break;\r\n                        case 'li':\r\n                            var className = node.getAttr('class');\r\n                            if (!className || !/list\\-/.test(className)) {\r\n                                node.setAttr()\r\n                            }\r\n                            var tmpNodes = node.getNodesByTagName('ol ul');\r\n                            UE.utils.each(tmpNodes, function (n) {\r\n                                node.parentNode.insertAfter(n, node);\r\n                            });\r\n                            break;\r\n                        case 'td':\r\n                        case 'th':\r\n                        case 'caption':\r\n                            if (!node.children || !node.children.length) {\r\n                                node.appendChild(browser.ie11below ? UE.uNode.createText(' ') : UE.uNode.createElement('br'))\r\n                            }\r\n                            break;\r\n                        case 'table':\r\n                            if (me.options.disabledTableInTable && tdParent(node)) {\r\n                                node.parentNode.insertBefore(UE.uNode.createText(node.innerText()), node);\r\n                                node.parentNode.removeChild(node)\r\n                            }\r\n                    }\r\n\r\n                }\r\n                //            if(node.type == 'comment'){\r\n                //                node.parentNode.removeChild(node);\r\n                //            }\r\n            })\r\n\r\n        });\r\n\r\n        //从编辑器出去的内容处理\r\n        me.addOutputRule(function (root) {\r\n\r\n            var val;\r\n            root.traversal(function (node) {\r\n                if (node.type == 'element') {\r\n\r\n                    if (me.options.autoClearEmptyNode && dtd.$inline[node.tagName] && !dtd.$empty[node.tagName] && (!node.attrs || utils.isEmptyObject(node.attrs))) {\r\n\r\n                        if (!node.firstChild()) node.parentNode.removeChild(node);\r\n                        else if (node.tagName == 'span' && (!node.attrs || utils.isEmptyObject(node.attrs))) {\r\n                            node.parentNode.removeChild(node, true)\r\n                        }\r\n                        return;\r\n                    }\r\n                    switch (node.tagName) {\r\n                        case 'div':\r\n                            if (val = node.getAttr('cdata_tag')) {\r\n                                node.tagName = val;\r\n                                node.appendChild(UE.uNode.createText(node.getAttr('cdata_data')));\r\n                                node.setAttr({ cdata_tag: '', cdata_data: '', '_ue_custom_node_': '' });\r\n                            }\r\n                            break;\r\n                        case 'a':\r\n                            if (val = node.getAttr('_href')) {\r\n                                node.setAttr({\r\n                                    'href': utils.html(val),\r\n                                    '_href': ''\r\n                                })\r\n                            }\r\n                            break;\r\n                            break;\r\n                        case 'span':\r\n                            val = node.getAttr('id');\r\n                            if (val && /^_baidu_bookmark_/i.test(val)) {\r\n                                node.parentNode.removeChild(node)\r\n                            }\r\n                            break;\r\n                        case 'img':\r\n                            if (val = node.getAttr('_src')) {\r\n                                node.setAttr({\r\n                                    'src': node.getAttr('_src'),\r\n                                    '_src': ''\r\n                                })\r\n                            }\r\n\r\n\r\n                    }\r\n                }\r\n\r\n            })\r\n\r\n\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/inserthtml.js\r\n    /**\r\n     * 插入html字符串插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 插入html代码\r\n     * @command inserthtml\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } html 插入的html字符串\r\n     * @remaind 插入的标签内容是在当前的选区位置上插入，如果当前是闭合状态，那直接插入内容， 如果当前是选中状态，将先清除当前选中内容后，再做插入\r\n     * @warning 注意:该命令会对当前选区的位置，对插入的内容进行过滤转换处理。 过滤的规则遵循html语意化的原则。\r\n     * @example\r\n     * ```javascript\r\n     * //xxx[BB]xxx 当前选区为非闭合选区，选中BB这两个文本\r\n     * //执行命令，插入<b>CC</b>\r\n     * //插入后的效果 xxx<b>CC</b>xxx\r\n     * //<p>xx|xxx</p> 当前选区为闭合状态\r\n     * //插入<p>CC</p>\r\n     * //结果 <p>xx</p><p>CC</p><p>xxx</p>\r\n     * //<p>xxxx</p>|</p>xxx</p> 当前选区在两个p标签之间\r\n     * //插入 xxxx\r\n     * //结果 <p>xxxx</p><p>xxxx</p></p>xxx</p>\r\n     * ```\r\n     */\r\n\r\n    UE.commands['inserthtml'] = {\r\n        execCommand: function (command, html, notNeedFilter) {\r\n            var me = this,\r\n                range,\r\n                div;\r\n            if (!html) {\r\n                return;\r\n            }\r\n            if (me.fireEvent('beforeinserthtml', html) === true) {\r\n                return;\r\n            }\r\n            range = me.selection.getRange();\r\n            div = range.document.createElement('div');\r\n            div.style.display = 'inline';\r\n\r\n            if (!notNeedFilter) {\r\n                var root = UE.htmlparser(html);\r\n                //如果给了过滤规则就先进行过滤\r\n                if (me.options.filterRules) {\r\n                    UE.filterNode(root, me.options.filterRules);\r\n                }\r\n                //执行默认的处理\r\n                me.filterInputRule(root);\r\n                html = root.toHtml()\r\n            }\r\n            div.innerHTML = utils.trim(html);\r\n\r\n            if (!range.collapsed) {\r\n                var tmpNode = range.startContainer;\r\n                if (domUtils.isFillChar(tmpNode)) {\r\n                    range.setStartBefore(tmpNode)\r\n                }\r\n                tmpNode = range.endContainer;\r\n                if (domUtils.isFillChar(tmpNode)) {\r\n                    range.setEndAfter(tmpNode)\r\n                }\r\n                range.txtToElmBoundary();\r\n                //结束边界可能放到了br的前边，要把br包含进来\r\n                // x[xxx]<br/>\r\n                if (range.endContainer && range.endContainer.nodeType == 1) {\r\n                    tmpNode = range.endContainer.childNodes[range.endOffset];\r\n                    if (tmpNode && domUtils.isBr(tmpNode)) {\r\n                        range.setEndAfter(tmpNode);\r\n                    }\r\n                }\r\n                if (range.startOffset == 0) {\r\n                    tmpNode = range.startContainer;\r\n                    if (domUtils.isBoundaryNode(tmpNode, 'firstChild')) {\r\n                        tmpNode = range.endContainer;\r\n                        if (range.endOffset == (tmpNode.nodeType == 3 ? tmpNode.nodeValue.length : tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode, 'lastChild')) {\r\n                            me.body.innerHTML = '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                            range.setStart(me.body.firstChild, 0).collapse(true)\r\n\r\n                        }\r\n                    }\r\n                }\r\n                !range.collapsed && range.deleteContents();\r\n                if (range.startContainer.nodeType == 1) {\r\n                    var child = range.startContainer.childNodes[range.startOffset], pre;\r\n                    if (child && domUtils.isBlockElm(child) && (pre = child.previousSibling) && domUtils.isBlockElm(pre)) {\r\n                        range.setEnd(pre, pre.childNodes.length).collapse();\r\n                        while (child.firstChild) {\r\n                            pre.appendChild(child.firstChild);\r\n                        }\r\n                        domUtils.remove(child);\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n\r\n            var child, parent, pre, tmp, hadBreak = 0, nextNode;\r\n            //如果当前位置选中了fillchar要干掉，要不会产生空行\r\n            if (range.inFillChar()) {\r\n                child = range.startContainer;\r\n                if (domUtils.isFillChar(child)) {\r\n                    range.setStartBefore(child).collapse(true);\r\n                    domUtils.remove(child);\r\n                } else if (domUtils.isFillChar(child, true)) {\r\n                    child.nodeValue = child.nodeValue.replace(fillCharReg, '');\r\n                    range.startOffset--;\r\n                    range.collapsed && range.collapse(true)\r\n                }\r\n            }\r\n            //列表单独处理\r\n            var li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n            if (li) {\r\n                var next, last;\r\n                while (child = div.firstChild) {\r\n                    //针对hr单独处理一下先\r\n                    while (child && (child.nodeType == 3 || !domUtils.isBlockElm(child) || child.tagName == 'HR')) {\r\n                        next = child.nextSibling;\r\n                        range.insertNode(child).collapse();\r\n                        last = child;\r\n                        child = next;\r\n\r\n                    }\r\n                    if (child) {\r\n                        if (/^(ol|ul)$/i.test(child.tagName)) {\r\n                            while (child.firstChild) {\r\n                                last = child.firstChild;\r\n                                domUtils.insertAfter(li, child.firstChild);\r\n                                li = li.nextSibling;\r\n                            }\r\n                            domUtils.remove(child)\r\n                        } else {\r\n                            var tmpLi;\r\n                            next = child.nextSibling;\r\n                            tmpLi = me.document.createElement('li');\r\n                            domUtils.insertAfter(li, tmpLi);\r\n                            tmpLi.appendChild(child);\r\n                            last = child;\r\n                            child = next;\r\n                            li = tmpLi;\r\n                        }\r\n                    }\r\n                }\r\n                li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n                if (domUtils.isEmptyBlock(li)) {\r\n                    domUtils.remove(li)\r\n                }\r\n                if (last) {\r\n\r\n                    range.setStartAfter(last).collapse(true).select(true)\r\n                }\r\n            } else {\r\n                while (child = div.firstChild) {\r\n                    if (hadBreak) {\r\n                        var p = me.document.createElement('p');\r\n                        while (child && (child.nodeType == 3 || !dtd.$block[child.tagName])) {\r\n                            nextNode = child.nextSibling;\r\n                            p.appendChild(child);\r\n                            child = nextNode;\r\n                        }\r\n                        if (p.firstChild) {\r\n\r\n                            child = p\r\n                        }\r\n                    }\r\n                    range.insertNode(child);\r\n                    nextNode = child.nextSibling;\r\n                    if (!hadBreak && child.nodeType == domUtils.NODE_ELEMENT && domUtils.isBlockElm(child)) {\r\n\r\n                        parent = domUtils.findParent(child, function (node) { return domUtils.isBlockElm(node); });\r\n                        if (parent && parent.tagName.toLowerCase() != 'body' && !(dtd[parent.tagName][child.nodeName] && child.parentNode === parent)) {\r\n                            if (!dtd[parent.tagName][child.nodeName]) {\r\n                                pre = parent;\r\n                            } else {\r\n                                tmp = child.parentNode;\r\n                                while (tmp !== parent) {\r\n                                    pre = tmp;\r\n                                    tmp = tmp.parentNode;\r\n\r\n                                }\r\n                            }\r\n\r\n\r\n                            domUtils.breakParent(child, pre || tmp);\r\n                            //去掉break后前一个多余的节点  <p>|<[p> ==> <p></p><div></div><p>|</p>\r\n                            var pre = child.previousSibling;\r\n                            domUtils.trimWhiteTextNode(pre);\r\n                            if (!pre.childNodes.length) {\r\n                                domUtils.remove(pre);\r\n                            }\r\n                            //trace:2012,在非ie的情况，切开后剩下的节点有可能不能点入光标添加br占位\r\n\r\n                            if (!browser.ie &&\r\n                                (next = child.nextSibling) &&\r\n                                domUtils.isBlockElm(next) &&\r\n                                next.lastChild &&\r\n                                !domUtils.isBr(next.lastChild)) {\r\n                                next.appendChild(me.document.createElement('br'));\r\n                            }\r\n                            hadBreak = 1;\r\n                        }\r\n                    }\r\n                    var next = child.nextSibling;\r\n                    if (!div.firstChild && next && domUtils.isBlockElm(next)) {\r\n\r\n                        range.setStart(next, 0).collapse(true);\r\n                        break;\r\n                    }\r\n                    range.setEndAfter(child).collapse();\r\n\r\n                }\r\n\r\n                child = range.startContainer;\r\n\r\n                if (nextNode && domUtils.isBr(nextNode)) {\r\n                    domUtils.remove(nextNode)\r\n                }\r\n                //用chrome可能有空白展位符\r\n                if (domUtils.isBlockElm(child) && domUtils.isEmptyNode(child)) {\r\n                    if (nextNode = child.nextSibling) {\r\n                        domUtils.remove(child);\r\n                        if (nextNode.nodeType == 1 && dtd.$block[nextNode.tagName]) {\r\n\r\n                            range.setStart(nextNode, 0).collapse(true).shrinkBoundary()\r\n                        }\r\n                    } else {\r\n\r\n                        try {\r\n                            child.innerHTML = browser.ie ? domUtils.fillChar : '<br/>';\r\n                        } catch (e) {\r\n                            range.setStartBefore(child);\r\n                            domUtils.remove(child)\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n                //加上true因为在删除表情等时会删两次，第一次是删的fillData\r\n                try {\r\n                    range.select(true);\r\n                } catch (e) { }\r\n\r\n            }\r\n\r\n\r\n\r\n            setTimeout(function () {\r\n                range = me.selection.getRange();\r\n                range.scrollToView(me.autoHeightEnabled, me.autoHeightEnabled ? domUtils.getXY(me.iframe).y : 0);\r\n                me.fireEvent('afterinserthtml', html);\r\n            }, 200);\r\n        }\r\n    };\r\n\r\n\r\n    // plugins/autotypeset.js\r\n    /**\r\n     * 自动排版\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 对当前编辑器的内容执行自动排版， 排版的行为根据config配置文件里的“autotypeset”选项进行控制。\r\n     * @command autotypeset\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'autotypeset' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['autotypeset'] = function () {\r\n\r\n        this.setOpt({\r\n            'autotypeset': {\r\n                mergeEmptyline: true,           //合并空行\r\n                removeClass: true,              //去掉冗余的class\r\n                removeEmptyline: false,         //去掉空行\r\n                textAlign: \"left\",               //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版\r\n                imageBlockLine: 'center',       //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版\r\n                pasteFilter: false,             //根据规则过滤没事粘贴进来的内容\r\n                clearFontSize: false,           //去掉所有的内嵌字号，使用编辑器默认的字号\r\n                clearFontFamily: false,         //去掉所有的内嵌字体，使用编辑器默认的字体\r\n                removeEmptyNode: false,         // 去掉空节点\r\n                //可以去掉的标签\r\n                removeTagNames: utils.extend({ div: 1 }, dtd.$removeEmpty),\r\n                indent: false,                  // 行首缩进\r\n                indentValue: '2em',            //行首缩进的大小\r\n                bdc2sb: false,\r\n                tobdc: false\r\n            }\r\n        });\r\n\r\n        var me = this,\r\n            opt = me.options.autotypeset,\r\n            remainClass = {\r\n                'selectTdClass': 1,\r\n                'pagebreak': 1,\r\n                'anchorclass': 1\r\n            },\r\n            remainTag = {\r\n                'li': 1\r\n            },\r\n            tags = {\r\n                div: 1,\r\n                p: 1,\r\n                //trace:2183 这些也认为是行\r\n                blockquote: 1, center: 1, h1: 1, h2: 1, h3: 1, h4: 1, h5: 1, h6: 1,\r\n                span: 1\r\n            },\r\n            highlightCont;\r\n        //升级了版本，但配置项目里没有autotypeset\r\n        if (!opt) {\r\n            return;\r\n        }\r\n\r\n        readLocalOpts();\r\n\r\n        function isLine(node, notEmpty) {\r\n            if (!node || node.nodeType == 3)\r\n                return 0;\r\n            if (domUtils.isBr(node))\r\n                return 1;\r\n            if (node && node.parentNode && tags[node.tagName.toLowerCase()]) {\r\n                if (highlightCont && highlightCont.contains(node)\r\n                    ||\r\n                    node.getAttribute('pagebreak')\r\n                ) {\r\n                    return 0;\r\n                }\r\n\r\n                return notEmpty ? !domUtils.isEmptyBlock(node) : domUtils.isEmptyBlock(node, new RegExp('[\\\\s' + domUtils.fillChar\r\n                    + ']', 'g'));\r\n            }\r\n        }\r\n\r\n        function removeNotAttributeSpan(node) {\r\n            if (!node.style.cssText) {\r\n                domUtils.removeAttributes(node, ['style']);\r\n                if (node.tagName.toLowerCase() == 'span' && domUtils.hasNoAttributes(node)) {\r\n                    domUtils.remove(node, true);\r\n                }\r\n            }\r\n        }\r\n        function autotype(type, html) {\r\n\r\n            var me = this, cont;\r\n            if (html) {\r\n                if (!opt.pasteFilter) {\r\n                    return;\r\n                }\r\n                cont = me.document.createElement('div');\r\n                cont.innerHTML = html.html;\r\n            } else {\r\n                cont = me.document.body;\r\n            }\r\n            var nodes = domUtils.getElementsByTagName(cont, '*');\r\n\r\n            // 行首缩进，段落方向，段间距，段内间距\r\n            for (var i = 0, ci; ci = nodes[i++];) {\r\n\r\n                if (me.fireEvent('excludeNodeinautotype', ci) === true) {\r\n                    continue;\r\n                }\r\n                //font-size\r\n                if (opt.clearFontSize && ci.style.fontSize) {\r\n                    domUtils.removeStyle(ci, 'font-size');\r\n\r\n                    removeNotAttributeSpan(ci);\r\n\r\n                }\r\n                //font-family\r\n                if (opt.clearFontFamily && ci.style.fontFamily) {\r\n                    domUtils.removeStyle(ci, 'font-family');\r\n                    removeNotAttributeSpan(ci);\r\n                }\r\n\r\n                if (isLine(ci)) {\r\n                    //合并空行\r\n                    if (opt.mergeEmptyline) {\r\n                        var next = ci.nextSibling, tmpNode, isBr = domUtils.isBr(ci);\r\n                        while (isLine(next)) {\r\n                            tmpNode = next;\r\n                            next = tmpNode.nextSibling;\r\n                            if (isBr && (!next || next && !domUtils.isBr(next))) {\r\n                                break;\r\n                            }\r\n                            domUtils.remove(tmpNode);\r\n                        }\r\n\r\n                    }\r\n                    //去掉空行，保留占位的空行\r\n                    if (opt.removeEmptyline && domUtils.inDoc(ci, cont) && !remainTag[ci.parentNode.tagName.toLowerCase()]) {\r\n                        if (domUtils.isBr(ci)) {\r\n                            next = ci.nextSibling;\r\n                            if (next && !domUtils.isBr(next)) {\r\n                                continue;\r\n                            }\r\n                        }\r\n                        domUtils.remove(ci);\r\n                        continue;\r\n\r\n                    }\r\n\r\n                }\r\n                if (isLine(ci, true) && ci.tagName != 'SPAN') {\r\n                    if (opt.indent) {\r\n                        ci.style.textIndent = opt.indentValue;\r\n                    }\r\n                    if (opt.textAlign) {\r\n                        ci.style.textAlign = opt.textAlign;\r\n                    }\r\n                    // if(opt.lineHeight)\r\n                    //     ci.style.lineHeight = opt.lineHeight + 'cm';\r\n\r\n                }\r\n\r\n                //去掉class,保留的class不去掉\r\n                if (opt.removeClass && ci.className && !remainClass[ci.className.toLowerCase()]) {\r\n\r\n                    if (highlightCont && highlightCont.contains(ci)) {\r\n                        continue;\r\n                    }\r\n                    domUtils.removeAttributes(ci, ['class']);\r\n                }\r\n\r\n                //表情不处理\r\n                if (opt.imageBlockLine && ci.tagName.toLowerCase() == 'img' && !ci.getAttribute('emotion')) {\r\n                    if (html) {\r\n                        var img = ci;\r\n                        switch (opt.imageBlockLine) {\r\n                            case 'left':\r\n                            case 'right':\r\n                            case 'none':\r\n                                var pN = img.parentNode, tmpNode, pre, next;\r\n                                while (dtd.$inline[pN.tagName] || pN.tagName == 'A') {\r\n                                    pN = pN.parentNode;\r\n                                }\r\n                                tmpNode = pN;\r\n                                if (tmpNode.tagName == 'P' && domUtils.getStyle(tmpNode, 'text-align') == 'center') {\r\n                                    if (!domUtils.isBody(tmpNode) && domUtils.getChildCount(tmpNode, function (node) { return !domUtils.isBr(node) && !domUtils.isWhitespace(node) }) == 1) {\r\n                                        pre = tmpNode.previousSibling;\r\n                                        next = tmpNode.nextSibling;\r\n                                        if (pre && next && pre.nodeType == 1 && next.nodeType == 1 && pre.tagName == next.tagName && domUtils.isBlockElm(pre)) {\r\n                                            pre.appendChild(tmpNode.firstChild);\r\n                                            while (next.firstChild) {\r\n                                                pre.appendChild(next.firstChild);\r\n                                            }\r\n                                            domUtils.remove(tmpNode);\r\n                                            domUtils.remove(next);\r\n                                        } else {\r\n                                            domUtils.setStyle(tmpNode, 'text-align', '');\r\n                                        }\r\n\r\n\r\n                                    }\r\n\r\n\r\n                                }\r\n                                domUtils.setStyle(img, 'float', opt.imageBlockLine);\r\n                                break;\r\n                            case 'center':\r\n                                if (me.queryCommandValue('imagefloat') != 'center') {\r\n                                    pN = img.parentNode;\r\n                                    domUtils.setStyle(img, 'float', 'none');\r\n                                    tmpNode = img;\r\n                                    while (pN && domUtils.getChildCount(pN, function (node) { return !domUtils.isBr(node) && !domUtils.isWhitespace(node) }) == 1\r\n                                        && (dtd.$inline[pN.tagName] || pN.tagName == 'A')) {\r\n                                        tmpNode = pN;\r\n                                        pN = pN.parentNode;\r\n                                    }\r\n                                    var pNode = me.document.createElement('p');\r\n                                    domUtils.setAttributes(pNode, {\r\n\r\n                                        style: 'text-align:center'\r\n                                    });\r\n                                    tmpNode.parentNode.insertBefore(pNode, tmpNode);\r\n                                    pNode.appendChild(tmpNode);\r\n                                    domUtils.setStyle(tmpNode, 'float', '');\r\n\r\n                                }\r\n\r\n\r\n                        }\r\n                    } else {\r\n                        var range = me.selection.getRange();\r\n                        range.selectNode(ci).select();\r\n                        me.execCommand('imagefloat', opt.imageBlockLine);\r\n                    }\r\n\r\n                }\r\n\r\n                //去掉冗余的标签\r\n                if (opt.removeEmptyNode) {\r\n                    if (opt.removeTagNames[ci.tagName.toLowerCase()] && domUtils.hasNoAttributes(ci) && domUtils.isEmptyBlock(ci)) {\r\n                        domUtils.remove(ci);\r\n                    }\r\n                }\r\n            }\r\n            if (opt.tobdc) {\r\n                var root = UE.htmlparser(cont.innerHTML);\r\n                root.traversal(function (node) {\r\n                    if (node.type == 'text') {\r\n                        node.data = ToDBC(node.data)\r\n                    }\r\n                });\r\n                cont.innerHTML = root.toHtml()\r\n            }\r\n            if (opt.bdc2sb) {\r\n                var root = UE.htmlparser(cont.innerHTML);\r\n                root.traversal(function (node) {\r\n                    if (node.type == 'text') {\r\n                        node.data = DBC2SB(node.data)\r\n                    }\r\n                });\r\n                cont.innerHTML = root.toHtml()\r\n            }\r\n            if (html) {\r\n                html.html = cont.innerHTML;\r\n            }\r\n        }\r\n        if (opt.pasteFilter) {\r\n            me.addListener('beforepaste', autotype);\r\n        }\r\n\r\n        function DBC2SB(str) {\r\n            var result = '';\r\n            for (var i = 0; i < str.length; i++) {\r\n                var code = str.charCodeAt(i); //获取当前字符的unicode编码\r\n                if (code >= 65281 && code <= 65373)//在这个unicode编码范围中的是所有的英文字母已经各种字符\r\n                {\r\n                    result += String.fromCharCode(str.charCodeAt(i) - 65248); //把全角字符的unicode编码转换为对应半角字符的unicode码\r\n                } else if (code == 12288)//空格\r\n                {\r\n                    result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);\r\n                } else {\r\n                    result += str.charAt(i);\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n        function ToDBC(txtstring) {\r\n            txtstring = utils.html(txtstring);\r\n            var tmp = \"\";\r\n            var mark = \"\";/*用于判断,如果是html尖括里的标记,则不进行全角的转换*/\r\n            for (var i = 0; i < txtstring.length; i++) {\r\n                if (txtstring.charCodeAt(i) == 32) {\r\n                    tmp = tmp + String.fromCharCode(12288);\r\n                }\r\n                else if (txtstring.charCodeAt(i) < 127) {\r\n                    tmp = tmp + String.fromCharCode(txtstring.charCodeAt(i) + 65248);\r\n                }\r\n                else {\r\n                    tmp += txtstring.charAt(i);\r\n                }\r\n            }\r\n            return tmp;\r\n        }\r\n\r\n        function readLocalOpts() {\r\n            var cookieOpt = me.getPreferences('autotypeset');\r\n            utils.extend(me.options.autotypeset, cookieOpt);\r\n        }\r\n\r\n        me.commands['autotypeset'] = {\r\n            execCommand: function () {\r\n                me.removeListener('beforepaste', autotype);\r\n                if (opt.pasteFilter) {\r\n                    me.addListener('beforepaste', autotype);\r\n                }\r\n                autotype.call(me)\r\n            }\r\n\r\n        };\r\n\r\n    };\r\n\r\n\r\n\r\n    // plugins/autosubmit.js\r\n    /**\r\n     * 快捷键提交\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 提交表单\r\n     * @command autosubmit\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'autosubmit' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugin.register('autosubmit', function () {\r\n        return {\r\n            shortcutkey: {\r\n                \"autosubmit\": \"ctrl+13\" //手动提交\r\n            },\r\n            commands: {\r\n                'autosubmit': {\r\n                    execCommand: function () {\r\n                        var me = this,\r\n                            form = domUtils.findParentByTagName(me.iframe, \"form\", false);\r\n                        if (form) {\r\n                            if (me.fireEvent(\"beforesubmit\") === false) {\r\n                                return;\r\n                            }\r\n                            me.sync();\r\n                            form.submit();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/background.js\r\n    /**\r\n     * 背景插件，为UEditor提供设置背景功能\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    UE.plugin.register('background', function () {\r\n        var me = this,\r\n            cssRuleId = 'editor_background',\r\n            isSetColored,\r\n            reg = new RegExp('body[\\\\s]*\\\\{(.+)\\\\}', 'i');\r\n\r\n        function stringToObj(str) {\r\n            var obj = {}, styles = str.split(';');\r\n            utils.each(styles, function (v) {\r\n                var index = v.indexOf(':'),\r\n                    key = utils.trim(v.substr(0, index)).toLowerCase();\r\n                key && (obj[key] = utils.trim(v.substr(index + 1) || ''));\r\n            });\r\n            return obj;\r\n        }\r\n\r\n        function setBackground(obj) {\r\n            if (obj) {\r\n                var styles = [];\r\n                for (var name in obj) {\r\n                    if (obj.hasOwnProperty(name)) {\r\n                        styles.push(name + \":\" + obj[name] + '; ');\r\n                    }\r\n                }\r\n                utils.cssRule(cssRuleId, styles.length ? ('body{' + styles.join(\"\") + '}') : '', me.document);\r\n            } else {\r\n                utils.cssRule(cssRuleId, '', me.document)\r\n            }\r\n        }\r\n        //重写editor.hasContent方法\r\n\r\n        var orgFn = me.hasContents;\r\n        me.hasContents = function () {\r\n            if (me.queryCommandValue('background')) {\r\n                return true\r\n            }\r\n            return orgFn.apply(me, arguments);\r\n        };\r\n        return {\r\n            bindEvents: {\r\n                'getAllHtml': function (type, headHtml) {\r\n                    var body = this.body,\r\n                        su = domUtils.getComputedStyle(body, \"background-image\"),\r\n                        url = \"\";\r\n                    if (su.indexOf(me.options.imagePath) > 0) {\r\n                        url = su.substring(su.indexOf(me.options.imagePath), su.length - 1).replace(/\"|\\(|\\)/ig, \"\");\r\n                    } else {\r\n                        url = su != \"none\" ? su.replace(/url\\(\"?|\"?\\)/ig, \"\") : \"\";\r\n                    }\r\n                    var html = '<style type=\"text/css\">body{';\r\n                    var bgObj = {\r\n                        \"background-color\": domUtils.getComputedStyle(body, \"background-color\") || \"#ffffff\",\r\n                        'background-image': url ? 'url(' + url + ')' : '',\r\n                        'background-repeat': domUtils.getComputedStyle(body, \"background-repeat\") || \"\",\r\n                        'background-position': browser.ie ? (domUtils.getComputedStyle(body, \"background-position-x\") + \" \" + domUtils.getComputedStyle(body, \"background-position-y\")) : domUtils.getComputedStyle(body, \"background-position\"),\r\n                        'height': domUtils.getComputedStyle(body, \"height\")\r\n                    };\r\n                    for (var name in bgObj) {\r\n                        if (bgObj.hasOwnProperty(name)) {\r\n                            html += name + \":\" + bgObj[name] + \"; \";\r\n                        }\r\n                    }\r\n                    html += '}</style> ';\r\n                    headHtml.push(html);\r\n                },\r\n                'aftersetcontent': function () {\r\n                    if (isSetColored == false) setBackground();\r\n                }\r\n            },\r\n            inputRule: function (root) {\r\n                isSetColored = false;\r\n                utils.each(root.getNodesByTagName('p'), function (p) {\r\n                    var styles = p.getAttr('data-background');\r\n                    if (styles) {\r\n                        isSetColored = true;\r\n                        setBackground(stringToObj(styles));\r\n                        p.parentNode.removeChild(p);\r\n                    }\r\n                })\r\n            },\r\n            outputRule: function (root) {\r\n                var me = this,\r\n                    styles = (utils.cssRule(cssRuleId, me.document) || '').replace(/[\\n\\r]+/g, '').match(reg);\r\n                if (styles) {\r\n                    root.appendChild(UE.uNode.createElement('<p style=\"display:none;\" data-background=\"' + utils.trim(styles[1].replace(/\"/g, '').replace(/[\\s]+/g, ' ')) + '\"><br/></p>'));\r\n                }\r\n            },\r\n            commands: {\r\n                'background': {\r\n                    execCommand: function (cmd, obj) {\r\n                        setBackground(obj);\r\n                    },\r\n                    queryCommandValue: function () {\r\n                        var me = this,\r\n                            styles = (utils.cssRule(cssRuleId, me.document) || '').replace(/[\\n\\r]+/g, '').match(reg);\r\n                        return styles ? stringToObj(styles[1]) : null;\r\n                    },\r\n                    notNeedUndo: true\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/image.js\r\n    /**\r\n     * 图片插入、排版插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 图片对齐方式\r\n     * @command imagefloat\r\n     * @method execCommand\r\n     * @remind 值center为独占一行居中\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } align 对齐方式，可传left、right、none、center\r\n     * @remaind center表示图片独占一行\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'imagefloat', 'center' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 如果选区所在位置是图片区域\r\n     * @command imagefloat\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回图片对齐方式\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'imagefloat' );\r\n     * ```\r\n     */\r\n\r\n    UE.commands['imagefloat'] = {\r\n        execCommand: function (cmd, align) {\r\n            var me = this,\r\n                range = me.selection.getRange();\r\n            if (!range.collapsed) {\r\n                var img = range.getClosedNode();\r\n                if (img && img.tagName == 'IMG') {\r\n                    switch (align) {\r\n                        case 'left':\r\n                        case 'right':\r\n                        case 'none':\r\n                            var pN = img.parentNode, tmpNode, pre, next;\r\n                            while (dtd.$inline[pN.tagName] || pN.tagName == 'A') {\r\n                                pN = pN.parentNode;\r\n                            }\r\n                            tmpNode = pN;\r\n                            if (tmpNode.tagName == 'P' && domUtils.getStyle(tmpNode, 'text-align') == 'center') {\r\n                                if (!domUtils.isBody(tmpNode) && domUtils.getChildCount(tmpNode, function (node) {\r\n                                    return !domUtils.isBr(node) && !domUtils.isWhitespace(node);\r\n                                }) == 1) {\r\n                                    pre = tmpNode.previousSibling;\r\n                                    next = tmpNode.nextSibling;\r\n                                    if (pre && next && pre.nodeType == 1 && next.nodeType == 1 && pre.tagName == next.tagName && domUtils.isBlockElm(pre)) {\r\n                                        pre.appendChild(tmpNode.firstChild);\r\n                                        while (next.firstChild) {\r\n                                            pre.appendChild(next.firstChild);\r\n                                        }\r\n                                        domUtils.remove(tmpNode);\r\n                                        domUtils.remove(next);\r\n                                    } else {\r\n                                        domUtils.setStyle(tmpNode, 'text-align', '');\r\n                                    }\r\n\r\n\r\n                                }\r\n\r\n                                range.selectNode(img).select();\r\n                            }\r\n                            domUtils.setStyle(img, 'float', align == 'none' ? '' : align);\r\n                            if (align == 'none') {\r\n                                domUtils.removeAttributes(img, 'align');\r\n                            }\r\n\r\n                            break;\r\n                        case 'center':\r\n                            if (me.queryCommandValue('imagefloat') != 'center') {\r\n                                pN = img.parentNode;\r\n                                domUtils.setStyle(img, 'float', '');\r\n                                domUtils.removeAttributes(img, 'align');\r\n                                tmpNode = img;\r\n                                while (pN && domUtils.getChildCount(pN, function (node) {\r\n                                    return !domUtils.isBr(node) && !domUtils.isWhitespace(node);\r\n                                }) == 1\r\n                                    && (dtd.$inline[pN.tagName] || pN.tagName == 'A')) {\r\n                                    tmpNode = pN;\r\n                                    pN = pN.parentNode;\r\n                                }\r\n                                range.setStartBefore(tmpNode).setCursor(false);\r\n                                pN = me.document.createElement('div');\r\n                                pN.appendChild(tmpNode);\r\n                                domUtils.setStyle(tmpNode, 'float', '');\r\n\r\n                                me.execCommand('insertHtml', '<p id=\"_img_parent_tmp\" style=\"text-align:center\">' + pN.innerHTML + '</p>');\r\n\r\n                                tmpNode = me.document.getElementById('_img_parent_tmp');\r\n                                if (!tmpNode) {\r\n                                    return;\r\n                                }\r\n                                tmpNode.removeAttribute('id');\r\n                                tmpNode = tmpNode.firstChild;\r\n                                range.selectNode(tmpNode).select();\r\n                                //去掉后边多余的元素\r\n                                next = tmpNode.parentNode.nextSibling;\r\n                                if (next && domUtils.isEmptyNode(next)) {\r\n                                    domUtils.remove(next);\r\n                                }\r\n\r\n                            }\r\n\r\n                            break;\r\n                    }\r\n\r\n                }\r\n            }\r\n        },\r\n        queryCommandValue: function () {\r\n            var range = this.selection.getRange(),\r\n                startNode, floatStyle;\r\n            if (range.collapsed) {\r\n                return 'none';\r\n            }\r\n            startNode = range.getClosedNode();\r\n            if (startNode && startNode.nodeType == 1 && startNode.tagName == 'IMG') {\r\n                floatStyle = domUtils.getComputedStyle(startNode, 'float') || startNode.getAttribute('align');\r\n\r\n                if (floatStyle == 'none') {\r\n                    floatStyle = domUtils.getComputedStyle(startNode.parentNode, 'text-align') == 'center' ? 'center' : floatStyle;\r\n                }\r\n                return {\r\n                    left: 1,\r\n                    right: 1,\r\n                    center: 1\r\n                }[floatStyle] ? floatStyle : 'none';\r\n            }\r\n            return 'none';\r\n\r\n\r\n        },\r\n        queryCommandState: function () {\r\n            var range = this.selection.getRange(),\r\n                startNode;\r\n\r\n            if (range.collapsed) return -1;\r\n\r\n            startNode = range.getClosedNode();\r\n            if (startNode && startNode.nodeType == 1 && startNode.tagName == 'IMG') {\r\n                return 0;\r\n            }\r\n            return -1;\r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * 插入图片\r\n     * @command insertimage\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { Object } opt 属性键值对，这些属性都将被复制到当前插入图片\r\n     * @remind 该命令第二个参数可接受一个图片配置项对象的数组，可以插入多张图片，\r\n     * 此时数组的每一个元素都是一个Object类型的图片属性集合。\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'insertimage', {\r\n     *     src:'a/b/c.jpg',\r\n     *     width:'100',\r\n     *     height:'100'\r\n     * } );\r\n     * ```\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'insertimage', [{\r\n     *     src:'a/b/c.jpg',\r\n     *     width:'100',\r\n     *     height:'100'\r\n     * },{\r\n     *     src:'a/b/d.jpg',\r\n     *     width:'100',\r\n     *     height:'100'\r\n     * }] );\r\n     * ```\r\n     */\r\n\r\n    UE.commands['insertimage'] = {\r\n        execCommand: function (cmd, opt) {\r\n\r\n            opt = utils.isArray(opt) ? opt : [opt];\r\n            if (!opt.length) {\r\n                return;\r\n            }\r\n            var me = this,\r\n                range = me.selection.getRange(),\r\n                img = range.getClosedNode();\r\n\r\n            if (me.fireEvent('beforeinsertimage', opt) === true) {\r\n                return;\r\n            }\r\n\r\n            function unhtmlData(imgCi) {\r\n\r\n                utils.each('width,height,border,hspace,vspace'.split(','), function (item) {\r\n\r\n                    if (imgCi[item]) {\r\n                        imgCi[item] = parseInt(imgCi[item], 10) || 0;\r\n                    }\r\n                });\r\n\r\n                utils.each('src,_src'.split(','), function (item) {\r\n\r\n                    if (imgCi[item]) {\r\n                        imgCi[item] = utils.unhtmlForUrl(imgCi[item]);\r\n                    }\r\n                });\r\n                utils.each('title,alt'.split(','), function (item) {\r\n\r\n                    if (imgCi[item]) {\r\n                        imgCi[item] = utils.unhtml(imgCi[item]);\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (img && /img/i.test(img.tagName) && (img.className != \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1) && !img.getAttribute(\"word_img\")) {\r\n                var first = opt.shift();\r\n                var floatStyle = first['floatStyle'];\r\n                delete first['floatStyle'];\r\n                ////                img.style.border = (first.border||0) +\"px solid #000\";\r\n                ////                img.style.margin = (first.margin||0) +\"px\";\r\n                //                img.style.cssText += ';margin:' + (first.margin||0) +\"px;\" + 'border:' + (first.border||0) +\"px solid #000\";\r\n                domUtils.setAttributes(img, first);\r\n                me.execCommand('imagefloat', floatStyle);\r\n                if (opt.length > 0) {\r\n                    range.setStartAfter(img).setCursor(false, true);\r\n                    me.execCommand('insertimage', opt);\r\n                }\r\n\r\n            } else {\r\n                var html = [], str = '', ci;\r\n                ci = opt[0];\r\n                if (opt.length == 1) {\r\n                    unhtmlData(ci);\r\n\r\n                    str = '<img src=\"' + ci.src + '\" ' + (ci._src ? ' _src=\"' + ci._src + '\" ' : '') +\r\n                        (ci.width ? 'width=\"' + ci.width + '\" ' : '') +\r\n                        (ci.height ? ' height=\"' + ci.height + '\" ' : '') +\r\n                        (ci['floatStyle'] == 'left' || ci['floatStyle'] == 'right' ? ' style=\"float:' + ci['floatStyle'] + ';\"' : '') +\r\n                        (ci.title && ci.title != \"\" ? ' title=\"' + ci.title + '\"' : '') +\r\n                        (ci.border && ci.border != \"0\" ? ' border=\"' + ci.border + '\"' : '') +\r\n                        (ci.alt && ci.alt != \"\" ? ' alt=\"' + ci.alt + '\"' : '') +\r\n                        (ci.hspace && ci.hspace != \"0\" ? ' hspace = \"' + ci.hspace + '\"' : '') +\r\n                        (ci.vspace && ci.vspace != \"0\" ? ' vspace = \"' + ci.vspace + '\"' : '') + '/>';\r\n                    if (ci['floatStyle'] == 'center') {\r\n                        str = '<p style=\"text-align: center\">' + str + '</p>';\r\n                    }\r\n                    html.push(str);\r\n\r\n                } else {\r\n                    for (var i = 0; ci = opt[i++];) {\r\n                        unhtmlData(ci);\r\n                        str = '<p ' + (ci['floatStyle'] == 'center' ? 'style=\"text-align: center\" ' : '') + '><img src=\"' + ci.src + '\" ' +\r\n                            (ci.width ? 'width=\"' + ci.width + '\" ' : '') + (ci._src ? ' _src=\"' + ci._src + '\" ' : '') +\r\n                            (ci.height ? ' height=\"' + ci.height + '\" ' : '') +\r\n                            ' style=\"' + (ci['floatStyle'] && ci['floatStyle'] != 'center' ? 'float:' + ci['floatStyle'] + ';' : '') +\r\n                            (ci.border || '') + '\" ' +\r\n                            (ci.title ? ' title=\"' + ci.title + '\"' : '') + ' /></p>';\r\n                        html.push(str);\r\n                    }\r\n                }\r\n\r\n                me.execCommand('insertHtml', html.join(''));\r\n            }\r\n\r\n            me.fireEvent('afterinsertimage', opt)\r\n        }\r\n    };\r\n\r\n\r\n    // plugins/justify.js\r\n    /**\r\n     * 段落格式\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 段落对齐方式\r\n     * @command justify\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } align 对齐方式：left => 居左，right => 居右，center => 居中，justify => 两端对齐\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'justify', 'center' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 如果选区所在位置是段落区域，返回当前段落对齐方式\r\n     * @command justify\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回段落对齐方式\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'justify' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['justify'] = function () {\r\n        var me = this,\r\n            block = domUtils.isBlockElm,\r\n            defaultValue = {\r\n                left: 1,\r\n                right: 1,\r\n                center: 1,\r\n                justify: 1\r\n            },\r\n            doJustify = function (range, style) {\r\n                var bookmark = range.createBookmark(),\r\n                    filterFn = function (node) {\r\n                        return node.nodeType == 1 ? node.tagName.toLowerCase() != 'br' && !domUtils.isBookmarkNode(node) : !domUtils.isWhitespace(node);\r\n                    };\r\n\r\n                range.enlarge(true);\r\n                var bookmark2 = range.createBookmark(),\r\n                    current = domUtils.getNextDomNode(bookmark2.start, false, filterFn),\r\n                    tmpRange = range.cloneRange(),\r\n                    tmpNode;\r\n                while (current && !(domUtils.getPosition(current, bookmark2.end) & domUtils.POSITION_FOLLOWING)) {\r\n                    if (current.nodeType == 3 || !block(current)) {\r\n                        tmpRange.setStartBefore(current);\r\n                        while (current && current !== bookmark2.end && !block(current)) {\r\n                            tmpNode = current;\r\n                            current = domUtils.getNextDomNode(current, false, null, function (node) {\r\n                                return !block(node);\r\n                            });\r\n                        }\r\n                        tmpRange.setEndAfter(tmpNode);\r\n                        var common = tmpRange.getCommonAncestor();\r\n                        if (!domUtils.isBody(common) && block(common)) {\r\n                            domUtils.setStyles(common, utils.isString(style) ? { 'text-align': style } : style);\r\n                            current = common;\r\n                        } else {\r\n                            var p = range.document.createElement('p');\r\n                            domUtils.setStyles(p, utils.isString(style) ? { 'text-align': style } : style);\r\n                            var frag = tmpRange.extractContents();\r\n                            p.appendChild(frag);\r\n                            tmpRange.insertNode(p);\r\n                            current = p;\r\n                        }\r\n                        current = domUtils.getNextDomNode(current, false, filterFn);\r\n                    } else {\r\n                        current = domUtils.getNextDomNode(current, true, filterFn);\r\n                    }\r\n                }\r\n                return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);\r\n            };\r\n\r\n        UE.commands['justify'] = {\r\n            execCommand: function (cmdName, align) {\r\n                var range = this.selection.getRange(),\r\n                    txt;\r\n\r\n                //闭合时单独处理\r\n                if (range.collapsed) {\r\n                    txt = this.document.createTextNode('p');\r\n                    range.insertNode(txt);\r\n                }\r\n                doJustify(range, align);\r\n                if (txt) {\r\n                    range.setStartBefore(txt).collapse(true);\r\n                    domUtils.remove(txt);\r\n                }\r\n\r\n                range.select();\r\n\r\n\r\n                return true;\r\n            },\r\n            queryCommandValue: function () {\r\n                var startNode = this.selection.getStart(),\r\n                    value = domUtils.getComputedStyle(startNode, 'text-align');\r\n                return defaultValue[value] ? value : 'left';\r\n            },\r\n            queryCommandState: function () {\r\n                var start = this.selection.getStart(),\r\n                    cell = start && domUtils.findParentByTagName(start, [\"td\", \"th\", \"caption\"], true);\r\n\r\n                return cell ? -1 : 0;\r\n            }\r\n\r\n        };\r\n    };\r\n\r\n\r\n    // plugins/font.js\r\n    /**\r\n     * 字体颜色,背景色,字号,字体,下划线,删除线\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 字体颜色\r\n     * @command forecolor\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } value 色值(必须十六进制)\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'forecolor', '#000' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 返回选区字体颜色\r\n     * @command forecolor\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回字体颜色\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'forecolor' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体背景颜色\r\n     * @command backcolor\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } value 色值(必须十六进制)\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'backcolor', '#000' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 返回选区字体颜色\r\n     * @command backcolor\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回字体背景颜色\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'backcolor' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体大小\r\n     * @command fontsize\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } value 字体大小\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'fontsize', '14px' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 返回选区字体大小\r\n     * @command fontsize\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回字体大小\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'fontsize' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体样式\r\n     * @command fontfamily\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } value 字体样式\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'fontfamily', '微软雅黑' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 返回选区字体样式\r\n     * @command fontfamily\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回字体样式\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'fontfamily' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体下划线,与删除线互斥\r\n     * @command underline\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'underline' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体删除线,与下划线互斥\r\n     * @command strikethrough\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'strikethrough' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 字体边框\r\n     * @command fontborder\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'fontborder' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['font'] = function () {\r\n        var me = this,\r\n            fonts = {\r\n                'forecolor': 'color',\r\n                'backcolor': 'background-color',\r\n                'fontsize': 'font-size',\r\n                'fontfamily': 'font-family',\r\n                'underline': 'text-decoration',\r\n                'strikethrough': 'text-decoration',\r\n                'fontborder': 'border'\r\n            },\r\n            needCmd = { 'underline': 1, 'strikethrough': 1, 'fontborder': 1 },\r\n            needSetChild = {\r\n                'forecolor': 'color',\r\n                'backcolor': 'background-color',\r\n                'fontsize': 'font-size',\r\n                'fontfamily': 'font-family'\r\n\r\n            };\r\n        me.setOpt({\r\n            'fontfamily': [\r\n                { name: 'songti', val: '宋体,SimSun' },\r\n                { name: 'yahei', val: '微软雅黑,Microsoft YaHei' },\r\n                { name: 'kaiti', val: '楷体,楷体_GB2312, SimKai' },\r\n                { name: 'heiti', val: '黑体, SimHei' },\r\n                { name: 'lishu', val: '隶书, SimLi' },\r\n                { name: 'andaleMono', val: 'andale mono' },\r\n                { name: 'arial', val: 'arial, helvetica,sans-serif' },\r\n                { name: 'arialBlack', val: 'arial black,avant garde' },\r\n                { name: 'comicSansMs', val: 'comic sans ms' },\r\n                { name: 'impact', val: 'impact,chicago' },\r\n                { name: 'timesNewRoman', val: 'times new roman' }\r\n            ],\r\n            'fontsize': [10, 11, 12, 14, 16, 18, 20, 24, 36]\r\n        });\r\n\r\n        function mergeWithParent(node) {\r\n            var parent;\r\n            while (parent = node.parentNode) {\r\n                if (parent.tagName == 'SPAN' && domUtils.getChildCount(parent, function (child) {\r\n                    return !domUtils.isBookmarkNode(child) && !domUtils.isBr(child)\r\n                }) == 1) {\r\n                    parent.style.cssText += node.style.cssText;\r\n                    domUtils.remove(node, true);\r\n                    node = parent;\r\n\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n\r\n        }\r\n        function mergeChild(rng, cmdName, value) {\r\n            if (needSetChild[cmdName]) {\r\n                rng.adjustmentBoundary();\r\n                if (!rng.collapsed && rng.startContainer.nodeType == 1) {\r\n                    var start = rng.startContainer.childNodes[rng.startOffset];\r\n                    if (start && domUtils.isTagNode(start, 'span')) {\r\n                        var bk = rng.createBookmark();\r\n                        utils.each(domUtils.getElementsByTagName(start, 'span'), function (span) {\r\n                            if (!span.parentNode || domUtils.isBookmarkNode(span)) return;\r\n                            if (cmdName == 'backcolor' && domUtils.getComputedStyle(span, 'background-color').toLowerCase() === value) {\r\n                                return;\r\n                            }\r\n                            domUtils.removeStyle(span, needSetChild[cmdName]);\r\n                            if (span.style.cssText.replace(/^\\s+$/, '').length == 0) {\r\n                                domUtils.remove(span, true)\r\n                            }\r\n                        });\r\n                        rng.moveToBookmark(bk)\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n        function mergesibling(rng, cmdName, value) {\r\n            var collapsed = rng.collapsed,\r\n                bk = rng.createBookmark(), common;\r\n            if (collapsed) {\r\n                common = bk.start.parentNode;\r\n                while (dtd.$inline[common.tagName]) {\r\n                    common = common.parentNode;\r\n                }\r\n            } else {\r\n                common = domUtils.getCommonAncestor(bk.start, bk.end);\r\n            }\r\n            utils.each(domUtils.getElementsByTagName(common, 'span'), function (span) {\r\n                if (!span.parentNode || domUtils.isBookmarkNode(span)) return;\r\n                if (/\\s*border\\s*:\\s*none;?\\s*/i.test(span.style.cssText)) {\r\n                    if (/^\\s*border\\s*:\\s*none;?\\s*$/.test(span.style.cssText)) {\r\n                        domUtils.remove(span, true);\r\n                    } else {\r\n                        domUtils.removeStyle(span, 'border');\r\n                    }\r\n                    return\r\n                }\r\n                if (/border/i.test(span.style.cssText) && span.parentNode.tagName == 'SPAN' && /border/i.test(span.parentNode.style.cssText)) {\r\n                    span.style.cssText = span.style.cssText.replace(/border[^:]*:[^;]+;?/gi, '');\r\n                }\r\n                if (!(cmdName == 'fontborder' && value == 'none')) {\r\n                    var next = span.nextSibling;\r\n                    while (next && next.nodeType == 1 && next.tagName == 'SPAN') {\r\n                        if (domUtils.isBookmarkNode(next) && cmdName == 'fontborder') {\r\n                            span.appendChild(next);\r\n                            next = span.nextSibling;\r\n                            continue;\r\n                        }\r\n                        if (next.style.cssText == span.style.cssText) {\r\n                            domUtils.moveChild(next, span);\r\n                            domUtils.remove(next);\r\n                        }\r\n                        if (span.nextSibling === next)\r\n                            break;\r\n                        next = span.nextSibling;\r\n                    }\r\n                }\r\n\r\n\r\n                mergeWithParent(span);\r\n                if (browser.ie && browser.version > 8) {\r\n                    //拷贝父亲们的特别的属性,这里只做背景颜色的处理\r\n                    var parent = domUtils.findParent(span, function (n) { return n.tagName == 'SPAN' && /background-color/.test(n.style.cssText) });\r\n                    if (parent && !/background-color/.test(span.style.cssText)) {\r\n                        span.style.backgroundColor = parent.style.backgroundColor;\r\n                    }\r\n                }\r\n\r\n            });\r\n            rng.moveToBookmark(bk);\r\n            mergeChild(rng, cmdName, value)\r\n        }\r\n\r\n        me.addInputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('u s del font strike'), function (node) {\r\n                if (node.tagName == 'font') {\r\n                    var cssStyle = [];\r\n                    for (var p in node.attrs) {\r\n                        switch (p) {\r\n                            case 'size':\r\n                                cssStyle.push('font-size:' +\r\n                                    ({\r\n                                        '1': '10',\r\n                                        '2': '12',\r\n                                        '3': '16',\r\n                                        '4': '18',\r\n                                        '5': '24',\r\n                                        '6': '32',\r\n                                        '7': '48'\r\n                                    }[node.attrs[p]] || node.attrs[p]) + 'px');\r\n                                break;\r\n                            case 'color':\r\n                                cssStyle.push('color:' + node.attrs[p]);\r\n                                break;\r\n                            case 'face':\r\n                                cssStyle.push('font-family:' + node.attrs[p]);\r\n                                break;\r\n                            case 'style':\r\n                                cssStyle.push(node.attrs[p]);\r\n                        }\r\n                    }\r\n                    node.attrs = {\r\n                        'style': cssStyle.join(';')\r\n                    };\r\n                } else {\r\n                    var val = node.tagName == 'u' ? 'underline' : 'line-through';\r\n                    node.attrs = {\r\n                        'style': (node.getAttr('style') || '') + 'text-decoration:' + val + ';'\r\n                    }\r\n                }\r\n                node.tagName = 'span';\r\n            });\r\n            //        utils.each(root.getNodesByTagName('span'), function (node) {\r\n            //            var val;\r\n            //            if(val = node.getAttr('class')){\r\n            //                if(/fontstrikethrough/.test(val)){\r\n            //                    node.setStyle('text-decoration','line-through');\r\n            //                    if(node.attrs['class']){\r\n            //                        node.attrs['class'] = node.attrs['class'].replace(/fontstrikethrough/,'');\r\n            //                    }else{\r\n            //                        node.setAttr('class')\r\n            //                    }\r\n            //                }\r\n            //                if(/fontborder/.test(val)){\r\n            //                    node.setStyle('border','1px solid #000');\r\n            //                    if(node.attrs['class']){\r\n            //                        node.attrs['class'] = node.attrs['class'].replace(/fontborder/,'');\r\n            //                    }else{\r\n            //                        node.setAttr('class')\r\n            //                    }\r\n            //                }\r\n            //            }\r\n            //        });\r\n        });\r\n        //    me.addOutputRule(function(root){\r\n        //        utils.each(root.getNodesByTagName('span'), function (node) {\r\n        //            var val;\r\n        //            if(val = node.getStyle('text-decoration')){\r\n        //                if(/line-through/.test(val)){\r\n        //                    if(node.attrs['class']){\r\n        //                        node.attrs['class'] += ' fontstrikethrough';\r\n        //                    }else{\r\n        //                        node.setAttr('class','fontstrikethrough')\r\n        //                    }\r\n        //                }\r\n        //\r\n        //                node.setStyle('text-decoration')\r\n        //            }\r\n        //            if(val = node.getStyle('border')){\r\n        //                if(/1px/.test(val) && /solid/.test(val)){\r\n        //                    if(node.attrs['class']){\r\n        //                        node.attrs['class'] += ' fontborder';\r\n        //\r\n        //                    }else{\r\n        //                        node.setAttr('class','fontborder')\r\n        //                    }\r\n        //                }\r\n        //                node.setStyle('border')\r\n        //\r\n        //            }\r\n        //        });\r\n        //    });\r\n        for (var p in fonts) {\r\n            (function (cmd, style) {\r\n                UE.commands[cmd] = {\r\n                    execCommand: function (cmdName, value) {\r\n                        value = value || (this.queryCommandState(cmdName) ? 'none' : cmdName == 'underline' ? 'underline' :\r\n                            cmdName == 'fontborder' ? '1px solid #000' :\r\n                                'line-through');\r\n                        var me = this,\r\n                            range = this.selection.getRange(),\r\n                            text;\r\n\r\n                        if (value == 'default') {\r\n\r\n                            if (range.collapsed) {\r\n                                text = me.document.createTextNode('font');\r\n                                range.insertNode(text).select();\r\n\r\n                            }\r\n                            me.execCommand('removeFormat', 'span,a', style);\r\n                            if (text) {\r\n                                range.setStartBefore(text).collapse(true);\r\n                                domUtils.remove(text);\r\n                            }\r\n                            mergesibling(range, cmdName, value);\r\n                            range.select()\r\n                        } else {\r\n                            if (!range.collapsed) {\r\n                                if (needCmd[cmd] && me.queryCommandValue(cmd)) {\r\n                                    me.execCommand('removeFormat', 'span,a', style);\r\n                                }\r\n                                range = me.selection.getRange();\r\n\r\n                                range.applyInlineStyle('span', { 'style': style + ':' + value });\r\n                                mergesibling(range, cmdName, value);\r\n                                range.select();\r\n                            } else {\r\n\r\n                                var span = domUtils.findParentByTagName(range.startContainer, 'span', true);\r\n                                text = me.document.createTextNode('font');\r\n                                if (span && !span.children.length && !span[browser.ie ? 'innerText' : 'textContent'].replace(fillCharReg, '').length) {\r\n                                    //for ie hack when enter\r\n                                    range.insertNode(text);\r\n                                    if (needCmd[cmd]) {\r\n                                        range.selectNode(text).select();\r\n                                        me.execCommand('removeFormat', 'span,a', style, null);\r\n\r\n                                        span = domUtils.findParentByTagName(text, 'span', true);\r\n                                        range.setStartBefore(text);\r\n\r\n                                    }\r\n                                    span && (span.style.cssText += ';' + style + ':' + value);\r\n                                    range.collapse(true).select();\r\n\r\n\r\n                                } else {\r\n                                    range.insertNode(text);\r\n                                    range.selectNode(text).select();\r\n                                    span = range.document.createElement('span');\r\n\r\n                                    if (needCmd[cmd]) {\r\n                                        //a标签内的不处理跳过\r\n                                        if (domUtils.findParentByTagName(text, 'a', true)) {\r\n                                            range.setStartBefore(text).setCursor();\r\n                                            domUtils.remove(text);\r\n                                            return;\r\n                                        }\r\n                                        me.execCommand('removeFormat', 'span,a', style);\r\n                                    }\r\n\r\n                                    span.style.cssText = style + ':' + value;\r\n\r\n\r\n                                    text.parentNode.insertBefore(span, text);\r\n                                    //修复，span套span 但样式不继承的问题\r\n                                    if (!browser.ie || browser.ie && browser.version == 9) {\r\n                                        var spanParent = span.parentNode;\r\n                                        while (!domUtils.isBlockElm(spanParent)) {\r\n                                            if (spanParent.tagName == 'SPAN') {\r\n                                                //opera合并style不会加入\";\"\r\n                                                span.style.cssText = spanParent.style.cssText + \";\" + span.style.cssText;\r\n                                            }\r\n                                            spanParent = spanParent.parentNode;\r\n                                        }\r\n                                    }\r\n\r\n\r\n                                    if (opera) {\r\n                                        setTimeout(function () {\r\n                                            range.setStart(span, 0).collapse(true);\r\n                                            mergesibling(range, cmdName, value);\r\n                                            range.select();\r\n                                        });\r\n                                    } else {\r\n                                        range.setStart(span, 0).collapse(true);\r\n                                        mergesibling(range, cmdName, value);\r\n                                        range.select();\r\n                                    }\r\n\r\n                                    //trace:981\r\n                                    //domUtils.mergeToParent(span)\r\n                                }\r\n                                domUtils.remove(text);\r\n                            }\r\n\r\n\r\n                        }\r\n                        return true;\r\n                    },\r\n                    queryCommandValue: function (cmdName) {\r\n                        var startNode = this.selection.getStart();\r\n\r\n                        //trace:946\r\n                        if (cmdName == 'underline' || cmdName == 'strikethrough') {\r\n                            var tmpNode = startNode, value;\r\n                            while (tmpNode && !domUtils.isBlockElm(tmpNode) && !domUtils.isBody(tmpNode)) {\r\n                                if (tmpNode.nodeType == 1) {\r\n                                    value = domUtils.getComputedStyle(tmpNode, style);\r\n                                    if (value != 'none') {\r\n                                        return value;\r\n                                    }\r\n                                }\r\n\r\n                                tmpNode = tmpNode.parentNode;\r\n                            }\r\n                            return 'none';\r\n                        }\r\n                        if (cmdName == 'fontborder') {\r\n                            var tmp = startNode, val;\r\n                            while (tmp && dtd.$inline[tmp.tagName]) {\r\n                                if (val = domUtils.getComputedStyle(tmp, 'border')) {\r\n\r\n                                    if (/1px/.test(val) && /solid/.test(val)) {\r\n                                        return val;\r\n                                    }\r\n                                }\r\n                                tmp = tmp.parentNode;\r\n                            }\r\n                            return ''\r\n                        }\r\n\r\n                        if (cmdName == 'FontSize') {\r\n                            var styleVal = domUtils.getComputedStyle(startNode, style),\r\n                                tmp = /^([\\d\\.]+)(\\w+)$/.exec(styleVal);\r\n\r\n                            if (tmp) {\r\n\r\n                                return Math.floor(tmp[1]) + tmp[2];\r\n\r\n                            }\r\n\r\n                            return styleVal;\r\n\r\n                        }\r\n\r\n                        return domUtils.getComputedStyle(startNode, style);\r\n                    },\r\n                    queryCommandState: function (cmdName) {\r\n                        if (!needCmd[cmdName])\r\n                            return 0;\r\n                        var val = this.queryCommandValue(cmdName);\r\n                        if (cmdName == 'fontborder') {\r\n                            return /1px/.test(val) && /solid/.test(val)\r\n                        } else {\r\n                            return cmdName == 'underline' ? /underline/.test(val) : /line\\-through/.test(val);\r\n\r\n                        }\r\n\r\n                    }\r\n                };\r\n            })(p, fonts[p]);\r\n        }\r\n    };\r\n\r\n    // plugins/link.js\r\n    /**\r\n     * 超链接\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 插入超链接\r\n     * @command link\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { Object } options   设置自定义属性，例如：url、title、target\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'link', '{\r\n     *     url:'ueditor.baidu.com',\r\n     *     title:'ueditor',\r\n     *     target:'_blank'\r\n     * }' );\r\n     * ```\r\n     */\r\n    /**\r\n     * 返回当前选中的第一个超链接节点\r\n     * @command link\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { Element } 超链接节点\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'link' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 取消超链接\r\n     * @command unlink\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'unlink');\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['link'] = function () {\r\n        function optimize(range) {\r\n            var start = range.startContainer, end = range.endContainer;\r\n\r\n            if (start = domUtils.findParentByTagName(start, 'a', true)) {\r\n                range.setStartBefore(start);\r\n            }\r\n            if (end = domUtils.findParentByTagName(end, 'a', true)) {\r\n                range.setEndAfter(end);\r\n            }\r\n        }\r\n\r\n\r\n        UE.commands['unlink'] = {\r\n            execCommand: function () {\r\n                var range = this.selection.getRange(),\r\n                    bookmark;\r\n                if (range.collapsed && !domUtils.findParentByTagName(range.startContainer, 'a', true)) {\r\n                    return;\r\n                }\r\n                bookmark = range.createBookmark();\r\n                optimize(range);\r\n                range.removeInlineStyle('a').moveToBookmark(bookmark).select();\r\n            },\r\n            queryCommandState: function () {\r\n                return !this.highlight && this.queryCommandValue('link') ? 0 : -1;\r\n            }\r\n\r\n        };\r\n        function doLink(range, opt, me) {\r\n            var rngClone = range.cloneRange(),\r\n                link = me.queryCommandValue('link');\r\n            optimize(range = range.adjustmentBoundary());\r\n            var start = range.startContainer;\r\n            if (start.nodeType == 1 && link) {\r\n                start = start.childNodes[range.startOffset];\r\n                if (start && start.nodeType == 1 && start.tagName == 'A' && /^(?:https?|ftp|file)\\s*:\\s*\\/\\//.test(start[browser.ie ? 'innerText' : 'textContent'])) {\r\n                    start[browser.ie ? 'innerText' : 'textContent'] = utils.html(opt.textValue || opt.href);\r\n\r\n                }\r\n            }\r\n            if (!rngClone.collapsed || link) {\r\n                range.removeInlineStyle('a');\r\n                rngClone = range.cloneRange();\r\n            }\r\n\r\n            if (rngClone.collapsed) {\r\n                var a = range.document.createElement('a'),\r\n                    text = '';\r\n                if (opt.textValue) {\r\n\r\n                    text = utils.html(opt.textValue);\r\n                    delete opt.textValue;\r\n                } else {\r\n                    text = utils.html(opt.href);\r\n\r\n                }\r\n                domUtils.setAttributes(a, opt);\r\n                start = domUtils.findParentByTagName(rngClone.startContainer, 'a', true);\r\n                if (start && domUtils.isInNodeEndBoundary(rngClone, start)) {\r\n                    range.setStartAfter(start).collapse(true);\r\n\r\n                }\r\n                a[browser.ie ? 'innerText' : 'textContent'] = text;\r\n                range.insertNode(a).selectNode(a);\r\n            } else {\r\n                range.applyInlineStyle('a', opt);\r\n\r\n            }\r\n        }\r\n        UE.commands['link'] = {\r\n            execCommand: function (cmdName, opt) {\r\n                var range;\r\n                opt._href && (opt._href = utils.unhtml(opt._href, /[<\">]/g));\r\n                opt.href && (opt.href = utils.unhtml(opt.href, /[<\">]/g));\r\n                opt.textValue && (opt.textValue = utils.unhtml(opt.textValue, /[<\">]/g));\r\n                doLink(range = this.selection.getRange(), opt, this);\r\n                //闭合都不加占位符，如果加了会在a后边多个占位符节点，导致a是图片背景组成的列表，出现空白问题\r\n                range.collapse().select(true);\r\n\r\n            },\r\n            queryCommandValue: function () {\r\n                var range = this.selection.getRange(),\r\n                    node;\r\n                if (range.collapsed) {\r\n                    //                    node = this.selection.getStart();\r\n                    //在ie下getstart()取值偏上了\r\n                    node = range.startContainer;\r\n                    node = node.nodeType == 1 ? node : node.parentNode;\r\n\r\n                    if (node && (node = domUtils.findParentByTagName(node, 'a', true)) && !domUtils.isInNodeEndBoundary(range, node)) {\r\n\r\n                        return node;\r\n                    }\r\n                } else {\r\n                    //trace:1111  如果是<p><a>xx</a></p> startContainer是p就会找不到a\r\n                    range.shrinkBoundary();\r\n                    var start = range.startContainer.nodeType == 3 || !range.startContainer.childNodes[range.startOffset] ? range.startContainer : range.startContainer.childNodes[range.startOffset],\r\n                        end = range.endContainer.nodeType == 3 || range.endOffset == 0 ? range.endContainer : range.endContainer.childNodes[range.endOffset - 1],\r\n                        common = range.getCommonAncestor();\r\n                    node = domUtils.findParentByTagName(common, 'a', true);\r\n                    if (!node && common.nodeType == 1) {\r\n\r\n                        var as = common.getElementsByTagName('a'),\r\n                            ps, pe;\r\n\r\n                        for (var i = 0, ci; ci = as[i++];) {\r\n                            ps = domUtils.getPosition(ci, start), pe = domUtils.getPosition(ci, end);\r\n                            if ((ps & domUtils.POSITION_FOLLOWING || ps & domUtils.POSITION_CONTAINS)\r\n                                &&\r\n                                (pe & domUtils.POSITION_PRECEDING || pe & domUtils.POSITION_CONTAINS)\r\n                            ) {\r\n                                node = ci;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    return node;\r\n                }\r\n\r\n            },\r\n            queryCommandState: function () {\r\n                //判断如果是视频的话连接不可用\r\n                //fix 853\r\n                var img = this.selection.getRange().getClosedNode(),\r\n                    flag = img && (img.className == \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1);\r\n                return flag ? -1 : 0;\r\n            }\r\n        };\r\n    };\r\n\r\n    // plugins/iframe.js\r\n    ///import core\r\n    ///import plugins\\inserthtml.js\r\n    ///commands 插入框架\r\n    ///commandsName  InsertFrame\r\n    ///commandsTitle  插入Iframe\r\n    ///commandsDialog  dialogs\\insertframe\r\n\r\n    UE.plugins['insertframe'] = function () {\r\n        var me = this;\r\n        function deleteIframe() {\r\n            me._iframe && delete me._iframe;\r\n        }\r\n\r\n        me.addListener(\"selectionchange\", function () {\r\n            deleteIframe();\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n    // plugins/scrawl.js\r\n    ///import core\r\n    ///commands 涂鸦\r\n    ///commandsName  Scrawl\r\n    ///commandsTitle  涂鸦\r\n    ///commandsDialog  dialogs\\scrawl\r\n    UE.commands['scrawl'] = {\r\n        queryCommandState: function () {\r\n            return (browser.ie && browser.version <= 8) ? -1 : 0;\r\n        }\r\n    };\r\n\r\n\r\n    // plugins/removeformat.js\r\n    /**\r\n     * 清除格式\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 清除文字样式\r\n     * @command removeformat\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param   {String}   tags     以逗号隔开的标签。如：strong\r\n     * @param   {String}   style    样式如：color\r\n     * @param   {String}   attrs    属性如:width\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'removeformat', 'strong','color','width' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['removeformat'] = function () {\r\n        var me = this;\r\n        me.setOpt({\r\n            'removeFormatTags': 'b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var',\r\n            'removeFormatAttributes': 'class,style,lang,width,height,align,hspace,valign'\r\n        });\r\n        me.commands['removeformat'] = {\r\n            execCommand: function (cmdName, tags, style, attrs, notIncludeA) {\r\n\r\n                var tagReg = new RegExp('^(?:' + (tags || this.options.removeFormatTags).replace(/,/g, '|') + ')$', 'i'),\r\n                    removeFormatAttributes = style ? [] : (attrs || this.options.removeFormatAttributes).split(','),\r\n                    range = new dom.Range(this.document),\r\n                    bookmark, node, parent,\r\n                    filter = function (node) {\r\n                        return node.nodeType == 1;\r\n                    };\r\n\r\n                function isRedundantSpan(node) {\r\n                    if (node.nodeType == 3 || node.tagName.toLowerCase() != 'span') {\r\n                        return 0;\r\n                    }\r\n                    if (browser.ie) {\r\n                        //ie 下判断实效，所以只能简单用style来判断\r\n                        //return node.style.cssText == '' ? 1 : 0;\r\n                        var attrs = node.attributes;\r\n                        if (attrs.length) {\r\n                            for (var i = 0, l = attrs.length; i < l; i++) {\r\n                                if (attrs[i].specified) {\r\n                                    return 0;\r\n                                }\r\n                            }\r\n                            return 1;\r\n                        }\r\n                    }\r\n                    return !node.attributes.length;\r\n                }\r\n                function doRemove(range) {\r\n\r\n                    var bookmark1 = range.createBookmark();\r\n                    if (range.collapsed) {\r\n                        range.enlarge(true);\r\n                    }\r\n\r\n                    //不能把a标签切了\r\n                    if (!notIncludeA) {\r\n                        var aNode = domUtils.findParentByTagName(range.startContainer, 'a', true);\r\n                        if (aNode) {\r\n                            range.setStartBefore(aNode);\r\n                        }\r\n\r\n                        aNode = domUtils.findParentByTagName(range.endContainer, 'a', true);\r\n                        if (aNode) {\r\n                            range.setEndAfter(aNode);\r\n                        }\r\n\r\n                    }\r\n\r\n\r\n                    bookmark = range.createBookmark();\r\n\r\n                    node = bookmark.start;\r\n\r\n                    //切开始\r\n                    while ((parent = node.parentNode) && !domUtils.isBlockElm(parent)) {\r\n                        domUtils.breakParent(node, parent);\r\n\r\n                        domUtils.clearEmptySibling(node);\r\n                    }\r\n                    if (bookmark.end) {\r\n                        //切结束\r\n                        node = bookmark.end;\r\n                        while ((parent = node.parentNode) && !domUtils.isBlockElm(parent)) {\r\n                            domUtils.breakParent(node, parent);\r\n                            domUtils.clearEmptySibling(node);\r\n                        }\r\n\r\n                        //开始去除样式\r\n                        var current = domUtils.getNextDomNode(bookmark.start, false, filter),\r\n                            next;\r\n                        while (current) {\r\n                            if (current == bookmark.end) {\r\n                                break;\r\n                            }\r\n\r\n                            next = domUtils.getNextDomNode(current, true, filter);\r\n\r\n                            if (!dtd.$empty[current.tagName.toLowerCase()] && !domUtils.isBookmarkNode(current)) {\r\n                                if (tagReg.test(current.tagName)) {\r\n                                    if (style) {\r\n                                        domUtils.removeStyle(current, style);\r\n                                        if (isRedundantSpan(current) && style != 'text-decoration') {\r\n                                            domUtils.remove(current, true);\r\n                                        }\r\n                                    } else {\r\n                                        domUtils.remove(current, true);\r\n                                    }\r\n                                } else {\r\n                                    //trace:939  不能把list上的样式去掉\r\n                                    if (!dtd.$tableContent[current.tagName] && !dtd.$list[current.tagName]) {\r\n                                        domUtils.removeAttributes(current, removeFormatAttributes);\r\n                                        if (isRedundantSpan(current)) {\r\n                                            domUtils.remove(current, true);\r\n                                        }\r\n                                    }\r\n\r\n                                }\r\n                            }\r\n                            current = next;\r\n                        }\r\n                    }\r\n                    //trace:1035\r\n                    //trace:1096 不能把td上的样式去掉，比如边框\r\n                    var pN = bookmark.start.parentNode;\r\n                    if (domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName] && !dtd.$list[pN.tagName]) {\r\n                        domUtils.removeAttributes(pN, removeFormatAttributes);\r\n                    }\r\n                    pN = bookmark.end.parentNode;\r\n                    if (bookmark.end && domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName] && !dtd.$list[pN.tagName]) {\r\n                        domUtils.removeAttributes(pN, removeFormatAttributes);\r\n                    }\r\n                    range.moveToBookmark(bookmark).moveToBookmark(bookmark1);\r\n                    //清除冗余的代码 <b><bookmark></b>\r\n                    var node = range.startContainer,\r\n                        tmp,\r\n                        collapsed = range.collapsed;\r\n                    while (node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]) {\r\n                        tmp = node.parentNode;\r\n                        range.setStartBefore(node);\r\n                        //trace:937\r\n                        //更新结束边界\r\n                        if (range.startContainer === range.endContainer) {\r\n                            range.endOffset--;\r\n                        }\r\n                        domUtils.remove(node);\r\n                        node = tmp;\r\n                    }\r\n\r\n                    if (!collapsed) {\r\n                        node = range.endContainer;\r\n                        while (node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]) {\r\n                            tmp = node.parentNode;\r\n                            range.setEndBefore(node);\r\n                            domUtils.remove(node);\r\n\r\n                            node = tmp;\r\n                        }\r\n\r\n\r\n                    }\r\n                }\r\n\r\n\r\n\r\n                range = this.selection.getRange();\r\n                doRemove(range);\r\n                range.select();\r\n\r\n            }\r\n\r\n        };\r\n\r\n    };\r\n\r\n\r\n    // plugins/blockquote.js\r\n    /**\r\n     * 添加引用\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 添加引用\r\n     * @command blockquote\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'blockquote' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 添加引用\r\n     * @command blockquote\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { Object } attrs 节点属性\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'blockquote',{\r\n     *     style: \"color: red;\"\r\n     * } );\r\n     * ```\r\n     */\r\n\r\n\r\n    UE.plugins['blockquote'] = function () {\r\n        var me = this;\r\n        function getObj(editor) {\r\n            return domUtils.filterNodeList(editor.selection.getStartElementPath(), 'blockquote');\r\n        }\r\n        me.commands['blockquote'] = {\r\n            execCommand: function (cmdName, attrs) {\r\n                var range = this.selection.getRange(),\r\n                    obj = getObj(this),\r\n                    blockquote = dtd.blockquote,\r\n                    bookmark = range.createBookmark();\r\n\r\n                if (obj) {\r\n\r\n                    var start = range.startContainer,\r\n                        startBlock = domUtils.isBlockElm(start) ? start : domUtils.findParent(start, function (node) { return domUtils.isBlockElm(node) }),\r\n\r\n                        end = range.endContainer,\r\n                        endBlock = domUtils.isBlockElm(end) ? end : domUtils.findParent(end, function (node) { return domUtils.isBlockElm(node) });\r\n\r\n                    //处理一下li\r\n                    startBlock = domUtils.findParentByTagName(startBlock, 'li', true) || startBlock;\r\n                    endBlock = domUtils.findParentByTagName(endBlock, 'li', true) || endBlock;\r\n\r\n\r\n                    if (startBlock.tagName == 'LI' || startBlock.tagName == 'TD' || startBlock === obj || domUtils.isBody(startBlock)) {\r\n                        domUtils.remove(obj, true);\r\n                    } else {\r\n                        domUtils.breakParent(startBlock, obj);\r\n                    }\r\n\r\n                    if (startBlock !== endBlock) {\r\n                        obj = domUtils.findParentByTagName(endBlock, 'blockquote');\r\n                        if (obj) {\r\n                            if (endBlock.tagName == 'LI' || endBlock.tagName == 'TD' || domUtils.isBody(endBlock)) {\r\n                                obj.parentNode && domUtils.remove(obj, true);\r\n                            } else {\r\n                                domUtils.breakParent(endBlock, obj);\r\n                            }\r\n\r\n                        }\r\n                    }\r\n\r\n                    var blockquotes = domUtils.getElementsByTagName(this.document, 'blockquote');\r\n                    for (var i = 0, bi; bi = blockquotes[i++];) {\r\n                        if (!bi.childNodes.length) {\r\n                            domUtils.remove(bi);\r\n                        } else if (domUtils.getPosition(bi, startBlock) & domUtils.POSITION_FOLLOWING && domUtils.getPosition(bi, endBlock) & domUtils.POSITION_PRECEDING) {\r\n                            domUtils.remove(bi, true);\r\n                        }\r\n                    }\r\n\r\n\r\n\r\n\r\n                } else {\r\n\r\n                    var tmpRange = range.cloneRange(),\r\n                        node = tmpRange.startContainer.nodeType == 1 ? tmpRange.startContainer : tmpRange.startContainer.parentNode,\r\n                        preNode = node,\r\n                        doEnd = 1;\r\n\r\n                    //调整开始\r\n                    while (1) {\r\n                        if (domUtils.isBody(node)) {\r\n                            if (preNode !== node) {\r\n                                if (range.collapsed) {\r\n                                    tmpRange.selectNode(preNode);\r\n                                    doEnd = 0;\r\n                                } else {\r\n                                    tmpRange.setStartBefore(preNode);\r\n                                }\r\n                            } else {\r\n                                tmpRange.setStart(node, 0);\r\n                            }\r\n\r\n                            break;\r\n                        }\r\n                        if (!blockquote[node.tagName]) {\r\n                            if (range.collapsed) {\r\n                                tmpRange.selectNode(preNode);\r\n                            } else {\r\n                                tmpRange.setStartBefore(preNode);\r\n                            }\r\n                            break;\r\n                        }\r\n\r\n                        preNode = node;\r\n                        node = node.parentNode;\r\n                    }\r\n\r\n                    //调整结束\r\n                    if (doEnd) {\r\n                        preNode = node = node = tmpRange.endContainer.nodeType == 1 ? tmpRange.endContainer : tmpRange.endContainer.parentNode;\r\n                        while (1) {\r\n\r\n                            if (domUtils.isBody(node)) {\r\n                                if (preNode !== node) {\r\n\r\n                                    tmpRange.setEndAfter(preNode);\r\n\r\n                                } else {\r\n                                    tmpRange.setEnd(node, node.childNodes.length);\r\n                                }\r\n\r\n                                break;\r\n                            }\r\n                            if (!blockquote[node.tagName]) {\r\n                                tmpRange.setEndAfter(preNode);\r\n                                break;\r\n                            }\r\n\r\n                            preNode = node;\r\n                            node = node.parentNode;\r\n                        }\r\n\r\n                    }\r\n\r\n\r\n                    node = range.document.createElement('blockquote');\r\n                    domUtils.setAttributes(node, attrs);\r\n                    node.appendChild(tmpRange.extractContents());\r\n                    tmpRange.insertNode(node);\r\n                    //去除重复的\r\n                    var childs = domUtils.getElementsByTagName(node, 'blockquote');\r\n                    for (var i = 0, ci; ci = childs[i++];) {\r\n                        if (ci.parentNode) {\r\n                            domUtils.remove(ci, true);\r\n                        }\r\n                    }\r\n\r\n                }\r\n                range.moveToBookmark(bookmark).select();\r\n            },\r\n            queryCommandState: function () {\r\n                return getObj(this) ? 1 : 0;\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n\r\n    // plugins/convertcase.js\r\n    /**\r\n     * 大小写转换\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 把选区内文本变大写，与“tolowercase”命令互斥\r\n     * @command touppercase\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'touppercase' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 把选区内文本变小写，与“touppercase”命令互斥\r\n     * @command tolowercase\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'tolowercase' );\r\n     * ```\r\n     */\r\n    UE.commands['touppercase'] =\r\n        UE.commands['tolowercase'] = {\r\n            execCommand: function (cmd) {\r\n                var me = this;\r\n                var rng = me.selection.getRange();\r\n                if (rng.collapsed) {\r\n                    return rng;\r\n                }\r\n                var bk = rng.createBookmark(),\r\n                    bkEnd = bk.end,\r\n                    filterFn = function (node) {\r\n                        return !domUtils.isBr(node) && !domUtils.isWhitespace(node);\r\n                    },\r\n                    curNode = domUtils.getNextDomNode(bk.start, false, filterFn);\r\n                while (curNode && (domUtils.getPosition(curNode, bkEnd) & domUtils.POSITION_PRECEDING)) {\r\n\r\n                    if (curNode.nodeType == 3) {\r\n                        curNode.nodeValue = curNode.nodeValue[cmd == 'touppercase' ? 'toUpperCase' : 'toLowerCase']();\r\n                    }\r\n                    curNode = domUtils.getNextDomNode(curNode, true, filterFn);\r\n                    if (curNode === bkEnd) {\r\n                        break;\r\n                    }\r\n\r\n                }\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n\r\n\r\n\r\n    // plugins/indent.js\r\n    /**\r\n     * 首行缩进\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 缩进\r\n     * @command indent\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'indent' );\r\n     * ```\r\n     */\r\n    UE.commands['indent'] = {\r\n        execCommand: function () {\r\n            var me = this, value = me.queryCommandState(\"indent\") ? \"0em\" : (me.options.indentValue || '2em');\r\n            me.execCommand('Paragraph', 'p', { style: 'text-indent:' + value });\r\n        },\r\n        queryCommandState: function () {\r\n            var pN = domUtils.filterNodeList(this.selection.getStartElementPath(), 'p h1 h2 h3 h4 h5 h6');\r\n            return pN && pN.style.textIndent && parseInt(pN.style.textIndent) ? 1 : 0;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    // plugins/print.js\r\n    /**\r\n     * 打印\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 打印\r\n     * @command print\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'print' );\r\n     * ```\r\n     */\r\n    UE.commands['print'] = {\r\n        execCommand: function () {\r\n            this.window.print();\r\n        },\r\n        notNeedUndo: 1\r\n    };\r\n\r\n\r\n\r\n    // plugins/preview.js\r\n    /**\r\n     * 预览\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 预览\r\n     * @command preview\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'preview' );\r\n     * ```\r\n     */\r\n    UE.commands['preview'] = {\r\n        execCommand: function () {\r\n            var w = window.open('', '_blank', ''),\r\n                d = w.document;\r\n            d.open();\r\n            d.write('<!DOCTYPE html><html><head><meta charset=\"utf-8\"/><script src=\"' + this.options.UEDITOR_HOME_URL + 'ueditor.parse.js\"></script><script>' +\r\n                \"setTimeout(function(){uParse('div',{rootPath: '\" + this.options.UEDITOR_HOME_URL + \"'})},300)\" +\r\n                '</script></head><body><div>' + this.getContent(null, null, true) + '</div></body></html>');\r\n            d.close();\r\n        },\r\n        notNeedUndo: 1\r\n    };\r\n\r\n\r\n    // plugins/selectall.js\r\n    /**\r\n     * 全选\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 选中所有内容\r\n     * @command selectall\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'selectall' );\r\n     * ```\r\n     */\r\n    UE.plugins['selectall'] = function () {\r\n        var me = this;\r\n        me.commands['selectall'] = {\r\n            execCommand: function () {\r\n                //去掉了原生的selectAll,因为会出现报错和当内容为空时，不能出现闭合状态的光标\r\n                var me = this, body = me.body,\r\n                    range = me.selection.getRange();\r\n                range.selectNodeContents(body);\r\n                if (domUtils.isEmptyBlock(body)) {\r\n                    //opera不能自动合并到元素的里边，要手动处理一下\r\n                    if (browser.opera && body.firstChild && body.firstChild.nodeType == 1) {\r\n                        range.setStartAtFirst(body.firstChild);\r\n                    }\r\n                    range.collapse(true);\r\n                }\r\n                range.select(true);\r\n            },\r\n            notNeedUndo: 1\r\n        };\r\n\r\n\r\n        //快捷键\r\n        me.addshortcutkey({\r\n            \"selectAll\": \"ctrl+65\"\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/paragraph.js\r\n    /**\r\n     * 段落样式\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 段落格式\r\n     * @command paragraph\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param {String}   style               标签值为：'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'\r\n     * @param {Object}   attrs               标签的属性\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'Paragraph','h1','{\r\n     *     class:'test'\r\n     * }' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 返回选区内节点标签名\r\n     * @command paragraph\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 节点标签名\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'Paragraph' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['paragraph'] = function () {\r\n        var me = this,\r\n            block = domUtils.isBlockElm,\r\n            notExchange = ['TD', 'LI', 'PRE'],\r\n\r\n            doParagraph = function (range, style, attrs, sourceCmdName) {\r\n                var bookmark = range.createBookmark(),\r\n                    filterFn = function (node) {\r\n                        return node.nodeType == 1 ? node.tagName.toLowerCase() != 'br' && !domUtils.isBookmarkNode(node) : !domUtils.isWhitespace(node);\r\n                    },\r\n                    para;\r\n\r\n                range.enlarge(true);\r\n                var bookmark2 = range.createBookmark(),\r\n                    current = domUtils.getNextDomNode(bookmark2.start, false, filterFn),\r\n                    tmpRange = range.cloneRange(),\r\n                    tmpNode;\r\n                while (current && !(domUtils.getPosition(current, bookmark2.end) & domUtils.POSITION_FOLLOWING)) {\r\n                    if (current.nodeType == 3 || !block(current)) {\r\n                        tmpRange.setStartBefore(current);\r\n                        while (current && current !== bookmark2.end && !block(current)) {\r\n                            tmpNode = current;\r\n                            current = domUtils.getNextDomNode(current, false, null, function (node) {\r\n                                return !block(node);\r\n                            });\r\n                        }\r\n                        tmpRange.setEndAfter(tmpNode);\r\n\r\n                        para = range.document.createElement(style);\r\n                        if (attrs) {\r\n                            domUtils.setAttributes(para, attrs);\r\n                            if (sourceCmdName && sourceCmdName == 'customstyle' && attrs.style) {\r\n                                para.style.cssText = attrs.style;\r\n                            }\r\n                        }\r\n                        para.appendChild(tmpRange.extractContents());\r\n                        //需要内容占位\r\n                        if (domUtils.isEmptyNode(para)) {\r\n                            domUtils.fillChar(range.document, para);\r\n\r\n                        }\r\n\r\n                        tmpRange.insertNode(para);\r\n\r\n                        var parent = para.parentNode;\r\n                        //如果para上一级是一个block元素且不是body,td就删除它\r\n                        if (block(parent) && !domUtils.isBody(para.parentNode) && utils.indexOf(notExchange, parent.tagName) == -1) {\r\n                            //存储dir,style\r\n                            if (!(sourceCmdName && sourceCmdName == 'customstyle')) {\r\n                                parent.getAttribute('dir') && para.setAttribute('dir', parent.getAttribute('dir'));\r\n                                //trace:1070\r\n                                parent.style.cssText && (para.style.cssText = parent.style.cssText + ';' + para.style.cssText);\r\n                                //trace:1030\r\n                                parent.style.textAlign && !para.style.textAlign && (para.style.textAlign = parent.style.textAlign);\r\n                                parent.style.textIndent && !para.style.textIndent && (para.style.textIndent = parent.style.textIndent);\r\n                                parent.style.padding && !para.style.padding && (para.style.padding = parent.style.padding);\r\n                            }\r\n\r\n                            //trace:1706 选择的就是h1-6要删除\r\n                            if (attrs && /h\\d/i.test(parent.tagName) && !/h\\d/i.test(para.tagName)) {\r\n                                domUtils.setAttributes(parent, attrs);\r\n                                if (sourceCmdName && sourceCmdName == 'customstyle' && attrs.style) {\r\n                                    parent.style.cssText = attrs.style;\r\n                                }\r\n                                domUtils.remove(para, true);\r\n                                para = parent;\r\n                            } else {\r\n                                domUtils.remove(para.parentNode, true);\r\n                            }\r\n\r\n                        }\r\n                        if (utils.indexOf(notExchange, parent.tagName) != -1) {\r\n                            current = parent;\r\n                        } else {\r\n                            current = para;\r\n                        }\r\n\r\n\r\n                        current = domUtils.getNextDomNode(current, false, filterFn);\r\n                    } else {\r\n                        current = domUtils.getNextDomNode(current, true, filterFn);\r\n                    }\r\n                }\r\n                return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);\r\n            };\r\n        me.setOpt('paragraph', { 'p': '', 'h1': '', 'h2': '', 'h3': '', 'h4': '', 'h5': '', 'h6': '' });\r\n        me.commands['paragraph'] = {\r\n            execCommand: function (cmdName, style, attrs, sourceCmdName) {\r\n                var range = this.selection.getRange();\r\n                //闭合时单独处理\r\n                if (range.collapsed) {\r\n                    var txt = this.document.createTextNode('p');\r\n                    range.insertNode(txt);\r\n                    //去掉冗余的fillchar\r\n                    if (browser.ie) {\r\n                        var node = txt.previousSibling;\r\n                        if (node && domUtils.isWhitespace(node)) {\r\n                            domUtils.remove(node);\r\n                        }\r\n                        node = txt.nextSibling;\r\n                        if (node && domUtils.isWhitespace(node)) {\r\n                            domUtils.remove(node);\r\n                        }\r\n                    }\r\n\r\n                }\r\n                range = doParagraph(range, style, attrs, sourceCmdName);\r\n                if (txt) {\r\n                    range.setStartBefore(txt).collapse(true);\r\n                    pN = txt.parentNode;\r\n\r\n                    domUtils.remove(txt);\r\n\r\n                    if (domUtils.isBlockElm(pN) && domUtils.isEmptyNode(pN)) {\r\n                        domUtils.fillNode(this.document, pN);\r\n                    }\r\n\r\n                }\r\n\r\n                if (browser.gecko && range.collapsed && range.startContainer.nodeType == 1) {\r\n                    var child = range.startContainer.childNodes[range.startOffset];\r\n                    if (child && child.nodeType == 1 && child.tagName.toLowerCase() == style) {\r\n                        range.setStart(child, 0).collapse(true);\r\n                    }\r\n                }\r\n                //trace:1097 原来有true，原因忘了，但去了就不能清除多余的占位符了\r\n                range.select();\r\n\r\n\r\n                return true;\r\n            },\r\n            queryCommandValue: function () {\r\n                var node = domUtils.filterNodeList(this.selection.getStartElementPath(), 'p h1 h2 h3 h4 h5 h6');\r\n                return node ? node.tagName.toLowerCase() : '';\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n    // plugins/directionality.js\r\n    /**\r\n     * 设置文字输入的方向的插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    (function () {\r\n        var block = domUtils.isBlockElm,\r\n            getObj = function (editor) {\r\n                //            var startNode = editor.selection.getStart(),\r\n                //                parents;\r\n                //            if ( startNode ) {\r\n                //                //查找所有的是block的父亲节点\r\n                //                parents = domUtils.findParents( startNode, true, block, true );\r\n                //                for ( var i = 0,ci; ci = parents[i++]; ) {\r\n                //                    if ( ci.getAttribute( 'dir' ) ) {\r\n                //                        return ci;\r\n                //                    }\r\n                //                }\r\n                //            }\r\n                return domUtils.filterNodeList(editor.selection.getStartElementPath(), function (n) { return n && n.nodeType == 1 && n.getAttribute('dir') });\r\n\r\n            },\r\n            doDirectionality = function (range, editor, forward) {\r\n\r\n                var bookmark,\r\n                    filterFn = function (node) {\r\n                        return node.nodeType == 1 ? !domUtils.isBookmarkNode(node) : !domUtils.isWhitespace(node);\r\n                    },\r\n\r\n                    obj = getObj(editor);\r\n\r\n                if (obj && range.collapsed) {\r\n                    obj.setAttribute('dir', forward);\r\n                    return range;\r\n                }\r\n                bookmark = range.createBookmark();\r\n                range.enlarge(true);\r\n                var bookmark2 = range.createBookmark(),\r\n                    current = domUtils.getNextDomNode(bookmark2.start, false, filterFn),\r\n                    tmpRange = range.cloneRange(),\r\n                    tmpNode;\r\n                while (current && !(domUtils.getPosition(current, bookmark2.end) & domUtils.POSITION_FOLLOWING)) {\r\n                    if (current.nodeType == 3 || !block(current)) {\r\n                        tmpRange.setStartBefore(current);\r\n                        while (current && current !== bookmark2.end && !block(current)) {\r\n                            tmpNode = current;\r\n                            current = domUtils.getNextDomNode(current, false, null, function (node) {\r\n                                return !block(node);\r\n                            });\r\n                        }\r\n                        tmpRange.setEndAfter(tmpNode);\r\n                        var common = tmpRange.getCommonAncestor();\r\n                        if (!domUtils.isBody(common) && block(common)) {\r\n                            //遍历到了block节点\r\n                            common.setAttribute('dir', forward);\r\n                            current = common;\r\n                        } else {\r\n                            //没有遍历到，添加一个block节点\r\n                            var p = range.document.createElement('p');\r\n                            p.setAttribute('dir', forward);\r\n                            var frag = tmpRange.extractContents();\r\n                            p.appendChild(frag);\r\n                            tmpRange.insertNode(p);\r\n                            current = p;\r\n                        }\r\n\r\n                        current = domUtils.getNextDomNode(current, false, filterFn);\r\n                    } else {\r\n                        current = domUtils.getNextDomNode(current, true, filterFn);\r\n                    }\r\n                }\r\n                return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);\r\n            };\r\n\r\n        /**\r\n         * 文字输入方向\r\n         * @command directionality\r\n         * @method execCommand\r\n         * @param { String } cmdName 命令字符串\r\n         * @param { String } forward 传入'ltr'表示从左向右输入，传入'rtl'表示从右向左输入\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'directionality', 'ltr');\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 查询当前选区的文字输入方向\r\n         * @command directionality\r\n         * @method queryCommandValue\r\n         * @param { String } cmdName 命令字符串\r\n         * @return { String } 返回'ltr'表示从左向右输入，返回'rtl'表示从右向左输入\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandValue( 'directionality');\r\n         * ```\r\n         */\r\n        UE.commands['directionality'] = {\r\n            execCommand: function (cmdName, forward) {\r\n                var range = this.selection.getRange();\r\n                //闭合时单独处理\r\n                if (range.collapsed) {\r\n                    var txt = this.document.createTextNode('d');\r\n                    range.insertNode(txt);\r\n                }\r\n                doDirectionality(range, this, forward);\r\n                if (txt) {\r\n                    range.setStartBefore(txt).collapse(true);\r\n                    domUtils.remove(txt);\r\n                }\r\n\r\n                range.select();\r\n                return true;\r\n            },\r\n            queryCommandValue: function () {\r\n                var node = getObj(this);\r\n                return node ? node.getAttribute('dir') : 'ltr';\r\n            }\r\n        };\r\n    })();\r\n\r\n\r\n\r\n    // plugins/horizontal.js\r\n    /**\r\n     * 插入分割线插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 插入分割线\r\n     * @command horizontal\r\n     * @method execCommand\r\n     * @param { String } cmdName 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'horizontal' );\r\n     * ```\r\n     */\r\n    UE.plugins['horizontal'] = function () {\r\n        var me = this;\r\n        me.commands['horizontal'] = {\r\n            execCommand: function (cmdName) {\r\n                var me = this;\r\n                if (me.queryCommandState(cmdName) !== -1) {\r\n                    me.execCommand('insertHtml', '<hr>');\r\n                    var range = me.selection.getRange(),\r\n                        start = range.startContainer;\r\n                    if (start.nodeType == 1 && !start.childNodes[range.startOffset]) {\r\n\r\n                        var tmp;\r\n                        if (tmp = start.childNodes[range.startOffset - 1]) {\r\n                            if (tmp.nodeType == 1 && tmp.tagName == 'HR') {\r\n                                if (me.options.enterTag == 'p') {\r\n                                    tmp = me.document.createElement('p');\r\n                                    range.insertNode(tmp);\r\n                                    range.setStart(tmp, 0).setCursor();\r\n\r\n                                } else {\r\n                                    tmp = me.document.createElement('br');\r\n                                    range.insertNode(tmp);\r\n                                    range.setStartBefore(tmp).setCursor();\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                    return true;\r\n                }\r\n\r\n            },\r\n            //边界在table里不能加分隔线\r\n            queryCommandState: function () {\r\n                return domUtils.filterNodeList(this.selection.getStartElementPath(), 'table') ? -1 : 0;\r\n            }\r\n        };\r\n        //    me.addListener('delkeyup',function(){\r\n        //        var rng = this.selection.getRange();\r\n        //        if(browser.ie && browser.version > 8){\r\n        //            rng.txtToElmBoundary(true);\r\n        //            if(domUtils.isStartInblock(rng)){\r\n        //                var tmpNode = rng.startContainer;\r\n        //                var pre = tmpNode.previousSibling;\r\n        //                if(pre && domUtils.isTagNode(pre,'hr')){\r\n        //                    domUtils.remove(pre);\r\n        //                    rng.select();\r\n        //                    return;\r\n        //                }\r\n        //            }\r\n        //        }\r\n        //        if(domUtils.isBody(rng.startContainer)){\r\n        //            var hr = rng.startContainer.childNodes[rng.startOffset -1];\r\n        //            if(hr && hr.nodeName == 'HR'){\r\n        //                var next = hr.nextSibling;\r\n        //                if(next){\r\n        //                    rng.setStart(next,0)\r\n        //                }else if(hr.previousSibling){\r\n        //                    rng.setStartAtLast(hr.previousSibling)\r\n        //                }else{\r\n        //                    var p = this.document.createElement('p');\r\n        //                    hr.parentNode.insertBefore(p,hr);\r\n        //                    domUtils.fillNode(this.document,p);\r\n        //                    rng.setStart(p,0);\r\n        //                }\r\n        //                domUtils.remove(hr);\r\n        //                rng.setCursor(false,true);\r\n        //            }\r\n        //        }\r\n        //    })\r\n        me.addListener('delkeydown', function (name, evt) {\r\n            var rng = this.selection.getRange();\r\n            rng.txtToElmBoundary(true);\r\n            if (domUtils.isStartInblock(rng)) {\r\n                var tmpNode = rng.startContainer;\r\n                var pre = tmpNode.previousSibling;\r\n                if (pre && domUtils.isTagNode(pre, 'hr')) {\r\n                    domUtils.remove(pre);\r\n                    rng.select();\r\n                    domUtils.preventDefault(evt);\r\n                    return true;\r\n\r\n                }\r\n            }\r\n\r\n        })\r\n    };\r\n\r\n\r\n\r\n    // plugins/time.js\r\n    /**\r\n     * 插入时间和日期\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 插入时间，默认格式：12:59:59\r\n     * @command time\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'time');\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 插入日期，默认格式：2013-08-30\r\n     * @command date\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'date');\r\n     * ```\r\n     */\r\n    UE.commands['time'] = UE.commands[\"date\"] = {\r\n        execCommand: function (cmd, format) {\r\n            var date = new Date;\r\n\r\n            function formatTime(date, format) {\r\n                var hh = ('0' + date.getHours()).slice(-2),\r\n                    ii = ('0' + date.getMinutes()).slice(-2),\r\n                    ss = ('0' + date.getSeconds()).slice(-2);\r\n                format = format || 'hh:ii:ss';\r\n                return format.replace(/hh/ig, hh).replace(/ii/ig, ii).replace(/ss/ig, ss);\r\n            }\r\n            function formatDate(date, format) {\r\n                var yyyy = ('000' + date.getFullYear()).slice(-4),\r\n                    yy = yyyy.slice(-2),\r\n                    mm = ('0' + (date.getMonth() + 1)).slice(-2),\r\n                    dd = ('0' + date.getDate()).slice(-2);\r\n                format = format || 'yyyy-mm-dd';\r\n                return format.replace(/yyyy/ig, yyyy).replace(/yy/ig, yy).replace(/mm/ig, mm).replace(/dd/ig, dd);\r\n            }\r\n\r\n            this.execCommand('insertHtml', cmd == \"time\" ? formatTime(date, format) : formatDate(date, format));\r\n        }\r\n    };\r\n\r\n\r\n    // plugins/rowspacing.js\r\n    /**\r\n     * 段前段后间距插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 设置段间距\r\n     * @command rowspacing\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } value 段间距的值，以px为单位\r\n     * @param { String } dir 间距位置，top或bottom，分别表示段前和段后\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'rowspacing', '10', 'top' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['rowspacing'] = function () {\r\n        var me = this;\r\n        me.setOpt({\r\n            'rowspacingtop': ['5', '10', '15', '20', '25'],\r\n            'rowspacingbottom': ['5', '10', '15', '20', '25']\r\n\r\n        });\r\n        me.commands['rowspacing'] = {\r\n            execCommand: function (cmdName, value, dir) {\r\n                this.execCommand('paragraph', 'p', { style: 'margin-' + dir + ':' + value + 'px' });\r\n                return true;\r\n            },\r\n            queryCommandValue: function (cmdName, dir) {\r\n                var pN = domUtils.filterNodeList(this.selection.getStartElementPath(), function (node) { return domUtils.isBlockElm(node) }),\r\n                    value;\r\n                //trace:1026\r\n                if (pN) {\r\n                    value = domUtils.getComputedStyle(pN, 'margin-' + dir).replace(/[^\\d]/g, '');\r\n                    return !value ? 0 : value;\r\n                }\r\n                return 0;\r\n\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n\r\n\r\n    // plugins/lineheight.js\r\n    /**\r\n     * 设置行内间距\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    UE.plugins['lineheight'] = function () {\r\n        var me = this;\r\n        me.setOpt({ 'lineheight': ['1', '1.5', '1.75', '2', '3', '4', '5'] });\r\n\r\n        /**\r\n         * 行距\r\n         * @command lineheight\r\n         * @method execCommand\r\n         * @param { String } cmdName 命令字符串\r\n         * @param { String } value 传入的行高值， 该值是当前字体的倍数， 例如： 1.5, 1.75\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'lineheight', 1.5);\r\n         * ```\r\n         */\r\n        /**\r\n         * 查询当前选区内容的行高大小\r\n         * @command lineheight\r\n         * @method queryCommandValue\r\n         * @param { String } cmd 命令字符串\r\n         * @return { String } 返回当前行高大小\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandValue( 'lineheight' );\r\n         * ```\r\n         */\r\n\r\n        me.commands['lineheight'] = {\r\n            execCommand: function (cmdName, value) {\r\n                this.execCommand('paragraph', 'p', { style: 'line-height:' + (value == \"1\" ? \"normal\" : value + 'em') });\r\n                return true;\r\n            },\r\n            queryCommandValue: function () {\r\n                var pN = domUtils.filterNodeList(this.selection.getStartElementPath(), function (node) { return domUtils.isBlockElm(node) });\r\n                if (pN) {\r\n                    var value = domUtils.getComputedStyle(pN, 'line-height');\r\n                    return value == 'normal' ? 1 : value.replace(/[^\\d.]*/ig, \"\");\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n\r\n\r\n    // plugins/insertcode.js\r\n    /**\r\n     * 插入代码插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    UE.plugins['insertcode'] = function () {\r\n        var me = this;\r\n        me.ready(function () {\r\n            utils.cssRule('pre', 'pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}',\r\n                me.document)\r\n        });\r\n        me.setOpt('insertcode', {\r\n            'as3': 'ActionScript3',\r\n            'bash': 'Bash/Shell',\r\n            'cpp': 'C/C++',\r\n            'css': 'Css',\r\n            'cf': 'CodeFunction',\r\n            'c#': 'C#',\r\n            'delphi': 'Delphi',\r\n            'diff': 'Diff',\r\n            'erlang': 'Erlang',\r\n            'groovy': 'Groovy',\r\n            'html': 'Html',\r\n            'java': 'Java',\r\n            'jfx': 'JavaFx',\r\n            'js': 'Javascript',\r\n            'pl': 'Perl',\r\n            'php': 'Php',\r\n            'plain': 'Plain Text',\r\n            'ps': 'PowerShell',\r\n            'python': 'Python',\r\n            'ruby': 'Ruby',\r\n            'scala': 'Scala',\r\n            'sql': 'Sql',\r\n            'vb': 'Vb',\r\n            'xml': 'Xml'\r\n        });\r\n\r\n        /**\r\n         * 插入代码\r\n         * @command insertcode\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @param { String } lang 插入代码的语言\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'insertcode', 'javascript' );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 如果选区所在位置是插入插入代码区域，返回代码的语言\r\n         * @command insertcode\r\n         * @method queryCommandValue\r\n         * @param { String } cmd 命令字符串\r\n         * @return { String } 返回代码的语言\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandValue( 'insertcode' );\r\n         * ```\r\n         */\r\n\r\n        me.commands['insertcode'] = {\r\n            execCommand: function (cmd, lang) {\r\n                var me = this,\r\n                    rng = me.selection.getRange(),\r\n                    pre = domUtils.findParentByTagName(rng.startContainer, 'pre', true);\r\n                if (pre) {\r\n                    pre.className = 'brush:' + lang + ';toolbar:false;';\r\n                } else {\r\n                    var code = '';\r\n                    if (rng.collapsed) {\r\n                        code = browser.ie && browser.ie11below ? (browser.version <= 8 ? '&nbsp;' : '') : '<br/>';\r\n                    } else {\r\n                        var frag = rng.extractContents();\r\n                        var div = me.document.createElement('div');\r\n                        div.appendChild(frag);\r\n\r\n                        utils.each(UE.filterNode(UE.htmlparser(div.innerHTML.replace(/[\\r\\t]/g, '')), me.options.filterTxtRules).children, function (node) {\r\n                            if (browser.ie && browser.ie11below && browser.version > 8) {\r\n\r\n                                if (node.type == 'element') {\r\n                                    if (node.tagName == 'br') {\r\n                                        code += '\\n'\r\n                                    } else if (!dtd.$empty[node.tagName]) {\r\n                                        utils.each(node.children, function (cn) {\r\n                                            if (cn.type == 'element') {\r\n                                                if (cn.tagName == 'br') {\r\n                                                    code += '\\n'\r\n                                                } else if (!dtd.$empty[node.tagName]) {\r\n                                                    code += cn.innerText();\r\n                                                }\r\n                                            } else {\r\n                                                code += cn.data\r\n                                            }\r\n                                        })\r\n                                        if (!/\\n$/.test(code)) {\r\n                                            code += '\\n';\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    code += node.data + '\\n'\r\n                                }\r\n                                if (!node.nextSibling() && /\\n$/.test(code)) {\r\n                                    code = code.replace(/\\n$/, '');\r\n                                }\r\n                            } else {\r\n                                if (browser.ie && browser.ie11below) {\r\n\r\n                                    if (node.type == 'element') {\r\n                                        if (node.tagName == 'br') {\r\n                                            code += '<br>'\r\n                                        } else if (!dtd.$empty[node.tagName]) {\r\n                                            utils.each(node.children, function (cn) {\r\n                                                if (cn.type == 'element') {\r\n                                                    if (cn.tagName == 'br') {\r\n                                                        code += '<br>'\r\n                                                    } else if (!dtd.$empty[node.tagName]) {\r\n                                                        code += cn.innerText();\r\n                                                    }\r\n                                                } else {\r\n                                                    code += cn.data\r\n                                                }\r\n                                            });\r\n                                            if (!/br>$/.test(code)) {\r\n                                                code += '<br>';\r\n                                            }\r\n                                        }\r\n                                    } else {\r\n                                        code += node.data + '<br>'\r\n                                    }\r\n                                    if (!node.nextSibling() && /<br>$/.test(code)) {\r\n                                        code = code.replace(/<br>$/, '');\r\n                                    }\r\n\r\n                                } else {\r\n                                    code += (node.type == 'element' ? (dtd.$empty[node.tagName] ? '' : node.innerText()) : node.data);\r\n                                    if (!/br\\/?\\s*>$/.test(code)) {\r\n                                        if (!node.nextSibling())\r\n                                            return;\r\n                                        code += '<br>'\r\n                                    }\r\n                                }\r\n\r\n                            }\r\n\r\n                        });\r\n                    }\r\n                    me.execCommand('inserthtml', '<pre id=\"coder\"class=\"brush:' + lang + ';toolbar:false\">' + code + '</pre>', true);\r\n\r\n                    pre = me.document.getElementById('coder');\r\n                    domUtils.removeAttributes(pre, 'id');\r\n                    var tmpNode = pre.previousSibling;\r\n\r\n                    if (tmpNode && (tmpNode.nodeType == 3 && tmpNode.nodeValue.length == 1 && browser.ie && browser.version == 6 || domUtils.isEmptyBlock(tmpNode))) {\r\n\r\n                        domUtils.remove(tmpNode)\r\n                    }\r\n                    var rng = me.selection.getRange();\r\n                    if (domUtils.isEmptyBlock(pre)) {\r\n                        rng.setStart(pre, 0).setCursor(false, true)\r\n                    } else {\r\n                        rng.selectNodeContents(pre).select()\r\n                    }\r\n                }\r\n\r\n\r\n\r\n            },\r\n            queryCommandValue: function () {\r\n                var path = this.selection.getStartElementPath();\r\n                var lang = '';\r\n                utils.each(path, function (node) {\r\n                    if (node.nodeName == 'PRE') {\r\n                        var match = node.className.match(/brush:([^;]+)/);\r\n                        lang = match && match[1] ? match[1] : '';\r\n                        return false;\r\n                    }\r\n                });\r\n                return lang;\r\n            }\r\n        };\r\n\r\n        me.addInputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('pre'), function (pre) {\r\n                var brs = pre.getNodesByTagName('br');\r\n                if (brs.length) {\r\n                    browser.ie && browser.ie11below && browser.version > 8 && utils.each(brs, function (br) {\r\n                        var txt = UE.uNode.createText('\\n');\r\n                        br.parentNode.insertBefore(txt, br);\r\n                        br.parentNode.removeChild(br);\r\n                    });\r\n                    return;\r\n                }\r\n                if (browser.ie && browser.ie11below && browser.version > 8)\r\n                    return;\r\n                var code = pre.innerText().split(/\\n/);\r\n                pre.innerHTML('');\r\n                utils.each(code, function (c) {\r\n                    if (c.length) {\r\n                        pre.appendChild(UE.uNode.createText(c));\r\n                    }\r\n                    pre.appendChild(UE.uNode.createElement('br'))\r\n                })\r\n            })\r\n        });\r\n        me.addOutputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('pre'), function (pre) {\r\n                var code = '';\r\n                utils.each(pre.children, function (n) {\r\n                    if (n.type == 'text') {\r\n                        //在ie下文本内容有可能末尾带有\\n要去掉\r\n                        //trace:3396\r\n                        code += n.data.replace(/[ ]/g, '&nbsp;').replace(/\\n$/, '');\r\n                    } else {\r\n                        if (n.tagName == 'br') {\r\n                            code += '\\n'\r\n                        } else {\r\n                            code += (!dtd.$empty[n.tagName] ? '' : n.innerText());\r\n                        }\r\n\r\n                    }\r\n\r\n                });\r\n\r\n                pre.innerText(code.replace(/(&nbsp;|\\n)+$/, ''))\r\n            })\r\n        });\r\n        //不需要判断highlight的command列表\r\n        me.notNeedCodeQuery = {\r\n            help: 1,\r\n            undo: 1,\r\n            redo: 1,\r\n            source: 1,\r\n            print: 1,\r\n            searchreplace: 1,\r\n            fullscreen: 1,\r\n            preview: 1,\r\n            insertparagraph: 1,\r\n            elementpath: 1,\r\n            insertcode: 1,\r\n            inserthtml: 1,\r\n            selectall: 1\r\n        };\r\n        //将queyCommamndState重置\r\n        var orgQuery = me.queryCommandState;\r\n        me.queryCommandState = function (cmd) {\r\n            var me = this;\r\n\r\n            if (!me.notNeedCodeQuery[cmd.toLowerCase()] && me.selection && me.queryCommandValue('insertcode')) {\r\n                return -1;\r\n            }\r\n            return UE.Editor.prototype.queryCommandState.apply(this, arguments)\r\n        };\r\n        me.addListener('beforeenterkeydown', function () {\r\n            var rng = me.selection.getRange();\r\n            var pre = domUtils.findParentByTagName(rng.startContainer, 'pre', true);\r\n            if (pre) {\r\n                me.fireEvent('saveScene');\r\n                if (!rng.collapsed) {\r\n                    rng.deleteContents();\r\n                }\r\n                if (!browser.ie || browser.ie9above) {\r\n                    var tmpNode = me.document.createElement('br'), pre;\r\n                    rng.insertNode(tmpNode).setStartAfter(tmpNode).collapse(true);\r\n                    var next = tmpNode.nextSibling;\r\n                    if (!next && (!browser.ie || browser.version > 10)) {\r\n                        rng.insertNode(tmpNode.cloneNode(false));\r\n                    } else {\r\n                        rng.setStartAfter(tmpNode);\r\n                    }\r\n                    pre = tmpNode.previousSibling;\r\n                    var tmp;\r\n                    while (pre) {\r\n                        tmp = pre;\r\n                        pre = pre.previousSibling;\r\n                        if (!pre || pre.nodeName == 'BR') {\r\n                            pre = tmp;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (pre) {\r\n                        var str = '';\r\n                        while (pre && pre.nodeName != 'BR' && new RegExp('^[\\\\s' + domUtils.fillChar + ']*$').test(pre.nodeValue)) {\r\n                            str += pre.nodeValue;\r\n                            pre = pre.nextSibling;\r\n                        }\r\n                        if (pre.nodeName != 'BR') {\r\n                            var match = pre.nodeValue.match(new RegExp('^([\\\\s' + domUtils.fillChar + ']+)'));\r\n                            if (match && match[1]) {\r\n                                str += match[1]\r\n                            }\r\n\r\n                        }\r\n                        if (str) {\r\n                            str = me.document.createTextNode(str);\r\n                            rng.insertNode(str).setStartAfter(str);\r\n                        }\r\n                    }\r\n                    rng.collapse(true).select(true);\r\n                } else {\r\n                    if (browser.version > 8) {\r\n\r\n                        var txt = me.document.createTextNode('\\n');\r\n                        var start = rng.startContainer;\r\n                        if (rng.startOffset == 0) {\r\n                            var preNode = start.previousSibling;\r\n                            if (preNode) {\r\n                                rng.insertNode(txt);\r\n                                var fillchar = me.document.createTextNode(' ');\r\n                                rng.setStartAfter(txt).insertNode(fillchar).setStart(fillchar, 0).collapse(true).select(true)\r\n                            }\r\n                        } else {\r\n                            rng.insertNode(txt).setStartAfter(txt);\r\n                            var fillchar = me.document.createTextNode(' ');\r\n                            start = rng.startContainer.childNodes[rng.startOffset];\r\n                            if (start && !/^\\n/.test(start.nodeValue)) {\r\n                                rng.setStartBefore(txt)\r\n                            }\r\n                            rng.insertNode(fillchar).setStart(fillchar, 0).collapse(true).select(true)\r\n                        }\r\n\r\n                    } else {\r\n                        var tmpNode = me.document.createElement('br');\r\n                        rng.insertNode(tmpNode);\r\n                        rng.insertNode(me.document.createTextNode(domUtils.fillChar));\r\n                        rng.setStartAfter(tmpNode);\r\n                        pre = tmpNode.previousSibling;\r\n                        var tmp;\r\n                        while (pre) {\r\n                            tmp = pre;\r\n                            pre = pre.previousSibling;\r\n                            if (!pre || pre.nodeName == 'BR') {\r\n                                pre = tmp;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (pre) {\r\n                            var str = '';\r\n                            while (pre && pre.nodeName != 'BR' && new RegExp('^[ ' + domUtils.fillChar + ']*$').test(pre.nodeValue)) {\r\n                                str += pre.nodeValue;\r\n                                pre = pre.nextSibling;\r\n                            }\r\n                            if (pre.nodeName != 'BR') {\r\n                                var match = pre.nodeValue.match(new RegExp('^([ ' + domUtils.fillChar + ']+)'));\r\n                                if (match && match[1]) {\r\n                                    str += match[1]\r\n                                }\r\n\r\n                            }\r\n\r\n                            str = me.document.createTextNode(str);\r\n                            rng.insertNode(str).setStartAfter(str);\r\n                        }\r\n                        rng.collapse(true).select();\r\n                    }\r\n\r\n\r\n                }\r\n                me.fireEvent('saveScene');\r\n                return true;\r\n            }\r\n\r\n\r\n        });\r\n\r\n        me.addListener('tabkeydown', function (cmd, evt) {\r\n            var rng = me.selection.getRange();\r\n            var pre = domUtils.findParentByTagName(rng.startContainer, 'pre', true);\r\n            if (pre) {\r\n                me.fireEvent('saveScene');\r\n                if (evt.shiftKey) {\r\n\r\n                } else {\r\n                    if (!rng.collapsed) {\r\n                        var bk = rng.createBookmark();\r\n                        var start = bk.start.previousSibling;\r\n\r\n                        while (start) {\r\n                            if (pre.firstChild === start && !domUtils.isBr(start)) {\r\n                                pre.insertBefore(me.document.createTextNode('    '), start);\r\n\r\n                                break;\r\n                            }\r\n                            if (domUtils.isBr(start)) {\r\n                                pre.insertBefore(me.document.createTextNode('    '), start.nextSibling);\r\n\r\n                                break;\r\n                            }\r\n                            start = start.previousSibling;\r\n                        }\r\n                        var end = bk.end;\r\n                        start = bk.start.nextSibling;\r\n                        if (pre.firstChild === bk.start) {\r\n                            pre.insertBefore(me.document.createTextNode('    '), start.nextSibling)\r\n\r\n                        }\r\n                        while (start && start !== end) {\r\n                            if (domUtils.isBr(start) && start.nextSibling) {\r\n                                if (start.nextSibling === end) {\r\n                                    break;\r\n                                }\r\n                                pre.insertBefore(me.document.createTextNode('    '), start.nextSibling)\r\n                            }\r\n\r\n                            start = start.nextSibling;\r\n                        }\r\n                        rng.moveToBookmark(bk).select();\r\n                    } else {\r\n                        var tmpNode = me.document.createTextNode('    ');\r\n                        rng.insertNode(tmpNode).setStartAfter(tmpNode).collapse(true).select(true);\r\n                    }\r\n                }\r\n\r\n\r\n                me.fireEvent('saveScene');\r\n                return true;\r\n            }\r\n\r\n\r\n        });\r\n\r\n\r\n        me.addListener('beforeinserthtml', function (evtName, html) {\r\n            var me = this,\r\n                rng = me.selection.getRange(),\r\n                pre = domUtils.findParentByTagName(rng.startContainer, 'pre', true);\r\n            if (pre) {\r\n                if (!rng.collapsed) {\r\n                    rng.deleteContents()\r\n                }\r\n                var htmlstr = '';\r\n                if (browser.ie && browser.version > 8) {\r\n\r\n                    utils.each(UE.filterNode(UE.htmlparser(html), me.options.filterTxtRules).children, function (node) {\r\n                        if (node.type == 'element') {\r\n                            if (node.tagName == 'br') {\r\n                                htmlstr += '\\n'\r\n                            } else if (!dtd.$empty[node.tagName]) {\r\n                                utils.each(node.children, function (cn) {\r\n                                    if (cn.type == 'element') {\r\n                                        if (cn.tagName == 'br') {\r\n                                            htmlstr += '\\n'\r\n                                        } else if (!dtd.$empty[node.tagName]) {\r\n                                            htmlstr += cn.innerText();\r\n                                        }\r\n                                    } else {\r\n                                        htmlstr += cn.data\r\n                                    }\r\n                                })\r\n                                if (!/\\n$/.test(htmlstr)) {\r\n                                    htmlstr += '\\n';\r\n                                }\r\n                            }\r\n                        } else {\r\n                            htmlstr += node.data + '\\n'\r\n                        }\r\n                        if (!node.nextSibling() && /\\n$/.test(htmlstr)) {\r\n                            htmlstr = htmlstr.replace(/\\n$/, '');\r\n                        }\r\n                    });\r\n                    var tmpNode = me.document.createTextNode(utils.html(htmlstr.replace(/&nbsp;/g, ' ')));\r\n                    rng.insertNode(tmpNode).selectNode(tmpNode).select();\r\n                } else {\r\n                    var frag = me.document.createDocumentFragment();\r\n\r\n                    utils.each(UE.filterNode(UE.htmlparser(html), me.options.filterTxtRules).children, function (node) {\r\n                        if (node.type == 'element') {\r\n                            if (node.tagName == 'br') {\r\n                                frag.appendChild(me.document.createElement('br'))\r\n                            } else if (!dtd.$empty[node.tagName]) {\r\n                                utils.each(node.children, function (cn) {\r\n                                    if (cn.type == 'element') {\r\n                                        if (cn.tagName == 'br') {\r\n\r\n                                            frag.appendChild(me.document.createElement('br'))\r\n                                        } else if (!dtd.$empty[node.tagName]) {\r\n                                            frag.appendChild(me.document.createTextNode(utils.html(cn.innerText().replace(/&nbsp;/g, ' '))));\r\n\r\n                                        }\r\n                                    } else {\r\n                                        frag.appendChild(me.document.createTextNode(utils.html(cn.data.replace(/&nbsp;/g, ' '))));\r\n\r\n                                    }\r\n                                })\r\n                                if (frag.lastChild.nodeName != 'BR') {\r\n                                    frag.appendChild(me.document.createElement('br'))\r\n                                }\r\n                            }\r\n                        } else {\r\n                            frag.appendChild(me.document.createTextNode(utils.html(node.data.replace(/&nbsp;/g, ' '))));\r\n                        }\r\n                        if (!node.nextSibling() && frag.lastChild.nodeName == 'BR') {\r\n                            frag.removeChild(frag.lastChild)\r\n                        }\r\n\r\n\r\n                    });\r\n                    rng.insertNode(frag).select();\r\n\r\n                }\r\n\r\n                return true;\r\n            }\r\n        });\r\n        //方向键的处理\r\n        me.addListener('keydown', function (cmd, evt) {\r\n            var me = this, keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 40) {\r\n                var rng = me.selection.getRange(), pre, start = rng.startContainer;\r\n                if (rng.collapsed && (pre = domUtils.findParentByTagName(rng.startContainer, 'pre', true)) && !pre.nextSibling) {\r\n                    var last = pre.lastChild\r\n                    while (last && last.nodeName == 'BR') {\r\n                        last = last.previousSibling;\r\n                    }\r\n                    if (last === start || rng.startContainer === pre && rng.startOffset == pre.childNodes.length) {\r\n                        me.execCommand('insertparagraph');\r\n                        domUtils.preventDefault(evt)\r\n                    }\r\n\r\n                }\r\n            }\r\n        });\r\n        //trace:3395\r\n        me.addListener('delkeydown', function (type, evt) {\r\n            var rng = this.selection.getRange();\r\n            rng.txtToElmBoundary(true);\r\n            var start = rng.startContainer;\r\n            if (domUtils.isTagNode(start, 'pre') && rng.collapsed && domUtils.isStartInblock(rng)) {\r\n                var p = me.document.createElement('p');\r\n                domUtils.fillNode(me.document, p);\r\n                start.parentNode.insertBefore(p, start);\r\n                domUtils.remove(start);\r\n                rng.setStart(p, 0).setCursor(false, true);\r\n                domUtils.preventDefault(evt);\r\n                return true;\r\n            }\r\n        })\r\n    };\r\n\r\n\r\n    // plugins/cleardoc.js\r\n    /**\r\n     * 清空文档插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 清空文档\r\n     * @command cleardoc\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * //editor 是编辑器实例\r\n     * editor.execCommand('cleardoc');\r\n     * ```\r\n     */\r\n\r\n    UE.commands['cleardoc'] = {\r\n        execCommand: function (cmdName) {\r\n            var me = this,\r\n                enterTag = me.options.enterTag,\r\n                range = me.selection.getRange();\r\n            if (enterTag == \"br\") {\r\n                me.body.innerHTML = \"<br/>\";\r\n                range.setStart(me.body, 0).setCursor();\r\n            } else {\r\n                me.body.innerHTML = \"<p>\" + (ie ? \"\" : \"<br/>\") + \"</p>\";\r\n                range.setStart(me.body.firstChild, 0).setCursor(false, true);\r\n            }\r\n            setTimeout(function () {\r\n                me.fireEvent(\"clearDoc\");\r\n            }, 0);\r\n\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // plugins/anchor.js\r\n    /**\r\n     * 锚点插件，为UEditor提供插入锚点支持\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    UE.plugin.register('anchor', function () {\r\n\r\n        return {\r\n            bindEvents: {\r\n                'ready': function () {\r\n                    utils.cssRule('anchor',\r\n                        '.anchorclass{background: url(\\''\r\n                        + this.options.themePath\r\n                        + this.options.theme + '/images/anchor.gif\\') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}',\r\n                        this.document);\r\n                }\r\n            },\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (a) {\r\n                    var val;\r\n                    if (val = a.getAttr('anchorname')) {\r\n                        a.tagName = 'a';\r\n                        a.setAttr({\r\n                            anchorname: '',\r\n                            name: val,\r\n                            'class': ''\r\n                        })\r\n                    }\r\n                })\r\n            },\r\n            inputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('a'), function (a) {\r\n                    var val;\r\n                    if ((val = a.getAttr('name')) && !a.getAttr('href')) {\r\n                        a.tagName = 'img';\r\n                        a.setAttr({\r\n                            anchorname: a.getAttr('name'),\r\n                            'class': 'anchorclass'\r\n                        });\r\n                        a.setAttr('name')\r\n\r\n                    }\r\n                })\r\n\r\n            },\r\n            commands: {\r\n                /**\r\n                 * 插入锚点\r\n                 * @command anchor\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @param { String } name 锚点名称字符串\r\n                 * @example\r\n                 * ```javascript\r\n                 * //editor 是编辑器实例\r\n                 * editor.execCommand('anchor', 'anchor1');\r\n                 * ```\r\n                 */\r\n                'anchor': {\r\n                    execCommand: function (cmd, name) {\r\n                        var range = this.selection.getRange(), img = range.getClosedNode();\r\n                        if (img && img.getAttribute('anchorname')) {\r\n                            if (name) {\r\n                                img.setAttribute('anchorname', name);\r\n                            } else {\r\n                                range.setStartBefore(img).setCursor();\r\n                                domUtils.remove(img);\r\n                            }\r\n                        } else {\r\n                            if (name) {\r\n                                //只在选区的开始插入\r\n                                var anchor = this.document.createElement('img');\r\n                                range.collapse(true);\r\n                                domUtils.setAttributes(anchor, {\r\n                                    'anchorname': name,\r\n                                    'class': 'anchorclass'\r\n                                });\r\n                                range.insertNode(anchor).setStartAfter(anchor).setCursor(false, true);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // plugins/wordcount.js\r\n    ///import core\r\n    ///commands 字数统计\r\n    ///commandsName  WordCount,wordCount\r\n    ///commandsTitle  字数统计\r\n    /*\r\n     * Created by JetBrains WebStorm.\r\n     * User: taoqili\r\n     * Date: 11-9-7\r\n     * Time: 下午8:18\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n\r\n    UE.plugins['wordcount'] = function () {\r\n        var me = this;\r\n        me.setOpt('wordCount', true);\r\n        me.addListener('contentchange', function () {\r\n            me.fireEvent('wordcount');\r\n        });\r\n        var timer;\r\n        me.addListener('ready', function () {\r\n            var me = this;\r\n            domUtils.on(me.body, \"keyup\", function (evt) {\r\n                var code = evt.keyCode || evt.which,\r\n                    //忽略的按键,ctr,alt,shift,方向键\r\n                    ignores = { \"16\": 1, \"18\": 1, \"20\": 1, \"37\": 1, \"38\": 1, \"39\": 1, \"40\": 1 };\r\n                if (code in ignores) return;\r\n                clearTimeout(timer);\r\n                timer = setTimeout(function () {\r\n                    me.fireEvent('wordcount');\r\n                }, 200)\r\n            })\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/pagebreak.js\r\n    /**\r\n     * 分页功能插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    UE.plugins['pagebreak'] = function () {\r\n        var me = this,\r\n            notBreakTags = ['td'];\r\n        me.setOpt('pageBreakTag', '_ueditor_page_break_tag_');\r\n\r\n        function fillNode(node) {\r\n            if (domUtils.isEmptyBlock(node)) {\r\n                var firstChild = node.firstChild, tmpNode;\r\n\r\n                while (firstChild && firstChild.nodeType == 1 && domUtils.isEmptyBlock(firstChild)) {\r\n                    tmpNode = firstChild;\r\n                    firstChild = firstChild.firstChild;\r\n                }\r\n                !tmpNode && (tmpNode = node);\r\n                domUtils.fillNode(me.document, tmpNode);\r\n            }\r\n        }\r\n        //分页符样式添加\r\n\r\n        me.ready(function () {\r\n            utils.cssRule('pagebreak', '.pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}', me.document);\r\n        });\r\n        function isHr(node) {\r\n            return node && node.nodeType == 1 && node.tagName == 'HR' && node.className == 'pagebreak';\r\n        }\r\n        me.addInputRule(function (root) {\r\n            root.traversal(function (node) {\r\n                if (node.type == 'text' && node.data == me.options.pageBreakTag) {\r\n                    var hr = UE.uNode.createElement('<hr class=\"pagebreak\" noshade=\"noshade\" size=\"5\" style=\"-webkit-user-select: none;\">');\r\n                    node.parentNode.insertBefore(hr, node);\r\n                    node.parentNode.removeChild(node)\r\n                }\r\n            })\r\n        });\r\n        me.addOutputRule(function (node) {\r\n            utils.each(node.getNodesByTagName('hr'), function (n) {\r\n                if (n.getAttr('class') == 'pagebreak') {\r\n                    var txt = UE.uNode.createText(me.options.pageBreakTag);\r\n                    n.parentNode.insertBefore(txt, n);\r\n                    n.parentNode.removeChild(n);\r\n                }\r\n            })\r\n\r\n        });\r\n\r\n        /**\r\n         * 插入分页符\r\n         * @command pagebreak\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @remind 在表格中插入分页符会把表格切分成两部分\r\n         * @remind 获取编辑器内的数据时， 编辑器会把分页符转换成“_ueditor_page_break_tag_”字符串，\r\n         *          以便于提交数据到服务器端后处理分页。\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'pagebreak'); //插入一个hr标签，带有样式类名pagebreak\r\n         * ```\r\n         */\r\n\r\n        me.commands['pagebreak'] = {\r\n            execCommand: function () {\r\n                var range = me.selection.getRange(), hr = me.document.createElement('hr');\r\n                domUtils.setAttributes(hr, {\r\n                    'class': 'pagebreak',\r\n                    noshade: \"noshade\",\r\n                    size: \"5\"\r\n                });\r\n                domUtils.unSelectable(hr);\r\n                //table单独处理\r\n                var node = domUtils.findParentByTagName(range.startContainer, notBreakTags, true),\r\n\r\n                    parents = [], pN;\r\n                if (node) {\r\n                    switch (node.tagName) {\r\n                        case 'TD':\r\n                            pN = node.parentNode;\r\n                            if (!pN.previousSibling) {\r\n                                var table = domUtils.findParentByTagName(pN, 'table');\r\n                                //                            var tableWrapDiv = table.parentNode;\r\n                                //                            if(tableWrapDiv && tableWrapDiv.nodeType == 1\r\n                                //                                && tableWrapDiv.tagName == 'DIV'\r\n                                //                                && tableWrapDiv.getAttribute('dropdrag')\r\n                                //                                ){\r\n                                //                                domUtils.remove(tableWrapDiv,true);\r\n                                //                            }\r\n                                table.parentNode.insertBefore(hr, table);\r\n                                parents = domUtils.findParents(hr, true);\r\n\r\n                            } else {\r\n                                pN.parentNode.insertBefore(hr, pN);\r\n                                parents = domUtils.findParents(hr);\r\n\r\n                            }\r\n                            pN = parents[1];\r\n                            if (hr !== pN) {\r\n                                domUtils.breakParent(hr, pN);\r\n\r\n                            }\r\n                            //table要重写绑定一下拖拽\r\n                            me.fireEvent('afteradjusttable', me.document);\r\n                    }\r\n\r\n                } else {\r\n\r\n                    if (!range.collapsed) {\r\n                        range.deleteContents();\r\n                        var start = range.startContainer;\r\n                        while (!domUtils.isBody(start) && domUtils.isBlockElm(start) && domUtils.isEmptyNode(start)) {\r\n                            range.setStartBefore(start).collapse(true);\r\n                            domUtils.remove(start);\r\n                            start = range.startContainer;\r\n                        }\r\n\r\n                    }\r\n                    range.insertNode(hr);\r\n\r\n                    var pN = hr.parentNode, nextNode;\r\n                    while (!domUtils.isBody(pN)) {\r\n                        domUtils.breakParent(hr, pN);\r\n                        nextNode = hr.nextSibling;\r\n                        if (nextNode && domUtils.isEmptyBlock(nextNode)) {\r\n                            domUtils.remove(nextNode);\r\n                        }\r\n                        pN = hr.parentNode;\r\n                    }\r\n                    nextNode = hr.nextSibling;\r\n                    var pre = hr.previousSibling;\r\n                    if (isHr(pre)) {\r\n                        domUtils.remove(pre);\r\n                    } else {\r\n                        pre && fillNode(pre);\r\n                    }\r\n\r\n                    if (!nextNode) {\r\n                        var p = me.document.createElement('p');\r\n\r\n                        hr.parentNode.appendChild(p);\r\n                        domUtils.fillNode(me.document, p);\r\n                        range.setStart(p, 0).collapse(true);\r\n                    } else {\r\n                        if (isHr(nextNode)) {\r\n                            domUtils.remove(nextNode);\r\n                        } else {\r\n                            fillNode(nextNode);\r\n                        }\r\n                        range.setEndAfter(hr).collapse(false);\r\n                    }\r\n\r\n                    range.select(true);\r\n\r\n                }\r\n\r\n            }\r\n        };\r\n    };\r\n\r\n    // plugins/wordimage.js\r\n    ///import core\r\n    ///commands 本地图片引导上传\r\n    ///commandsName  WordImage\r\n    ///commandsTitle  本地图片引导上传\r\n    ///commandsDialog  dialogs\\wordimage\r\n\r\n    UE.plugin.register('wordimage', function () {\r\n        var me = this,\r\n            images = [];\r\n        return {\r\n            commands: {\r\n                'wordimage': {\r\n                    execCommand: function () {\r\n                        var images = domUtils.getElementsByTagName(me.body, \"img\");\r\n                        var urlList = [];\r\n                        for (var i = 0, ci; ci = images[i++];) {\r\n                            var url = ci.getAttribute(\"word_img\");\r\n                            url && urlList.push(url);\r\n                        }\r\n                        return urlList;\r\n                    },\r\n                    queryCommandState: function () {\r\n                        images = domUtils.getElementsByTagName(me.body, \"img\");\r\n                        for (var i = 0, ci; ci = images[i++];) {\r\n                            if (ci.getAttribute(\"word_img\")) {\r\n                                return 1;\r\n                            }\r\n                        }\r\n                        return -1;\r\n                    },\r\n                    notNeedUndo: true\r\n                }\r\n            },\r\n            inputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (img) {\r\n                    var attrs = img.attrs,\r\n                        flag = parseInt(attrs.width) < 128 || parseInt(attrs.height) < 43,\r\n                        opt = me.options,\r\n                        src = opt.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif';\r\n                    if (attrs['src'] && /^(?:(file:\\/+))/.test(attrs['src'])) {\r\n                        img.setAttr({\r\n                            width: attrs.width,\r\n                            height: attrs.height,\r\n                            alt: attrs.alt,\r\n                            word_img: attrs.src,\r\n                            src: src,\r\n                            'style': 'background:url(' + (flag ? opt.themePath + opt.theme + '/images/word.gif' : opt.langPath + opt.lang + '/images/localimage.png') + ') no-repeat center center;border:1px solid #ddd'\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/dragdrop.js\r\n    UE.plugins['dragdrop'] = function () {\r\n\r\n        var me = this;\r\n        me.ready(function () {\r\n            domUtils.on(this.body, 'dragend', function () {\r\n                var rng = me.selection.getRange();\r\n                var node = rng.getClosedNode() || me.selection.getStart();\r\n\r\n                if (node && node.tagName == 'IMG') {\r\n\r\n                    var pre = node.previousSibling, next;\r\n                    while (next = node.nextSibling) {\r\n                        if (next.nodeType == 1 && next.tagName == 'SPAN' && !next.firstChild) {\r\n                            domUtils.remove(next)\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n\r\n                    if ((pre && pre.nodeType == 1 && !domUtils.isEmptyBlock(pre) || !pre) && (!next || next && !domUtils.isEmptyBlock(next))) {\r\n                        if (pre && pre.tagName == 'P' && !domUtils.isEmptyBlock(pre)) {\r\n                            pre.appendChild(node);\r\n                            domUtils.moveChild(next, pre);\r\n                            domUtils.remove(next);\r\n                        } else if (next && next.tagName == 'P' && !domUtils.isEmptyBlock(next)) {\r\n                            next.insertBefore(node, next.firstChild);\r\n                        }\r\n\r\n                        if (pre && pre.tagName == 'P' && domUtils.isEmptyBlock(pre)) {\r\n                            domUtils.remove(pre)\r\n                        }\r\n                        if (next && next.tagName == 'P' && domUtils.isEmptyBlock(next)) {\r\n                            domUtils.remove(next)\r\n                        }\r\n                        rng.selectNode(node).select();\r\n                        me.fireEvent('saveScene');\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            })\r\n        });\r\n        me.addListener('keyup', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 13) {\r\n                var rng = me.selection.getRange(), node;\r\n                if (node = domUtils.findParentByTagName(rng.startContainer, 'p', true)) {\r\n                    if (domUtils.getComputedStyle(node, 'text-align') == 'center') {\r\n                        domUtils.removeStyle(node, 'text-align')\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    };\r\n\r\n\r\n    // plugins/undo.js\r\n    /**\r\n     * undo redo\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 撤销上一次执行的命令\r\n     * @command undo\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'undo' );\r\n     * ```\r\n     */\r\n\r\n    /**\r\n     * 重做上一次执行的命令\r\n     * @command redo\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'redo' );\r\n     * ```\r\n     */\r\n\r\n    UE.plugins['undo'] = function () {\r\n        var saveSceneTimer;\r\n        var me = this,\r\n            maxUndoCount = me.options.maxUndoCount || 20,\r\n            maxInputCount = me.options.maxInputCount || 20,\r\n            fillchar = new RegExp(domUtils.fillChar + '|<\\/hr>', 'gi');// ie会产生多余的</hr>\r\n        var noNeedFillCharTags = {\r\n            ol: 1, ul: 1, table: 1, tbody: 1, tr: 1, body: 1\r\n        };\r\n        var orgState = me.options.autoClearEmptyNode;\r\n        function compareAddr(indexA, indexB) {\r\n            if (indexA.length != indexB.length)\r\n                return 0;\r\n            for (var i = 0, l = indexA.length; i < l; i++) {\r\n                if (indexA[i] != indexB[i])\r\n                    return 0\r\n            }\r\n            return 1;\r\n        }\r\n\r\n        function compareRangeAddress(rngAddrA, rngAddrB) {\r\n            if (rngAddrA.collapsed != rngAddrB.collapsed) {\r\n                return 0;\r\n            }\r\n            if (!compareAddr(rngAddrA.startAddress, rngAddrB.startAddress) || !compareAddr(rngAddrA.endAddress, rngAddrB.endAddress)) {\r\n                return 0;\r\n            }\r\n            return 1;\r\n        }\r\n\r\n        function UndoManager() {\r\n            this.list = [];\r\n            this.index = 0;\r\n            this.hasUndo = false;\r\n            this.hasRedo = false;\r\n            this.undo = function () {\r\n                if (this.hasUndo) {\r\n                    if (!this.list[this.index - 1] && this.list.length == 1) {\r\n                        this.reset();\r\n                        return;\r\n                    }\r\n                    while (this.list[this.index].content == this.list[this.index - 1].content) {\r\n                        this.index--;\r\n                        if (this.index == 0) {\r\n                            return this.restore(0);\r\n                        }\r\n                    }\r\n                    this.restore(--this.index);\r\n                }\r\n            };\r\n            this.redo = function () {\r\n                if (this.hasRedo) {\r\n                    while (this.list[this.index].content == this.list[this.index + 1].content) {\r\n                        this.index++;\r\n                        if (this.index == this.list.length - 1) {\r\n                            return this.restore(this.index);\r\n                        }\r\n                    }\r\n                    this.restore(++this.index);\r\n                }\r\n            };\r\n\r\n            this.restore = function () {\r\n                var me = this.editor;\r\n                var scene = this.list[this.index];\r\n                var root = UE.htmlparser(scene.content.replace(fillchar, ''));\r\n                me.options.autoClearEmptyNode = false;\r\n                me.filterInputRule(root);\r\n                me.options.autoClearEmptyNode = orgState;\r\n                //trace:873\r\n                //去掉展位符\r\n                me.document.body.innerHTML = root.toHtml();\r\n                me.fireEvent('afterscencerestore');\r\n                //处理undo后空格不展位的问题\r\n                if (browser.ie) {\r\n                    utils.each(domUtils.getElementsByTagName(me.document, 'td th caption p'), function (node) {\r\n                        if (domUtils.isEmptyNode(node)) {\r\n                            domUtils.fillNode(me.document, node);\r\n                        }\r\n                    })\r\n                }\r\n\r\n                try {\r\n                    var rng = new dom.Range(me.document).moveToAddress(scene.address);\r\n                    rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()]);\r\n                } catch (e) { }\r\n\r\n                this.update();\r\n                this.clearKey();\r\n                //不能把自己reset了\r\n                me.fireEvent('reset', true);\r\n            };\r\n\r\n            this.getScene = function () {\r\n                var me = this.editor;\r\n                var rng = me.selection.getRange(),\r\n                    rngAddress = rng.createAddress(false, true);\r\n                me.fireEvent('beforegetscene');\r\n                var root = UE.htmlparser(me.body.innerHTML);\r\n                me.options.autoClearEmptyNode = false;\r\n                me.filterOutputRule(root);\r\n                me.options.autoClearEmptyNode = orgState;\r\n                var cont = root.toHtml();\r\n                //trace:3461\r\n                //这个会引起回退时导致空格丢失的情况\r\n                //            browser.ie && (cont = cont.replace(/>&nbsp;</g, '><').replace(/\\s*</g, '<').replace(/>\\s*/g, '>'));\r\n                me.fireEvent('aftergetscene');\r\n\r\n                return {\r\n                    address: rngAddress,\r\n                    content: cont\r\n                }\r\n            };\r\n            this.save = function (notCompareRange, notSetCursor) {\r\n                clearTimeout(saveSceneTimer);\r\n                var currentScene = this.getScene(notSetCursor),\r\n                    lastScene = this.list[this.index];\r\n\r\n                if (lastScene && lastScene.content != currentScene.content) {\r\n                    me.trigger('contentchange')\r\n                }\r\n                //内容相同位置相同不存\r\n                if (lastScene && lastScene.content == currentScene.content &&\r\n                    (notCompareRange ? 1 : compareRangeAddress(lastScene.address, currentScene.address))\r\n                ) {\r\n                    return;\r\n                }\r\n                this.list = this.list.slice(0, this.index + 1);\r\n                this.list.push(currentScene);\r\n                //如果大于最大数量了，就把最前的剔除\r\n                if (this.list.length > maxUndoCount) {\r\n                    this.list.shift();\r\n                }\r\n                this.index = this.list.length - 1;\r\n                this.clearKey();\r\n                //跟新undo/redo状态\r\n                this.update();\r\n\r\n            };\r\n            this.update = function () {\r\n                this.hasRedo = !!this.list[this.index + 1];\r\n                this.hasUndo = !!this.list[this.index - 1];\r\n            };\r\n            this.reset = function () {\r\n                this.list = [];\r\n                this.index = 0;\r\n                this.hasUndo = false;\r\n                this.hasRedo = false;\r\n                this.clearKey();\r\n            };\r\n            this.clearKey = function () {\r\n                keycont = 0;\r\n                lastKeyCode = null;\r\n            };\r\n        }\r\n\r\n        me.undoManger = new UndoManager();\r\n        me.undoManger.editor = me;\r\n        function saveScene() {\r\n            this.undoManger.save();\r\n        }\r\n\r\n        me.addListener('saveScene', function () {\r\n            var args = Array.prototype.splice.call(arguments, 1);\r\n            this.undoManger.save.apply(this.undoManger, args);\r\n        });\r\n\r\n        //    me.addListener('beforeexeccommand', saveScene);\r\n        //    me.addListener('afterexeccommand', saveScene);\r\n\r\n        me.addListener('reset', function (type, exclude) {\r\n            if (!exclude) {\r\n                this.undoManger.reset();\r\n            }\r\n        });\r\n        me.commands['redo'] = me.commands['undo'] = {\r\n            execCommand: function (cmdName) {\r\n                this.undoManger[cmdName]();\r\n            },\r\n            queryCommandState: function (cmdName) {\r\n                return this.undoManger['has' + (cmdName.toLowerCase() == 'undo' ? 'Undo' : 'Redo')] ? 0 : -1;\r\n            },\r\n            notNeedUndo: 1\r\n        };\r\n\r\n        var keys = {\r\n            //  /*Backspace*/ 8:1, /*Delete*/ 46:1,\r\n            /*Shift*/ 16: 1, /*Ctrl*/ 17: 1, /*Alt*/ 18: 1,\r\n            37: 1, 38: 1, 39: 1, 40: 1\r\n\r\n        },\r\n            keycont = 0,\r\n            lastKeyCode;\r\n        //输入法状态下不计算字符数\r\n        var inputType = false;\r\n        me.addListener('ready', function () {\r\n            domUtils.on(this.body, 'compositionstart', function () {\r\n                inputType = true;\r\n            });\r\n            domUtils.on(this.body, 'compositionend', function () {\r\n                inputType = false;\r\n            })\r\n        });\r\n        //快捷键\r\n        me.addshortcutkey({\r\n            \"Undo\": \"ctrl+90\", //undo\r\n            \"Redo\": \"ctrl+89\" //redo\r\n\r\n        });\r\n        var isCollapsed = true;\r\n        me.addListener('keydown', function (type, evt) {\r\n\r\n            var me = this;\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey) {\r\n                if (inputType)\r\n                    return;\r\n\r\n                if (!me.selection.getRange().collapsed) {\r\n                    me.undoManger.save(false, true);\r\n                    isCollapsed = false;\r\n                    return;\r\n                }\r\n                if (me.undoManger.list.length == 0) {\r\n                    me.undoManger.save(true);\r\n                }\r\n                clearTimeout(saveSceneTimer);\r\n                function save(cont) {\r\n                    cont.undoManger.save(false, true);\r\n                    cont.fireEvent('selectionchange');\r\n                }\r\n                saveSceneTimer = setTimeout(function () {\r\n                    if (inputType) {\r\n                        var interalTimer = setInterval(function () {\r\n                            if (!inputType) {\r\n                                save(me);\r\n                                clearInterval(interalTimer)\r\n                            }\r\n                        }, 300)\r\n                        return;\r\n                    }\r\n                    save(me);\r\n                }, 200);\r\n\r\n                lastKeyCode = keyCode;\r\n                keycont++;\r\n                if (keycont >= maxInputCount) {\r\n                    save(me)\r\n                }\r\n            }\r\n        });\r\n        me.addListener('keyup', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey) {\r\n                if (inputType)\r\n                    return;\r\n                if (!isCollapsed) {\r\n                    this.undoManger.save(false, true);\r\n                    isCollapsed = true;\r\n                }\r\n            }\r\n        });\r\n        //扩展实例，添加关闭和开启命令undo\r\n        me.stopCmdUndo = function () {\r\n            me.__hasEnterExecCommand = true;\r\n        };\r\n        me.startCmdUndo = function () {\r\n            me.__hasEnterExecCommand = false;\r\n        }\r\n    };\r\n\r\n\r\n    // plugins/copy.js\r\n    UE.plugin.register('copy', function () {\r\n\r\n        var me = this;\r\n\r\n        function initZeroClipboard() {\r\n            ZeroClipboard.config({\r\n                debug: false,\r\n                swfPath: me.options.UEDITOR_HOME_URL + 'third-party/zeroclipboard/ZeroClipboard.swf'\r\n            });\r\n\r\n            var client = me.zeroclipboard = new ZeroClipboard();\r\n\r\n            // 复制内容\r\n            client.on('copy', function (e) {\r\n                var client = e.client,\r\n                    rng = me.selection.getRange(),\r\n                    div = document.createElement('div');\r\n\r\n                div.appendChild(rng.cloneContents());\r\n                client.setText(div.innerText || div.textContent);\r\n                client.setHtml(div.innerHTML);\r\n                rng.select();\r\n            });\r\n            // hover事件传递到target\r\n            client.on('mouseover mouseout', function (e) {\r\n                var target = e.target;\r\n                if (e.type == 'mouseover') {\r\n                    domUtils.addClass(target, 'edui-state-hover');\r\n                } else if (e.type == 'mouseout') {\r\n                    domUtils.removeClasses(target, 'edui-state-hover');\r\n                }\r\n            });\r\n            // flash加载不成功\r\n            client.on('wrongflash noflash', function () {\r\n                ZeroClipboard.destroy();\r\n            });\r\n        }\r\n\r\n        return {\r\n            bindEvents: {\r\n                'ready': function () {\r\n                    if (!browser.ie) {\r\n                        if (window.ZeroClipboard) {\r\n                            initZeroClipboard();\r\n                        } else {\r\n                            utils.loadFile(document, {\r\n                                src: me.options.UEDITOR_HOME_URL + \"third-party/zeroclipboard/ZeroClipboard.js\",\r\n                                tag: \"script\",\r\n                                type: \"text/javascript\",\r\n                                defer: \"defer\"\r\n                            }, function () {\r\n                                initZeroClipboard();\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            commands: {\r\n                'copy': {\r\n                    execCommand: function (cmd) {\r\n                        if (!me.document.execCommand('copy')) {\r\n                            alert(me.getLang('copymsg'));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // plugins/paste.js\r\n    ///import core\r\n    ///import plugins/inserthtml.js\r\n    ///import plugins/undo.js\r\n    ///import plugins/serialize.js\r\n    ///commands 粘贴\r\n    ///commandsName  PastePlain\r\n    ///commandsTitle  纯文本粘贴模式\r\n    /**\r\n     * @description 粘贴\r\n     * @author zhanyi\r\n     */\r\n    UE.plugins['paste'] = function () {\r\n        function getClipboardData(callback) {\r\n            var doc = this.document;\r\n            if (doc.getElementById('baidu_pastebin')) {\r\n                return;\r\n            }\r\n            var range = this.selection.getRange(),\r\n                bk = range.createBookmark(),\r\n                //创建剪贴的容器div\r\n                pastebin = doc.createElement('div');\r\n            pastebin.id = 'baidu_pastebin';\r\n            // Safari 要求div必须有内容，才能粘贴内容进来\r\n            browser.webkit && pastebin.appendChild(doc.createTextNode(domUtils.fillChar + domUtils.fillChar));\r\n            doc.body.appendChild(pastebin);\r\n            //trace:717 隐藏的span不能得到top\r\n            //bk.start.innerHTML = '&nbsp;';\r\n            bk.start.style.display = '';\r\n            pastebin.style.cssText = \"position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:\" +\r\n                //要在现在光标平行的位置加入，否则会出现跳动的问题\r\n                domUtils.getXY(bk.start).y + 'px';\r\n\r\n            range.selectNodeContents(pastebin).select(true);\r\n\r\n            setTimeout(function () {\r\n                if (browser.webkit) {\r\n                    for (var i = 0, pastebins = doc.querySelectorAll('#baidu_pastebin'), pi; pi = pastebins[i++];) {\r\n                        if (domUtils.isEmptyNode(pi)) {\r\n                            domUtils.remove(pi);\r\n                        } else {\r\n                            pastebin = pi;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                try {\r\n                    pastebin.parentNode.removeChild(pastebin);\r\n                } catch (e) {\r\n                }\r\n                range.moveToBookmark(bk).select(true);\r\n                callback(pastebin);\r\n            }, 0);\r\n        }\r\n\r\n        var me = this;\r\n\r\n        me.setOpt({\r\n            retainOnlyLabelPasted: false\r\n        });\r\n\r\n        var txtContent, htmlContent, address;\r\n\r\n        function getPureHtml(html) {\r\n            return html.replace(/<(\\/?)([\\w\\-]+)([^>]*)>/gi, function (a, b, tagName, attrs) {\r\n                tagName = tagName.toLowerCase();\r\n                if ({ img: 1 }[tagName]) {\r\n                    return a;\r\n                }\r\n                attrs = attrs.replace(/([\\w\\-]*?)\\s*=\\s*((\"([^\"]*)\")|('([^']*)')|([^\\s>]+))/gi, function (str, atr, val) {\r\n                    if ({\r\n                        'src': 1,\r\n                        'href': 1,\r\n                        'name': 1\r\n                    }[atr.toLowerCase()]) {\r\n                        return atr + '=' + val + ' '\r\n                    }\r\n                    return ''\r\n                });\r\n                if ({\r\n                    'span': 1,\r\n                    'div': 1\r\n                }[tagName]) {\r\n                    return ''\r\n                } else {\r\n\r\n                    return '<' + b + tagName + ' ' + utils.trim(attrs) + '>'\r\n                }\r\n\r\n            });\r\n        }\r\n        function filter(div) {\r\n            var html;\r\n            if (div.firstChild) {\r\n                //去掉cut中添加的边界值\r\n                var nodes = domUtils.getElementsByTagName(div, 'span');\r\n                for (var i = 0, ni; ni = nodes[i++];) {\r\n                    if (ni.id == '_baidu_cut_start' || ni.id == '_baidu_cut_end') {\r\n                        domUtils.remove(ni);\r\n                    }\r\n                }\r\n\r\n                if (browser.webkit) {\r\n\r\n                    var brs = div.querySelectorAll('div br');\r\n                    for (var i = 0, bi; bi = brs[i++];) {\r\n                        var pN = bi.parentNode;\r\n                        if (pN.tagName == 'DIV' && pN.childNodes.length == 1) {\r\n                            pN.innerHTML = '<p><br/></p>';\r\n                            domUtils.remove(pN);\r\n                        }\r\n                    }\r\n                    var divs = div.querySelectorAll('#baidu_pastebin');\r\n                    for (var i = 0, di; di = divs[i++];) {\r\n                        var tmpP = me.document.createElement('p');\r\n                        di.parentNode.insertBefore(tmpP, di);\r\n                        while (di.firstChild) {\r\n                            tmpP.appendChild(di.firstChild);\r\n                        }\r\n                        domUtils.remove(di);\r\n                    }\r\n\r\n                    var metas = div.querySelectorAll('meta');\r\n                    for (var i = 0, ci; ci = metas[i++];) {\r\n                        domUtils.remove(ci);\r\n                    }\r\n\r\n                    var brs = div.querySelectorAll('br');\r\n                    for (i = 0; ci = brs[i++];) {\r\n                        if (/^apple-/i.test(ci.className)) {\r\n                            domUtils.remove(ci);\r\n                        }\r\n                    }\r\n                }\r\n                if (browser.gecko) {\r\n                    var dirtyNodes = div.querySelectorAll('[_moz_dirty]');\r\n                    for (i = 0; ci = dirtyNodes[i++];) {\r\n                        ci.removeAttribute('_moz_dirty');\r\n                    }\r\n                }\r\n                if (!browser.ie) {\r\n                    var spans = div.querySelectorAll('span.Apple-style-span');\r\n                    for (var i = 0, ci; ci = spans[i++];) {\r\n                        domUtils.remove(ci, true);\r\n                    }\r\n                }\r\n\r\n                //ie下使用innerHTML会产生多余的\\r\\n字符，也会产生&nbsp;这里过滤掉\r\n                html = div.innerHTML;//.replace(/>(?:(\\s|&nbsp;)*?)</g,'><');\r\n\r\n                //过滤word粘贴过来的冗余属性\r\n                html = UE.filterWord(html);\r\n                //取消了忽略空白的第二个参数，粘贴过来的有些是有空白的，会被套上相关的标签\r\n                var root = UE.htmlparser(html);\r\n                //如果给了过滤规则就先进行过滤\r\n                if (me.options.filterRules) {\r\n                    UE.filterNode(root, me.options.filterRules);\r\n                }\r\n                //执行默认的处理\r\n                me.filterInputRule(root);\r\n                //针对chrome的处理\r\n                if (browser.webkit) {\r\n                    var br = root.lastChild();\r\n                    if (br && br.type == 'element' && br.tagName == 'br') {\r\n                        root.removeChild(br)\r\n                    }\r\n                    utils.each(me.body.querySelectorAll('div'), function (node) {\r\n                        if (domUtils.isEmptyBlock(node)) {\r\n                            domUtils.remove(node, true)\r\n                        }\r\n                    })\r\n                }\r\n                html = { 'html': root.toHtml() };\r\n                me.fireEvent('beforepaste', html, root);\r\n                //抢了默认的粘贴，那后边的内容就不执行了，比如表格粘贴\r\n                if (!html.html) {\r\n                    return;\r\n                }\r\n                root = UE.htmlparser(html.html, true);\r\n                //如果开启了纯文本模式\r\n                if (me.queryCommandState('pasteplain') === 1) {\r\n                    me.execCommand('insertHtml', UE.filterNode(root, me.options.filterTxtRules).toHtml(), true);\r\n                } else {\r\n                    //文本模式\r\n                    UE.filterNode(root, me.options.filterTxtRules);\r\n                    txtContent = root.toHtml();\r\n                    //完全模式\r\n                    htmlContent = html.html;\r\n\r\n                    address = me.selection.getRange().createAddress(true);\r\n                    me.execCommand('insertHtml', me.getOpt('retainOnlyLabelPasted') === true ? getPureHtml(htmlContent) : htmlContent, true);\r\n                }\r\n                me.fireEvent(\"afterpaste\", html);\r\n            }\r\n        }\r\n\r\n        me.addListener('pasteTransfer', function (cmd, plainType) {\r\n\r\n            if (address && txtContent && htmlContent && txtContent != htmlContent) {\r\n                var range = me.selection.getRange();\r\n                range.moveToAddress(address, true);\r\n\r\n                if (!range.collapsed) {\r\n\r\n                    while (!domUtils.isBody(range.startContainer)\r\n                    ) {\r\n                        var start = range.startContainer;\r\n                        if (start.nodeType == 1) {\r\n                            start = start.childNodes[range.startOffset];\r\n                            if (!start) {\r\n                                range.setStartBefore(range.startContainer);\r\n                                continue;\r\n                            }\r\n                            var pre = start.previousSibling;\r\n\r\n                            if (pre && pre.nodeType == 3 && new RegExp('^[\\n\\r\\t ' + domUtils.fillChar + ']*$').test(pre.nodeValue)) {\r\n                                range.setStartBefore(pre)\r\n                            }\r\n                        }\r\n                        if (range.startOffset == 0) {\r\n                            range.setStartBefore(range.startContainer);\r\n                        } else {\r\n                            break;\r\n                        }\r\n\r\n                    }\r\n                    while (!domUtils.isBody(range.endContainer)\r\n                    ) {\r\n                        var end = range.endContainer;\r\n                        if (end.nodeType == 1) {\r\n                            end = end.childNodes[range.endOffset];\r\n                            if (!end) {\r\n                                range.setEndAfter(range.endContainer);\r\n                                continue;\r\n                            }\r\n                            var next = end.nextSibling;\r\n                            if (next && next.nodeType == 3 && new RegExp('^[\\n\\r\\t' + domUtils.fillChar + ']*$').test(next.nodeValue)) {\r\n                                range.setEndAfter(next)\r\n                            }\r\n                        }\r\n                        if (range.endOffset == range.endContainer[range.endContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length) {\r\n                            range.setEndAfter(range.endContainer);\r\n                        } else {\r\n                            break;\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                range.deleteContents();\r\n                range.select(true);\r\n                me.__hasEnterExecCommand = true;\r\n                var html = htmlContent;\r\n                if (plainType === 2) {\r\n                    html = getPureHtml(html);\r\n                } else if (plainType) {\r\n                    html = txtContent;\r\n                }\r\n                me.execCommand('inserthtml', html, true);\r\n                me.__hasEnterExecCommand = false;\r\n                var rng = me.selection.getRange();\r\n                while (!domUtils.isBody(rng.startContainer) && !rng.startOffset &&\r\n                    rng.startContainer[rng.startContainer.nodeType == 3 ? 'nodeValue' : 'childNodes'].length\r\n                ) {\r\n                    rng.setStartBefore(rng.startContainer);\r\n                }\r\n                var tmpAddress = rng.createAddress(true);\r\n                address.endAddress = tmpAddress.startAddress;\r\n            }\r\n        });\r\n\r\n        me.addListener('ready', function () {\r\n            domUtils.on(me.body, 'cut', function () {\r\n                var range = me.selection.getRange();\r\n                if (!range.collapsed && me.undoManger) {\r\n                    me.undoManger.save();\r\n                }\r\n            });\r\n\r\n            //ie下beforepaste在点击右键时也会触发，所以用监控键盘才处理\r\n            domUtils.on(me.body, browser.ie || browser.opera ? 'keydown' : 'paste', function (e) {\r\n                if ((browser.ie || browser.opera) && ((!e.ctrlKey && !e.metaKey) || e.keyCode != '86')) {\r\n                    return;\r\n                }\r\n                getClipboardData.call(me, function (div) {\r\n                    filter(div);\r\n                });\r\n            });\r\n\r\n        });\r\n\r\n        me.commands['paste'] = {\r\n            execCommand: function (cmd) {\r\n                if (browser.ie) {\r\n                    getClipboardData.call(me, function (div) {\r\n                        filter(div);\r\n                    });\r\n                    me.document.execCommand('paste');\r\n                } else {\r\n                    alert(me.getLang('pastemsg'));\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // plugins/puretxtpaste.js\r\n    /**\r\n     * 纯文本粘贴插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    UE.plugins['pasteplain'] = function () {\r\n        var me = this;\r\n        me.setOpt({\r\n            'pasteplain': false,\r\n            'filterTxtRules': function () {\r\n                function transP(node) {\r\n                    node.tagName = 'p';\r\n                    node.setStyle();\r\n                }\r\n                function removeNode(node) {\r\n                    node.parentNode.removeChild(node, true)\r\n                }\r\n                return {\r\n                    //直接删除及其字节点内容\r\n                    '-': 'script style object iframe embed input select',\r\n                    'p': { $: {} },\r\n                    'br': { $: {} },\r\n                    div: function (node) {\r\n                        var tmpNode, p = UE.uNode.createElement('p');\r\n                        while (tmpNode = node.firstChild()) {\r\n                            if (tmpNode.type == 'text' || !UE.dom.dtd.$block[tmpNode.tagName]) {\r\n                                p.appendChild(tmpNode);\r\n                            } else {\r\n                                if (p.firstChild()) {\r\n                                    node.parentNode.insertBefore(p, node);\r\n                                    p = UE.uNode.createElement('p');\r\n                                } else {\r\n                                    node.parentNode.insertBefore(tmpNode, node);\r\n                                }\r\n                            }\r\n                        }\r\n                        if (p.firstChild()) {\r\n                            node.parentNode.insertBefore(p, node);\r\n                        }\r\n                        node.parentNode.removeChild(node);\r\n                    },\r\n                    ol: removeNode,\r\n                    ul: removeNode,\r\n                    dl: removeNode,\r\n                    dt: removeNode,\r\n                    dd: removeNode,\r\n                    'li': removeNode,\r\n                    'caption': transP,\r\n                    'th': transP,\r\n                    'tr': transP,\r\n                    'h1': transP, 'h2': transP, 'h3': transP, 'h4': transP, 'h5': transP, 'h6': transP,\r\n                    'td': function (node) {\r\n                        //没有内容的td直接删掉\r\n                        var txt = !!node.innerText();\r\n                        if (txt) {\r\n                            node.parentNode.insertAfter(UE.uNode.createText(' &nbsp; &nbsp;'), node);\r\n                        }\r\n                        node.parentNode.removeChild(node, node.innerText())\r\n                    }\r\n                }\r\n            }()\r\n        });\r\n        //暂时这里支持一下老版本的属性\r\n        var pasteplain = me.options.pasteplain;\r\n\r\n        /**\r\n         * 启用或取消纯文本粘贴模式\r\n         * @command pasteplain\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState( 'pasteplain' );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 查询当前是否处于纯文本粘贴模式\r\n         * @command pasteplain\r\n         * @method queryCommandState\r\n         * @param { String } cmd 命令字符串\r\n         * @return { int } 如果处于纯文本模式，返回1，否则，返回0\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState( 'pasteplain' );\r\n         * ```\r\n         */\r\n        me.commands['pasteplain'] = {\r\n            queryCommandState: function () {\r\n                return pasteplain ? 1 : 0;\r\n            },\r\n            execCommand: function () {\r\n                pasteplain = !pasteplain | 0;\r\n            },\r\n            notNeedUndo: 1\r\n        };\r\n    };\r\n\r\n    // plugins/list.js\r\n    /**\r\n     * 有序列表,无序列表插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    UE.plugins['list'] = function () {\r\n        var me = this,\r\n            notExchange = {\r\n                'TD': 1,\r\n                'PRE': 1,\r\n                'BLOCKQUOTE': 1\r\n            };\r\n        var customStyle = {\r\n            'cn': 'cn-1-',\r\n            'cn1': 'cn-2-',\r\n            'cn2': 'cn-3-',\r\n            'num': 'num-1-',\r\n            'num1': 'num-2-',\r\n            'num2': 'num-3-',\r\n            'dash': 'dash',\r\n            'dot': 'dot'\r\n        };\r\n\r\n        me.setOpt({\r\n            'autoTransWordToList': false,\r\n            'insertorderedlist': {\r\n                'num': '',\r\n                'num1': '',\r\n                'num2': '',\r\n                'cn': '',\r\n                'cn1': '',\r\n                'cn2': '',\r\n                'decimal': '',\r\n                'lower-alpha': '',\r\n                'lower-roman': '',\r\n                'upper-alpha': '',\r\n                'upper-roman': ''\r\n            },\r\n            'insertunorderedlist': {\r\n                'circle': '',\r\n                'disc': '',\r\n                'square': '',\r\n                'dash': '',\r\n                'dot': ''\r\n            },\r\n            listDefaultPaddingLeft: '30',\r\n            listiconpath: 'http://bs.baidu.com/listicon/',\r\n            maxListLevel: -1,//-1不限制\r\n            disablePInList: false\r\n        });\r\n        function listToArray(list) {\r\n            var arr = [];\r\n            for (var p in list) {\r\n                arr.push(p)\r\n            }\r\n            return arr;\r\n        }\r\n        var listStyle = {\r\n            'OL': listToArray(me.options.insertorderedlist),\r\n            'UL': listToArray(me.options.insertunorderedlist)\r\n        };\r\n        var liiconpath = me.options.listiconpath;\r\n\r\n        //根据用户配置，调整customStyle\r\n        for (var s in customStyle) {\r\n            if (!me.options.insertorderedlist.hasOwnProperty(s) && !me.options.insertunorderedlist.hasOwnProperty(s)) {\r\n                delete customStyle[s];\r\n            }\r\n        }\r\n\r\n        me.ready(function () {\r\n            var customCss = [];\r\n            for (var p in customStyle) {\r\n                if (p == 'dash' || p == 'dot') {\r\n                    customCss.push('li.list-' + customStyle[p] + '{background-image:url(' + liiconpath + customStyle[p] + '.gif)}');\r\n                    customCss.push('ul.custom_' + p + '{list-style:none;}ul.custom_' + p + ' li{background-position:0 3px;background-repeat:no-repeat}');\r\n                } else {\r\n                    for (var i = 0; i < 99; i++) {\r\n                        customCss.push('li.list-' + customStyle[p] + i + '{background-image:url(' + liiconpath + 'list-' + customStyle[p] + i + '.gif)}')\r\n                    }\r\n                    customCss.push('ol.custom_' + p + '{list-style:none;}ol.custom_' + p + ' li{background-position:0 3px;background-repeat:no-repeat}');\r\n                }\r\n                switch (p) {\r\n                    case 'cn':\r\n                        customCss.push('li.list-' + p + '-paddingleft-1{padding-left:25px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-3{padding-left:55px}');\r\n                        break;\r\n                    case 'cn1':\r\n                        customCss.push('li.list-' + p + '-paddingleft-1{padding-left:30px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-3{padding-left:55px}');\r\n                        break;\r\n                    case 'cn2':\r\n                        customCss.push('li.list-' + p + '-paddingleft-1{padding-left:40px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-2{padding-left:55px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-3{padding-left:68px}');\r\n                        break;\r\n                    case 'num':\r\n                    case 'num1':\r\n                        customCss.push('li.list-' + p + '-paddingleft-1{padding-left:25px}');\r\n                        break;\r\n                    case 'num2':\r\n                        customCss.push('li.list-' + p + '-paddingleft-1{padding-left:35px}');\r\n                        customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');\r\n                        break;\r\n                    case 'dash':\r\n                        customCss.push('li.list-' + p + '-paddingleft{padding-left:35px}');\r\n                        break;\r\n                    case 'dot':\r\n                        customCss.push('li.list-' + p + '-paddingleft{padding-left:20px}');\r\n                }\r\n            }\r\n            customCss.push('.list-paddingleft-1{padding-left:0}');\r\n            customCss.push('.list-paddingleft-2{padding-left:' + me.options.listDefaultPaddingLeft + 'px}');\r\n            customCss.push('.list-paddingleft-3{padding-left:' + me.options.listDefaultPaddingLeft * 2 + 'px}');\r\n            //如果不给宽度会在自定应样式里出现滚动条\r\n            utils.cssRule('list', 'ol,ul{margin:0;pading:0;' + (browser.ie ? '' : 'width:95%') + '}li{clear:both;}' + customCss.join('\\n'), me.document);\r\n        });\r\n        //单独处理剪切的问题\r\n        me.ready(function () {\r\n            domUtils.on(me.body, 'cut', function () {\r\n                setTimeout(function () {\r\n                    var rng = me.selection.getRange(), li;\r\n                    //trace:3416\r\n                    if (!rng.collapsed) {\r\n                        if (li = domUtils.findParentByTagName(rng.startContainer, 'li', true)) {\r\n                            if (!li.nextSibling && domUtils.isEmptyBlock(li)) {\r\n                                var pn = li.parentNode, node;\r\n                                if (node = pn.previousSibling) {\r\n                                    domUtils.remove(pn);\r\n                                    rng.setStartAtLast(node).collapse(true);\r\n                                    rng.select(true);\r\n                                } else if (node = pn.nextSibling) {\r\n                                    domUtils.remove(pn);\r\n                                    rng.setStartAtFirst(node).collapse(true);\r\n                                    rng.select(true);\r\n                                } else {\r\n                                    var tmpNode = me.document.createElement('p');\r\n                                    domUtils.fillNode(me.document, tmpNode);\r\n                                    pn.parentNode.insertBefore(tmpNode, pn);\r\n                                    domUtils.remove(pn);\r\n                                    rng.setStart(tmpNode, 0).collapse(true);\r\n                                    rng.select(true);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                })\r\n            })\r\n        });\r\n\r\n        function getStyle(node) {\r\n            var cls = node.className;\r\n            if (domUtils.hasClass(node, /custom_/)) {\r\n                return cls.match(/custom_(\\w+)/)[1]\r\n            }\r\n            return domUtils.getStyle(node, 'list-style-type')\r\n\r\n        }\r\n\r\n        me.addListener('beforepaste', function (type, html) {\r\n            var me = this,\r\n                rng = me.selection.getRange(), li;\r\n            var root = UE.htmlparser(html.html, true);\r\n            if (li = domUtils.findParentByTagName(rng.startContainer, 'li', true)) {\r\n                var list = li.parentNode, tagName = list.tagName == 'OL' ? 'ul' : 'ol';\r\n                utils.each(root.getNodesByTagName(tagName), function (n) {\r\n                    n.tagName = list.tagName;\r\n                    n.setAttr();\r\n                    if (n.parentNode === root) {\r\n                        type = getStyle(list) || (list.tagName == 'OL' ? 'decimal' : 'disc')\r\n                    } else {\r\n                        var className = n.parentNode.getAttr('class');\r\n                        if (className && /custom_/.test(className)) {\r\n                            type = className.match(/custom_(\\w+)/)[1]\r\n                        } else {\r\n                            type = n.parentNode.getStyle('list-style-type');\r\n                        }\r\n                        if (!type) {\r\n                            type = list.tagName == 'OL' ? 'decimal' : 'disc';\r\n                        }\r\n                    }\r\n                    var index = utils.indexOf(listStyle[list.tagName], type);\r\n                    if (n.parentNode !== root)\r\n                        index = index + 1 == listStyle[list.tagName].length ? 0 : index + 1;\r\n                    var currentStyle = listStyle[list.tagName][index];\r\n                    if (customStyle[currentStyle]) {\r\n                        n.setAttr('class', 'custom_' + currentStyle)\r\n\r\n                    } else {\r\n                        n.setStyle('list-style-type', currentStyle)\r\n                    }\r\n                })\r\n\r\n            }\r\n\r\n            html.html = root.toHtml();\r\n        });\r\n        //导出时，去掉p标签\r\n        me.getOpt('disablePInList') === true && me.addOutputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('li'), function (li) {\r\n                var newChildrens = [], index = 0;\r\n                utils.each(li.children, function (n) {\r\n                    if (n.tagName == 'p') {\r\n                        var tmpNode;\r\n                        while (tmpNode = n.children.pop()) {\r\n                            newChildrens.splice(index, 0, tmpNode);\r\n                            tmpNode.parentNode = li;\r\n                            lastNode = tmpNode;\r\n                        }\r\n                        tmpNode = newChildrens[newChildrens.length - 1];\r\n                        if (!tmpNode || tmpNode.type != 'element' || tmpNode.tagName != 'br') {\r\n                            var br = UE.uNode.createElement('br');\r\n                            br.parentNode = li;\r\n                            newChildrens.push(br);\r\n                        }\r\n\r\n                        index = newChildrens.length;\r\n                    }\r\n                });\r\n                if (newChildrens.length) {\r\n                    li.children = newChildrens;\r\n                }\r\n            });\r\n        });\r\n        //进入编辑器的li要套p标签\r\n        me.addInputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('li'), function (li) {\r\n                var tmpP = UE.uNode.createElement('p');\r\n                for (var i = 0, ci; ci = li.children[i];) {\r\n                    if (ci.type == 'text' || dtd.p[ci.tagName]) {\r\n                        tmpP.appendChild(ci);\r\n                    } else {\r\n                        if (tmpP.firstChild()) {\r\n                            li.insertBefore(tmpP, ci);\r\n                            tmpP = UE.uNode.createElement('p');\r\n                            i = i + 2;\r\n                        } else {\r\n                            i++;\r\n                        }\r\n\r\n                    }\r\n                }\r\n                if (tmpP.firstChild() && !tmpP.parentNode || !li.firstChild()) {\r\n                    li.appendChild(tmpP);\r\n                }\r\n                //trace:3357\r\n                //p不能为空\r\n                if (!tmpP.firstChild()) {\r\n                    tmpP.innerHTML(browser.ie ? '&nbsp;' : '<br/>')\r\n                }\r\n                //去掉末尾的空白\r\n                var p = li.firstChild();\r\n                var lastChild = p.lastChild();\r\n                if (lastChild && lastChild.type == 'text' && /^\\s*$/.test(lastChild.data)) {\r\n                    p.removeChild(lastChild)\r\n                }\r\n            });\r\n            if (me.options.autoTransWordToList) {\r\n                var orderlisttype = {\r\n                    'num1': /^\\d+\\)/,\r\n                    'decimal': /^\\d+\\./,\r\n                    'lower-alpha': /^[a-z]+\\)/,\r\n                    'upper-alpha': /^[A-Z]+\\./,\r\n                    'cn': /^[\\u4E00\\u4E8C\\u4E09\\u56DB\\u516d\\u4e94\\u4e03\\u516b\\u4e5d]+[\\u3001]/,\r\n                    'cn2': /^\\([\\u4E00\\u4E8C\\u4E09\\u56DB\\u516d\\u4e94\\u4e03\\u516b\\u4e5d]+\\)/\r\n                },\r\n                    unorderlisttype = {\r\n                        'square': 'n'\r\n                    };\r\n                function checkListType(content, container) {\r\n                    var span = container.firstChild();\r\n                    if (span && span.type == 'element' && span.tagName == 'span' && /Wingdings|Symbol/.test(span.getStyle('font-family'))) {\r\n                        for (var p in unorderlisttype) {\r\n                            if (unorderlisttype[p] == span.data) {\r\n                                return p\r\n                            }\r\n                        }\r\n                        return 'disc'\r\n                    }\r\n                    for (var p in orderlisttype) {\r\n                        if (orderlisttype[p].test(content)) {\r\n                            return p;\r\n                        }\r\n                    }\r\n\r\n                }\r\n                utils.each(root.getNodesByTagName('p'), function (node) {\r\n                    if (node.getAttr('class') != 'MsoListParagraph') {\r\n                        return\r\n                    }\r\n\r\n                    //word粘贴过来的会带有margin要去掉,但这样也可能会误命中一些央视\r\n                    node.setStyle('margin', '');\r\n                    node.setStyle('margin-left', '');\r\n                    node.setAttr('class', '');\r\n\r\n                    function appendLi(list, p, type) {\r\n                        if (list.tagName == 'ol') {\r\n                            if (browser.ie) {\r\n                                var first = p.firstChild();\r\n                                if (first.type == 'element' && first.tagName == 'span' && orderlisttype[type].test(first.innerText())) {\r\n                                    p.removeChild(first);\r\n                                }\r\n                            } else {\r\n                                p.innerHTML(p.innerHTML().replace(orderlisttype[type], ''));\r\n                            }\r\n                        } else {\r\n                            p.removeChild(p.firstChild())\r\n                        }\r\n\r\n                        var li = UE.uNode.createElement('li');\r\n                        li.appendChild(p);\r\n                        list.appendChild(li);\r\n                    }\r\n                    var tmp = node, type, cacheNode = node;\r\n\r\n                    if (node.parentNode.tagName != 'li' && (type = checkListType(node.innerText(), node))) {\r\n\r\n                        var list = UE.uNode.createElement(me.options.insertorderedlist.hasOwnProperty(type) ? 'ol' : 'ul');\r\n                        if (customStyle[type]) {\r\n                            list.setAttr('class', 'custom_' + type)\r\n                        } else {\r\n                            list.setStyle('list-style-type', type)\r\n                        }\r\n                        while (node && node.parentNode.tagName != 'li' && checkListType(node.innerText(), node)) {\r\n                            tmp = node.nextSibling();\r\n                            if (!tmp) {\r\n                                node.parentNode.insertBefore(list, node)\r\n                            }\r\n                            appendLi(list, node, type);\r\n                            node = tmp;\r\n                        }\r\n                        if (!list.parentNode && node && node.parentNode) {\r\n                            node.parentNode.insertBefore(list, node)\r\n                        }\r\n                    }\r\n                    var span = cacheNode.firstChild();\r\n                    if (span && span.type == 'element' && span.tagName == 'span' && /^\\s*(&nbsp;)+\\s*$/.test(span.innerText())) {\r\n                        span.parentNode.removeChild(span)\r\n                    }\r\n                })\r\n            }\r\n\r\n        });\r\n\r\n        //调整索引标签\r\n        me.addListener('contentchange', function () {\r\n            adjustListStyle(me.document)\r\n        });\r\n\r\n        function adjustListStyle(doc, ignore) {\r\n            utils.each(domUtils.getElementsByTagName(doc, 'ol ul'), function (node) {\r\n\r\n                if (!domUtils.inDoc(node, doc))\r\n                    return;\r\n\r\n                var parent = node.parentNode;\r\n                if (parent.tagName == node.tagName) {\r\n                    var nodeStyleType = getStyle(node) || (node.tagName == 'OL' ? 'decimal' : 'disc'),\r\n                        parentStyleType = getStyle(parent) || (parent.tagName == 'OL' ? 'decimal' : 'disc');\r\n                    if (nodeStyleType == parentStyleType) {\r\n                        var styleIndex = utils.indexOf(listStyle[node.tagName], nodeStyleType);\r\n                        styleIndex = styleIndex + 1 == listStyle[node.tagName].length ? 0 : styleIndex + 1;\r\n                        setListStyle(node, listStyle[node.tagName][styleIndex])\r\n                    }\r\n\r\n                }\r\n                var index = 0, type = 2;\r\n                if (domUtils.hasClass(node, /custom_/)) {\r\n                    if (!(/[ou]l/i.test(parent.tagName) && domUtils.hasClass(parent, /custom_/))) {\r\n                        type = 1;\r\n                    }\r\n                } else {\r\n                    if (/[ou]l/i.test(parent.tagName) && domUtils.hasClass(parent, /custom_/)) {\r\n                        type = 3;\r\n                    }\r\n                }\r\n\r\n                var style = domUtils.getStyle(node, 'list-style-type');\r\n                style && (node.style.cssText = 'list-style-type:' + style);\r\n                node.className = utils.trim(node.className.replace(/list-paddingleft-\\w+/, '')) + ' list-paddingleft-' + type;\r\n                utils.each(domUtils.getElementsByTagName(node, 'li'), function (li) {\r\n                    li.style.cssText && (li.style.cssText = '');\r\n                    if (!li.firstChild) {\r\n                        domUtils.remove(li);\r\n                        return;\r\n                    }\r\n                    if (li.parentNode !== node) {\r\n                        return;\r\n                    }\r\n                    index++;\r\n                    if (domUtils.hasClass(node, /custom_/)) {\r\n                        var paddingLeft = 1, currentStyle = getStyle(node);\r\n                        if (node.tagName == 'OL') {\r\n                            if (currentStyle) {\r\n                                switch (currentStyle) {\r\n                                    case 'cn':\r\n                                    case 'cn1':\r\n                                    case 'cn2':\r\n                                        if (index > 10 && (index % 10 == 0 || index > 10 && index < 20)) {\r\n                                            paddingLeft = 2\r\n                                        } else if (index > 20) {\r\n                                            paddingLeft = 3\r\n                                        }\r\n                                        break;\r\n                                    case 'num2':\r\n                                        if (index > 9) {\r\n                                            paddingLeft = 2\r\n                                        }\r\n                                }\r\n                            }\r\n                            li.className = 'list-' + customStyle[currentStyle] + index + ' ' + 'list-' + currentStyle + '-paddingleft-' + paddingLeft;\r\n                        } else {\r\n                            li.className = 'list-' + customStyle[currentStyle] + ' ' + 'list-' + currentStyle + '-paddingleft';\r\n                        }\r\n                    } else {\r\n                        li.className = li.className.replace(/list-[\\w\\-]+/gi, '');\r\n                    }\r\n                    var className = li.getAttribute('class');\r\n                    if (className !== null && !className.replace(/\\s/g, '')) {\r\n                        domUtils.removeAttributes(li, 'class')\r\n                    }\r\n                });\r\n                !ignore && adjustList(node, node.tagName.toLowerCase(), getStyle(node) || domUtils.getStyle(node, 'list-style-type'), true);\r\n            })\r\n        }\r\n        function adjustList(list, tag, style, ignoreEmpty) {\r\n            var nextList = list.nextSibling;\r\n            if (nextList && nextList.nodeType == 1 && nextList.tagName.toLowerCase() == tag && (getStyle(nextList) || domUtils.getStyle(nextList, 'list-style-type') || (tag == 'ol' ? 'decimal' : 'disc')) == style) {\r\n                domUtils.moveChild(nextList, list);\r\n                if (nextList.childNodes.length == 0) {\r\n                    domUtils.remove(nextList);\r\n                }\r\n            }\r\n            if (nextList && domUtils.isFillChar(nextList)) {\r\n                domUtils.remove(nextList);\r\n            }\r\n            var preList = list.previousSibling;\r\n            if (preList && preList.nodeType == 1 && preList.tagName.toLowerCase() == tag && (getStyle(preList) || domUtils.getStyle(preList, 'list-style-type') || (tag == 'ol' ? 'decimal' : 'disc')) == style) {\r\n                domUtils.moveChild(list, preList);\r\n            }\r\n            if (preList && domUtils.isFillChar(preList)) {\r\n                domUtils.remove(preList);\r\n            }\r\n            !ignoreEmpty && domUtils.isEmptyBlock(list) && domUtils.remove(list);\r\n            if (getStyle(list)) {\r\n                adjustListStyle(list.ownerDocument, true)\r\n            }\r\n        }\r\n\r\n        function setListStyle(list, style) {\r\n            if (customStyle[style]) {\r\n                list.className = 'custom_' + style;\r\n            }\r\n            try {\r\n                domUtils.setStyle(list, 'list-style-type', style);\r\n            } catch (e) { }\r\n        }\r\n        function clearEmptySibling(node) {\r\n            var tmpNode = node.previousSibling;\r\n            if (tmpNode && domUtils.isEmptyBlock(tmpNode)) {\r\n                domUtils.remove(tmpNode);\r\n            }\r\n            tmpNode = node.nextSibling;\r\n            if (tmpNode && domUtils.isEmptyBlock(tmpNode)) {\r\n                domUtils.remove(tmpNode);\r\n            }\r\n        }\r\n\r\n        me.addListener('keydown', function (type, evt) {\r\n            function preventAndSave() {\r\n                evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\r\n                me.fireEvent('contentchange');\r\n                me.undoManger && me.undoManger.save();\r\n            }\r\n            function findList(node, filterFn) {\r\n                while (node && !domUtils.isBody(node)) {\r\n                    if (filterFn(node)) {\r\n                        return null\r\n                    }\r\n                    if (node.nodeType == 1 && /[ou]l/i.test(node.tagName)) {\r\n                        return node;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                return null;\r\n            }\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 13 && !evt.shiftKey) {//回车\r\n                var rng = me.selection.getRange(),\r\n                    parent = domUtils.findParent(rng.startContainer, function (node) { return domUtils.isBlockElm(node) }, true),\r\n                    li = domUtils.findParentByTagName(rng.startContainer, 'li', true);\r\n                if (parent && parent.tagName != 'PRE' && !li) {\r\n                    var html = parent.innerHTML.replace(new RegExp(domUtils.fillChar, 'g'), '');\r\n                    if (/^\\s*1\\s*\\.[^\\d]/.test(html)) {\r\n                        parent.innerHTML = html.replace(/^\\s*1\\s*\\./, '');\r\n                        rng.setStartAtLast(parent).collapse(true).select();\r\n                        me.__hasEnterExecCommand = true;\r\n                        me.execCommand('insertorderedlist');\r\n                        me.__hasEnterExecCommand = false;\r\n                    }\r\n                }\r\n                var range = me.selection.getRange(),\r\n                    start = findList(range.startContainer, function (node) {\r\n                        return node.tagName == 'TABLE';\r\n                    }),\r\n                    end = range.collapsed ? start : findList(range.endContainer, function (node) {\r\n                        return node.tagName == 'TABLE';\r\n                    });\r\n\r\n                if (start && end && start === end) {\r\n\r\n                    if (!range.collapsed) {\r\n                        start = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n                        end = domUtils.findParentByTagName(range.endContainer, 'li', true);\r\n                        if (start && end && start === end) {\r\n                            range.deleteContents();\r\n                            li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n                            if (li && domUtils.isEmptyBlock(li)) {\r\n\r\n                                pre = li.previousSibling;\r\n                                next = li.nextSibling;\r\n                                p = me.document.createElement('p');\r\n\r\n                                domUtils.fillNode(me.document, p);\r\n                                parentList = li.parentNode;\r\n                                if (pre && next) {\r\n                                    range.setStart(next, 0).collapse(true).select(true);\r\n                                    domUtils.remove(li);\r\n\r\n                                } else {\r\n                                    if (!pre && !next || !pre) {\r\n\r\n                                        parentList.parentNode.insertBefore(p, parentList);\r\n\r\n\r\n                                    } else {\r\n                                        li.parentNode.parentNode.insertBefore(p, parentList.nextSibling);\r\n                                    }\r\n                                    domUtils.remove(li);\r\n                                    if (!parentList.firstChild) {\r\n                                        domUtils.remove(parentList);\r\n                                    }\r\n                                    range.setStart(p, 0).setCursor();\r\n\r\n\r\n                                }\r\n                                preventAndSave();\r\n                                return;\r\n\r\n                            }\r\n                        } else {\r\n                            var tmpRange = range.cloneRange(),\r\n                                bk = tmpRange.collapse(false).createBookmark();\r\n\r\n                            range.deleteContents();\r\n                            tmpRange.moveToBookmark(bk);\r\n                            var li = domUtils.findParentByTagName(tmpRange.startContainer, 'li', true);\r\n\r\n                            clearEmptySibling(li);\r\n                            tmpRange.select();\r\n                            preventAndSave();\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n\r\n                    li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n\r\n                    if (li) {\r\n                        if (domUtils.isEmptyBlock(li)) {\r\n                            bk = range.createBookmark();\r\n                            var parentList = li.parentNode;\r\n                            if (li !== parentList.lastChild) {\r\n                                domUtils.breakParent(li, parentList);\r\n                                clearEmptySibling(li);\r\n                            } else {\r\n\r\n                                parentList.parentNode.insertBefore(li, parentList.nextSibling);\r\n                                if (domUtils.isEmptyNode(parentList)) {\r\n                                    domUtils.remove(parentList);\r\n                                }\r\n                            }\r\n                            //嵌套不处理\r\n                            if (!dtd.$list[li.parentNode.tagName]) {\r\n\r\n                                if (!domUtils.isBlockElm(li.firstChild)) {\r\n                                    p = me.document.createElement('p');\r\n                                    li.parentNode.insertBefore(p, li);\r\n                                    while (li.firstChild) {\r\n                                        p.appendChild(li.firstChild);\r\n                                    }\r\n                                    domUtils.remove(li);\r\n                                } else {\r\n                                    domUtils.remove(li, true);\r\n                                }\r\n                            }\r\n                            range.moveToBookmark(bk).select();\r\n\r\n\r\n                        } else {\r\n                            var first = li.firstChild;\r\n                            if (!first || !domUtils.isBlockElm(first)) {\r\n                                var p = me.document.createElement('p');\r\n\r\n                                !li.firstChild && domUtils.fillNode(me.document, p);\r\n                                while (li.firstChild) {\r\n\r\n                                    p.appendChild(li.firstChild);\r\n                                }\r\n                                li.appendChild(p);\r\n                                first = p;\r\n                            }\r\n\r\n                            var span = me.document.createElement('span');\r\n\r\n                            range.insertNode(span);\r\n                            domUtils.breakParent(span, li);\r\n\r\n                            var nextLi = span.nextSibling;\r\n                            first = nextLi.firstChild;\r\n\r\n                            if (!first) {\r\n                                p = me.document.createElement('p');\r\n\r\n                                domUtils.fillNode(me.document, p);\r\n                                nextLi.appendChild(p);\r\n                                first = p;\r\n                            }\r\n                            if (domUtils.isEmptyNode(first)) {\r\n                                first.innerHTML = '';\r\n                                domUtils.fillNode(me.document, first);\r\n                            }\r\n\r\n                            range.setStart(first, 0).collapse(true).shrinkBoundary().select();\r\n                            domUtils.remove(span);\r\n                            var pre = nextLi.previousSibling;\r\n                            if (pre && domUtils.isEmptyBlock(pre)) {\r\n                                pre.innerHTML = '<p></p>';\r\n                                domUtils.fillNode(me.document, pre.firstChild);\r\n                            }\r\n\r\n                        }\r\n                        //                        }\r\n                        preventAndSave();\r\n                    }\r\n\r\n\r\n                }\r\n\r\n\r\n            }\r\n            if (keyCode == 8) {\r\n                //修中ie中li下的问题\r\n                range = me.selection.getRange();\r\n                if (range.collapsed && domUtils.isStartInblock(range)) {\r\n                    tmpRange = range.cloneRange().trimBoundary();\r\n                    li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n                    //要在li的最左边，才能处理\r\n                    if (li && domUtils.isStartInblock(tmpRange)) {\r\n                        start = domUtils.findParentByTagName(range.startContainer, 'p', true);\r\n                        if (start && start !== li.firstChild) {\r\n                            var parentList = domUtils.findParentByTagName(start, ['ol', 'ul']);\r\n                            domUtils.breakParent(start, parentList);\r\n                            clearEmptySibling(start);\r\n                            me.fireEvent('contentchange');\r\n                            range.setStart(start, 0).setCursor(false, true);\r\n                            me.fireEvent('saveScene');\r\n                            domUtils.preventDefault(evt);\r\n                            return;\r\n                        }\r\n\r\n                        if (li && (pre = li.previousSibling)) {\r\n                            if (keyCode == 46 && li.childNodes.length) {\r\n                                return;\r\n                            }\r\n                            //有可能上边的兄弟节点是个2级菜单，要追加到2级菜单的最后的li\r\n                            if (dtd.$list[pre.tagName]) {\r\n                                pre = pre.lastChild;\r\n                            }\r\n                            me.undoManger && me.undoManger.save();\r\n                            first = li.firstChild;\r\n                            if (domUtils.isBlockElm(first)) {\r\n                                if (domUtils.isEmptyNode(first)) {\r\n                                    //                                    range.setEnd(pre, pre.childNodes.length).shrinkBoundary().collapse().select(true);\r\n                                    pre.appendChild(first);\r\n                                    range.setStart(first, 0).setCursor(false, true);\r\n                                    //first不是唯一的节点\r\n                                    while (li.firstChild) {\r\n                                        pre.appendChild(li.firstChild);\r\n                                    }\r\n                                } else {\r\n\r\n                                    span = me.document.createElement('span');\r\n                                    range.insertNode(span);\r\n                                    //判断pre是否是空的节点,如果是<p><br/></p>类型的空节点，干掉p标签防止它占位\r\n                                    if (domUtils.isEmptyBlock(pre)) {\r\n                                        pre.innerHTML = '';\r\n                                    }\r\n                                    domUtils.moveChild(li, pre);\r\n                                    range.setStartBefore(span).collapse(true).select(true);\r\n\r\n                                    domUtils.remove(span);\r\n\r\n                                }\r\n                            } else {\r\n                                if (domUtils.isEmptyNode(li)) {\r\n                                    var p = me.document.createElement('p');\r\n                                    pre.appendChild(p);\r\n                                    range.setStart(p, 0).setCursor();\r\n                                    //                                    range.setEnd(pre, pre.childNodes.length).shrinkBoundary().collapse().select(true);\r\n                                } else {\r\n                                    range.setEnd(pre, pre.childNodes.length).collapse().select(true);\r\n                                    while (li.firstChild) {\r\n                                        pre.appendChild(li.firstChild);\r\n                                    }\r\n                                }\r\n                            }\r\n                            domUtils.remove(li);\r\n                            me.fireEvent('contentchange');\r\n                            me.fireEvent('saveScene');\r\n                            domUtils.preventDefault(evt);\r\n                            return;\r\n\r\n                        }\r\n                        //trace:980\r\n\r\n                        if (li && !li.previousSibling) {\r\n                            var parentList = li.parentNode;\r\n                            var bk = range.createBookmark();\r\n                            if (domUtils.isTagNode(parentList.parentNode, 'ol ul')) {\r\n                                parentList.parentNode.insertBefore(li, parentList);\r\n                                if (domUtils.isEmptyNode(parentList)) {\r\n                                    domUtils.remove(parentList)\r\n                                }\r\n                            } else {\r\n\r\n                                while (li.firstChild) {\r\n                                    parentList.parentNode.insertBefore(li.firstChild, parentList);\r\n                                }\r\n\r\n                                domUtils.remove(li);\r\n                                if (domUtils.isEmptyNode(parentList)) {\r\n                                    domUtils.remove(parentList)\r\n                                }\r\n\r\n                            }\r\n                            range.moveToBookmark(bk).setCursor(false, true);\r\n                            me.fireEvent('contentchange');\r\n                            me.fireEvent('saveScene');\r\n                            domUtils.preventDefault(evt);\r\n                            return;\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n        me.addListener('keyup', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 8) {\r\n                var rng = me.selection.getRange(), list;\r\n                if (list = domUtils.findParentByTagName(rng.startContainer, ['ol', 'ul'], true)) {\r\n                    adjustList(list, list.tagName.toLowerCase(), getStyle(list) || domUtils.getComputedStyle(list, 'list-style-type'), true)\r\n                }\r\n            }\r\n        });\r\n        //处理tab键\r\n        me.addListener('tabkeydown', function () {\r\n\r\n            var range = me.selection.getRange();\r\n\r\n            //控制级数\r\n            function checkLevel(li) {\r\n                if (me.options.maxListLevel != -1) {\r\n                    var level = li.parentNode, levelNum = 0;\r\n                    while (/[ou]l/i.test(level.tagName)) {\r\n                        levelNum++;\r\n                        level = level.parentNode;\r\n                    }\r\n                    if (levelNum >= me.options.maxListLevel) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            //只以开始为准\r\n            //todo 后续改进\r\n            var li = domUtils.findParentByTagName(range.startContainer, 'li', true);\r\n            if (li) {\r\n\r\n                var bk;\r\n                if (range.collapsed) {\r\n                    if (checkLevel(li))\r\n                        return true;\r\n                    var parentLi = li.parentNode,\r\n                        list = me.document.createElement(parentLi.tagName),\r\n                        index = utils.indexOf(listStyle[list.tagName], getStyle(parentLi) || domUtils.getComputedStyle(parentLi, 'list-style-type'));\r\n                    index = index + 1 == listStyle[list.tagName].length ? 0 : index + 1;\r\n                    var currentStyle = listStyle[list.tagName][index];\r\n                    setListStyle(list, currentStyle);\r\n                    if (domUtils.isStartInblock(range)) {\r\n                        me.fireEvent('saveScene');\r\n                        bk = range.createBookmark();\r\n                        parentLi.insertBefore(list, li);\r\n                        list.appendChild(li);\r\n                        adjustList(list, list.tagName.toLowerCase(), currentStyle);\r\n                        me.fireEvent('contentchange');\r\n                        range.moveToBookmark(bk).select(true);\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    me.fireEvent('saveScene');\r\n                    bk = range.createBookmark();\r\n                    for (var i = 0, closeList, parents = domUtils.findParents(li), ci; ci = parents[i++];) {\r\n                        if (domUtils.isTagNode(ci, 'ol ul')) {\r\n                            closeList = ci;\r\n                            break;\r\n                        }\r\n                    }\r\n                    var current = li;\r\n                    if (bk.end) {\r\n                        while (current && !(domUtils.getPosition(current, bk.end) & domUtils.POSITION_FOLLOWING)) {\r\n                            if (checkLevel(current)) {\r\n                                current = domUtils.getNextDomNode(current, false, null, function (node) { return node !== closeList });\r\n                                continue;\r\n                            }\r\n                            var parentLi = current.parentNode,\r\n                                list = me.document.createElement(parentLi.tagName),\r\n                                index = utils.indexOf(listStyle[list.tagName], getStyle(parentLi) || domUtils.getComputedStyle(parentLi, 'list-style-type'));\r\n                            var currentIndex = index + 1 == listStyle[list.tagName].length ? 0 : index + 1;\r\n                            var currentStyle = listStyle[list.tagName][currentIndex];\r\n                            setListStyle(list, currentStyle);\r\n                            parentLi.insertBefore(list, current);\r\n                            while (current && !(domUtils.getPosition(current, bk.end) & domUtils.POSITION_FOLLOWING)) {\r\n                                li = current.nextSibling;\r\n                                list.appendChild(current);\r\n                                if (!li || domUtils.isTagNode(li, 'ol ul')) {\r\n                                    if (li) {\r\n                                        while (li = li.firstChild) {\r\n                                            if (li.tagName == 'LI') {\r\n                                                break;\r\n                                            }\r\n                                        }\r\n                                    } else {\r\n                                        li = domUtils.getNextDomNode(current, false, null, function (node) { return node !== closeList });\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                current = li;\r\n                            }\r\n                            adjustList(list, list.tagName.toLowerCase(), currentStyle);\r\n                            current = li;\r\n                        }\r\n                    }\r\n                    me.fireEvent('contentchange');\r\n                    range.moveToBookmark(bk).select();\r\n                    return true;\r\n                }\r\n            }\r\n\r\n        });\r\n        function getLi(start) {\r\n            while (start && !domUtils.isBody(start)) {\r\n                if (start.nodeName == 'TABLE') {\r\n                    return null;\r\n                }\r\n                if (start.nodeName == 'LI') {\r\n                    return start\r\n                }\r\n                start = start.parentNode;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 有序列表，与“insertunorderedlist”命令互斥\r\n         * @command insertorderedlist\r\n         * @method execCommand\r\n         * @param { String } command 命令字符串\r\n         * @param { String } style 插入的有序列表类型，值为：decimal,lower-alpha,lower-roman,upper-alpha,upper-roman,cn,cn1,cn2,num,num1,num2\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'insertorderedlist','decimal');\r\n         * ```\r\n         */\r\n        /**\r\n         * 查询当前选区内容是否有序列表\r\n         * @command insertorderedlist\r\n         * @method queryCommandState\r\n         * @param { String } cmd 命令字符串\r\n         * @return { int } 如果当前选区是有序列表返回1，否则返回0\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState( 'insertorderedlist' );\r\n         * ```\r\n         */\r\n        /**\r\n         * 查询当前选区内容是否有序列表\r\n         * @command insertorderedlist\r\n         * @method queryCommandValue\r\n         * @param { String } cmd 命令字符串\r\n         * @return { String } 返回当前有序列表的类型，值为null或decimal,lower-alpha,lower-roman,upper-alpha,upper-roman,cn,cn1,cn2,num,num1,num2\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandValue( 'insertorderedlist' );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 无序列表，与“insertorderedlist”命令互斥\r\n         * @command insertunorderedlist\r\n         * @method execCommand\r\n         * @param { String } command 命令字符串\r\n         * @param { String } style 插入的无序列表类型，值为：circle,disc,square,dash,dot\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'insertunorderedlist','circle');\r\n         * ```\r\n         */\r\n        /**\r\n         * 查询当前是否有word文档粘贴进来的图片\r\n         * @command insertunorderedlist\r\n         * @method insertunorderedlist\r\n         * @param { String } command 命令字符串\r\n         * @return { int } 如果当前选区是无序列表返回1，否则返回0\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState( 'insertunorderedlist' );\r\n         * ```\r\n         */\r\n        /**\r\n         * 查询当前选区内容是否有序列表\r\n         * @command insertunorderedlist\r\n         * @method queryCommandValue\r\n         * @param { String } command 命令字符串\r\n         * @return { String } 返回当前无序列表的类型，值为null或circle,disc,square,dash,dot\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandValue( 'insertunorderedlist' );\r\n         * ```\r\n         */\r\n\r\n        me.commands['insertorderedlist'] =\r\n            me.commands['insertunorderedlist'] = {\r\n                execCommand: function (command, style) {\r\n\r\n                    if (!style) {\r\n                        style = command.toLowerCase() == 'insertorderedlist' ? 'decimal' : 'disc';\r\n                    }\r\n                    var me = this,\r\n                        range = this.selection.getRange(),\r\n                        filterFn = function (node) {\r\n                            return node.nodeType == 1 ? node.tagName.toLowerCase() != 'br' : !domUtils.isWhitespace(node);\r\n                        },\r\n                        tag = command.toLowerCase() == 'insertorderedlist' ? 'ol' : 'ul',\r\n                        frag = me.document.createDocumentFragment();\r\n                    //去掉是因为会出现选到末尾，导致adjustmentBoundary缩到ol/ul的位置\r\n                    //range.shrinkBoundary();//.adjustmentBoundary();\r\n                    range.adjustmentBoundary().shrinkBoundary();\r\n                    var bko = range.createBookmark(true),\r\n                        start = getLi(me.document.getElementById(bko.start)),\r\n                        modifyStart = 0,\r\n                        end = getLi(me.document.getElementById(bko.end)),\r\n                        modifyEnd = 0,\r\n                        startParent, endParent,\r\n                        list, tmp;\r\n\r\n                    if (start || end) {\r\n                        start && (startParent = start.parentNode);\r\n                        if (!bko.end) {\r\n                            end = start;\r\n                        }\r\n                        end && (endParent = end.parentNode);\r\n\r\n                        if (startParent === endParent) {\r\n                            while (start !== end) {\r\n                                tmp = start;\r\n                                start = start.nextSibling;\r\n                                if (!domUtils.isBlockElm(tmp.firstChild)) {\r\n                                    var p = me.document.createElement('p');\r\n                                    while (tmp.firstChild) {\r\n                                        p.appendChild(tmp.firstChild);\r\n                                    }\r\n                                    tmp.appendChild(p);\r\n                                }\r\n                                frag.appendChild(tmp);\r\n                            }\r\n                            tmp = me.document.createElement('span');\r\n                            startParent.insertBefore(tmp, end);\r\n                            if (!domUtils.isBlockElm(end.firstChild)) {\r\n                                p = me.document.createElement('p');\r\n                                while (end.firstChild) {\r\n                                    p.appendChild(end.firstChild);\r\n                                }\r\n                                end.appendChild(p);\r\n                            }\r\n                            frag.appendChild(end);\r\n                            domUtils.breakParent(tmp, startParent);\r\n                            if (domUtils.isEmptyNode(tmp.previousSibling)) {\r\n                                domUtils.remove(tmp.previousSibling);\r\n                            }\r\n                            if (domUtils.isEmptyNode(tmp.nextSibling)) {\r\n                                domUtils.remove(tmp.nextSibling)\r\n                            }\r\n                            var nodeStyle = getStyle(startParent) || domUtils.getComputedStyle(startParent, 'list-style-type') || (command.toLowerCase() == 'insertorderedlist' ? 'decimal' : 'disc');\r\n                            if (startParent.tagName.toLowerCase() == tag && nodeStyle == style) {\r\n                                for (var i = 0, ci, tmpFrag = me.document.createDocumentFragment(); ci = frag.firstChild;) {\r\n                                    if (domUtils.isTagNode(ci, 'ol ul')) {\r\n                                        //                                  删除时，子列表不处理\r\n                                        //                                  utils.each(domUtils.getElementsByTagName(ci,'li'),function(li){\r\n                                        //                                        while(li.firstChild){\r\n                                        //                                            tmpFrag.appendChild(li.firstChild);\r\n                                        //                                        }\r\n                                        //\r\n                                        //                                    });\r\n                                        tmpFrag.appendChild(ci);\r\n                                    } else {\r\n                                        while (ci.firstChild) {\r\n\r\n                                            tmpFrag.appendChild(ci.firstChild);\r\n                                            domUtils.remove(ci);\r\n                                        }\r\n                                    }\r\n\r\n                                }\r\n                                tmp.parentNode.insertBefore(tmpFrag, tmp);\r\n                            } else {\r\n                                list = me.document.createElement(tag);\r\n                                setListStyle(list, style);\r\n                                list.appendChild(frag);\r\n                                tmp.parentNode.insertBefore(list, tmp);\r\n                            }\r\n\r\n                            domUtils.remove(tmp);\r\n                            list && adjustList(list, tag, style);\r\n                            range.moveToBookmark(bko).select();\r\n                            return;\r\n                        }\r\n                        //开始\r\n                        if (start) {\r\n                            while (start) {\r\n                                tmp = start.nextSibling;\r\n                                if (domUtils.isTagNode(start, 'ol ul')) {\r\n                                    frag.appendChild(start);\r\n                                } else {\r\n                                    var tmpfrag = me.document.createDocumentFragment(),\r\n                                        hasBlock = 0;\r\n                                    while (start.firstChild) {\r\n                                        if (domUtils.isBlockElm(start.firstChild)) {\r\n                                            hasBlock = 1;\r\n                                        }\r\n                                        tmpfrag.appendChild(start.firstChild);\r\n                                    }\r\n                                    if (!hasBlock) {\r\n                                        var tmpP = me.document.createElement('p');\r\n                                        tmpP.appendChild(tmpfrag);\r\n                                        frag.appendChild(tmpP);\r\n                                    } else {\r\n                                        frag.appendChild(tmpfrag);\r\n                                    }\r\n                                    domUtils.remove(start);\r\n                                }\r\n\r\n                                start = tmp;\r\n                            }\r\n                            startParent.parentNode.insertBefore(frag, startParent.nextSibling);\r\n                            if (domUtils.isEmptyNode(startParent)) {\r\n                                range.setStartBefore(startParent);\r\n                                domUtils.remove(startParent);\r\n                            } else {\r\n                                range.setStartAfter(startParent);\r\n                            }\r\n                            modifyStart = 1;\r\n                        }\r\n\r\n                        if (end && domUtils.inDoc(endParent, me.document)) {\r\n                            //结束\r\n                            start = endParent.firstChild;\r\n                            while (start && start !== end) {\r\n                                tmp = start.nextSibling;\r\n                                if (domUtils.isTagNode(start, 'ol ul')) {\r\n                                    frag.appendChild(start);\r\n                                } else {\r\n                                    tmpfrag = me.document.createDocumentFragment();\r\n                                    hasBlock = 0;\r\n                                    while (start.firstChild) {\r\n                                        if (domUtils.isBlockElm(start.firstChild)) {\r\n                                            hasBlock = 1;\r\n                                        }\r\n                                        tmpfrag.appendChild(start.firstChild);\r\n                                    }\r\n                                    if (!hasBlock) {\r\n                                        tmpP = me.document.createElement('p');\r\n                                        tmpP.appendChild(tmpfrag);\r\n                                        frag.appendChild(tmpP);\r\n                                    } else {\r\n                                        frag.appendChild(tmpfrag);\r\n                                    }\r\n                                    domUtils.remove(start);\r\n                                }\r\n                                start = tmp;\r\n                            }\r\n                            var tmpDiv = domUtils.createElement(me.document, 'div', {\r\n                                'tmpDiv': 1\r\n                            });\r\n                            domUtils.moveChild(end, tmpDiv);\r\n\r\n                            frag.appendChild(tmpDiv);\r\n                            domUtils.remove(end);\r\n                            endParent.parentNode.insertBefore(frag, endParent);\r\n                            range.setEndBefore(endParent);\r\n                            if (domUtils.isEmptyNode(endParent)) {\r\n                                domUtils.remove(endParent);\r\n                            }\r\n\r\n                            modifyEnd = 1;\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    if (!modifyStart) {\r\n                        range.setStartBefore(me.document.getElementById(bko.start));\r\n                    }\r\n                    if (bko.end && !modifyEnd) {\r\n                        range.setEndAfter(me.document.getElementById(bko.end));\r\n                    }\r\n                    range.enlarge(true, function (node) {\r\n                        return notExchange[node.tagName];\r\n                    });\r\n\r\n                    frag = me.document.createDocumentFragment();\r\n\r\n                    var bk = range.createBookmark(),\r\n                        current = domUtils.getNextDomNode(bk.start, false, filterFn),\r\n                        tmpRange = range.cloneRange(),\r\n                        tmpNode,\r\n                        block = domUtils.isBlockElm;\r\n\r\n                    while (current && current !== bk.end && (domUtils.getPosition(current, bk.end) & domUtils.POSITION_PRECEDING)) {\r\n\r\n                        if (current.nodeType == 3 || dtd.li[current.tagName]) {\r\n                            if (current.nodeType == 1 && dtd.$list[current.tagName]) {\r\n                                while (current.firstChild) {\r\n                                    frag.appendChild(current.firstChild);\r\n                                }\r\n                                tmpNode = domUtils.getNextDomNode(current, false, filterFn);\r\n                                domUtils.remove(current);\r\n                                current = tmpNode;\r\n                                continue;\r\n\r\n                            }\r\n                            tmpNode = current;\r\n                            tmpRange.setStartBefore(current);\r\n\r\n                            while (current && current !== bk.end && (!block(current) || domUtils.isBookmarkNode(current))) {\r\n                                tmpNode = current;\r\n                                current = domUtils.getNextDomNode(current, false, null, function (node) {\r\n                                    return !notExchange[node.tagName];\r\n                                });\r\n                            }\r\n\r\n                            if (current && block(current)) {\r\n                                tmp = domUtils.getNextDomNode(tmpNode, false, filterFn);\r\n                                if (tmp && domUtils.isBookmarkNode(tmp)) {\r\n                                    current = domUtils.getNextDomNode(tmp, false, filterFn);\r\n                                    tmpNode = tmp;\r\n                                }\r\n                            }\r\n                            tmpRange.setEndAfter(tmpNode);\r\n\r\n                            current = domUtils.getNextDomNode(tmpNode, false, filterFn);\r\n\r\n                            var li = range.document.createElement('li');\r\n\r\n                            li.appendChild(tmpRange.extractContents());\r\n                            if (domUtils.isEmptyNode(li)) {\r\n                                var tmpNode = range.document.createElement('p');\r\n                                while (li.firstChild) {\r\n                                    tmpNode.appendChild(li.firstChild)\r\n                                }\r\n                                li.appendChild(tmpNode);\r\n                            }\r\n                            frag.appendChild(li);\r\n                        } else {\r\n                            current = domUtils.getNextDomNode(current, true, filterFn);\r\n                        }\r\n                    }\r\n                    range.moveToBookmark(bk).collapse(true);\r\n                    list = me.document.createElement(tag);\r\n                    setListStyle(list, style);\r\n                    list.appendChild(frag);\r\n                    range.insertNode(list);\r\n                    //当前list上下看能否合并\r\n                    adjustList(list, tag, style);\r\n                    //去掉冗余的tmpDiv\r\n                    for (var i = 0, ci, tmpDivs = domUtils.getElementsByTagName(list, 'div'); ci = tmpDivs[i++];) {\r\n                        if (ci.getAttribute('tmpDiv')) {\r\n                            domUtils.remove(ci, true)\r\n                        }\r\n                    }\r\n                    range.moveToBookmark(bko).select();\r\n\r\n                },\r\n                queryCommandState: function (command) {\r\n                    var tag = command.toLowerCase() == 'insertorderedlist' ? 'ol' : 'ul';\r\n                    var path = this.selection.getStartElementPath();\r\n                    for (var i = 0, ci; ci = path[i++];) {\r\n                        if (ci.nodeName == 'TABLE') {\r\n                            return 0\r\n                        }\r\n                        if (tag == ci.nodeName.toLowerCase()) {\r\n                            return 1\r\n                        };\r\n                    }\r\n                    return 0;\r\n\r\n                },\r\n                queryCommandValue: function (command) {\r\n                    var tag = command.toLowerCase() == 'insertorderedlist' ? 'ol' : 'ul';\r\n                    var path = this.selection.getStartElementPath(),\r\n                        node;\r\n                    for (var i = 0, ci; ci = path[i++];) {\r\n                        if (ci.nodeName == 'TABLE') {\r\n                            node = null;\r\n                            break;\r\n                        }\r\n                        if (tag == ci.nodeName.toLowerCase()) {\r\n                            node = ci;\r\n                            break;\r\n                        };\r\n                    }\r\n                    return node ? getStyle(node) || domUtils.getComputedStyle(node, 'list-style-type') : null;\r\n                }\r\n            };\r\n    };\r\n\r\n\r\n\r\n    // plugins/source.js\r\n    /**\r\n     * 源码编辑插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    (function () {\r\n        var sourceEditors = {\r\n            textarea: function (editor, holder) {\r\n                var textarea = holder.ownerDocument.createElement('textarea');\r\n                textarea.style.cssText = 'position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;';\r\n                // todo: IE下只有onresize属性可用... 很纠结\r\n                if (browser.ie && browser.version < 8) {\r\n                    textarea.style.width = holder.offsetWidth + 'px';\r\n                    textarea.style.height = holder.offsetHeight + 'px';\r\n                    holder.onresize = function () {\r\n                        textarea.style.width = holder.offsetWidth + 'px';\r\n                        textarea.style.height = holder.offsetHeight + 'px';\r\n                    };\r\n                }\r\n                holder.appendChild(textarea);\r\n                return {\r\n                    setContent: function (content) {\r\n                        textarea.value = content;\r\n                    },\r\n                    getContent: function () {\r\n                        return textarea.value;\r\n                    },\r\n                    select: function () {\r\n                        var range;\r\n                        if (browser.ie) {\r\n                            range = textarea.createTextRange();\r\n                            range.collapse(true);\r\n                            range.select();\r\n                        } else {\r\n                            //todo: chrome下无法设置焦点\r\n                            textarea.setSelectionRange(0, 0);\r\n                            textarea.focus();\r\n                        }\r\n                    },\r\n                    dispose: function () {\r\n                        holder.removeChild(textarea);\r\n                        // todo\r\n                        holder.onresize = null;\r\n                        textarea = null;\r\n                        holder = null;\r\n                    }\r\n                };\r\n            },\r\n            codemirror: function (editor, holder) {\r\n\r\n                var codeEditor = window.CodeMirror(holder, {\r\n                    mode: \"text/html\",\r\n                    tabMode: \"indent\",\r\n                    lineNumbers: true,\r\n                    lineWrapping: true\r\n                });\r\n                var dom = codeEditor.getWrapperElement();\r\n                dom.style.cssText = 'position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,\"Courier new\",monospace;font-size:13px;';\r\n                codeEditor.getScrollerElement().style.cssText = 'position:absolute;left:0;top:0;width:100%;height:100%;';\r\n                codeEditor.refresh();\r\n                return {\r\n                    getCodeMirror: function () {\r\n                        return codeEditor;\r\n                    },\r\n                    setContent: function (content) {\r\n                        codeEditor.setValue(content);\r\n                    },\r\n                    getContent: function () {\r\n                        return codeEditor.getValue();\r\n                    },\r\n                    select: function () {\r\n                        codeEditor.focus();\r\n                    },\r\n                    dispose: function () {\r\n                        holder.removeChild(dom);\r\n                        dom = null;\r\n                        codeEditor = null;\r\n                    }\r\n                };\r\n            }\r\n        };\r\n\r\n        UE.plugins['source'] = function () {\r\n            var me = this;\r\n            var opt = this.options;\r\n            var sourceMode = false;\r\n            var sourceEditor;\r\n            var orgSetContent;\r\n            opt.sourceEditor = browser.ie ? 'textarea' : (opt.sourceEditor || 'codemirror');\r\n\r\n            me.setOpt({\r\n                sourceEditorFirst: false\r\n            });\r\n            function createSourceEditor(holder) {\r\n                return sourceEditors[opt.sourceEditor == 'codemirror' && window.CodeMirror ? 'codemirror' : 'textarea'](me, holder);\r\n            }\r\n\r\n            var bakCssText;\r\n            //解决在源码模式下getContent不能得到最新的内容问题\r\n            var oldGetContent,\r\n                bakAddress;\r\n\r\n            /**\r\n             * 切换源码模式和编辑模式\r\n             * @command source\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand( 'source');\r\n             * ```\r\n             */\r\n\r\n            /**\r\n             * 查询当前编辑区域的状态是源码模式还是可视化模式\r\n             * @command source\r\n             * @method queryCommandState\r\n             * @param { String } cmd 命令字符串\r\n             * @return { int } 如果当前是源码编辑模式，返回1，否则返回0\r\n             * @example\r\n             * ```javascript\r\n             * editor.queryCommandState( 'source' );\r\n             * ```\r\n             */\r\n\r\n            me.commands['source'] = {\r\n                execCommand: function () {\r\n\r\n                    sourceMode = !sourceMode;\r\n                    if (sourceMode) {\r\n                        bakAddress = me.selection.getRange().createAddress(false, true);\r\n                        me.undoManger && me.undoManger.save(true);\r\n                        if (browser.gecko) {\r\n                            me.body.contentEditable = false;\r\n                        }\r\n\r\n                        bakCssText = me.iframe.style.cssText;\r\n                        me.iframe.style.cssText += 'position:absolute;left:-32768px;top:-32768px;';\r\n\r\n\r\n                        me.fireEvent('beforegetcontent');\r\n                        var root = UE.htmlparser(me.body.innerHTML);\r\n                        me.filterOutputRule(root);\r\n                        root.traversal(function (node) {\r\n                            if (node.type == 'element') {\r\n                                switch (node.tagName) {\r\n                                    case 'td':\r\n                                    case 'th':\r\n                                    case 'caption':\r\n                                        if (node.children && node.children.length == 1) {\r\n                                            if (node.firstChild().tagName == 'br') {\r\n                                                node.removeChild(node.firstChild())\r\n                                            }\r\n                                        };\r\n                                        break;\r\n                                    case 'pre':\r\n                                        node.innerText(node.innerText().replace(/&nbsp;/g, ' '))\r\n\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        me.fireEvent('aftergetcontent');\r\n\r\n                        var content = root.toHtml(true);\r\n\r\n                        sourceEditor = createSourceEditor(me.iframe.parentNode);\r\n\r\n                        sourceEditor.setContent(content);\r\n\r\n                        orgSetContent = me.setContent;\r\n\r\n                        me.setContent = function (html) {\r\n                            //这里暂时不触发事件，防止报错\r\n                            var root = UE.htmlparser(html);\r\n                            me.filterInputRule(root);\r\n                            html = root.toHtml();\r\n                            sourceEditor.setContent(html);\r\n                        };\r\n\r\n                        setTimeout(function () {\r\n                            sourceEditor.select();\r\n                            me.addListener('fullscreenchanged', function () {\r\n                                try {\r\n                                    sourceEditor.getCodeMirror().refresh()\r\n                                } catch (e) { }\r\n                            });\r\n                        });\r\n\r\n                        //重置getContent，源码模式下取值也能是最新的数据\r\n                        oldGetContent = me.getContent;\r\n                        me.getContent = function () {\r\n                            return sourceEditor.getContent() || '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                        };\r\n                    } else {\r\n                        me.iframe.style.cssText = bakCssText;\r\n                        var cont = sourceEditor.getContent() || '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                        //处理掉block节点前后的空格,有可能会误命中，暂时不考虑\r\n                        cont = cont.replace(new RegExp('[\\\\r\\\\t\\\\n ]*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>', 'g'), function (a, b) {\r\n                            if (b && !dtd.$inlineWithA[b.toLowerCase()]) {\r\n                                return a.replace(/(^[\\n\\r\\t ]*)|([\\n\\r\\t ]*$)/g, '');\r\n                            }\r\n                            return a.replace(/(^[\\n\\r\\t]*)|([\\n\\r\\t]*$)/g, '')\r\n                        });\r\n\r\n                        me.setContent = orgSetContent;\r\n\r\n                        me.setContent(cont);\r\n                        sourceEditor.dispose();\r\n                        sourceEditor = null;\r\n                        //还原getContent方法\r\n                        me.getContent = oldGetContent;\r\n                        var first = me.body.firstChild;\r\n                        //trace:1106 都删除空了，下边会报错，所以补充一个p占位\r\n                        if (!first) {\r\n                            me.body.innerHTML = '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                            first = me.body.firstChild;\r\n                        }\r\n\r\n\r\n                        //要在ifm为显示时ff才能取到selection,否则报错\r\n                        //这里不能比较位置了\r\n                        me.undoManger && me.undoManger.save(true);\r\n\r\n                        if (browser.gecko) {\r\n\r\n                            var input = document.createElement('input');\r\n                            input.style.cssText = 'position:absolute;left:0;top:-32768px';\r\n\r\n                            document.body.appendChild(input);\r\n\r\n                            me.body.contentEditable = false;\r\n                            setTimeout(function () {\r\n                                domUtils.setViewportOffset(input, { left: -32768, top: 0 });\r\n                                input.focus();\r\n                                setTimeout(function () {\r\n                                    me.body.contentEditable = true;\r\n                                    me.selection.getRange().moveToAddress(bakAddress).select(true);\r\n                                    domUtils.remove(input);\r\n                                });\r\n\r\n                            });\r\n                        } else {\r\n                            //ie下有可能报错，比如在代码顶头的情况\r\n                            try {\r\n                                me.selection.getRange().moveToAddress(bakAddress).select(true);\r\n                            } catch (e) { }\r\n\r\n                        }\r\n                    }\r\n                    this.fireEvent('sourcemodechanged', sourceMode);\r\n                },\r\n                queryCommandState: function () {\r\n                    return sourceMode | 0;\r\n                },\r\n                notNeedUndo: 1\r\n            };\r\n            var oldQueryCommandState = me.queryCommandState;\r\n\r\n            me.queryCommandState = function (cmdName) {\r\n                cmdName = cmdName.toLowerCase();\r\n                if (sourceMode) {\r\n                    //源码模式下可以开启的命令\r\n                    return cmdName in {\r\n                        'source': 1,\r\n                        'fullscreen': 1\r\n                    } ? 1 : -1\r\n                }\r\n                return oldQueryCommandState.apply(this, arguments);\r\n            };\r\n\r\n            // if (opt.sourceEditor == \"codemirror\") {\r\n\r\n            //     me.addListener(\"ready\", function () {\r\n            //         utils.loadFile(document, {\r\n            //             src: opt.codeMirrorJsUrl || opt.UEDITOR_HOME_URL + \"third-party/codemirror/codemirror.js\",\r\n            //             tag: \"script\",\r\n            //             type: \"text/javascript\",\r\n            //             defer: \"defer\"\r\n            //         }, function () {\r\n            //             if (opt.sourceEditorFirst) {\r\n            //                 setTimeout(function () {\r\n            //                     me.execCommand(\"source\");\r\n            //                 }, 0);\r\n            //             }\r\n            //         });\r\n            //         utils.loadFile(document, {\r\n            //             tag: \"link\",\r\n            //             rel: \"stylesheet\",\r\n            //             type: \"text/css\",\r\n            //             href: opt.codeMirrorCssUrl || opt.UEDITOR_HOME_URL + \"third-party/codemirror/codemirror.css\"\r\n            //         });\r\n\r\n            //     });\r\n            // }\r\n\r\n        };\r\n\r\n    })();\r\n\r\n    // plugins/enterkey.js\r\n    ///import core\r\n    ///import plugins/undo.js\r\n    ///commands 设置回车标签p或br\r\n    ///commandsName  EnterKey\r\n    ///commandsTitle  设置回车标签p或br\r\n    /**\r\n     * @description 处理回车\r\n     * @author zhanyi\r\n     */\r\n    UE.plugins['enterkey'] = function () {\r\n        var hTag,\r\n            me = this,\r\n            tag = me.options.enterTag;\r\n        me.addListener('keyup', function (type, evt) {\r\n\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 13) {\r\n                var range = me.selection.getRange(),\r\n                    start = range.startContainer,\r\n                    doSave;\r\n\r\n                //修正在h1-h6里边回车后不能嵌套p的问题\r\n                if (!browser.ie) {\r\n\r\n                    if (/h\\d/i.test(hTag)) {\r\n                        if (browser.gecko) {\r\n                            var h = domUtils.findParentByTagName(start, ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'caption', 'table'], true);\r\n                            if (!h) {\r\n                                me.document.execCommand('formatBlock', false, '<p>');\r\n                                doSave = 1;\r\n                            }\r\n                        } else {\r\n                            //chrome remove div\r\n                            if (start.nodeType == 1) {\r\n                                var tmp = me.document.createTextNode(''), div;\r\n                                range.insertNode(tmp);\r\n                                div = domUtils.findParentByTagName(tmp, 'div', true);\r\n                                if (div) {\r\n                                    var p = me.document.createElement('p');\r\n                                    while (div.firstChild) {\r\n                                        p.appendChild(div.firstChild);\r\n                                    }\r\n                                    div.parentNode.insertBefore(p, div);\r\n                                    domUtils.remove(div);\r\n                                    range.setStartBefore(tmp).setCursor();\r\n                                    doSave = 1;\r\n                                }\r\n                                domUtils.remove(tmp);\r\n\r\n                            }\r\n                        }\r\n\r\n                        if (me.undoManger && doSave) {\r\n                            me.undoManger.save();\r\n                        }\r\n                    }\r\n                    //没有站位符，会出现多行的问题\r\n                    browser.opera && range.select();\r\n                } else {\r\n                    me.fireEvent('saveScene', true, true)\r\n                }\r\n            }\r\n        });\r\n\r\n        me.addListener('keydown', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which;\r\n            if (keyCode == 13) {//回车\r\n                if (me.fireEvent('beforeenterkeydown')) {\r\n                    domUtils.preventDefault(evt);\r\n                    return;\r\n                }\r\n                me.fireEvent('saveScene', true, true);\r\n                hTag = '';\r\n\r\n\r\n                var range = me.selection.getRange();\r\n\r\n                if (!range.collapsed) {\r\n                    //跨td不能删\r\n                    var start = range.startContainer,\r\n                        end = range.endContainer,\r\n                        startTd = domUtils.findParentByTagName(start, 'td', true),\r\n                        endTd = domUtils.findParentByTagName(end, 'td', true);\r\n                    if (startTd && endTd && startTd !== endTd || !startTd && endTd || startTd && !endTd) {\r\n                        evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\r\n                        return;\r\n                    }\r\n                }\r\n                if (tag == 'p') {\r\n\r\n\r\n                    if (!browser.ie) {\r\n\r\n                        start = domUtils.findParentByTagName(range.startContainer, ['ol', 'ul', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'caption'], true);\r\n\r\n                        //opera下执行formatblock会在table的场景下有问题，回车在opera原生支持很好，所以暂时在opera去掉调用这个原生的command\r\n                        //trace:2431\r\n                        if (!start && !browser.opera) {\r\n\r\n                            me.document.execCommand('formatBlock', false, '<p>');\r\n\r\n                            if (browser.gecko) {\r\n                                range = me.selection.getRange();\r\n                                start = domUtils.findParentByTagName(range.startContainer, 'p', true);\r\n                                start && domUtils.removeDirtyAttr(start);\r\n                            }\r\n\r\n\r\n                        } else {\r\n                            hTag = start.tagName;\r\n                            start.tagName.toLowerCase() == 'p' && browser.gecko && domUtils.removeDirtyAttr(start);\r\n                        }\r\n\r\n                    }\r\n\r\n                } else {\r\n                    evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\r\n\r\n                    if (!range.collapsed) {\r\n                        range.deleteContents();\r\n                        start = range.startContainer;\r\n                        if (start.nodeType == 1 && (start = start.childNodes[range.startOffset])) {\r\n                            while (start.nodeType == 1) {\r\n                                if (dtd.$empty[start.tagName]) {\r\n                                    range.setStartBefore(start).setCursor();\r\n                                    if (me.undoManger) {\r\n                                        me.undoManger.save();\r\n                                    }\r\n                                    return false;\r\n                                }\r\n                                if (!start.firstChild) {\r\n                                    var br = range.document.createElement('br');\r\n                                    start.appendChild(br);\r\n                                    range.setStart(start, 0).setCursor();\r\n                                    if (me.undoManger) {\r\n                                        me.undoManger.save();\r\n                                    }\r\n                                    return false;\r\n                                }\r\n                                start = start.firstChild;\r\n                            }\r\n                            if (start === range.startContainer.childNodes[range.startOffset]) {\r\n                                br = range.document.createElement('br');\r\n                                range.insertNode(br).setCursor();\r\n\r\n                            } else {\r\n                                range.setStart(start, 0).setCursor();\r\n                            }\r\n\r\n\r\n                        } else {\r\n                            br = range.document.createElement('br');\r\n                            range.insertNode(br).setStartAfter(br).setCursor();\r\n                        }\r\n\r\n\r\n                    } else {\r\n                        br = range.document.createElement('br');\r\n                        range.insertNode(br);\r\n                        var parent = br.parentNode;\r\n                        if (parent.lastChild === br) {\r\n                            br.parentNode.insertBefore(br.cloneNode(true), br);\r\n                            range.setStartBefore(br);\r\n                        } else {\r\n                            range.setStartAfter(br);\r\n                        }\r\n                        range.setCursor();\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/keystrokes.js\r\n    /* 处理特殊键的兼容性问题 */\r\n    UE.plugins['keystrokes'] = function () {\r\n        var me = this;\r\n        var collapsed = true;\r\n        me.addListener('keydown', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which,\r\n                rng = me.selection.getRange();\r\n\r\n            //处理全选的情况\r\n            if (!rng.collapsed && !(evt.ctrlKey || evt.shiftKey || evt.altKey || evt.metaKey) && (keyCode >= 65 && keyCode <= 90\r\n                || keyCode >= 48 && keyCode <= 57 ||\r\n                keyCode >= 96 && keyCode <= 111 || {\r\n                    13: 1,\r\n                    8: 1,\r\n                    46: 1\r\n                }[keyCode])\r\n            ) {\r\n\r\n                var tmpNode = rng.startContainer;\r\n                if (domUtils.isFillChar(tmpNode)) {\r\n                    rng.setStartBefore(tmpNode)\r\n                }\r\n                tmpNode = rng.endContainer;\r\n                if (domUtils.isFillChar(tmpNode)) {\r\n                    rng.setEndAfter(tmpNode)\r\n                }\r\n                rng.txtToElmBoundary();\r\n                //结束边界可能放到了br的前边，要把br包含进来\r\n                // x[xxx]<br/>\r\n                if (rng.endContainer && rng.endContainer.nodeType == 1) {\r\n                    tmpNode = rng.endContainer.childNodes[rng.endOffset];\r\n                    if (tmpNode && domUtils.isBr(tmpNode)) {\r\n                        rng.setEndAfter(tmpNode);\r\n                    }\r\n                }\r\n                if (rng.startOffset == 0) {\r\n                    tmpNode = rng.startContainer;\r\n                    if (domUtils.isBoundaryNode(tmpNode, 'firstChild')) {\r\n                        tmpNode = rng.endContainer;\r\n                        if (rng.endOffset == (tmpNode.nodeType == 3 ? tmpNode.nodeValue.length : tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode, 'lastChild')) {\r\n                            me.fireEvent('saveScene');\r\n                            me.body.innerHTML = '<p>' + (browser.ie ? '' : '<br/>') + '</p>';\r\n                            rng.setStart(me.body.firstChild, 0).setCursor(false, true);\r\n                            me._selectionChange();\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            //处理backspace\r\n            if (keyCode == keymap.Backspace) {\r\n                rng = me.selection.getRange();\r\n                collapsed = rng.collapsed;\r\n                if (me.fireEvent('delkeydown', evt)) {\r\n                    return;\r\n                }\r\n                var start, end;\r\n                //避免按两次删除才能生效的问题\r\n                if (rng.collapsed && rng.inFillChar()) {\r\n                    start = rng.startContainer;\r\n\r\n                    if (domUtils.isFillChar(start)) {\r\n                        rng.setStartBefore(start).shrinkBoundary(true).collapse(true);\r\n                        domUtils.remove(start)\r\n                    } else {\r\n                        start.nodeValue = start.nodeValue.replace(new RegExp('^' + domUtils.fillChar), '');\r\n                        rng.startOffset--;\r\n                        rng.collapse(true).select(true)\r\n                    }\r\n                }\r\n\r\n                //解决选中control元素不能删除的问题\r\n                if (start = rng.getClosedNode()) {\r\n                    me.fireEvent('saveScene');\r\n                    rng.setStartBefore(start);\r\n                    domUtils.remove(start);\r\n                    rng.setCursor();\r\n                    me.fireEvent('saveScene');\r\n                    domUtils.preventDefault(evt);\r\n                    return;\r\n                }\r\n                //阻止在table上的删除\r\n                if (!browser.ie) {\r\n                    start = domUtils.findParentByTagName(rng.startContainer, 'table', true);\r\n                    end = domUtils.findParentByTagName(rng.endContainer, 'table', true);\r\n                    if (start && !end || !start && end || start !== end) {\r\n                        evt.preventDefault();\r\n                        return;\r\n                    }\r\n                }\r\n\r\n            }\r\n            //处理tab键的逻辑\r\n            if (keyCode == keymap.Tab) {\r\n                //不处理以下标签\r\n                var excludeTagNameForTabKey = {\r\n                    'ol': 1,\r\n                    'ul': 1,\r\n                    'table': 1\r\n                };\r\n                //处理组件里的tab按下事件\r\n                if (me.fireEvent('tabkeydown', evt)) {\r\n                    domUtils.preventDefault(evt);\r\n                    return;\r\n                }\r\n                var range = me.selection.getRange();\r\n                me.fireEvent('saveScene');\r\n                for (var i = 0, txt = '', tabSize = me.options.tabSize || 4, tabNode = me.options.tabNode || '&nbsp;'; i < tabSize; i++) {\r\n                    txt += tabNode;\r\n                }\r\n                var span = me.document.createElement('span');\r\n                span.innerHTML = txt + domUtils.fillChar;\r\n                if (range.collapsed) {\r\n                    range.insertNode(span.cloneNode(true).firstChild).setCursor(true);\r\n                } else {\r\n                    var filterFn = function (node) {\r\n                        return domUtils.isBlockElm(node) && !excludeTagNameForTabKey[node.tagName.toLowerCase()]\r\n\r\n                    };\r\n                    //普通的情况\r\n                    start = domUtils.findParent(range.startContainer, filterFn, true);\r\n                    end = domUtils.findParent(range.endContainer, filterFn, true);\r\n                    if (start && end && start === end) {\r\n                        range.deleteContents();\r\n                        range.insertNode(span.cloneNode(true).firstChild).setCursor(true);\r\n                    } else {\r\n                        var bookmark = range.createBookmark();\r\n                        range.enlarge(true);\r\n                        var bookmark2 = range.createBookmark(),\r\n                            current = domUtils.getNextDomNode(bookmark2.start, false, filterFn);\r\n                        while (current && !(domUtils.getPosition(current, bookmark2.end) & domUtils.POSITION_FOLLOWING)) {\r\n                            current.insertBefore(span.cloneNode(true).firstChild, current.firstChild);\r\n                            current = domUtils.getNextDomNode(current, false, filterFn);\r\n                        }\r\n                        range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select();\r\n                    }\r\n                }\r\n                domUtils.preventDefault(evt)\r\n            }\r\n            //trace:1634\r\n            //ff的del键在容器空的时候，也会删除\r\n            if (browser.gecko && keyCode == 46) {\r\n                range = me.selection.getRange();\r\n                if (range.collapsed) {\r\n                    start = range.startContainer;\r\n                    if (domUtils.isEmptyBlock(start)) {\r\n                        var parent = start.parentNode;\r\n                        while (domUtils.getChildCount(parent) == 1 && !domUtils.isBody(parent)) {\r\n                            start = parent;\r\n                            parent = parent.parentNode;\r\n                        }\r\n                        if (start === parent.lastChild)\r\n                            evt.preventDefault();\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        me.addListener('keyup', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which,\r\n                rng, me = this;\r\n            if (keyCode == keymap.Backspace) {\r\n                if (me.fireEvent('delkeyup')) {\r\n                    return;\r\n                }\r\n                rng = me.selection.getRange();\r\n                if (rng.collapsed) {\r\n                    var tmpNode,\r\n                        autoClearTagName = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\r\n                    if (tmpNode = domUtils.findParentByTagName(rng.startContainer, autoClearTagName, true)) {\r\n                        if (domUtils.isEmptyBlock(tmpNode)) {\r\n                            var pre = tmpNode.previousSibling;\r\n                            if (pre && pre.nodeName != 'TABLE') {\r\n                                domUtils.remove(tmpNode);\r\n                                rng.setStartAtLast(pre).setCursor(false, true);\r\n                                return;\r\n                            } else {\r\n                                var next = tmpNode.nextSibling;\r\n                                if (next && next.nodeName != 'TABLE') {\r\n                                    domUtils.remove(tmpNode);\r\n                                    rng.setStartAtFirst(next).setCursor(false, true);\r\n                                    return;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    //处理当删除到body时，要重新给p标签展位\r\n                    if (domUtils.isBody(rng.startContainer)) {\r\n                        var tmpNode = domUtils.createElement(me.document, 'p', {\r\n                            'innerHTML': browser.ie ? domUtils.fillChar : '<br/>'\r\n                        });\r\n                        rng.insertNode(tmpNode).setStart(tmpNode, 0).setCursor(false, true);\r\n                    }\r\n                }\r\n\r\n\r\n                //chrome下如果删除了inline标签，浏览器会有记忆，在输入文字还是会套上刚才删除的标签，所以这里再选一次就不会了\r\n                if (!collapsed && (rng.startContainer.nodeType == 3 || rng.startContainer.nodeType == 1 && domUtils.isEmptyBlock(rng.startContainer))) {\r\n                    if (browser.ie) {\r\n                        var span = rng.document.createElement('span');\r\n                        rng.insertNode(span).setStartBefore(span).collapse(true);\r\n                        rng.select();\r\n                        domUtils.remove(span)\r\n                    } else {\r\n                        rng.select()\r\n                    }\r\n\r\n                }\r\n            }\r\n\r\n\r\n        })\r\n    };\r\n\r\n    // plugins/fiximgclick.js\r\n    ///import core\r\n    ///commands 修复chrome下图片不能点击的问题，出现八个角可改变大小\r\n    ///commandsName  FixImgClick\r\n    ///commandsTitle  修复chrome下图片不能点击的问题，出现八个角可改变大小\r\n    //修复chrome下图片不能点击的问题，出现八个角可改变大小\r\n\r\n    UE.plugins['fiximgclick'] = (function () {\r\n\r\n        var elementUpdated = false;\r\n        function Scale() {\r\n            this.editor = null;\r\n            this.resizer = null;\r\n            this.cover = null;\r\n            this.doc = document;\r\n            this.prePos = { x: 0, y: 0 };\r\n            this.startPos = { x: 0, y: 0 };\r\n        }\r\n\r\n        (function () {\r\n            var rect = [\r\n                //[left, top, width, height]\r\n                [0, 0, -1, -1],\r\n                [0, 0, 0, -1],\r\n                [0, 0, 1, -1],\r\n                [0, 0, -1, 0],\r\n                [0, 0, 1, 0],\r\n                [0, 0, -1, 1],\r\n                [0, 0, 0, 1],\r\n                [0, 0, 1, 1]\r\n            ];\r\n\r\n            Scale.prototype = {\r\n                init: function (editor) {\r\n                    var me = this;\r\n                    me.editor = editor;\r\n                    me.startPos = this.prePos = { x: 0, y: 0 };\r\n                    me.dragId = -1;\r\n\r\n                    var hands = [],\r\n                        cover = me.cover = document.createElement('div'),\r\n                        resizer = me.resizer = document.createElement('div');\r\n\r\n                    cover.id = me.editor.ui.id + '_imagescale_cover';\r\n                    cover.style.cssText = 'position:absolute;display:none;z-index:' + (me.editor.options.zIndex) + ';filter:alpha(opacity=0); opacity:0;background:#CCC;';\r\n                    domUtils.on(cover, 'mousedown click', function () {\r\n                        me.hide();\r\n                    });\r\n\r\n                    for (i = 0; i < 8; i++) {\r\n                        hands.push('<span class=\"edui-editor-imagescale-hand' + i + '\"></span>');\r\n                    }\r\n                    resizer.id = me.editor.ui.id + '_imagescale';\r\n                    resizer.className = 'edui-editor-imagescale';\r\n                    resizer.innerHTML = hands.join('');\r\n                    resizer.style.cssText += ';display:none;border:1px solid #3b77ff;z-index:' + (me.editor.options.zIndex) + ';';\r\n\r\n                    me.editor.ui.getDom().appendChild(cover);\r\n                    me.editor.ui.getDom().appendChild(resizer);\r\n\r\n                    me.initStyle();\r\n                    me.initEvents();\r\n                },\r\n                initStyle: function () {\r\n                    utils.cssRule('imagescale', '.edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}' +\r\n                        '.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}'\r\n                        + '.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}');\r\n                },\r\n                initEvents: function () {\r\n                    var me = this;\r\n\r\n                    me.startPos.x = me.startPos.y = 0;\r\n                    me.isDraging = false;\r\n                },\r\n                _eventHandler: function (e) {\r\n                    var me = this;\r\n                    switch (e.type) {\r\n                        case 'mousedown':\r\n                            var hand = e.target || e.srcElement, hand;\r\n                            if (hand.className.indexOf('edui-editor-imagescale-hand') != -1 && me.dragId == -1) {\r\n                                me.dragId = hand.className.slice(-1);\r\n                                me.startPos.x = me.prePos.x = e.clientX;\r\n                                me.startPos.y = me.prePos.y = e.clientY;\r\n                                domUtils.on(me.doc, 'mousemove', me.proxy(me._eventHandler, me));\r\n                            }\r\n                            break;\r\n                        case 'mousemove':\r\n                            if (me.dragId != -1) {\r\n                                me.updateContainerStyle(me.dragId, { x: e.clientX - me.prePos.x, y: e.clientY - me.prePos.y });\r\n                                me.prePos.x = e.clientX;\r\n                                me.prePos.y = e.clientY;\r\n                                elementUpdated = true;\r\n                                me.updateTargetElement();\r\n\r\n                            }\r\n                            break;\r\n                        case 'mouseup':\r\n                            if (me.dragId != -1) {\r\n                                me.updateContainerStyle(me.dragId, { x: e.clientX - me.prePos.x, y: e.clientY - me.prePos.y });\r\n                                me.updateTargetElement();\r\n                                if (me.target.parentNode) me.attachTo(me.target);\r\n                                me.dragId = -1;\r\n                            }\r\n                            domUtils.un(me.doc, 'mousemove', me.proxy(me._eventHandler, me));\r\n                            //修复只是点击挪动点，但没有改变大小，不应该触发contentchange\r\n                            if (elementUpdated) {\r\n                                elementUpdated = false;\r\n                                me.editor.fireEvent('contentchange');\r\n                            }\r\n\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                },\r\n                updateTargetElement: function () {\r\n                    var me = this;\r\n                    domUtils.setStyles(me.target, {\r\n                        'width': me.resizer.style.width,\r\n                        'height': me.resizer.style.height\r\n                    });\r\n                    me.target.width = parseInt(me.resizer.style.width);\r\n                    me.target.height = parseInt(me.resizer.style.height);\r\n                    me.attachTo(me.target);\r\n                },\r\n                updateContainerStyle: function (dir, offset) {\r\n                    var me = this,\r\n                        dom = me.resizer, tmp;\r\n\r\n                    if (rect[dir][0] != 0) {\r\n                        tmp = parseInt(dom.style.left) + offset.x;\r\n                        dom.style.left = me._validScaledProp('left', tmp) + 'px';\r\n                    }\r\n                    if (rect[dir][1] != 0) {\r\n                        tmp = parseInt(dom.style.top) + offset.y;\r\n                        dom.style.top = me._validScaledProp('top', tmp) + 'px';\r\n                    }\r\n                    if (rect[dir][2] != 0) {\r\n                        tmp = dom.clientWidth + rect[dir][2] * offset.x;\r\n                        dom.style.width = me._validScaledProp('width', tmp) + 'px';\r\n                    }\r\n                    if (rect[dir][3] != 0) {\r\n                        tmp = dom.clientHeight + rect[dir][3] * offset.y;\r\n                        dom.style.height = me._validScaledProp('height', tmp) + 'px';\r\n                    }\r\n                },\r\n                _validScaledProp: function (prop, value) {\r\n                    var ele = this.resizer,\r\n                        wrap = document;\r\n\r\n                    value = isNaN(value) ? 0 : value;\r\n                    switch (prop) {\r\n                        case 'left':\r\n                            return value < 0 ? 0 : (value + ele.clientWidth) > wrap.clientWidth ? wrap.clientWidth - ele.clientWidth : value;\r\n                        case 'top':\r\n                            return value < 0 ? 0 : (value + ele.clientHeight) > wrap.clientHeight ? wrap.clientHeight - ele.clientHeight : value;\r\n                        case 'width':\r\n                            return value <= 0 ? 1 : (value + ele.offsetLeft) > wrap.clientWidth ? wrap.clientWidth - ele.offsetLeft : value;\r\n                        case 'height':\r\n                            return value <= 0 ? 1 : (value + ele.offsetTop) > wrap.clientHeight ? wrap.clientHeight - ele.offsetTop : value;\r\n                    }\r\n                },\r\n                hideCover: function () {\r\n                    this.cover.style.display = 'none';\r\n                },\r\n                showCover: function () {\r\n                    var me = this,\r\n                        editorPos = domUtils.getXY(me.editor.ui.getDom()),\r\n                        iframePos = domUtils.getXY(me.editor.iframe);\r\n\r\n                    domUtils.setStyles(me.cover, {\r\n                        'width': me.editor.iframe.offsetWidth + 'px',\r\n                        'height': me.editor.iframe.offsetHeight + 'px',\r\n                        'top': iframePos.y - editorPos.y + 'px',\r\n                        'left': iframePos.x - editorPos.x + 'px',\r\n                        'position': 'absolute',\r\n                        'display': ''\r\n                    })\r\n                },\r\n                show: function (targetObj) {\r\n                    var me = this;\r\n                    me.resizer.style.display = 'block';\r\n                    if (targetObj) me.attachTo(targetObj);\r\n\r\n                    domUtils.on(this.resizer, 'mousedown', me.proxy(me._eventHandler, me));\r\n                    domUtils.on(me.doc, 'mouseup', me.proxy(me._eventHandler, me));\r\n\r\n                    me.showCover();\r\n                    me.editor.fireEvent('afterscaleshow', me);\r\n                    me.editor.fireEvent('saveScene');\r\n                },\r\n                hide: function () {\r\n                    var me = this;\r\n                    me.hideCover();\r\n                    me.resizer.style.display = 'none';\r\n\r\n                    domUtils.un(me.resizer, 'mousedown', me.proxy(me._eventHandler, me));\r\n                    domUtils.un(me.doc, 'mouseup', me.proxy(me._eventHandler, me));\r\n                    me.editor.fireEvent('afterscalehide', me);\r\n                },\r\n                proxy: function (fn, context) {\r\n                    return function (e) {\r\n                        return fn.apply(context || this, arguments);\r\n                    };\r\n                },\r\n                attachTo: function (targetObj) {\r\n                    var me = this,\r\n                        target = me.target = targetObj,\r\n                        resizer = this.resizer,\r\n                        imgPos = domUtils.getXY(target),\r\n                        iframePos = domUtils.getXY(me.editor.iframe),\r\n                        editorPos = domUtils.getXY(resizer.parentNode);\r\n\r\n                    domUtils.setStyles(resizer, {\r\n                        'width': target.width + 'px',\r\n                        'height': target.height + 'px',\r\n                        'left': iframePos.x + imgPos.x - me.editor.document.body.scrollLeft - editorPos.x - parseInt(resizer.style.borderLeftWidth) + 'px',\r\n                        'top': iframePos.y + imgPos.y - me.editor.document.body.scrollTop - editorPos.y - parseInt(resizer.style.borderTopWidth) + 'px'\r\n                    });\r\n                }\r\n            }\r\n        })();\r\n\r\n        return function () {\r\n            var me = this,\r\n                imageScale;\r\n\r\n            me.setOpt('imageScaleEnabled', true);\r\n\r\n            if (!browser.ie && me.options.imageScaleEnabled) {\r\n                me.addListener('click', function (type, e) {\r\n\r\n                    var range = me.selection.getRange(),\r\n                        img = range.getClosedNode();\r\n\r\n                    if (img && img.tagName == 'IMG' && me.body.contentEditable != \"false\") {\r\n\r\n                        if (img.className.indexOf(\"edui-faked-music\") != -1 ||\r\n                            img.getAttribute(\"anchorname\") ||\r\n                            domUtils.hasClass(img, 'loadingclass') ||\r\n                            domUtils.hasClass(img, 'loaderrorclass')) { return }\r\n\r\n                        if (!imageScale) {\r\n                            imageScale = new Scale();\r\n                            imageScale.init(me);\r\n                            me.ui.getDom().appendChild(imageScale.resizer);\r\n\r\n                            var _keyDownHandler = function (e) {\r\n                                imageScale.hide();\r\n                                if (imageScale.target) me.selection.getRange().selectNode(imageScale.target).select();\r\n                            }, _mouseDownHandler = function (e) {\r\n                                var ele = e.target || e.srcElement;\r\n                                if (ele && (ele.className === undefined || ele.className.indexOf('edui-editor-imagescale') == -1)) {\r\n                                    _keyDownHandler(e);\r\n                                }\r\n                            }, timer;\r\n\r\n                            me.addListener('afterscaleshow', function (e) {\r\n                                me.addListener('beforekeydown', _keyDownHandler);\r\n                                me.addListener('beforemousedown', _mouseDownHandler);\r\n                                domUtils.on(document, 'keydown', _keyDownHandler);\r\n                                domUtils.on(document, 'mousedown', _mouseDownHandler);\r\n                                me.selection.getNative().removeAllRanges();\r\n                            });\r\n                            me.addListener('afterscalehide', function (e) {\r\n                                me.removeListener('beforekeydown', _keyDownHandler);\r\n                                me.removeListener('beforemousedown', _mouseDownHandler);\r\n                                domUtils.un(document, 'keydown', _keyDownHandler);\r\n                                domUtils.un(document, 'mousedown', _mouseDownHandler);\r\n                                var target = imageScale.target;\r\n                                if (target.parentNode) {\r\n                                    me.selection.getRange().selectNode(target).select();\r\n                                }\r\n                            });\r\n                            //TODO 有iframe的情况，mousedown不能往下传。。\r\n                            domUtils.on(imageScale.resizer, 'mousedown', function (e) {\r\n                                me.selection.getNative().removeAllRanges();\r\n                                var ele = e.target || e.srcElement;\r\n                                if (ele && ele.className.indexOf('edui-editor-imagescale-hand') == -1) {\r\n                                    timer = setTimeout(function () {\r\n                                        imageScale.hide();\r\n                                        if (imageScale.target) me.selection.getRange().selectNode(ele).select();\r\n                                    }, 200);\r\n                                }\r\n                            });\r\n                            domUtils.on(imageScale.resizer, 'mouseup', function (e) {\r\n                                var ele = e.target || e.srcElement;\r\n                                if (ele && ele.className.indexOf('edui-editor-imagescale-hand') == -1) {\r\n                                    clearTimeout(timer);\r\n                                }\r\n                            });\r\n                        }\r\n                        imageScale.show(img);\r\n                    } else {\r\n                        if (imageScale && imageScale.resizer.style.display != 'none') imageScale.hide();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (browser.webkit) {\r\n                me.addListener('click', function (type, e) {\r\n                    if (e.target.tagName == 'IMG' && me.body.contentEditable != \"false\") {\r\n                        var range = new dom.Range(me.document);\r\n                        range.selectNode(e.target).select();\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    })();\r\n\r\n    // plugins/autolink.js\r\n    ///import core\r\n    ///commands 为非ie浏览器自动添加a标签\r\n    ///commandsName  AutoLink\r\n    ///commandsTitle  自动增加链接\r\n    /**\r\n     * @description 为非ie浏览器自动添加a标签\r\n     * @author zhanyi\r\n     */\r\n\r\n    UE.plugin.register('autolink', function () {\r\n        var cont = 0;\r\n\r\n        return !browser.ie ? {\r\n\r\n            bindEvents: {\r\n                'reset': function () {\r\n                    cont = 0;\r\n                },\r\n                'keydown': function (type, evt) {\r\n                    var me = this;\r\n                    var keyCode = evt.keyCode || evt.which;\r\n\r\n                    if (keyCode == 32 || keyCode == 13) {\r\n\r\n                        var sel = me.selection.getNative(),\r\n                            range = sel.getRangeAt(0).cloneRange(),\r\n                            offset,\r\n                            charCode;\r\n\r\n                        var start = range.startContainer;\r\n                        while (start.nodeType == 1 && range.startOffset > 0) {\r\n                            start = range.startContainer.childNodes[range.startOffset - 1];\r\n                            if (!start) {\r\n                                break;\r\n                            }\r\n                            range.setStart(start, start.nodeType == 1 ? start.childNodes.length : start.nodeValue.length);\r\n                            range.collapse(true);\r\n                            start = range.startContainer;\r\n                        }\r\n\r\n                        do {\r\n                            if (range.startOffset == 0) {\r\n                                start = range.startContainer.previousSibling;\r\n\r\n                                while (start && start.nodeType == 1) {\r\n                                    start = start.lastChild;\r\n                                }\r\n                                if (!start || domUtils.isFillChar(start)) {\r\n                                    break;\r\n                                }\r\n                                offset = start.nodeValue.length;\r\n                            } else {\r\n                                start = range.startContainer;\r\n                                offset = range.startOffset;\r\n                            }\r\n                            range.setStart(start, offset - 1);\r\n                            charCode = range.toString().charCodeAt(0);\r\n                        } while (charCode != 160 && charCode != 32);\r\n\r\n                        if (range.toString().replace(new RegExp(domUtils.fillChar, 'g'), '').match(/(?:https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.)/i)) {\r\n                            while (range.toString().length) {\r\n                                if (/^(?:https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.)/i.test(range.toString())) {\r\n                                    break;\r\n                                }\r\n                                try {\r\n                                    range.setStart(range.startContainer, range.startOffset + 1);\r\n                                } catch (e) {\r\n                                    //trace:2121\r\n                                    var start = range.startContainer;\r\n                                    while (!(next = start.nextSibling)) {\r\n                                        if (domUtils.isBody(start)) {\r\n                                            return;\r\n                                        }\r\n                                        start = start.parentNode;\r\n\r\n                                    }\r\n                                    range.setStart(next, 0);\r\n\r\n                                }\r\n\r\n                            }\r\n                            //range的开始边界已经在a标签里的不再处理\r\n                            if (domUtils.findParentByTagName(range.startContainer, 'a', true)) {\r\n                                return;\r\n                            }\r\n                            var a = me.document.createElement('a'), text = me.document.createTextNode(' '), href;\r\n\r\n                            me.undoManger && me.undoManger.save();\r\n                            a.appendChild(range.extractContents());\r\n                            a.href = a.innerHTML = a.innerHTML.replace(/<[^>]+>/g, '');\r\n                            href = a.getAttribute(\"href\").replace(new RegExp(domUtils.fillChar, 'g'), '');\r\n                            href = /^(?:https?:\\/\\/)/ig.test(href) ? href : \"http://\" + href;\r\n                            a.setAttribute('_src', utils.html(href));\r\n                            a.href = utils.html(href);\r\n\r\n                            range.insertNode(a);\r\n                            a.parentNode.insertBefore(text, a.nextSibling);\r\n                            range.setStart(text, 0);\r\n                            range.collapse(true);\r\n                            sel.removeAllRanges();\r\n                            sel.addRange(range);\r\n                            me.undoManger && me.undoManger.save();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } : {}\r\n    }, function () {\r\n        var keyCodes = {\r\n            37: 1, 38: 1, 39: 1, 40: 1,\r\n            13: 1, 32: 1\r\n        };\r\n        function checkIsCludeLink(node) {\r\n            if (node.nodeType == 3) {\r\n                return null\r\n            }\r\n            if (node.nodeName == 'A') {\r\n                return node;\r\n            }\r\n            var lastChild = node.lastChild;\r\n\r\n            while (lastChild) {\r\n                if (lastChild.nodeName == 'A') {\r\n                    return lastChild;\r\n                }\r\n                if (lastChild.nodeType == 3) {\r\n                    if (domUtils.isWhitespace(lastChild)) {\r\n                        lastChild = lastChild.previousSibling;\r\n                        continue;\r\n                    }\r\n                    return null\r\n                }\r\n                lastChild = lastChild.lastChild;\r\n            }\r\n        }\r\n        browser.ie && this.addListener('keyup', function (cmd, evt) {\r\n            var me = this, keyCode = evt.keyCode;\r\n            if (keyCodes[keyCode]) {\r\n                var rng = me.selection.getRange();\r\n                var start = rng.startContainer;\r\n\r\n                if (keyCode == 13) {\r\n                    while (start && !domUtils.isBody(start) && !domUtils.isBlockElm(start)) {\r\n                        start = start.parentNode;\r\n                    }\r\n                    if (start && !domUtils.isBody(start) && start.nodeName == 'P') {\r\n                        var pre = start.previousSibling;\r\n                        if (pre && pre.nodeType == 1) {\r\n                            var pre = checkIsCludeLink(pre);\r\n                            if (pre && !pre.getAttribute('_href')) {\r\n                                domUtils.remove(pre, true);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (keyCode == 32) {\r\n                    if (start.nodeType == 3 && /^\\s$/.test(start.nodeValue)) {\r\n                        start = start.previousSibling;\r\n                        if (start && start.nodeName == 'A' && !start.getAttribute('_href')) {\r\n                            domUtils.remove(start, true);\r\n                        }\r\n                    }\r\n                } else {\r\n                    start = domUtils.findParentByTagName(start, 'a', true);\r\n                    if (start && !start.getAttribute('_href')) {\r\n                        var bk = rng.createBookmark();\r\n\r\n                        domUtils.remove(start, true);\r\n                        rng.moveToBookmark(bk).select(true)\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n\r\n        });\r\n    }\r\n    );\r\n\r\n    // plugins/autoheight.js\r\n    ///import core\r\n    ///commands 当输入内容超过编辑器高度时，编辑器自动增高\r\n    ///commandsName  AutoHeight,autoHeightEnabled\r\n    ///commandsTitle  自动增高\r\n    /**\r\n     * @description 自动伸展\r\n     * @author zhanyi\r\n     */\r\n    UE.plugins['autoheight'] = function () {\r\n        var me = this;\r\n        //提供开关，就算加载也可以关闭\r\n        me.autoHeightEnabled = me.options.autoHeightEnabled !== false;\r\n        if (!me.autoHeightEnabled) {\r\n            return;\r\n        }\r\n\r\n        var bakOverflow,\r\n            lastHeight = 0,\r\n            options = me.options,\r\n            currentHeight,\r\n            timer;\r\n\r\n        function adjustHeight() {\r\n            var me = this;\r\n            clearTimeout(timer);\r\n            if (isFullscreen) return;\r\n            if (!me.queryCommandState || me.queryCommandState && me.queryCommandState('source') != 1) {\r\n                timer = setTimeout(function () {\r\n\r\n                    var node = me.body.lastChild;\r\n                    while (node && node.nodeType != 1) {\r\n                        node = node.previousSibling;\r\n                    }\r\n                    if (node && node.nodeType == 1) {\r\n                        node.style.clear = 'both';\r\n                        currentHeight = Math.max(domUtils.getXY(node).y + node.offsetHeight + 25, Math.max(options.minFrameHeight, options.initialFrameHeight));\r\n                        if (currentHeight != lastHeight) {\r\n                            if (currentHeight !== parseInt(me.iframe.parentNode.style.height)) {\r\n                                me.iframe.parentNode.style.height = currentHeight + 'px';\r\n                            }\r\n                            me.body.style.height = currentHeight + 'px';\r\n                            lastHeight = currentHeight;\r\n                        }\r\n                        domUtils.removeStyle(node, 'clear');\r\n                    }\r\n\r\n\r\n                }, 50)\r\n            }\r\n        }\r\n        var isFullscreen;\r\n        me.addListener('fullscreenchanged', function (cmd, f) {\r\n            isFullscreen = f\r\n        });\r\n        me.addListener('destroy', function () {\r\n            me.removeListener('contentchange afterinserthtml keyup mouseup', adjustHeight)\r\n        });\r\n        me.enableAutoHeight = function () {\r\n            var me = this;\r\n            if (!me.autoHeightEnabled) {\r\n                return;\r\n            }\r\n            var doc = me.document;\r\n            me.autoHeightEnabled = true;\r\n            bakOverflow = doc.body.style.overflowY;\r\n            doc.body.style.overflowY = 'hidden';\r\n            me.addListener('contentchange afterinserthtml keyup mouseup', adjustHeight);\r\n            //ff不给事件算得不对\r\n\r\n            setTimeout(function () {\r\n                adjustHeight.call(me);\r\n            }, browser.gecko ? 100 : 0);\r\n            me.fireEvent('autoheightchanged', me.autoHeightEnabled);\r\n        };\r\n        me.disableAutoHeight = function () {\r\n\r\n            me.body.style.overflowY = bakOverflow || '';\r\n\r\n            me.removeListener('contentchange', adjustHeight);\r\n            me.removeListener('keyup', adjustHeight);\r\n            me.removeListener('mouseup', adjustHeight);\r\n            me.autoHeightEnabled = false;\r\n            me.fireEvent('autoheightchanged', me.autoHeightEnabled);\r\n        };\r\n\r\n        me.on('setHeight', function () {\r\n            me.disableAutoHeight()\r\n        });\r\n        me.addListener('ready', function () {\r\n            me.enableAutoHeight();\r\n            //trace:1764\r\n            var timer;\r\n            domUtils.on(browser.ie ? me.body : me.document, browser.webkit ? 'dragover' : 'drop', function () {\r\n                clearTimeout(timer);\r\n                timer = setTimeout(function () {\r\n                    //trace:3681\r\n                    adjustHeight.call(me);\r\n                }, 100);\r\n\r\n            });\r\n            //修复内容过多时，回到顶部，顶部内容被工具栏遮挡问题\r\n            var lastScrollY;\r\n            window.onscroll = function () {\r\n                if (lastScrollY === null) {\r\n                    lastScrollY = this.scrollY\r\n                } else if (this.scrollY == 0 && lastScrollY != 0) {\r\n                    me.window.scrollTo(0, 0);\r\n                    lastScrollY = null;\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n    };\r\n\r\n\r\n\r\n    // plugins/autofloat.js\r\n    ///import core\r\n    ///commands 悬浮工具栏\r\n    ///commandsName  AutoFloat,autoFloatEnabled\r\n    ///commandsTitle  悬浮工具栏\r\n    /**\r\n     *  modified by chengchao01\r\n     *  注意： 引入此功能后，在IE6下会将body的背景图片覆盖掉！\r\n     */\r\n    UE.plugins['autofloat'] = function () {\r\n        var me = this,\r\n            lang = me.getLang();\r\n        me.setOpt({\r\n            topOffset: 0\r\n        });\r\n        var optsAutoFloatEnabled = me.options.autoFloatEnabled !== false,\r\n            topOffset = me.options.topOffset;\r\n\r\n\r\n        //如果不固定toolbar的位置，则直接退出\r\n        if (!optsAutoFloatEnabled) {\r\n            return;\r\n        }\r\n        var uiUtils = UE.ui.uiUtils,\r\n            LteIE6 = browser.ie && browser.version <= 6,\r\n            quirks = browser.quirks;\r\n\r\n        function checkHasUI() {\r\n            if (!UE.ui) {\r\n                alert(lang.autofloatMsg);\r\n                return 0;\r\n            }\r\n            return 1;\r\n        }\r\n        function fixIE6FixedPos() {\r\n            var docStyle = document.body.style;\r\n            docStyle.backgroundImage = 'url(\"about:blank\")';\r\n            docStyle.backgroundAttachment = 'fixed';\r\n        }\r\n        var bakCssText,\r\n            placeHolder = document.createElement('div'),\r\n            toolbarBox, orgTop,\r\n            getPosition,\r\n            flag = true;   //ie7模式下需要偏移\r\n        function setFloating() {\r\n            var toobarBoxPos = domUtils.getXY(toolbarBox),\r\n                origalFloat = domUtils.getComputedStyle(toolbarBox, 'position'),\r\n                origalLeft = domUtils.getComputedStyle(toolbarBox, 'left');\r\n            toolbarBox.style.width = toolbarBox.offsetWidth + 'px';\r\n            toolbarBox.style.zIndex = me.options.zIndex * 1 + 1;\r\n            toolbarBox.parentNode.insertBefore(placeHolder, toolbarBox);\r\n            if (LteIE6 || (quirks && browser.ie)) {\r\n                if (toolbarBox.style.position != 'absolute') {\r\n                    toolbarBox.style.position = 'absolute';\r\n                }\r\n                toolbarBox.style.top = (document.body.scrollTop || document.documentElement.scrollTop) - orgTop + topOffset + 'px';\r\n            } else {\r\n                if (browser.ie7Compat && flag) {\r\n                    flag = false;\r\n                    toolbarBox.style.left = domUtils.getXY(toolbarBox).x - document.documentElement.getBoundingClientRect().left + 2 + 'px';\r\n                }\r\n                if (toolbarBox.style.position != 'fixed') {\r\n                    // toolbarBox.style.position = 'fixed';\r\n                    toolbarBox.style.top = topOffset + \"px\";\r\n                    ((origalFloat == 'absolute' || origalFloat == 'relative') && parseFloat(origalLeft)) && (toolbarBox.style.left = toobarBoxPos.x + 'px');\r\n                }\r\n            }\r\n        }\r\n        function unsetFloating() {\r\n            flag = true;\r\n            if (placeHolder.parentNode) {\r\n                placeHolder.parentNode.removeChild(placeHolder);\r\n            }\r\n\r\n            toolbarBox.style.cssText = bakCssText;\r\n        }\r\n\r\n        function updateFloating() {\r\n            var rect3 = getPosition(me.container);\r\n            var offset = me.options.toolbarTopOffset || 0;\r\n            if (rect3.top < 0 && rect3.bottom - toolbarBox.offsetHeight > offset) {\r\n                setFloating();\r\n            } else {\r\n                unsetFloating();\r\n            }\r\n        }\r\n        var defer_updateFloating = utils.defer(function () {\r\n            updateFloating();\r\n        }, browser.ie ? 200 : 100, true);\r\n\r\n        me.addListener('destroy', function () {\r\n            domUtils.un(window, ['scroll', 'resize'], updateFloating);\r\n            me.removeListener('keydown', defer_updateFloating);\r\n        });\r\n\r\n        me.addListener('ready', function () {\r\n            if (checkHasUI(me)) {\r\n                //加载了ui组件，但在new时，没有加载ui，导致编辑器实例上没有ui类，所以这里做判断\r\n                if (!me.ui) {\r\n                    return;\r\n                }\r\n                getPosition = uiUtils.getClientRect;\r\n                toolbarBox = me.ui.getDom('toolbarbox');\r\n                orgTop = getPosition(toolbarBox).top;\r\n                bakCssText = toolbarBox.style.cssText;\r\n                placeHolder.style.height = toolbarBox.offsetHeight + 'px';\r\n                if (LteIE6) {\r\n                    fixIE6FixedPos();\r\n                }\r\n                domUtils.on(window, ['scroll', 'resize'], updateFloating);\r\n                me.addListener('keydown', defer_updateFloating);\r\n\r\n                me.addListener('beforefullscreenchange', function (t, enabled) {\r\n                    if (enabled) {\r\n                        unsetFloating();\r\n                    }\r\n                });\r\n                me.addListener('fullscreenchanged', function (t, enabled) {\r\n                    if (!enabled) {\r\n                        updateFloating();\r\n                    }\r\n                });\r\n                me.addListener('sourcemodechanged', function (t, enabled) {\r\n                    setTimeout(function () {\r\n                        updateFloating();\r\n                    }, 0);\r\n                });\r\n                me.addListener(\"clearDoc\", function () {\r\n                    setTimeout(function () {\r\n                        updateFloating();\r\n                    }, 0);\r\n\r\n                })\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/video.js\r\n    /**\r\n     * video插件， 为UEditor提供视频插入支持\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    UE.plugins['video'] = function () {\r\n        var me = this;\r\n\r\n        /**\r\n         * 创建插入视频字符窜\r\n         * @param url 视频地址\r\n         * @param width 视频宽度\r\n         * @param height 视频高度\r\n         * @param align 视频对齐\r\n         * @param toEmbed 是否以flash代替显示\r\n         * @param addParagraph  是否需要添加P 标签\r\n         */\r\n        function creatInsertStr(url, width, height, id, align, classname, type) {\r\n\r\n            url = utils.unhtmlForUrl(url);\r\n            align = utils.unhtml(align);\r\n            classname = utils.unhtml(classname);\r\n\r\n            width = parseInt(width, 10) || 0;\r\n            height = parseInt(height, 10) || 0;\r\n\r\n            var str;\r\n            switch (type) {\r\n                case 'image':\r\n                    str = '<img ' + (id ? 'id=\"' + id + '\"' : '') + ' width=\"' + width + '\" height=\"' + height + '\" _url=\"' + url + '\" class=\"' + classname.replace(/\\bvideo-js\\b/, '') + '\"' +\r\n                        ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" style=\"background:url(' + me.options.UEDITOR_HOME_URL + 'themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;' + (align ? 'float:' + align + ';' : '') + '\" />'\r\n                    break;\r\n                case 'embed':\r\n                    str = '<embed type=\"application/x-shockwave-flash\" class=\"' + classname + '\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"' +\r\n                        ' src=\"' + utils.html(url) + '\" width=\"' + width + '\" height=\"' + height + '\"' + (align ? ' style=\"float:' + align + '\"' : '') +\r\n                        ' wmode=\"transparent\" play=\"true\" loop=\"false\" menu=\"false\" allowscriptaccess=\"never\" allowfullscreen=\"true\" >';\r\n                    break;\r\n                case 'video':\r\n                    var ext = url.substr(url.lastIndexOf('.') + 1);\r\n                    if (ext == 'ogv') ext = 'ogg';\r\n                    str = '<video' + (id ? ' id=\"' + id + '\"' : '') + ' class=\"' + classname + ' video-js\" ' + (align ? ' style=\"float:' + align + '\"' : '') +\r\n                        ' controls preload=\"none\" width=\"' + width + '\" height=\"' + height + '\" src=\"' + url + '\" data-setup=\"{}\">' +\r\n                        '<source src=\"' + url + '\" type=\"video/' + ext + '\" /></video>';\r\n                    break;\r\n            }\r\n            return str;\r\n        }\r\n\r\n        function switchImgAndVideo(root, img2video) {\r\n            utils.each(root.getNodesByTagName(img2video ? 'img' : 'embed video'), function (node) {\r\n                var className = node.getAttr('class');\r\n                if (className && className.indexOf('edui-faked-video') != -1) {\r\n                    var html = creatInsertStr(img2video ? node.getAttr('_url') : node.getAttr('src'), node.getAttr('width'), node.getAttr('height'), null, node.getStyle('float') || '', className, img2video ? 'embed' : 'image');\r\n                    node.parentNode.replaceChild(UE.uNode.createElement(html), node);\r\n                }\r\n                if (className && className.indexOf('edui-upload-video') != -1) {\r\n                    var html = creatInsertStr(img2video ? node.getAttr('_url') : node.getAttr('src'), node.getAttr('width'), node.getAttr('height'), null, node.getStyle('float') || '', className, img2video ? 'video' : 'image');\r\n                    node.parentNode.replaceChild(UE.uNode.createElement(html), node);\r\n                }\r\n            })\r\n        }\r\n\r\n        me.addOutputRule(function (root) {\r\n            switchImgAndVideo(root, true)\r\n        });\r\n        me.addInputRule(function (root) {\r\n            switchImgAndVideo(root)\r\n        });\r\n\r\n        /**\r\n         * 插入视频\r\n         * @command insertvideo\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @param { Object } videoAttr 键值对对象， 描述一个视频的所有属性\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var videoAttr = {\r\n         *      //视频地址\r\n         *      url: 'http://www.youku.com/xxx',\r\n         *      //视频宽高值， 单位px\r\n         *      width: 200,\r\n         *      height: 100\r\n         * };\r\n         *\r\n         * //editor 是编辑器实例\r\n         * //向编辑器插入单个视频\r\n         * editor.execCommand( 'insertvideo', videoAttr );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 插入视频\r\n         * @command insertvideo\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @param { Array } videoArr 需要插入的视频的数组， 其中的每一个元素都是一个键值对对象， 描述了一个视频的所有属性\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * var videoAttr1 = {\r\n         *      //视频地址\r\n         *      url: 'http://www.youku.com/xxx',\r\n         *      //视频宽高值， 单位px\r\n         *      width: 200,\r\n         *      height: 100\r\n         * },\r\n         * videoAttr2 = {\r\n         *      //视频地址\r\n         *      url: 'http://www.youku.com/xxx',\r\n         *      //视频宽高值， 单位px\r\n         *      width: 200,\r\n         *      height: 100\r\n         * }\r\n         *\r\n         * //editor 是编辑器实例\r\n         * //该方法将会向编辑器内插入两个视频\r\n         * editor.execCommand( 'insertvideo', [ videoAttr1, videoAttr2 ] );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 查询当前光标所在处是否是一个视频\r\n         * @command insertvideo\r\n         * @method queryCommandState\r\n         * @param { String } cmd 需要查询的命令字符串\r\n         * @return { int } 如果当前光标所在处的元素是一个视频对象， 则返回1，否则返回0\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //editor 是编辑器实例\r\n         * editor.queryCommandState( 'insertvideo' );\r\n         * ```\r\n         */\r\n        me.commands[\"insertvideo\"] = {\r\n            execCommand: function (cmd, videoObjs, type) {\r\n                videoObjs = utils.isArray(videoObjs) ? videoObjs : [videoObjs];\r\n                var html = [], id = 'tmpVedio', cl;\r\n                for (var i = 0, vi, len = videoObjs.length; i < len; i++) {\r\n                    vi = videoObjs[i];\r\n                    cl = (type == 'upload' ? 'edui-upload-video video-js vjs-default-skin' : 'edui-faked-video');\r\n                    html.push(creatInsertStr(vi.url, vi.width || 420, vi.height || 280, id + i, null, cl, 'image'));\r\n                }\r\n                me.execCommand(\"inserthtml\", html.join(\"\"), true);\r\n                var rng = this.selection.getRange();\r\n                for (var i = 0, len = videoObjs.length; i < len; i++) {\r\n                    var img = this.document.getElementById('tmpVedio' + i);\r\n                    domUtils.removeAttributes(img, 'id');\r\n                    rng.selectNode(img).select();\r\n                    me.execCommand('imagefloat', videoObjs[i].align)\r\n                }\r\n            },\r\n            queryCommandState: function () {\r\n                var img = me.selection.getRange().getClosedNode(),\r\n                    flag = img && (img.className == \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1);\r\n                return flag ? 1 : 0;\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n    // plugins/table.core.js\r\n    /**\r\n     * Created with JetBrains WebStorm.\r\n     * User: taoqili\r\n     * Date: 13-1-18\r\n     * Time: 上午11:09\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n    /**\r\n     * UE表格操作类\r\n     * @param table\r\n     * @constructor\r\n     */\r\n    (function () {\r\n        var UETable = UE.UETable = function (table) {\r\n            this.table = table;\r\n            this.indexTable = [];\r\n            this.selectedTds = [];\r\n            this.cellsRange = {};\r\n            this.update(table);\r\n        };\r\n\r\n        //===以下为静态工具方法===\r\n        UETable.removeSelectedClass = function (cells) {\r\n            utils.each(cells, function (cell) {\r\n                domUtils.removeClasses(cell, \"selectTdClass\");\r\n            })\r\n        };\r\n        UETable.addSelectedClass = function (cells) {\r\n            utils.each(cells, function (cell) {\r\n                domUtils.addClass(cell, \"selectTdClass\");\r\n            })\r\n        };\r\n        UETable.isEmptyBlock = function (node) {\r\n            var reg = new RegExp(domUtils.fillChar, 'g');\r\n            if (node[browser.ie ? 'innerText' : 'textContent'].replace(/^\\s*$/, '').replace(reg, '').length > 0) {\r\n                return 0;\r\n            }\r\n            for (var i in dtd.$isNotEmpty) if (dtd.$isNotEmpty.hasOwnProperty(i)) {\r\n                if (node.getElementsByTagName(i).length) {\r\n                    return 0;\r\n                }\r\n            }\r\n            return 1;\r\n        };\r\n        UETable.getWidth = function (cell) {\r\n            if (!cell) return 0;\r\n            return parseInt(domUtils.getComputedStyle(cell, \"width\"), 10);\r\n        };\r\n\r\n        /**\r\n         * 获取单元格或者单元格组的“对齐”状态。 如果当前的检测对象是一个单元格组， 只有在满足所有单元格的 水平和竖直 对齐属性都相同的\r\n         * 条件时才会返回其状态值，否则将返回null； 如果当前只检测了一个单元格， 则直接返回当前单元格的对齐状态；\r\n         * @param table cell or table cells , 支持单个单元格dom对象 或者 单元格dom对象数组\r\n         * @return { align: 'left' || 'right' || 'center', valign: 'top' || 'middle' || 'bottom' } 或者 null\r\n         */\r\n        UETable.getTableCellAlignState = function (cells) {\r\n\r\n            !utils.isArray(cells) && (cells = [cells]);\r\n\r\n            var result = {},\r\n                status = ['align', 'valign'],\r\n                tempStatus = null,\r\n                isSame = true;//状态是否相同\r\n\r\n            utils.each(cells, function (cellNode) {\r\n\r\n                utils.each(status, function (currentState) {\r\n\r\n                    tempStatus = cellNode.getAttribute(currentState);\r\n\r\n                    if (!result[currentState] && tempStatus) {\r\n                        result[currentState] = tempStatus;\r\n                    } else if (!result[currentState] || (tempStatus !== result[currentState])) {\r\n                        isSame = false;\r\n                        return false;\r\n                    }\r\n\r\n                });\r\n\r\n                return isSame;\r\n\r\n            });\r\n\r\n            return isSame ? result : null;\r\n\r\n        };\r\n\r\n        /**\r\n         * 根据当前选区获取相关的table信息\r\n         * @return {Object}\r\n         */\r\n        UETable.getTableItemsByRange = function (editor) {\r\n            var start = editor.selection.getStart();\r\n\r\n            //ff下会选中bookmark\r\n            if (start && start.id && start.id.indexOf('_baidu_bookmark_start_') === 0 && start.nextSibling) {\r\n                start = start.nextSibling;\r\n            }\r\n\r\n            //在table或者td边缘有可能存在选中tr的情况\r\n            var cell = start && domUtils.findParentByTagName(start, [\"td\", \"th\"], true),\r\n                tr = cell && cell.parentNode,\r\n                caption = start && domUtils.findParentByTagName(start, 'caption', true),\r\n                table = caption ? caption.parentNode : tr && tr.parentNode.parentNode;\r\n\r\n            return {\r\n                cell: cell,\r\n                tr: tr,\r\n                table: table,\r\n                caption: caption\r\n            }\r\n        };\r\n        UETable.getUETableBySelected = function (editor) {\r\n            var table = UETable.getTableItemsByRange(editor).table;\r\n            if (table && table.ueTable && table.ueTable.selectedTds.length) {\r\n                return table.ueTable;\r\n            }\r\n            return null;\r\n        };\r\n\r\n        UETable.getDefaultValue = function (editor, table) {\r\n            var borderMap = {\r\n                thin: '0px',\r\n                medium: '1px',\r\n                thick: '2px'\r\n            },\r\n                tableBorder, tdPadding, tdBorder, tmpValue;\r\n            if (!table) {\r\n                table = editor.document.createElement('table');\r\n                table.insertRow(0).insertCell(0).innerHTML = 'xxx';\r\n                editor.body.appendChild(table);\r\n                var td = table.getElementsByTagName('td')[0];\r\n                tmpValue = domUtils.getComputedStyle(table, 'border-left-width');\r\n                tableBorder = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                tmpValue = domUtils.getComputedStyle(td, 'padding-left');\r\n                tdPadding = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                tmpValue = domUtils.getComputedStyle(td, 'border-left-width');\r\n                tdBorder = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                domUtils.remove(table);\r\n                return {\r\n                    tableBorder: tableBorder,\r\n                    tdPadding: tdPadding,\r\n                    tdBorder: tdBorder\r\n                };\r\n            } else {\r\n                td = table.getElementsByTagName('td')[0];\r\n                tmpValue = domUtils.getComputedStyle(table, 'border-left-width');\r\n                tableBorder = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                tmpValue = domUtils.getComputedStyle(td, 'padding-left');\r\n                tdPadding = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                tmpValue = domUtils.getComputedStyle(td, 'border-left-width');\r\n                tdBorder = parseInt(borderMap[tmpValue] || tmpValue, 10);\r\n                return {\r\n                    tableBorder: tableBorder,\r\n                    tdPadding: tdPadding,\r\n                    tdBorder: tdBorder\r\n                };\r\n            }\r\n        };\r\n        /**\r\n         * 根据当前点击的td或者table获取索引对象\r\n         * @param tdOrTable\r\n         */\r\n        UETable.getUETable = function (tdOrTable) {\r\n            var tag = tdOrTable.tagName.toLowerCase();\r\n            tdOrTable = (tag == \"td\" || tag == \"th\" || tag == 'caption') ? domUtils.findParentByTagName(tdOrTable, \"table\", true) : tdOrTable;\r\n            if (!tdOrTable.ueTable) {\r\n                tdOrTable.ueTable = new UETable(tdOrTable);\r\n            }\r\n            return tdOrTable.ueTable;\r\n        };\r\n\r\n        UETable.cloneCell = function (cell, ignoreMerge, keepPro) {\r\n            if (!cell || utils.isString(cell)) {\r\n                return this.table.ownerDocument.createElement(cell || 'td');\r\n            }\r\n            var flag = domUtils.hasClass(cell, \"selectTdClass\");\r\n            flag && domUtils.removeClasses(cell, \"selectTdClass\");\r\n            var tmpCell = cell.cloneNode(true);\r\n            if (ignoreMerge) {\r\n                tmpCell.rowSpan = tmpCell.colSpan = 1;\r\n            }\r\n            //去掉宽高\r\n            !keepPro && domUtils.removeAttributes(tmpCell, 'width height');\r\n            !keepPro && domUtils.removeAttributes(tmpCell, 'style');\r\n\r\n            tmpCell.style.borderLeftStyle = \"\";\r\n            tmpCell.style.borderTopStyle = \"\";\r\n            tmpCell.style.borderLeftColor = cell.style.borderRightColor;\r\n            tmpCell.style.borderLeftWidth = cell.style.borderRightWidth;\r\n            tmpCell.style.borderTopColor = cell.style.borderBottomColor;\r\n            tmpCell.style.borderTopWidth = cell.style.borderBottomWidth;\r\n            flag && domUtils.addClass(cell, \"selectTdClass\");\r\n            return tmpCell;\r\n        }\r\n\r\n        UETable.prototype = {\r\n            getMaxRows: function () {\r\n                var rows = this.table.rows, maxLen = 1;\r\n                for (var i = 0, row; row = rows[i]; i++) {\r\n                    var currentMax = 1;\r\n                    for (var j = 0, cj; cj = row.cells[j++];) {\r\n                        currentMax = Math.max(cj.rowSpan || 1, currentMax);\r\n                    }\r\n                    maxLen = Math.max(currentMax + i, maxLen);\r\n                }\r\n                return maxLen;\r\n            },\r\n            /**\r\n             * 获取当前表格的最大列数\r\n             */\r\n            getMaxCols: function () {\r\n                var rows = this.table.rows, maxLen = 0, cellRows = {};\r\n                for (var i = 0, row; row = rows[i]; i++) {\r\n                    var cellsNum = 0;\r\n                    for (var j = 0, cj; cj = row.cells[j++];) {\r\n                        cellsNum += (cj.colSpan || 1);\r\n                        if (cj.rowSpan && cj.rowSpan > 1) {\r\n                            for (var k = 1; k < cj.rowSpan; k++) {\r\n                                if (!cellRows['row_' + (i + k)]) {\r\n                                    cellRows['row_' + (i + k)] = (cj.colSpan || 1);\r\n                                } else {\r\n                                    cellRows['row_' + (i + k)]++\r\n                                }\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                    cellsNum += cellRows['row_' + i] || 0;\r\n                    maxLen = Math.max(cellsNum, maxLen);\r\n                }\r\n                return maxLen;\r\n            },\r\n            getCellColIndex: function (cell) {\r\n\r\n            },\r\n            /**\r\n             * 获取当前cell旁边的单元格，\r\n             * @param cell\r\n             * @param right\r\n             */\r\n            getHSideCell: function (cell, right) {\r\n                try {\r\n                    var cellInfo = this.getCellInfo(cell),\r\n                        previewRowIndex, previewColIndex;\r\n                    var len = this.selectedTds.length,\r\n                        range = this.cellsRange;\r\n                    //首行或者首列没有前置单元格\r\n                    if ((!right && (!len ? !cellInfo.colIndex : !range.beginColIndex)) || (right && (!len ? (cellInfo.colIndex == (this.colsNum - 1)) : (range.endColIndex == this.colsNum - 1)))) return null;\r\n\r\n                    previewRowIndex = !len ? cellInfo.rowIndex : range.beginRowIndex;\r\n                    previewColIndex = !right ? (!len ? (cellInfo.colIndex < 1 ? 0 : (cellInfo.colIndex - 1)) : range.beginColIndex - 1)\r\n                        : (!len ? cellInfo.colIndex + 1 : range.endColIndex + 1);\r\n                    return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex, this.indexTable[previewRowIndex][previewColIndex].cellIndex);\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            getTabNextCell: function (cell, preRowIndex) {\r\n                var cellInfo = this.getCellInfo(cell),\r\n                    rowIndex = preRowIndex || cellInfo.rowIndex,\r\n                    colIndex = cellInfo.colIndex + 1 + (cellInfo.colSpan - 1),\r\n                    nextCell;\r\n                try {\r\n                    nextCell = this.getCell(this.indexTable[rowIndex][colIndex].rowIndex, this.indexTable[rowIndex][colIndex].cellIndex);\r\n                } catch (e) {\r\n                    try {\r\n                        rowIndex = rowIndex * 1 + 1;\r\n                        colIndex = 0;\r\n                        nextCell = this.getCell(this.indexTable[rowIndex][colIndex].rowIndex, this.indexTable[rowIndex][colIndex].cellIndex);\r\n                    } catch (e) {\r\n                    }\r\n                }\r\n                return nextCell;\r\n\r\n            },\r\n            /**\r\n             * 获取视觉上的后置单元格\r\n             * @param cell\r\n             * @param bottom\r\n             */\r\n            getVSideCell: function (cell, bottom, ignoreRange) {\r\n                try {\r\n                    var cellInfo = this.getCellInfo(cell),\r\n                        nextRowIndex, nextColIndex;\r\n                    var len = this.selectedTds.length && !ignoreRange,\r\n                        range = this.cellsRange;\r\n                    //末行或者末列没有后置单元格\r\n                    if ((!bottom && (cellInfo.rowIndex == 0)) || (bottom && (!len ? (cellInfo.rowIndex + cellInfo.rowSpan > this.rowsNum - 1) : (range.endRowIndex == this.rowsNum - 1)))) return null;\r\n\r\n                    nextRowIndex = !bottom ? (!len ? cellInfo.rowIndex - 1 : range.beginRowIndex - 1)\r\n                        : (!len ? (cellInfo.rowIndex + cellInfo.rowSpan) : range.endRowIndex + 1);\r\n                    nextColIndex = !len ? cellInfo.colIndex : range.beginColIndex;\r\n                    return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex, this.indexTable[nextRowIndex][nextColIndex].cellIndex);\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            /**\r\n             * 获取相同结束位置的单元格，xOrY指代了是获取x轴相同还是y轴相同\r\n             */\r\n            getSameEndPosCells: function (cell, xOrY) {\r\n                try {\r\n                    var flag = (xOrY.toLowerCase() === \"x\"),\r\n                        end = domUtils.getXY(cell)[flag ? 'x' : 'y'] + cell[\"offset\" + (flag ? 'Width' : 'Height')],\r\n                        rows = this.table.rows,\r\n                        cells = null, returns = [];\r\n                    for (var i = 0; i < this.rowsNum; i++) {\r\n                        cells = rows[i].cells;\r\n                        for (var j = 0, tmpCell; tmpCell = cells[j++];) {\r\n                            var tmpEnd = domUtils.getXY(tmpCell)[flag ? 'x' : 'y'] + tmpCell[\"offset\" + (flag ? 'Width' : 'Height')];\r\n                            //对应行的td已经被上面行rowSpan了\r\n                            if (tmpEnd > end && flag) break;\r\n                            if (cell == tmpCell || end == tmpEnd) {\r\n                                //只获取单一的单元格\r\n                                //todo 仅获取单一单元格在特定情况下会造成returns为空，从而影响后续的拖拽实现，修正这个。需考虑性能\r\n                                if (tmpCell[flag ? \"colSpan\" : \"rowSpan\"] == 1) {\r\n                                    returns.push(tmpCell);\r\n                                }\r\n                                if (flag) break;\r\n                            }\r\n                        }\r\n                    }\r\n                    return returns;\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            setCellContent: function (cell, content) {\r\n                cell.innerHTML = content || (browser.ie ? domUtils.fillChar : \"<br />\");\r\n            },\r\n            cloneCell: UETable.cloneCell,\r\n            /**\r\n             * 获取跟当前单元格的右边竖线为左边的所有未合并单元格\r\n             */\r\n            getSameStartPosXCells: function (cell) {\r\n                try {\r\n                    var start = domUtils.getXY(cell).x + cell.offsetWidth,\r\n                        rows = this.table.rows, cells, returns = [];\r\n                    for (var i = 0; i < this.rowsNum; i++) {\r\n                        cells = rows[i].cells;\r\n                        for (var j = 0, tmpCell; tmpCell = cells[j++];) {\r\n                            var tmpStart = domUtils.getXY(tmpCell).x;\r\n                            if (tmpStart > start) break;\r\n                            if (tmpStart == start && tmpCell.colSpan == 1) {\r\n                                returns.push(tmpCell);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    return returns;\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            /**\r\n             * 更新table对应的索引表\r\n             */\r\n            update: function (table) {\r\n                this.table = table || this.table;\r\n                this.selectedTds = [];\r\n                this.cellsRange = {};\r\n                this.indexTable = [];\r\n                var rows = this.table.rows,\r\n                    rowsNum = this.getMaxRows(),\r\n                    dNum = rowsNum - rows.length,\r\n                    colsNum = this.getMaxCols();\r\n                while (dNum--) {\r\n                    this.table.insertRow(rows.length);\r\n                }\r\n                this.rowsNum = rowsNum;\r\n                this.colsNum = colsNum;\r\n                for (var i = 0, len = rows.length; i < len; i++) {\r\n                    this.indexTable[i] = new Array(colsNum);\r\n                }\r\n                //填充索引表\r\n                for (var rowIndex = 0, row; row = rows[rowIndex]; rowIndex++) {\r\n                    for (var cellIndex = 0, cell, cells = row.cells; cell = cells[cellIndex]; cellIndex++) {\r\n                        //修正整行被rowSpan时导致的行数计算错误\r\n                        if (cell.rowSpan > rowsNum) {\r\n                            cell.rowSpan = rowsNum;\r\n                        }\r\n                        var colIndex = cellIndex,\r\n                            rowSpan = cell.rowSpan || 1,\r\n                            colSpan = cell.colSpan || 1;\r\n                        //当已经被上一行rowSpan或者被前一列colSpan了，则跳到下一个单元格进行\r\n                        while (this.indexTable[rowIndex][colIndex]) colIndex++;\r\n                        for (var j = 0; j < rowSpan; j++) {\r\n                            for (var k = 0; k < colSpan; k++) {\r\n                                this.indexTable[rowIndex + j][colIndex + k] = {\r\n                                    rowIndex: rowIndex,\r\n                                    cellIndex: cellIndex,\r\n                                    colIndex: colIndex,\r\n                                    rowSpan: rowSpan,\r\n                                    colSpan: colSpan\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                //修复残缺td\r\n                for (j = 0; j < rowsNum; j++) {\r\n                    for (k = 0; k < colsNum; k++) {\r\n                        if (this.indexTable[j][k] === undefined) {\r\n                            row = rows[j];\r\n                            cell = row.cells[row.cells.length - 1];\r\n                            cell = cell ? cell.cloneNode(true) : this.table.ownerDocument.createElement(\"td\");\r\n                            this.setCellContent(cell);\r\n                            if (cell.colSpan !== 1) cell.colSpan = 1;\r\n                            if (cell.rowSpan !== 1) cell.rowSpan = 1;\r\n                            row.appendChild(cell);\r\n                            this.indexTable[j][k] = {\r\n                                rowIndex: j,\r\n                                cellIndex: cell.cellIndex,\r\n                                colIndex: k,\r\n                                rowSpan: 1,\r\n                                colSpan: 1\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                //当框选后删除行或者列后撤销，需要重建选区。\r\n                var tds = domUtils.getElementsByTagName(this.table, \"td\"),\r\n                    selectTds = [];\r\n                utils.each(tds, function (td) {\r\n                    if (domUtils.hasClass(td, \"selectTdClass\")) {\r\n                        selectTds.push(td);\r\n                    }\r\n                });\r\n                if (selectTds.length) {\r\n                    var start = selectTds[0],\r\n                        end = selectTds[selectTds.length - 1],\r\n                        startInfo = this.getCellInfo(start),\r\n                        endInfo = this.getCellInfo(end);\r\n                    this.selectedTds = selectTds;\r\n                    this.cellsRange = {\r\n                        beginRowIndex: startInfo.rowIndex,\r\n                        beginColIndex: startInfo.colIndex,\r\n                        endRowIndex: endInfo.rowIndex + endInfo.rowSpan - 1,\r\n                        endColIndex: endInfo.colIndex + endInfo.colSpan - 1\r\n                    };\r\n                }\r\n                //给第一行设置firstRow的样式名称,在排序图标的样式上使用到\r\n                if (!domUtils.hasClass(this.table.rows[0], \"firstRow\")) {\r\n                    domUtils.addClass(this.table.rows[0], \"firstRow\");\r\n                    for (var i = 1; i < this.table.rows.length; i++) {\r\n                        domUtils.removeClasses(this.table.rows[i], \"firstRow\");\r\n                    }\r\n                }\r\n            },\r\n            /**\r\n             * 获取单元格的索引信息\r\n             */\r\n            getCellInfo: function (cell) {\r\n                if (!cell) return;\r\n                var cellIndex = cell.cellIndex,\r\n                    rowIndex = cell.parentNode.rowIndex,\r\n                    rowInfo = this.indexTable[rowIndex],\r\n                    numCols = this.colsNum;\r\n                for (var colIndex = cellIndex; colIndex < numCols; colIndex++) {\r\n                    var cellInfo = rowInfo[colIndex];\r\n                    if (cellInfo.rowIndex === rowIndex && cellInfo.cellIndex === cellIndex) {\r\n                        return cellInfo;\r\n                    }\r\n                }\r\n            },\r\n            /**\r\n             * 根据行列号获取单元格\r\n             */\r\n            getCell: function (rowIndex, cellIndex) {\r\n                return rowIndex < this.rowsNum && this.table.rows[rowIndex].cells[cellIndex] || null;\r\n            },\r\n            /**\r\n             * 删除单元格\r\n             */\r\n            deleteCell: function (cell, rowIndex) {\r\n                rowIndex = typeof rowIndex == 'number' ? rowIndex : cell.parentNode.rowIndex;\r\n                var row = this.table.rows[rowIndex];\r\n                row.deleteCell(cell.cellIndex);\r\n            },\r\n            /**\r\n             * 根据始末两个单元格获取被框选的所有单元格范围\r\n             */\r\n            getCellsRange: function (cellA, cellB) {\r\n                function checkRange(beginRowIndex, beginColIndex, endRowIndex, endColIndex) {\r\n                    var tmpBeginRowIndex = beginRowIndex,\r\n                        tmpBeginColIndex = beginColIndex,\r\n                        tmpEndRowIndex = endRowIndex,\r\n                        tmpEndColIndex = endColIndex,\r\n                        cellInfo, colIndex, rowIndex;\r\n                    // 通过indexTable检查是否存在超出TableRange上边界的情况\r\n                    if (beginRowIndex > 0) {\r\n                        for (colIndex = beginColIndex; colIndex < endColIndex; colIndex++) {\r\n                            cellInfo = me.indexTable[beginRowIndex][colIndex];\r\n                            rowIndex = cellInfo.rowIndex;\r\n                            if (rowIndex < beginRowIndex) {\r\n                                tmpBeginRowIndex = Math.min(rowIndex, tmpBeginRowIndex);\r\n                            }\r\n                        }\r\n                    }\r\n                    // 通过indexTable检查是否存在超出TableRange右边界的情况\r\n                    if (endColIndex < me.colsNum) {\r\n                        for (rowIndex = beginRowIndex; rowIndex < endRowIndex; rowIndex++) {\r\n                            cellInfo = me.indexTable[rowIndex][endColIndex];\r\n                            colIndex = cellInfo.colIndex + cellInfo.colSpan - 1;\r\n                            if (colIndex > endColIndex) {\r\n                                tmpEndColIndex = Math.max(colIndex, tmpEndColIndex);\r\n                            }\r\n                        }\r\n                    }\r\n                    // 检查是否有超出TableRange下边界的情况\r\n                    if (endRowIndex < me.rowsNum) {\r\n                        for (colIndex = beginColIndex; colIndex < endColIndex; colIndex++) {\r\n                            cellInfo = me.indexTable[endRowIndex][colIndex];\r\n                            rowIndex = cellInfo.rowIndex + cellInfo.rowSpan - 1;\r\n                            if (rowIndex > endRowIndex) {\r\n                                tmpEndRowIndex = Math.max(rowIndex, tmpEndRowIndex);\r\n                            }\r\n                        }\r\n                    }\r\n                    // 检查是否有超出TableRange左边界的情况\r\n                    if (beginColIndex > 0) {\r\n                        for (rowIndex = beginRowIndex; rowIndex < endRowIndex; rowIndex++) {\r\n                            cellInfo = me.indexTable[rowIndex][beginColIndex];\r\n                            colIndex = cellInfo.colIndex;\r\n                            if (colIndex < beginColIndex) {\r\n                                tmpBeginColIndex = Math.min(cellInfo.colIndex, tmpBeginColIndex);\r\n                            }\r\n                        }\r\n                    }\r\n                    //递归调用直至所有完成所有框选单元格的扩展\r\n                    if (tmpBeginRowIndex != beginRowIndex || tmpBeginColIndex != beginColIndex || tmpEndRowIndex != endRowIndex || tmpEndColIndex != endColIndex) {\r\n                        return checkRange(tmpBeginRowIndex, tmpBeginColIndex, tmpEndRowIndex, tmpEndColIndex);\r\n                    } else {\r\n                        // 不需要扩展TableRange的情况\r\n                        return {\r\n                            beginRowIndex: beginRowIndex,\r\n                            beginColIndex: beginColIndex,\r\n                            endRowIndex: endRowIndex,\r\n                            endColIndex: endColIndex\r\n                        };\r\n                    }\r\n                }\r\n\r\n                try {\r\n                    var me = this,\r\n                        cellAInfo = me.getCellInfo(cellA);\r\n                    if (cellA === cellB) {\r\n                        return {\r\n                            beginRowIndex: cellAInfo.rowIndex,\r\n                            beginColIndex: cellAInfo.colIndex,\r\n                            endRowIndex: cellAInfo.rowIndex + cellAInfo.rowSpan - 1,\r\n                            endColIndex: cellAInfo.colIndex + cellAInfo.colSpan - 1\r\n                        };\r\n                    }\r\n                    var cellBInfo = me.getCellInfo(cellB);\r\n                    // 计算TableRange的四个边\r\n                    var beginRowIndex = Math.min(cellAInfo.rowIndex, cellBInfo.rowIndex),\r\n                        beginColIndex = Math.min(cellAInfo.colIndex, cellBInfo.colIndex),\r\n                        endRowIndex = Math.max(cellAInfo.rowIndex + cellAInfo.rowSpan - 1, cellBInfo.rowIndex + cellBInfo.rowSpan - 1),\r\n                        endColIndex = Math.max(cellAInfo.colIndex + cellAInfo.colSpan - 1, cellBInfo.colIndex + cellBInfo.colSpan - 1);\r\n\r\n                    return checkRange(beginRowIndex, beginColIndex, endRowIndex, endColIndex);\r\n                } catch (e) {\r\n                    //throw e;\r\n                }\r\n            },\r\n            /**\r\n             * 依据cellsRange获取对应的单元格集合\r\n             */\r\n            getCells: function (range) {\r\n                //每次获取cells之前必须先清除上次的选择，否则会对后续获取操作造成影响\r\n                this.clearSelected();\r\n                var beginRowIndex = range.beginRowIndex,\r\n                    beginColIndex = range.beginColIndex,\r\n                    endRowIndex = range.endRowIndex,\r\n                    endColIndex = range.endColIndex,\r\n                    cellInfo, rowIndex, colIndex, tdHash = {}, returnTds = [];\r\n                for (var i = beginRowIndex; i <= endRowIndex; i++) {\r\n                    for (var j = beginColIndex; j <= endColIndex; j++) {\r\n                        cellInfo = this.indexTable[i][j];\r\n                        rowIndex = cellInfo.rowIndex;\r\n                        colIndex = cellInfo.colIndex;\r\n                        // 如果Cells里已经包含了此Cell则跳过\r\n                        var key = rowIndex + '|' + colIndex;\r\n                        if (tdHash[key]) continue;\r\n                        tdHash[key] = 1;\r\n                        if (rowIndex < i || colIndex < j || rowIndex + cellInfo.rowSpan - 1 > endRowIndex || colIndex + cellInfo.colSpan - 1 > endColIndex) {\r\n                            return null;\r\n                        }\r\n                        returnTds.push(this.getCell(rowIndex, cellInfo.cellIndex));\r\n                    }\r\n                }\r\n                return returnTds;\r\n            },\r\n            /**\r\n             * 清理已经选中的单元格\r\n             */\r\n            clearSelected: function () {\r\n                UETable.removeSelectedClass(this.selectedTds);\r\n                this.selectedTds = [];\r\n                this.cellsRange = {};\r\n            },\r\n            /**\r\n             * 根据range设置已经选中的单元格\r\n             */\r\n            setSelected: function (range) {\r\n                var cells = this.getCells(range);\r\n                UETable.addSelectedClass(cells);\r\n                this.selectedTds = cells;\r\n                this.cellsRange = range;\r\n            },\r\n            isFullRow: function () {\r\n                var range = this.cellsRange;\r\n                return (range.endColIndex - range.beginColIndex + 1) == this.colsNum;\r\n            },\r\n            isFullCol: function () {\r\n                var range = this.cellsRange,\r\n                    table = this.table,\r\n                    ths = table.getElementsByTagName(\"th\"),\r\n                    rows = range.endRowIndex - range.beginRowIndex + 1;\r\n                return !ths.length ? rows == this.rowsNum : rows == this.rowsNum || (rows == this.rowsNum - 1);\r\n\r\n            },\r\n            /**\r\n             * 获取视觉上的前置单元格，默认是左边，top传入时\r\n             * @param cell\r\n             * @param top\r\n             */\r\n            getNextCell: function (cell, bottom, ignoreRange) {\r\n                try {\r\n                    var cellInfo = this.getCellInfo(cell),\r\n                        nextRowIndex, nextColIndex;\r\n                    var len = this.selectedTds.length && !ignoreRange,\r\n                        range = this.cellsRange;\r\n                    //末行或者末列没有后置单元格\r\n                    if ((!bottom && (cellInfo.rowIndex == 0)) || (bottom && (!len ? (cellInfo.rowIndex + cellInfo.rowSpan > this.rowsNum - 1) : (range.endRowIndex == this.rowsNum - 1)))) return null;\r\n\r\n                    nextRowIndex = !bottom ? (!len ? cellInfo.rowIndex - 1 : range.beginRowIndex - 1)\r\n                        : (!len ? (cellInfo.rowIndex + cellInfo.rowSpan) : range.endRowIndex + 1);\r\n                    nextColIndex = !len ? cellInfo.colIndex : range.beginColIndex;\r\n                    return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex, this.indexTable[nextRowIndex][nextColIndex].cellIndex);\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            getPreviewCell: function (cell, top) {\r\n                try {\r\n                    var cellInfo = this.getCellInfo(cell),\r\n                        previewRowIndex, previewColIndex;\r\n                    var len = this.selectedTds.length,\r\n                        range = this.cellsRange;\r\n                    //首行或者首列没有前置单元格\r\n                    if ((!top && (!len ? !cellInfo.colIndex : !range.beginColIndex)) || (top && (!len ? (cellInfo.rowIndex > (this.colsNum - 1)) : (range.endColIndex == this.colsNum - 1)))) return null;\r\n\r\n                    previewRowIndex = !top ? (!len ? cellInfo.rowIndex : range.beginRowIndex)\r\n                        : (!len ? (cellInfo.rowIndex < 1 ? 0 : (cellInfo.rowIndex - 1)) : range.beginRowIndex);\r\n                    previewColIndex = !top ? (!len ? (cellInfo.colIndex < 1 ? 0 : (cellInfo.colIndex - 1)) : range.beginColIndex - 1)\r\n                        : (!len ? cellInfo.colIndex : range.endColIndex + 1);\r\n                    return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex, this.indexTable[previewRowIndex][previewColIndex].cellIndex);\r\n                } catch (e) {\r\n                    showError(e);\r\n                }\r\n            },\r\n            /**\r\n             * 移动单元格中的内容\r\n             */\r\n            moveContent: function (cellTo, cellFrom) {\r\n                if (UETable.isEmptyBlock(cellFrom)) return;\r\n                if (UETable.isEmptyBlock(cellTo)) {\r\n                    cellTo.innerHTML = cellFrom.innerHTML;\r\n                    return;\r\n                }\r\n                var child = cellTo.lastChild;\r\n                if (child.nodeType == 3 || !dtd.$block[child.tagName]) {\r\n                    cellTo.appendChild(cellTo.ownerDocument.createElement('br'))\r\n                }\r\n                while (child = cellFrom.firstChild) {\r\n                    cellTo.appendChild(child);\r\n                }\r\n            },\r\n            /**\r\n             * 向右合并单元格\r\n             */\r\n            mergeRight: function (cell) {\r\n                var cellInfo = this.getCellInfo(cell),\r\n                    rightColIndex = cellInfo.colIndex + cellInfo.colSpan,\r\n                    rightCellInfo = this.indexTable[cellInfo.rowIndex][rightColIndex],\r\n                    rightCell = this.getCell(rightCellInfo.rowIndex, rightCellInfo.cellIndex);\r\n                //合并\r\n                cell.colSpan = cellInfo.colSpan + rightCellInfo.colSpan;\r\n                //被合并的单元格不应存在宽度属性\r\n                cell.removeAttribute(\"width\");\r\n                //移动内容\r\n                this.moveContent(cell, rightCell);\r\n                //删掉被合并的Cell\r\n                this.deleteCell(rightCell, rightCellInfo.rowIndex);\r\n                this.update();\r\n            },\r\n            /**\r\n             * 向下合并单元格\r\n             */\r\n            mergeDown: function (cell) {\r\n                var cellInfo = this.getCellInfo(cell),\r\n                    downRowIndex = cellInfo.rowIndex + cellInfo.rowSpan,\r\n                    downCellInfo = this.indexTable[downRowIndex][cellInfo.colIndex],\r\n                    downCell = this.getCell(downCellInfo.rowIndex, downCellInfo.cellIndex);\r\n                cell.rowSpan = cellInfo.rowSpan + downCellInfo.rowSpan;\r\n                cell.removeAttribute(\"height\");\r\n                this.moveContent(cell, downCell);\r\n                this.deleteCell(downCell, downCellInfo.rowIndex);\r\n                this.update();\r\n            },\r\n            /**\r\n             * 合并整个range中的内容\r\n             */\r\n            mergeRange: function () {\r\n                //由于合并操作可以在任意时刻进行，所以无法通过鼠标位置等信息实时生成range，只能通过缓存实例中的cellsRange对象来访问\r\n                var range = this.cellsRange,\r\n                    leftTopCell = this.getCell(range.beginRowIndex, this.indexTable[range.beginRowIndex][range.beginColIndex].cellIndex);\r\n\r\n                if (leftTopCell.tagName == \"TH\" && range.endRowIndex !== range.beginRowIndex) {\r\n                    var index = this.indexTable,\r\n                        info = this.getCellInfo(leftTopCell);\r\n                    leftTopCell = this.getCell(1, index[1][info.colIndex].cellIndex);\r\n                    range = this.getCellsRange(leftTopCell, this.getCell(index[this.rowsNum - 1][info.colIndex].rowIndex, index[this.rowsNum - 1][info.colIndex].cellIndex));\r\n                }\r\n\r\n                // 删除剩余的Cells\r\n                var cells = this.getCells(range);\r\n                for (var i = 0, ci; ci = cells[i++];) {\r\n                    if (ci !== leftTopCell) {\r\n                        this.moveContent(leftTopCell, ci);\r\n                        this.deleteCell(ci);\r\n                    }\r\n                }\r\n                // 修改左上角Cell的rowSpan和colSpan，并调整宽度属性设置\r\n                leftTopCell.rowSpan = range.endRowIndex - range.beginRowIndex + 1;\r\n                leftTopCell.rowSpan > 1 && leftTopCell.removeAttribute(\"height\");\r\n                leftTopCell.colSpan = range.endColIndex - range.beginColIndex + 1;\r\n                leftTopCell.colSpan > 1 && leftTopCell.removeAttribute(\"width\");\r\n                if (leftTopCell.rowSpan == this.rowsNum && leftTopCell.colSpan != 1) {\r\n                    leftTopCell.colSpan = 1;\r\n                }\r\n\r\n                if (leftTopCell.colSpan == this.colsNum && leftTopCell.rowSpan != 1) {\r\n                    var rowIndex = leftTopCell.parentNode.rowIndex;\r\n                    //解决IE下的表格操作问题\r\n                    if (this.table.deleteRow) {\r\n                        for (var i = rowIndex + 1, curIndex = rowIndex + 1, len = leftTopCell.rowSpan; i < len; i++) {\r\n                            this.table.deleteRow(curIndex);\r\n                        }\r\n                    } else {\r\n                        for (var i = 0, len = leftTopCell.rowSpan - 1; i < len; i++) {\r\n                            var row = this.table.rows[rowIndex + 1];\r\n                            row.parentNode.removeChild(row);\r\n                        }\r\n                    }\r\n                    leftTopCell.rowSpan = 1;\r\n                }\r\n                this.update();\r\n            },\r\n            /**\r\n             * 插入一行单元格\r\n             */\r\n            insertRow: function (rowIndex, sourceCell) {\r\n                var numCols = this.colsNum,\r\n                    table = this.table,\r\n                    row = table.insertRow(rowIndex), cell,\r\n                    isInsertTitle = typeof sourceCell == 'string' && sourceCell.toUpperCase() == 'TH';\r\n\r\n                function replaceTdToTh(colIndex, cell, tableRow) {\r\n                    if (colIndex == 0) {\r\n                        var tr = tableRow.nextSibling || tableRow.previousSibling,\r\n                            th = tr.cells[colIndex];\r\n                        if (th.tagName == 'TH') {\r\n                            th = cell.ownerDocument.createElement(\"th\");\r\n                            th.appendChild(cell.firstChild);\r\n                            tableRow.insertBefore(th, cell);\r\n                            domUtils.remove(cell)\r\n                        }\r\n                    } else {\r\n                        if (cell.tagName == 'TH') {\r\n                            var td = cell.ownerDocument.createElement(\"td\");\r\n                            td.appendChild(cell.firstChild);\r\n                            tableRow.insertBefore(td, cell);\r\n                            domUtils.remove(cell)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //首行直接插入,无需考虑部分单元格被rowspan的情况\r\n                if (rowIndex == 0 || rowIndex == this.rowsNum) {\r\n                    for (var colIndex = 0; colIndex < numCols; colIndex++) {\r\n                        cell = this.cloneCell(sourceCell, true);\r\n                        this.setCellContent(cell);\r\n                        cell.getAttribute('vAlign') && cell.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                        row.appendChild(cell);\r\n                        if (!isInsertTitle) replaceTdToTh(colIndex, cell, row);\r\n                    }\r\n                } else {\r\n                    var infoRow = this.indexTable[rowIndex],\r\n                        cellIndex = 0;\r\n                    for (colIndex = 0; colIndex < numCols; colIndex++) {\r\n                        var cellInfo = infoRow[colIndex];\r\n                        //如果存在某个单元格的rowspan穿过待插入行的位置，则修改该单元格的rowspan即可，无需插入单元格\r\n                        if (cellInfo.rowIndex < rowIndex) {\r\n                            cell = this.getCell(cellInfo.rowIndex, cellInfo.cellIndex);\r\n                            cell.rowSpan = cellInfo.rowSpan + 1;\r\n                        } else {\r\n                            cell = this.cloneCell(sourceCell, true);\r\n                            this.setCellContent(cell);\r\n                            row.appendChild(cell);\r\n                        }\r\n                        if (!isInsertTitle) replaceTdToTh(colIndex, cell, row);\r\n                    }\r\n                }\r\n                //框选时插入不触发contentchange，需要手动更新索引。\r\n                this.update();\r\n                return row;\r\n            },\r\n            /**\r\n             * 删除一行单元格\r\n             * @param rowIndex\r\n             */\r\n            deleteRow: function (rowIndex) {\r\n                var row = this.table.rows[rowIndex],\r\n                    infoRow = this.indexTable[rowIndex],\r\n                    colsNum = this.colsNum,\r\n                    count = 0;     //处理计数\r\n                for (var colIndex = 0; colIndex < colsNum;) {\r\n                    var cellInfo = infoRow[colIndex],\r\n                        cell = this.getCell(cellInfo.rowIndex, cellInfo.cellIndex);\r\n                    if (cell.rowSpan > 1) {\r\n                        if (cellInfo.rowIndex == rowIndex) {\r\n                            var clone = cell.cloneNode(true);\r\n                            clone.rowSpan = cell.rowSpan - 1;\r\n                            clone.innerHTML = \"\";\r\n                            cell.rowSpan = 1;\r\n                            var nextRowIndex = rowIndex + 1,\r\n                                nextRow = this.table.rows[nextRowIndex],\r\n                                insertCellIndex,\r\n                                preMerged = this.getPreviewMergedCellsNum(nextRowIndex, colIndex) - count;\r\n                            if (preMerged < colIndex) {\r\n                                insertCellIndex = colIndex - preMerged - 1;\r\n                                //nextRow.insertCell(insertCellIndex);\r\n                                domUtils.insertAfter(nextRow.cells[insertCellIndex], clone);\r\n                            } else {\r\n                                if (nextRow.cells.length) nextRow.insertBefore(clone, nextRow.cells[0])\r\n                            }\r\n                            count += 1;\r\n                            //cell.parentNode.removeChild(cell);\r\n                        }\r\n                    }\r\n                    colIndex += cell.colSpan || 1;\r\n                }\r\n                var deleteTds = [], cacheMap = {};\r\n                for (colIndex = 0; colIndex < colsNum; colIndex++) {\r\n                    var tmpRowIndex = infoRow[colIndex].rowIndex,\r\n                        tmpCellIndex = infoRow[colIndex].cellIndex,\r\n                        key = tmpRowIndex + \"_\" + tmpCellIndex;\r\n                    if (cacheMap[key]) continue;\r\n                    cacheMap[key] = 1;\r\n                    cell = this.getCell(tmpRowIndex, tmpCellIndex);\r\n                    deleteTds.push(cell);\r\n                }\r\n                var mergeTds = [];\r\n                utils.each(deleteTds, function (td) {\r\n                    if (td.rowSpan == 1) {\r\n                        td.parentNode.removeChild(td);\r\n                    } else {\r\n                        mergeTds.push(td);\r\n                    }\r\n                });\r\n                utils.each(mergeTds, function (td) {\r\n                    td.rowSpan--;\r\n                });\r\n                row.parentNode.removeChild(row);\r\n                //浏览器方法本身存在bug,采用自定义方法删除\r\n                //this.table.deleteRow(rowIndex);\r\n                this.update();\r\n            },\r\n            insertCol: function (colIndex, sourceCell, defaultValue) {\r\n                var rowsNum = this.rowsNum,\r\n                    rowIndex = 0,\r\n                    tableRow, cell,\r\n                    backWidth = parseInt((this.table.offsetWidth - (this.colsNum + 1) * 20 - (this.colsNum + 1)) / (this.colsNum + 1), 10),\r\n                    isInsertTitleCol = typeof sourceCell == 'string' && sourceCell.toUpperCase() == 'TH';\r\n\r\n                function replaceTdToTh(rowIndex, cell, tableRow) {\r\n                    if (rowIndex == 0) {\r\n                        var th = cell.nextSibling || cell.previousSibling;\r\n                        if (th.tagName == 'TH') {\r\n                            th = cell.ownerDocument.createElement(\"th\");\r\n                            th.appendChild(cell.firstChild);\r\n                            tableRow.insertBefore(th, cell);\r\n                            domUtils.remove(cell)\r\n                        }\r\n                    } else {\r\n                        if (cell.tagName == 'TH') {\r\n                            var td = cell.ownerDocument.createElement(\"td\");\r\n                            td.appendChild(cell.firstChild);\r\n                            tableRow.insertBefore(td, cell);\r\n                            domUtils.remove(cell)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                var preCell;\r\n                if (colIndex == 0 || colIndex == this.colsNum) {\r\n                    for (; rowIndex < rowsNum; rowIndex++) {\r\n                        tableRow = this.table.rows[rowIndex];\r\n                        preCell = tableRow.cells[colIndex == 0 ? colIndex : tableRow.cells.length];\r\n                        cell = this.cloneCell(sourceCell, true); //tableRow.insertCell(colIndex == 0 ? colIndex : tableRow.cells.length);\r\n                        this.setCellContent(cell);\r\n                        cell.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                        preCell && cell.setAttribute('width', preCell.getAttribute('width'));\r\n                        if (!colIndex) {\r\n                            tableRow.insertBefore(cell, tableRow.cells[0]);\r\n                        } else {\r\n                            domUtils.insertAfter(tableRow.cells[tableRow.cells.length - 1], cell);\r\n                        }\r\n                        if (!isInsertTitleCol) replaceTdToTh(rowIndex, cell, tableRow)\r\n                    }\r\n                } else {\r\n                    for (; rowIndex < rowsNum; rowIndex++) {\r\n                        var cellInfo = this.indexTable[rowIndex][colIndex];\r\n                        if (cellInfo.colIndex < colIndex) {\r\n                            cell = this.getCell(cellInfo.rowIndex, cellInfo.cellIndex);\r\n                            cell.colSpan = cellInfo.colSpan + 1;\r\n                        } else {\r\n                            tableRow = this.table.rows[rowIndex];\r\n                            preCell = tableRow.cells[cellInfo.cellIndex];\r\n\r\n                            cell = this.cloneCell(sourceCell, true);//tableRow.insertCell(cellInfo.cellIndex);\r\n                            this.setCellContent(cell);\r\n                            cell.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                            preCell && cell.setAttribute('width', preCell.getAttribute('width'));\r\n                            //防止IE下报错\r\n                            preCell ? tableRow.insertBefore(cell, preCell) : tableRow.appendChild(cell);\r\n                        }\r\n                        if (!isInsertTitleCol) replaceTdToTh(rowIndex, cell, tableRow);\r\n                    }\r\n                }\r\n                //框选时插入不触发contentchange，需要手动更新索引\r\n                this.update();\r\n                this.updateWidth(backWidth, defaultValue || { tdPadding: 10, tdBorder: 1 });\r\n            },\r\n            updateWidth: function (width, defaultValue) {\r\n                var table = this.table,\r\n                    tmpWidth = UETable.getWidth(table) - defaultValue.tdPadding * 2 - defaultValue.tdBorder + width;\r\n                if (tmpWidth < table.ownerDocument.body.offsetWidth) {\r\n                    table.setAttribute(\"width\", tmpWidth);\r\n                    return;\r\n                }\r\n                var tds = domUtils.getElementsByTagName(this.table, \"td th\");\r\n                utils.each(tds, function (td) {\r\n                    td.setAttribute(\"width\", width);\r\n                })\r\n            },\r\n            deleteCol: function (colIndex) {\r\n                var indexTable = this.indexTable,\r\n                    tableRows = this.table.rows,\r\n                    backTableWidth = this.table.getAttribute(\"width\"),\r\n                    backTdWidth = 0,\r\n                    rowsNum = this.rowsNum,\r\n                    cacheMap = {};\r\n                for (var rowIndex = 0; rowIndex < rowsNum;) {\r\n                    var infoRow = indexTable[rowIndex],\r\n                        cellInfo = infoRow[colIndex],\r\n                        key = cellInfo.rowIndex + '_' + cellInfo.colIndex;\r\n                    // 跳过已经处理过的Cell\r\n                    if (cacheMap[key]) continue;\r\n                    cacheMap[key] = 1;\r\n                    var cell = this.getCell(cellInfo.rowIndex, cellInfo.cellIndex);\r\n                    if (!backTdWidth) backTdWidth = cell && parseInt(cell.offsetWidth / cell.colSpan, 10).toFixed(0);\r\n                    // 如果Cell的colSpan大于1, 就修改colSpan, 否则就删掉这个Cell\r\n                    if (cell.colSpan > 1) {\r\n                        cell.colSpan--;\r\n                    } else {\r\n                        tableRows[rowIndex].deleteCell(cellInfo.cellIndex);\r\n                    }\r\n                    rowIndex += cellInfo.rowSpan || 1;\r\n                }\r\n                this.table.setAttribute(\"width\", backTableWidth - backTdWidth);\r\n                this.update();\r\n            },\r\n            splitToCells: function (cell) {\r\n                var me = this,\r\n                    cells = this.splitToRows(cell);\r\n                utils.each(cells, function (cell) {\r\n                    me.splitToCols(cell);\r\n                })\r\n            },\r\n            splitToRows: function (cell) {\r\n                var cellInfo = this.getCellInfo(cell),\r\n                    rowIndex = cellInfo.rowIndex,\r\n                    colIndex = cellInfo.colIndex,\r\n                    results = [];\r\n                // 修改Cell的rowSpan\r\n                cell.rowSpan = 1;\r\n                results.push(cell);\r\n                // 补齐单元格\r\n                for (var i = rowIndex, endRow = rowIndex + cellInfo.rowSpan; i < endRow; i++) {\r\n                    if (i == rowIndex) continue;\r\n                    var tableRow = this.table.rows[i],\r\n                        tmpCell = tableRow.insertCell(colIndex - this.getPreviewMergedCellsNum(i, colIndex));\r\n                    tmpCell.colSpan = cellInfo.colSpan;\r\n                    this.setCellContent(tmpCell);\r\n                    tmpCell.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                    tmpCell.setAttribute('align', cell.getAttribute('align'));\r\n                    if (cell.style.cssText) {\r\n                        tmpCell.style.cssText = cell.style.cssText;\r\n                    }\r\n                    results.push(tmpCell);\r\n                }\r\n                this.update();\r\n                return results;\r\n            },\r\n            getPreviewMergedCellsNum: function (rowIndex, colIndex) {\r\n                var indexRow = this.indexTable[rowIndex],\r\n                    num = 0;\r\n                for (var i = 0; i < colIndex;) {\r\n                    var colSpan = indexRow[i].colSpan,\r\n                        tmpRowIndex = indexRow[i].rowIndex;\r\n                    num += (colSpan - (tmpRowIndex == rowIndex ? 1 : 0));\r\n                    i += colSpan;\r\n                }\r\n                return num;\r\n            },\r\n            splitToCols: function (cell) {\r\n                var backWidth = (cell.offsetWidth / cell.colSpan - 22).toFixed(0),\r\n\r\n                    cellInfo = this.getCellInfo(cell),\r\n                    rowIndex = cellInfo.rowIndex,\r\n                    colIndex = cellInfo.colIndex,\r\n                    results = [];\r\n                // 修改Cell的rowSpan\r\n                cell.colSpan = 1;\r\n                cell.setAttribute(\"width\", backWidth);\r\n                results.push(cell);\r\n                // 补齐单元格\r\n                for (var j = colIndex, endCol = colIndex + cellInfo.colSpan; j < endCol; j++) {\r\n                    if (j == colIndex) continue;\r\n                    var tableRow = this.table.rows[rowIndex],\r\n                        tmpCell = tableRow.insertCell(this.indexTable[rowIndex][j].cellIndex + 1);\r\n                    tmpCell.rowSpan = cellInfo.rowSpan;\r\n                    this.setCellContent(tmpCell);\r\n                    tmpCell.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                    tmpCell.setAttribute('align', cell.getAttribute('align'));\r\n                    tmpCell.setAttribute('width', backWidth);\r\n                    if (cell.style.cssText) {\r\n                        tmpCell.style.cssText = cell.style.cssText;\r\n                    }\r\n                    //处理th的情况\r\n                    if (cell.tagName == 'TH') {\r\n                        var th = cell.ownerDocument.createElement('th');\r\n                        th.appendChild(tmpCell.firstChild);\r\n                        th.setAttribute('vAlign', cell.getAttribute('vAlign'));\r\n                        th.rowSpan = tmpCell.rowSpan;\r\n                        tableRow.insertBefore(th, tmpCell);\r\n                        domUtils.remove(tmpCell);\r\n                    }\r\n                    results.push(tmpCell);\r\n                }\r\n                this.update();\r\n                return results;\r\n            },\r\n            isLastCell: function (cell, rowsNum, colsNum) {\r\n                rowsNum = rowsNum || this.rowsNum;\r\n                colsNum = colsNum || this.colsNum;\r\n                var cellInfo = this.getCellInfo(cell);\r\n                return ((cellInfo.rowIndex + cellInfo.rowSpan) == rowsNum) &&\r\n                    ((cellInfo.colIndex + cellInfo.colSpan) == colsNum);\r\n            },\r\n            getLastCell: function (cells) {\r\n                cells = cells || this.table.getElementsByTagName(\"td\");\r\n                var firstInfo = this.getCellInfo(cells[0]);\r\n                var me = this, last = cells[0],\r\n                    tr = last.parentNode,\r\n                    cellsNum = 0, cols = 0, rows;\r\n                utils.each(cells, function (cell) {\r\n                    if (cell.parentNode == tr) cols += cell.colSpan || 1;\r\n                    cellsNum += cell.rowSpan * cell.colSpan || 1;\r\n                });\r\n                rows = cellsNum / cols;\r\n                utils.each(cells, function (cell) {\r\n                    if (me.isLastCell(cell, rows, cols)) {\r\n                        last = cell;\r\n                        return false;\r\n                    }\r\n                });\r\n                return last;\r\n\r\n            },\r\n            selectRow: function (rowIndex) {\r\n                var indexRow = this.indexTable[rowIndex],\r\n                    start = this.getCell(indexRow[0].rowIndex, indexRow[0].cellIndex),\r\n                    end = this.getCell(indexRow[this.colsNum - 1].rowIndex, indexRow[this.colsNum - 1].cellIndex),\r\n                    range = this.getCellsRange(start, end);\r\n                this.setSelected(range);\r\n            },\r\n            selectTable: function () {\r\n                var tds = this.table.getElementsByTagName(\"td\"),\r\n                    range = this.getCellsRange(tds[0], tds[tds.length - 1]);\r\n                this.setSelected(range);\r\n            },\r\n            setBackground: function (cells, value) {\r\n                if (typeof value === \"string\") {\r\n                    utils.each(cells, function (cell) {\r\n                        cell.style.backgroundColor = value;\r\n                    })\r\n                } else if (typeof value === \"object\") {\r\n                    value = utils.extend({\r\n                        repeat: true,\r\n                        colorList: [\"#ddd\", \"#fff\"]\r\n                    }, value);\r\n                    var rowIndex = this.getCellInfo(cells[0]).rowIndex,\r\n                        count = 0,\r\n                        colors = value.colorList,\r\n                        getColor = function (list, index, repeat) {\r\n                            return list[index] ? list[index] : repeat ? list[index % list.length] : \"\";\r\n                        };\r\n                    for (var i = 0, cell; cell = cells[i++];) {\r\n                        var cellInfo = this.getCellInfo(cell);\r\n                        cell.style.backgroundColor = getColor(colors, ((rowIndex + count) == cellInfo.rowIndex) ? count : ++count, value.repeat);\r\n                    }\r\n                }\r\n            },\r\n            removeBackground: function (cells) {\r\n                utils.each(cells, function (cell) {\r\n                    cell.style.backgroundColor = \"\";\r\n                })\r\n            }\r\n\r\n\r\n        };\r\n        function showError(e) {\r\n        }\r\n    })();\r\n\r\n    // plugins/table.cmds.js\r\n    /**\r\n     * Created with JetBrains PhpStorm.\r\n     * User: taoqili\r\n     * Date: 13-2-20\r\n     * Time: 下午6:25\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n    ;\r\n    (function () {\r\n        var UT = UE.UETable,\r\n            getTableItemsByRange = function (editor) {\r\n                return UT.getTableItemsByRange(editor);\r\n            },\r\n            getUETableBySelected = function (editor) {\r\n                return UT.getUETableBySelected(editor)\r\n            },\r\n            getDefaultValue = function (editor, table) {\r\n                return UT.getDefaultValue(editor, table);\r\n            },\r\n            getUETable = function (tdOrTable) {\r\n                return UT.getUETable(tdOrTable);\r\n            };\r\n\r\n\r\n        UE.commands['inserttable'] = {\r\n            queryCommandState: function () {\r\n                return getTableItemsByRange(this).table ? -1 : 0;\r\n            },\r\n            execCommand: function (cmd, opt) {\r\n                function createTable(opt, tdWidth) {\r\n                    var html = [],\r\n                        rowsNum = opt.numRows,\r\n                        colsNum = opt.numCols;\r\n                    for (var r = 0; r < rowsNum; r++) {\r\n                        html.push('<tr' + (r == 0 ? ' class=\"firstRow\"' : '') + '>');\r\n                        for (var c = 0; c < colsNum; c++) {\r\n                            html.push('<td width=\"' + tdWidth + '\"  vAlign=\"' + opt.tdvalign + '\" >' + (browser.ie && browser.version < 11 ? domUtils.fillChar : '<br/>') + '</td>')\r\n                        }\r\n                        html.push('</tr>')\r\n                    }\r\n                    //禁止指定table-width\r\n                    return '<table><tbody>' + html.join('') + '</tbody></table>'\r\n                }\r\n\r\n                if (!opt) {\r\n                    opt = utils.extend({}, {\r\n                        numCols: this.options.defaultCols,\r\n                        numRows: this.options.defaultRows,\r\n                        tdvalign: this.options.tdvalign\r\n                    })\r\n                }\r\n                var me = this;\r\n                var range = this.selection.getRange(),\r\n                    start = range.startContainer,\r\n                    firstParentBlock = domUtils.findParent(start, function (node) {\r\n                        return domUtils.isBlockElm(node);\r\n                    }, true) || me.body;\r\n\r\n                var defaultValue = getDefaultValue(me),\r\n                    tableWidth = firstParentBlock.offsetWidth,\r\n                    tdWidth = Math.floor(tableWidth / opt.numCols - defaultValue.tdPadding * 2 - defaultValue.tdBorder);\r\n\r\n                //todo其他属性\r\n                !opt.tdvalign && (opt.tdvalign = me.options.tdvalign);\r\n                me.execCommand(\"inserthtml\", createTable(opt, tdWidth));\r\n            }\r\n        };\r\n\r\n        UE.commands['insertparagraphbeforetable'] = {\r\n            queryCommandState: function () {\r\n                return getTableItemsByRange(this).cell ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var p = this.document.createElement(\"p\");\r\n                    p.innerHTML = browser.ie ? '&nbsp;' : '<br />';\r\n                    table.parentNode.insertBefore(p, table);\r\n                    this.selection.getRange().setStart(p, 0).setCursor();\r\n                }\r\n            }\r\n        };\r\n\r\n        UE.commands['deletetable'] = {\r\n            queryCommandState: function () {\r\n                var rng = this.selection.getRange();\r\n                return domUtils.findParentByTagName(rng.startContainer, 'table', true) ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd, table) {\r\n                var rng = this.selection.getRange();\r\n                table = table || domUtils.findParentByTagName(rng.startContainer, 'table', true);\r\n                if (table) {\r\n                    var next = table.nextSibling;\r\n                    if (!next) {\r\n                        next = domUtils.createElement(this.document, 'p', {\r\n                            'innerHTML': browser.ie ? domUtils.fillChar : '<br/>'\r\n                        });\r\n                        table.parentNode.insertBefore(next, table);\r\n                    }\r\n                    domUtils.remove(table);\r\n                    rng = this.selection.getRange();\r\n                    if (next.nodeType == 3) {\r\n                        rng.setStartBefore(next)\r\n                    } else {\r\n                        rng.setStart(next, 0)\r\n                    }\r\n                    rng.setCursor(false, true)\r\n                    this.fireEvent(\"tablehasdeleted\")\r\n\r\n                }\r\n\r\n            }\r\n        };\r\n        UE.commands['cellalign'] = {\r\n            queryCommandState: function () {\r\n                return getSelectedArr(this).length ? 0 : -1\r\n            },\r\n            execCommand: function (cmd, align) {\r\n                var selectedTds = getSelectedArr(this);\r\n                if (selectedTds.length) {\r\n                    for (var i = 0, ci; ci = selectedTds[i++];) {\r\n                        ci.setAttribute('align', align);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        UE.commands['cellvalign'] = {\r\n            queryCommandState: function () {\r\n                return getSelectedArr(this).length ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd, valign) {\r\n                var selectedTds = getSelectedArr(this);\r\n                if (selectedTds.length) {\r\n                    for (var i = 0, ci; ci = selectedTds[i++];) {\r\n                        ci.setAttribute('vAlign', valign);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        UE.commands['insertcaption'] = {\r\n            queryCommandState: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    return table.getElementsByTagName('caption').length == 0 ? 1 : -1;\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var caption = this.document.createElement('caption');\r\n                    caption.innerHTML = browser.ie ? domUtils.fillChar : '<br/>';\r\n                    table.insertBefore(caption, table.firstChild);\r\n                    var range = this.selection.getRange();\r\n                    range.setStart(caption, 0).setCursor();\r\n                }\r\n\r\n            }\r\n        };\r\n        UE.commands['deletecaption'] = {\r\n            queryCommandState: function () {\r\n                var rng = this.selection.getRange(),\r\n                    table = domUtils.findParentByTagName(rng.startContainer, 'table');\r\n                if (table) {\r\n                    return table.getElementsByTagName('caption').length == 0 ? -1 : 1;\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    table = domUtils.findParentByTagName(rng.startContainer, 'table');\r\n                if (table) {\r\n                    domUtils.remove(table.getElementsByTagName('caption')[0]);\r\n                    var range = this.selection.getRange();\r\n                    range.setStart(table.rows[0].cells[0], 0).setCursor();\r\n                }\r\n\r\n            }\r\n        };\r\n        UE.commands['inserttitle'] = {\r\n            queryCommandState: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var firstRow = table.rows[0];\r\n                    return firstRow.cells[firstRow.cells.length - 1].tagName.toLowerCase() != 'th' ? 0 : -1\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    getUETable(table).insertRow(0, 'th');\r\n                }\r\n                var th = table.getElementsByTagName('th')[0];\r\n                this.selection.getRange().setStart(th, 0).setCursor(false, true);\r\n            }\r\n        };\r\n        UE.commands['deletetitle'] = {\r\n            queryCommandState: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var firstRow = table.rows[0];\r\n                    return firstRow.cells[firstRow.cells.length - 1].tagName.toLowerCase() == 'th' ? 0 : -1\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    domUtils.remove(table.rows[0])\r\n                }\r\n                var td = table.getElementsByTagName('td')[0];\r\n                this.selection.getRange().setStart(td, 0).setCursor(false, true);\r\n            }\r\n        };\r\n        UE.commands['inserttitlecol'] = {\r\n            queryCommandState: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var lastRow = table.rows[table.rows.length - 1];\r\n                    return lastRow.getElementsByTagName('th').length ? -1 : 0;\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    getUETable(table).insertCol(0, 'th');\r\n                }\r\n                resetTdWidth(table, this);\r\n                var th = table.getElementsByTagName('th')[0];\r\n                this.selection.getRange().setStart(th, 0).setCursor(false, true);\r\n            }\r\n        };\r\n        UE.commands['deletetitlecol'] = {\r\n            queryCommandState: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    var lastRow = table.rows[table.rows.length - 1];\r\n                    return lastRow.getElementsByTagName('th').length ? 0 : -1;\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table) {\r\n                    for (var i = 0; i < table.rows.length; i++) {\r\n                        domUtils.remove(table.rows[i].children[0])\r\n                    }\r\n                }\r\n                resetTdWidth(table, this);\r\n                var td = table.getElementsByTagName('td')[0];\r\n                this.selection.getRange().setStart(td, 0).setCursor(false, true);\r\n            }\r\n        };\r\n\r\n        UE.commands[\"mergeright\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    table = tableItems.table,\r\n                    cell = tableItems.cell;\r\n\r\n                if (!table || !cell) return -1;\r\n                var ut = getUETable(table);\r\n                if (ut.selectedTds.length) return -1;\r\n\r\n                var cellInfo = ut.getCellInfo(cell),\r\n                    rightColIndex = cellInfo.colIndex + cellInfo.colSpan;\r\n                if (rightColIndex >= ut.colsNum) return -1; // 如果处于最右边则不能向右合并\r\n\r\n                var rightCellInfo = ut.indexTable[cellInfo.rowIndex][rightColIndex],\r\n                    rightCell = table.rows[rightCellInfo.rowIndex].cells[rightCellInfo.cellIndex];\r\n                if (!rightCell || cell.tagName != rightCell.tagName) return -1; // TH和TD不能相互合并\r\n\r\n                // 当且仅当两个Cell的开始列号和结束列号一致时能进行合并\r\n                return (rightCellInfo.rowIndex == cellInfo.rowIndex && rightCellInfo.rowSpan == cellInfo.rowSpan) ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell);\r\n                ut.mergeRight(cell);\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n        UE.commands[\"mergedown\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    table = tableItems.table,\r\n                    cell = tableItems.cell;\r\n\r\n                if (!table || !cell) return -1;\r\n                var ut = getUETable(table);\r\n                if (ut.selectedTds.length) return -1;\r\n\r\n                var cellInfo = ut.getCellInfo(cell),\r\n                    downRowIndex = cellInfo.rowIndex + cellInfo.rowSpan;\r\n                if (downRowIndex >= ut.rowsNum) return -1; // 如果处于最下边则不能向下合并\r\n\r\n                var downCellInfo = ut.indexTable[downRowIndex][cellInfo.colIndex],\r\n                    downCell = table.rows[downCellInfo.rowIndex].cells[downCellInfo.cellIndex];\r\n                if (!downCell || cell.tagName != downCell.tagName) return -1; // TH和TD不能相互合并\r\n\r\n                // 当且仅当两个Cell的开始列号和结束列号一致时能进行合并\r\n                return (downCellInfo.colIndex == cellInfo.colIndex && downCellInfo.colSpan == cellInfo.colSpan) ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell);\r\n                ut.mergeDown(cell);\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n        UE.commands[\"mergecells\"] = {\r\n            queryCommandState: function () {\r\n                return getUETableBySelected(this) ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var ut = getUETableBySelected(this);\r\n                if (ut && ut.selectedTds.length) {\r\n                    var cell = ut.selectedTds[0];\r\n                    ut.mergeRange();\r\n                    var rng = this.selection.getRange();\r\n                    if (domUtils.isEmptyBlock(cell)) {\r\n                        rng.setStart(cell, 0).collapse(true)\r\n                    } else {\r\n                        rng.selectNodeContents(cell)\r\n                    }\r\n                    rng.select();\r\n                }\r\n\r\n\r\n            }\r\n        };\r\n        UE.commands[\"insertrow\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                return cell && (cell.tagName == \"TD\" || (cell.tagName == 'TH' && tableItems.tr !== tableItems.table.rows[0])) &&\r\n                    getUETable(tableItems.table).rowsNum < this.options.maxRowNum ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell,\r\n                    table = tableItems.table,\r\n                    ut = getUETable(table),\r\n                    cellInfo = ut.getCellInfo(cell);\r\n                //ut.insertRow(!ut.selectedTds.length ? cellInfo.rowIndex:ut.cellsRange.beginRowIndex,'');\r\n                if (!ut.selectedTds.length) {\r\n                    ut.insertRow(cellInfo.rowIndex, cell);\r\n                } else {\r\n                    var range = ut.cellsRange;\r\n                    for (var i = 0, len = range.endRowIndex - range.beginRowIndex + 1; i < len; i++) {\r\n                        ut.insertRow(range.beginRowIndex, cell);\r\n                    }\r\n                }\r\n                rng.moveToBookmark(bk).select();\r\n                if (table.getAttribute(\"interlaced\") === \"enabled\") this.fireEvent(\"interlacetable\", table);\r\n            }\r\n        };\r\n        //后插入行\r\n        UE.commands[\"insertrownext\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                return cell && (cell.tagName == \"TD\") && getUETable(tableItems.table).rowsNum < this.options.maxRowNum ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell,\r\n                    table = tableItems.table,\r\n                    ut = getUETable(table),\r\n                    cellInfo = ut.getCellInfo(cell);\r\n                //ut.insertRow(!ut.selectedTds.length? cellInfo.rowIndex + cellInfo.rowSpan : ut.cellsRange.endRowIndex + 1,'');\r\n                if (!ut.selectedTds.length) {\r\n                    ut.insertRow(cellInfo.rowIndex + cellInfo.rowSpan, cell);\r\n                } else {\r\n                    var range = ut.cellsRange;\r\n                    for (var i = 0, len = range.endRowIndex - range.beginRowIndex + 1; i < len; i++) {\r\n                        ut.insertRow(range.endRowIndex + 1, cell);\r\n                    }\r\n                }\r\n                rng.moveToBookmark(bk).select();\r\n                if (table.getAttribute(\"interlaced\") === \"enabled\") this.fireEvent(\"interlacetable\", table);\r\n            }\r\n        };\r\n        UE.commands[\"deleterow\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this);\r\n                return tableItems.cell ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell),\r\n                    cellsRange = ut.cellsRange,\r\n                    cellInfo = ut.getCellInfo(cell),\r\n                    preCell = ut.getVSideCell(cell),\r\n                    nextCell = ut.getVSideCell(cell, true),\r\n                    rng = this.selection.getRange();\r\n                if (utils.isEmptyObject(cellsRange)) {\r\n                    ut.deleteRow(cellInfo.rowIndex);\r\n                } else {\r\n                    for (var i = cellsRange.beginRowIndex; i < cellsRange.endRowIndex + 1; i++) {\r\n                        ut.deleteRow(cellsRange.beginRowIndex);\r\n                    }\r\n                }\r\n                var table = ut.table;\r\n                if (!table.getElementsByTagName('td').length) {\r\n                    var nextSibling = table.nextSibling;\r\n                    domUtils.remove(table);\r\n                    if (nextSibling) {\r\n                        rng.setStart(nextSibling, 0).setCursor(false, true);\r\n                    }\r\n                } else {\r\n                    if (cellInfo.rowSpan == 1 || cellInfo.rowSpan == cellsRange.endRowIndex - cellsRange.beginRowIndex + 1) {\r\n                        if (nextCell || preCell) rng.selectNodeContents(nextCell || preCell).setCursor(false, true);\r\n                    } else {\r\n                        var newCell = ut.getCell(cellInfo.rowIndex, ut.indexTable[cellInfo.rowIndex][cellInfo.colIndex].cellIndex);\r\n                        if (newCell) rng.selectNodeContents(newCell).setCursor(false, true);\r\n                    }\r\n                }\r\n                if (table.getAttribute(\"interlaced\") === \"enabled\") this.fireEvent(\"interlacetable\", table);\r\n            }\r\n        };\r\n        UE.commands[\"insertcol\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                return cell && (cell.tagName == \"TD\" || (cell.tagName == 'TH' && cell !== tableItems.tr.cells[0])) &&\r\n                    getUETable(tableItems.table).colsNum < this.options.maxColNum ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                if (this.queryCommandState(cmd) == -1) return;\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell),\r\n                    cellInfo = ut.getCellInfo(cell);\r\n\r\n                //ut.insertCol(!ut.selectedTds.length ? cellInfo.colIndex:ut.cellsRange.beginColIndex);\r\n                if (!ut.selectedTds.length) {\r\n                    ut.insertCol(cellInfo.colIndex, cell);\r\n                } else {\r\n                    var range = ut.cellsRange;\r\n                    for (var i = 0, len = range.endColIndex - range.beginColIndex + 1; i < len; i++) {\r\n                        ut.insertCol(range.beginColIndex, cell);\r\n                    }\r\n                }\r\n                rng.moveToBookmark(bk).select(true);\r\n            }\r\n        };\r\n        UE.commands[\"insertcolnext\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                return cell && getUETable(tableItems.table).colsNum < this.options.maxColNum ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell),\r\n                    cellInfo = ut.getCellInfo(cell);\r\n                //ut.insertCol(!ut.selectedTds.length ? cellInfo.colIndex + cellInfo.colSpan:ut.cellsRange.endColIndex +1);\r\n                if (!ut.selectedTds.length) {\r\n                    ut.insertCol(cellInfo.colIndex + cellInfo.colSpan, cell);\r\n                } else {\r\n                    var range = ut.cellsRange;\r\n                    for (var i = 0, len = range.endColIndex - range.beginColIndex + 1; i < len; i++) {\r\n                        ut.insertCol(range.endColIndex + 1, cell);\r\n                    }\r\n                }\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n\r\n        UE.commands[\"deletecol\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this);\r\n                return tableItems.cell ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell),\r\n                    range = ut.cellsRange,\r\n                    cellInfo = ut.getCellInfo(cell),\r\n                    preCell = ut.getHSideCell(cell),\r\n                    nextCell = ut.getHSideCell(cell, true);\r\n                if (utils.isEmptyObject(range)) {\r\n                    ut.deleteCol(cellInfo.colIndex);\r\n                } else {\r\n                    for (var i = range.beginColIndex; i < range.endColIndex + 1; i++) {\r\n                        ut.deleteCol(range.beginColIndex);\r\n                    }\r\n                }\r\n                var table = ut.table,\r\n                    rng = this.selection.getRange();\r\n\r\n                if (!table.getElementsByTagName('td').length) {\r\n                    var nextSibling = table.nextSibling;\r\n                    domUtils.remove(table);\r\n                    if (nextSibling) {\r\n                        rng.setStart(nextSibling, 0).setCursor(false, true);\r\n                    }\r\n                } else {\r\n                    if (domUtils.inDoc(cell, this.document)) {\r\n                        rng.setStart(cell, 0).setCursor(false, true);\r\n                    } else {\r\n                        if (nextCell && domUtils.inDoc(nextCell, this.document)) {\r\n                            rng.selectNodeContents(nextCell).setCursor(false, true);\r\n                        } else {\r\n                            if (preCell && domUtils.inDoc(preCell, this.document)) {\r\n                                rng.selectNodeContents(preCell).setCursor(true, true);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        UE.commands[\"splittocells\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                if (!cell) return -1;\r\n                var ut = getUETable(tableItems.table);\r\n                if (ut.selectedTds.length > 0) return -1;\r\n                return cell && (cell.colSpan > 1 || cell.rowSpan > 1) ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell);\r\n                ut.splitToCells(cell);\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n        UE.commands[\"splittorows\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                if (!cell) return -1;\r\n                var ut = getUETable(tableItems.table);\r\n                if (ut.selectedTds.length > 0) return -1;\r\n                return cell && cell.rowSpan > 1 ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell);\r\n                ut.splitToRows(cell);\r\n                rng.moveToBookmark(bk).select();\r\n            }\r\n        };\r\n        UE.commands[\"splittocols\"] = {\r\n            queryCommandState: function () {\r\n                var tableItems = getTableItemsByRange(this),\r\n                    cell = tableItems.cell;\r\n                if (!cell) return -1;\r\n                var ut = getUETable(tableItems.table);\r\n                if (ut.selectedTds.length > 0) return -1;\r\n                return cell && cell.colSpan > 1 ? 0 : -1;\r\n            },\r\n            execCommand: function () {\r\n                var rng = this.selection.getRange(),\r\n                    bk = rng.createBookmark(true);\r\n                var cell = getTableItemsByRange(this).cell,\r\n                    ut = getUETable(cell);\r\n                ut.splitToCols(cell);\r\n                rng.moveToBookmark(bk).select();\r\n\r\n            }\r\n        };\r\n\r\n        UE.commands[\"adaptbytext\"] =\r\n            UE.commands[\"adaptbywindow\"] = {\r\n                queryCommandState: function () {\r\n                    return getTableItemsByRange(this).table ? 0 : -1\r\n                },\r\n                execCommand: function (cmd) {\r\n                    var tableItems = getTableItemsByRange(this),\r\n                        table = tableItems.table;\r\n                    if (table) {\r\n                        if (cmd == 'adaptbywindow') {\r\n                            resetTdWidth(table, this);\r\n                        } else {\r\n                            var cells = domUtils.getElementsByTagName(table, \"td th\");\r\n                            utils.each(cells, function (cell) {\r\n                                cell.removeAttribute(\"width\");\r\n                            });\r\n                            table.removeAttribute(\"width\");\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n        //平均分配各列\r\n        UE.commands['averagedistributecol'] = {\r\n            queryCommandState: function () {\r\n                var ut = getUETableBySelected(this);\r\n                if (!ut) return -1;\r\n                return ut.isFullRow() || ut.isFullCol() ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var me = this,\r\n                    ut = getUETableBySelected(me);\r\n\r\n                function getAverageWidth() {\r\n                    var tb = ut.table,\r\n                        averageWidth, sumWidth = 0, colsNum = 0,\r\n                        tbAttr = getDefaultValue(me, tb);\r\n\r\n                    if (ut.isFullRow()) {\r\n                        sumWidth = tb.offsetWidth;\r\n                        colsNum = ut.colsNum;\r\n                    } else {\r\n                        var begin = ut.cellsRange.beginColIndex,\r\n                            end = ut.cellsRange.endColIndex,\r\n                            node;\r\n                        for (var i = begin; i <= end;) {\r\n                            node = ut.selectedTds[i];\r\n                            sumWidth += node.offsetWidth;\r\n                            i += node.colSpan;\r\n                            colsNum += 1;\r\n                        }\r\n                    }\r\n                    averageWidth = Math.ceil(sumWidth / colsNum) - tbAttr.tdBorder * 2 - tbAttr.tdPadding * 2;\r\n                    return averageWidth;\r\n                }\r\n\r\n                function setAverageWidth(averageWidth) {\r\n                    utils.each(domUtils.getElementsByTagName(ut.table, \"th\"), function (node) {\r\n                        node.setAttribute(\"width\", \"\");\r\n                    });\r\n                    var cells = ut.isFullRow() ? domUtils.getElementsByTagName(ut.table, \"td\") : ut.selectedTds;\r\n\r\n                    utils.each(cells, function (node) {\r\n                        if (node.colSpan == 1) {\r\n                            node.setAttribute(\"width\", averageWidth);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (ut && ut.selectedTds.length) {\r\n                    setAverageWidth(getAverageWidth());\r\n                }\r\n            }\r\n        };\r\n        //平均分配各行\r\n        UE.commands['averagedistributerow'] = {\r\n            queryCommandState: function () {\r\n                var ut = getUETableBySelected(this);\r\n                if (!ut) return -1;\r\n                if (ut.selectedTds && /th/ig.test(ut.selectedTds[0].tagName)) return -1;\r\n                return ut.isFullRow() || ut.isFullCol() ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var me = this,\r\n                    ut = getUETableBySelected(me);\r\n\r\n                function getAverageHeight() {\r\n                    var averageHeight, rowNum, sumHeight = 0,\r\n                        tb = ut.table,\r\n                        tbAttr = getDefaultValue(me, tb),\r\n                        tdpadding = parseInt(domUtils.getComputedStyle(tb.getElementsByTagName('td')[0], \"padding-top\"));\r\n\r\n                    if (ut.isFullCol()) {\r\n                        var captionArr = domUtils.getElementsByTagName(tb, \"caption\"),\r\n                            thArr = domUtils.getElementsByTagName(tb, \"th\"),\r\n                            captionHeight, thHeight;\r\n\r\n                        if (captionArr.length > 0) {\r\n                            captionHeight = captionArr[0].offsetHeight;\r\n                        }\r\n                        if (thArr.length > 0) {\r\n                            thHeight = thArr[0].offsetHeight;\r\n                        }\r\n\r\n                        sumHeight = tb.offsetHeight - (captionHeight || 0) - (thHeight || 0);\r\n                        rowNum = thArr.length == 0 ? ut.rowsNum : (ut.rowsNum - 1);\r\n                    } else {\r\n                        var begin = ut.cellsRange.beginRowIndex,\r\n                            end = ut.cellsRange.endRowIndex,\r\n                            count = 0,\r\n                            trs = domUtils.getElementsByTagName(tb, \"tr\");\r\n                        for (var i = begin; i <= end; i++) {\r\n                            sumHeight += trs[i].offsetHeight;\r\n                            count += 1;\r\n                        }\r\n                        rowNum = count;\r\n                    }\r\n                    //ie8下是混杂模式\r\n                    if (browser.ie && browser.version < 9) {\r\n                        averageHeight = Math.ceil(sumHeight / rowNum);\r\n                    } else {\r\n                        averageHeight = Math.ceil(sumHeight / rowNum) - tbAttr.tdBorder * 2 - tdpadding * 2;\r\n                    }\r\n                    return averageHeight;\r\n                }\r\n\r\n                function setAverageHeight(averageHeight) {\r\n                    var cells = ut.isFullCol() ? domUtils.getElementsByTagName(ut.table, \"td\") : ut.selectedTds;\r\n                    utils.each(cells, function (node) {\r\n                        if (node.rowSpan == 1) {\r\n                            node.setAttribute(\"height\", averageHeight);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (ut && ut.selectedTds.length) {\r\n                    setAverageHeight(getAverageHeight());\r\n                }\r\n            }\r\n        };\r\n\r\n        //单元格对齐方式\r\n        UE.commands['cellalignment'] = {\r\n            queryCommandState: function () {\r\n                return getTableItemsByRange(this).table ? 0 : -1\r\n            },\r\n            execCommand: function (cmd, data) {\r\n                var me = this,\r\n                    ut = getUETableBySelected(me);\r\n\r\n                if (!ut) {\r\n                    var start = me.selection.getStart(),\r\n                        cell = start && domUtils.findParentByTagName(start, [\"td\", \"th\", \"caption\"], true);\r\n                    if (!/caption/ig.test(cell.tagName)) {\r\n                        domUtils.setAttributes(cell, data);\r\n                    } else {\r\n                        cell.style.textAlign = data.align;\r\n                        cell.style.verticalAlign = data.vAlign;\r\n                    }\r\n                    me.selection.getRange().setCursor(true);\r\n                } else {\r\n                    utils.each(ut.selectedTds, function (cell) {\r\n                        domUtils.setAttributes(cell, data);\r\n                    });\r\n                }\r\n            },\r\n            /**\r\n             * 查询当前点击的单元格的对齐状态， 如果当前已经选择了多个单元格， 则会返回所有单元格经过统一协调过后的状态\r\n             * @see UE.UETable.getTableCellAlignState\r\n             */\r\n            queryCommandValue: function (cmd) {\r\n\r\n                var activeMenuCell = getTableItemsByRange(this).cell;\r\n\r\n                if (!activeMenuCell) {\r\n                    activeMenuCell = getSelectedArr(this)[0];\r\n                }\r\n\r\n                if (!activeMenuCell) {\r\n\r\n                    return null;\r\n\r\n                } else {\r\n\r\n                    //获取同时选中的其他单元格\r\n                    var cells = UE.UETable.getUETable(activeMenuCell).selectedTds;\r\n\r\n                    !cells.length && (cells = activeMenuCell);\r\n\r\n                    return UE.UETable.getTableCellAlignState(cells);\r\n\r\n                }\r\n\r\n            }\r\n        };\r\n        //表格对齐方式\r\n        UE.commands['tablealignment'] = {\r\n            queryCommandState: function () {\r\n                if (browser.ie && browser.version < 8) {\r\n                    return -1;\r\n                }\r\n                return getTableItemsByRange(this).table ? 0 : -1\r\n            },\r\n            execCommand: function (cmd, value) {\r\n                var me = this,\r\n                    start = me.selection.getStart(),\r\n                    table = start && domUtils.findParentByTagName(start, [\"table\"], true);\r\n\r\n                if (table) {\r\n                    table.setAttribute(\"align\", value);\r\n                }\r\n            }\r\n        };\r\n\r\n        //表格属性\r\n        UE.commands['edittable'] = {\r\n            queryCommandState: function () {\r\n                return getTableItemsByRange(this).table ? 0 : -1\r\n            },\r\n            execCommand: function (cmd, color) {\r\n                var rng = this.selection.getRange(),\r\n                    table = domUtils.findParentByTagName(rng.startContainer, 'table');\r\n                if (table) {\r\n                    var arr = domUtils.getElementsByTagName(table, \"td\").concat(\r\n                        domUtils.getElementsByTagName(table, \"th\"),\r\n                        domUtils.getElementsByTagName(table, \"caption\")\r\n                    );\r\n                    utils.each(arr, function (node) {\r\n                        node.style.borderColor = color;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        //单元格属性\r\n        UE.commands['edittd'] = {\r\n            queryCommandState: function () {\r\n                return getTableItemsByRange(this).table ? 0 : -1\r\n            },\r\n            execCommand: function (cmd, bkColor) {\r\n                var me = this,\r\n                    ut = getUETableBySelected(me);\r\n\r\n                if (!ut) {\r\n                    var start = me.selection.getStart(),\r\n                        cell = start && domUtils.findParentByTagName(start, [\"td\", \"th\", \"caption\"], true);\r\n                    if (cell) {\r\n                        cell.style.backgroundColor = bkColor;\r\n                    }\r\n                } else {\r\n                    utils.each(ut.selectedTds, function (cell) {\r\n                        cell.style.backgroundColor = bkColor;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        UE.commands[\"settablebackground\"] = {\r\n            queryCommandState: function () {\r\n                return getSelectedArr(this).length > 1 ? 0 : -1;\r\n            },\r\n            execCommand: function (cmd, value) {\r\n                var cells, ut;\r\n                cells = getSelectedArr(this);\r\n                ut = getUETable(cells[0]);\r\n                ut.setBackground(cells, value);\r\n            }\r\n        };\r\n\r\n        UE.commands[\"cleartablebackground\"] = {\r\n            queryCommandState: function () {\r\n                var cells = getSelectedArr(this);\r\n                if (!cells.length) return -1;\r\n                for (var i = 0, cell; cell = cells[i++];) {\r\n                    if (cell.style.backgroundColor !== \"\") return 0;\r\n                }\r\n                return -1;\r\n            },\r\n            execCommand: function () {\r\n                var cells = getSelectedArr(this),\r\n                    ut = getUETable(cells[0]);\r\n                ut.removeBackground(cells);\r\n            }\r\n        };\r\n\r\n        UE.commands[\"interlacetable\"] = UE.commands[\"uninterlacetable\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (!table) return -1;\r\n                var interlaced = table.getAttribute(\"interlaced\");\r\n                if (cmd == \"interlacetable\") {\r\n                    //TODO 待定\r\n                    //是否需要待定，如果设置，则命令只能单次执行成功，但反射具备toggle效果；否则可以覆盖前次命令，但反射将不存在toggle效果\r\n                    return (interlaced === \"enabled\") ? -1 : 0;\r\n                } else {\r\n                    return (!interlaced || interlaced === \"disabled\") ? -1 : 0;\r\n                }\r\n            },\r\n            execCommand: function (cmd, classList) {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (cmd == \"interlacetable\") {\r\n                    table.setAttribute(\"interlaced\", \"enabled\");\r\n                    this.fireEvent(\"interlacetable\", table, classList);\r\n                } else {\r\n                    table.setAttribute(\"interlaced\", \"disabled\");\r\n                    this.fireEvent(\"uninterlacetable\", table);\r\n                }\r\n            }\r\n        };\r\n        UE.commands[\"setbordervisible\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (!table) return -1;\r\n                return 0;\r\n            },\r\n            execCommand: function () {\r\n                var table = getTableItemsByRange(this).table;\r\n                utils.each(domUtils.getElementsByTagName(table, 'td'), function (td) {\r\n                    td.style.borderWidth = '1px';\r\n                    td.style.borderStyle = 'solid';\r\n                })\r\n            }\r\n        };\r\n        function resetTdWidth(table, editor) {\r\n            var tds = domUtils.getElementsByTagName(table, 'td th');\r\n            utils.each(tds, function (td) {\r\n                td.removeAttribute(\"width\");\r\n            });\r\n            table.setAttribute('width', getTableWidth(editor, true, getDefaultValue(editor, table)));\r\n            var tdsWidths = [];\r\n            setTimeout(function () {\r\n                utils.each(tds, function (td) {\r\n                    (td.colSpan == 1) && tdsWidths.push(td.offsetWidth)\r\n                })\r\n                utils.each(tds, function (td, i) {\r\n                    (td.colSpan == 1) && td.setAttribute(\"width\", tdsWidths[i] + \"\");\r\n                })\r\n            }, 0);\r\n        }\r\n\r\n        function getTableWidth(editor, needIEHack, defaultValue) {\r\n            var body = editor.body;\r\n            return body.offsetWidth - (needIEHack ? parseInt(domUtils.getComputedStyle(body, 'margin-left'), 10) * 2 : 0) - defaultValue.tableBorder * 2 - (editor.options.offsetWidth || 0);\r\n        }\r\n\r\n        function getSelectedArr(editor) {\r\n            var cell = getTableItemsByRange(editor).cell;\r\n            if (cell) {\r\n                var ut = getUETable(cell);\r\n                return ut.selectedTds.length ? ut.selectedTds : [cell];\r\n            } else {\r\n                return [];\r\n            }\r\n        }\r\n    })();\r\n\r\n\r\n    // plugins/table.action.js\r\n    /**\r\n     * Created with JetBrains PhpStorm.\r\n     * User: taoqili\r\n     * Date: 12-10-12\r\n     * Time: 上午10:05\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n    UE.plugins['table'] = function () {\r\n        var me = this,\r\n            tabTimer = null,\r\n            //拖动计时器\r\n            tableDragTimer = null,\r\n            //双击计时器\r\n            tableResizeTimer = null,\r\n            //单元格最小宽度\r\n            cellMinWidth = 5,\r\n            isInResizeBuffer = false,\r\n            //单元格边框大小\r\n            cellBorderWidth = 5,\r\n            //鼠标偏移距离\r\n            offsetOfTableCell = 10,\r\n            //记录在有限时间内的点击状态， 共有3个取值， 0, 1, 2。 0代表未初始化， 1代表单击了1次，2代表2次\r\n            singleClickState = 0,\r\n            userActionStatus = null,\r\n            //双击允许的时间范围\r\n            dblclickTime = 360,\r\n            UT = UE.UETable,\r\n            getUETable = function (tdOrTable) {\r\n                return UT.getUETable(tdOrTable);\r\n            },\r\n            getUETableBySelected = function (editor) {\r\n                return UT.getUETableBySelected(editor);\r\n            },\r\n            getDefaultValue = function (editor, table) {\r\n                return UT.getDefaultValue(editor, table);\r\n            },\r\n            removeSelectedClass = function (cells) {\r\n                return UT.removeSelectedClass(cells);\r\n            };\r\n\r\n        function showError(e) {\r\n            //        throw e;\r\n        }\r\n        me.ready(function () {\r\n            var me = this;\r\n            var orgGetText = me.selection.getText;\r\n            me.selection.getText = function () {\r\n                var table = getUETableBySelected(me);\r\n                if (table) {\r\n                    var str = '';\r\n                    utils.each(table.selectedTds, function (td) {\r\n                        str += td[browser.ie ? 'innerText' : 'textContent'];\r\n                    })\r\n                    return str;\r\n                } else {\r\n                    return orgGetText.call(me.selection)\r\n                }\r\n\r\n            }\r\n        })\r\n\r\n        //处理拖动及框选相关方法\r\n        var startTd = null, //鼠标按下时的锚点td\r\n            currentTd = null, //当前鼠标经过时的td\r\n            onDrag = \"\", //指示当前拖动状态，其值可为\"\",\"h\",\"v\" ,分别表示未拖动状态，横向拖动状态，纵向拖动状态，用于鼠标移动过程中的判断\r\n            onBorder = false, //检测鼠标按下时是否处在单元格边缘位置\r\n            dragButton = null,\r\n            dragOver = false,\r\n            dragLine = null, //模拟的拖动线\r\n            dragTd = null;    //发生拖动的目标td\r\n\r\n        var mousedown = false,\r\n            //todo 判断混乱模式\r\n            needIEHack = true;\r\n\r\n        me.setOpt({\r\n            'maxColNum': 20,\r\n            'maxRowNum': 100,\r\n            'defaultCols': 5,\r\n            'defaultRows': 5,\r\n            'tdvalign': 'top',\r\n            'cursorpath': me.options.UEDITOR_HOME_URL + \"themes/default/images/cursor_\",\r\n            'tableDragable': false,\r\n            'classList': [\"ue-table-interlace-color-single\", \"ue-table-interlace-color-double\"]\r\n        });\r\n        me.getUETable = getUETable;\r\n        var commands = {\r\n            'deletetable': 1,\r\n            'inserttable': 1,\r\n            'cellvalign': 1,\r\n            'insertcaption': 1,\r\n            'deletecaption': 1,\r\n            'inserttitle': 1,\r\n            'deletetitle': 1,\r\n            \"mergeright\": 1,\r\n            \"mergedown\": 1,\r\n            \"mergecells\": 1,\r\n            \"insertrow\": 1,\r\n            \"insertrownext\": 1,\r\n            \"deleterow\": 1,\r\n            \"insertcol\": 1,\r\n            \"insertcolnext\": 1,\r\n            \"deletecol\": 1,\r\n            \"splittocells\": 1,\r\n            \"splittorows\": 1,\r\n            \"splittocols\": 1,\r\n            \"adaptbytext\": 1,\r\n            \"adaptbywindow\": 1,\r\n            \"adaptbycustomer\": 1,\r\n            \"insertparagraph\": 1,\r\n            \"insertparagraphbeforetable\": 1,\r\n            \"averagedistributecol\": 1,\r\n            \"averagedistributerow\": 1\r\n        };\r\n        me.ready(function () {\r\n            utils.cssRule('table',\r\n                //选中的td上的样式\r\n                '.selectTdClass{background-color:#edf5fa !important}' +\r\n                'table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}' +\r\n                //插入的表格的默认样式\r\n                'table{margin-bottom:10px;border-collapse:collapse;display:table;}' +\r\n                'td,th{padding: 5px 10px;border: 1px solid #DDD;}' +\r\n                'caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}' +\r\n                'th{border-top:1px solid #BBB;background-color:#F7F7F7;}' +\r\n                'table tr.firstRow th{border-top-width:2px;}' +\r\n                '.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }' +\r\n                'td p{margin:0;padding:0;}', me.document);\r\n\r\n            var tableCopyList, isFullCol, isFullRow;\r\n            //注册del/backspace事件\r\n            me.addListener('keydown', function (cmd, evt) {\r\n                var me = this;\r\n                var keyCode = evt.keyCode || evt.which;\r\n\r\n                if (keyCode == 8) {\r\n\r\n                    var ut = getUETableBySelected(me);\r\n                    if (ut && ut.selectedTds.length) {\r\n\r\n                        if (ut.isFullCol()) {\r\n                            me.execCommand('deletecol')\r\n                        } else if (ut.isFullRow()) {\r\n                            me.execCommand('deleterow')\r\n                        } else {\r\n                            me.fireEvent('delcells');\r\n                        }\r\n                        domUtils.preventDefault(evt);\r\n                    }\r\n\r\n                    var caption = domUtils.findParentByTagName(me.selection.getStart(), 'caption', true),\r\n                        range = me.selection.getRange();\r\n                    if (range.collapsed && caption && isEmptyBlock(caption)) {\r\n                        me.fireEvent('saveScene');\r\n                        var table = caption.parentNode;\r\n                        domUtils.remove(caption);\r\n                        if (table) {\r\n                            range.setStart(table.rows[0].cells[0], 0).setCursor(false, true);\r\n                        }\r\n                        me.fireEvent('saveScene');\r\n                    }\r\n\r\n                }\r\n\r\n                if (keyCode == 46) {\r\n\r\n                    ut = getUETableBySelected(me);\r\n                    if (ut) {\r\n                        me.fireEvent('saveScene');\r\n                        for (var i = 0, ci; ci = ut.selectedTds[i++];) {\r\n                            domUtils.fillNode(me.document, ci)\r\n                        }\r\n                        me.fireEvent('saveScene');\r\n                        domUtils.preventDefault(evt);\r\n\r\n                    }\r\n\r\n                }\r\n                if (keyCode == 13) {\r\n\r\n                    var rng = me.selection.getRange(),\r\n                        caption = domUtils.findParentByTagName(rng.startContainer, 'caption', true);\r\n                    if (caption) {\r\n                        var table = domUtils.findParentByTagName(caption, 'table');\r\n                        if (!rng.collapsed) {\r\n\r\n                            rng.deleteContents();\r\n                            me.fireEvent('saveScene');\r\n                        } else {\r\n                            if (caption) {\r\n                                rng.setStart(table.rows[0].cells[0], 0).setCursor(false, true);\r\n                            }\r\n                        }\r\n                        domUtils.preventDefault(evt);\r\n                        return;\r\n                    }\r\n                    if (rng.collapsed) {\r\n                        var table = domUtils.findParentByTagName(rng.startContainer, 'table');\r\n                        if (table) {\r\n                            var cell = table.rows[0].cells[0],\r\n                                start = domUtils.findParentByTagName(me.selection.getStart(), ['td', 'th'], true),\r\n                                preNode = table.previousSibling;\r\n                            if (cell === start && (!preNode || preNode.nodeType == 1 && preNode.tagName == 'TABLE') && domUtils.isStartInblock(rng)) {\r\n                                var first = domUtils.findParent(me.selection.getStart(), function (n) { return domUtils.isBlockElm(n) }, true);\r\n                                if (first && (/t(h|d)/i.test(first.tagName) || first === start.firstChild)) {\r\n                                    me.execCommand('insertparagraphbeforetable');\r\n                                    domUtils.preventDefault(evt);\r\n                                }\r\n\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if ((evt.ctrlKey || evt.metaKey) && evt.keyCode == '67') {\r\n                    tableCopyList = null;\r\n                    var ut = getUETableBySelected(me);\r\n                    if (ut) {\r\n                        var tds = ut.selectedTds;\r\n                        isFullCol = ut.isFullCol();\r\n                        isFullRow = ut.isFullRow();\r\n                        tableCopyList = [\r\n                            [ut.cloneCell(tds[0], null, true)]\r\n                        ];\r\n                        for (var i = 1, ci; ci = tds[i]; i++) {\r\n                            if (ci.parentNode !== tds[i - 1].parentNode) {\r\n                                tableCopyList.push([ut.cloneCell(ci, null, true)]);\r\n                            } else {\r\n                                tableCopyList[tableCopyList.length - 1].push(ut.cloneCell(ci, null, true));\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            me.addListener(\"tablehasdeleted\", function () {\r\n                toggleDraggableState(this, false, \"\", null);\r\n                if (dragButton) domUtils.remove(dragButton);\r\n            });\r\n\r\n            me.addListener('beforepaste', function (cmd, html) {\r\n                var me = this;\r\n                var rng = me.selection.getRange();\r\n                if (domUtils.findParentByTagName(rng.startContainer, 'caption', true)) {\r\n                    var div = me.document.createElement(\"div\");\r\n                    div.innerHTML = html.html;\r\n                    //trace:3729\r\n                    html.html = div[browser.ie9below ? 'innerText' : 'textContent'];\r\n                    return;\r\n                }\r\n                var table = getUETableBySelected(me);\r\n                if (tableCopyList) {\r\n                    me.fireEvent('saveScene');\r\n                    var rng = me.selection.getRange();\r\n                    var td = domUtils.findParentByTagName(rng.startContainer, ['td', 'th'], true), tmpNode, preNode;\r\n                    if (td) {\r\n                        var ut = getUETable(td);\r\n                        if (isFullRow) {\r\n                            var rowIndex = ut.getCellInfo(td).rowIndex;\r\n                            if (td.tagName == 'TH') {\r\n                                rowIndex++;\r\n                            }\r\n                            for (var i = 0, ci; ci = tableCopyList[i++];) {\r\n                                var tr = ut.insertRow(rowIndex++, \"td\");\r\n                                for (var j = 0, cj; cj = ci[j]; j++) {\r\n                                    var cell = tr.cells[j];\r\n                                    if (!cell) {\r\n                                        cell = tr.insertCell(j)\r\n                                    }\r\n                                    cell.innerHTML = cj.innerHTML;\r\n                                    cj.getAttribute('width') && cell.setAttribute('width', cj.getAttribute('width'));\r\n                                    cj.getAttribute('vAlign') && cell.setAttribute('vAlign', cj.getAttribute('vAlign'));\r\n                                    cj.getAttribute('align') && cell.setAttribute('align', cj.getAttribute('align'));\r\n                                    cj.style.cssText && (cell.style.cssText = cj.style.cssText)\r\n                                }\r\n                                for (var j = 0, cj; cj = tr.cells[j]; j++) {\r\n                                    if (!ci[j])\r\n                                        break;\r\n                                    cj.innerHTML = ci[j].innerHTML;\r\n                                    ci[j].getAttribute('width') && cj.setAttribute('width', ci[j].getAttribute('width'));\r\n                                    ci[j].getAttribute('vAlign') && cj.setAttribute('vAlign', ci[j].getAttribute('vAlign'));\r\n                                    ci[j].getAttribute('align') && cj.setAttribute('align', ci[j].getAttribute('align'));\r\n                                    ci[j].style.cssText && (cj.style.cssText = ci[j].style.cssText)\r\n                                }\r\n                            }\r\n                        } else {\r\n                            if (isFullCol) {\r\n                                cellInfo = ut.getCellInfo(td);\r\n                                var maxColNum = 0;\r\n                                for (var j = 0, ci = tableCopyList[0], cj; cj = ci[j++];) {\r\n                                    maxColNum += cj.colSpan || 1;\r\n                                }\r\n                                me.__hasEnterExecCommand = true;\r\n                                for (i = 0; i < maxColNum; i++) {\r\n                                    me.execCommand('insertcol');\r\n                                }\r\n                                me.__hasEnterExecCommand = false;\r\n                                td = ut.table.rows[0].cells[cellInfo.cellIndex];\r\n                                if (td.tagName == 'TH') {\r\n                                    td = ut.table.rows[1].cells[cellInfo.cellIndex];\r\n                                }\r\n                            }\r\n                            for (var i = 0, ci; ci = tableCopyList[i++];) {\r\n                                tmpNode = td;\r\n                                for (var j = 0, cj; cj = ci[j++];) {\r\n                                    if (td) {\r\n                                        td.innerHTML = cj.innerHTML;\r\n                                        //todo 定制处理\r\n                                        cj.getAttribute('width') && td.setAttribute('width', cj.getAttribute('width'));\r\n                                        cj.getAttribute('vAlign') && td.setAttribute('vAlign', cj.getAttribute('vAlign'));\r\n                                        cj.getAttribute('align') && td.setAttribute('align', cj.getAttribute('align'));\r\n                                        cj.style.cssText && (td.style.cssText = cj.style.cssText);\r\n                                        preNode = td;\r\n                                        td = td.nextSibling;\r\n                                    } else {\r\n                                        var cloneTd = cj.cloneNode(true);\r\n                                        domUtils.removeAttributes(cloneTd, ['class', 'rowSpan', 'colSpan']);\r\n\r\n                                        preNode.parentNode.appendChild(cloneTd)\r\n                                    }\r\n                                }\r\n                                td = ut.getNextCell(tmpNode, true, true);\r\n                                if (!tableCopyList[i])\r\n                                    break;\r\n                                if (!td) {\r\n                                    var cellInfo = ut.getCellInfo(tmpNode);\r\n                                    ut.table.insertRow(ut.table.rows.length);\r\n                                    ut.update();\r\n                                    td = ut.getVSideCell(tmpNode, true);\r\n                                }\r\n                            }\r\n                        }\r\n                        ut.update();\r\n                    } else {\r\n                        table = me.document.createElement('table');\r\n                        for (var i = 0, ci; ci = tableCopyList[i++];) {\r\n                            var tr = table.insertRow(table.rows.length);\r\n                            for (var j = 0, cj; cj = ci[j++];) {\r\n                                cloneTd = UT.cloneCell(cj, null, true);\r\n                                domUtils.removeAttributes(cloneTd, ['class']);\r\n                                tr.appendChild(cloneTd)\r\n                            }\r\n                            if (j == 2 && cloneTd.rowSpan > 1) {\r\n                                cloneTd.rowSpan = 1;\r\n                            }\r\n                        }\r\n\r\n                        var defaultValue = getDefaultValue(me),\r\n                            width = me.body.offsetWidth -\r\n                                (needIEHack ? parseInt(domUtils.getComputedStyle(me.body, 'margin-left'), 10) * 2 : 0) - defaultValue.tableBorder * 2 - (me.options.offsetWidth || 0);\r\n                        me.execCommand('insertHTML', '<table  ' +\r\n                            (isFullCol && isFullRow ? 'width=\"' + width + '\"' : '') +\r\n                            '>' + table.innerHTML.replace(/>\\s*</g, '><').replace(/\\bth\\b/gi, \"td\") + '</table>')\r\n                    }\r\n                    me.fireEvent('contentchange');\r\n                    me.fireEvent('saveScene');\r\n                    html.html = '';\r\n                    return true;\r\n                } else {\r\n                    var div = me.document.createElement(\"div\"), tables;\r\n                    div.innerHTML = html.html;\r\n                    tables = div.getElementsByTagName(\"table\");\r\n                    if (domUtils.findParentByTagName(me.selection.getStart(), 'table')) {\r\n                        utils.each(tables, function (t) {\r\n                            domUtils.remove(t)\r\n                        });\r\n                        if (domUtils.findParentByTagName(me.selection.getStart(), 'caption', true)) {\r\n                            div.innerHTML = div[browser.ie ? 'innerText' : 'textContent'];\r\n                        }\r\n                    } else {\r\n                        utils.each(tables, function (table) {\r\n                            removeStyleSize(table, true);\r\n                            domUtils.removeAttributes(table, ['style', 'border']);\r\n                            utils.each(domUtils.getElementsByTagName(table, \"td\"), function (td) {\r\n                                if (isEmptyBlock(td)) {\r\n                                    domUtils.fillNode(me.document, td);\r\n                                }\r\n                                removeStyleSize(td, true);\r\n                                //                            domUtils.removeAttributes(td, ['style'])\r\n                            });\r\n                        });\r\n                    }\r\n                    html.html = div.innerHTML;\r\n                }\r\n            });\r\n\r\n            me.addListener('afterpaste', function () {\r\n                utils.each(domUtils.getElementsByTagName(me.body, \"table\"), function (table) {\r\n                    if (table.offsetWidth > me.body.offsetWidth) {\r\n                        var defaultValue = getDefaultValue(me, table);\r\n                        table.style.width = me.body.offsetWidth - (needIEHack ? parseInt(domUtils.getComputedStyle(me.body, 'margin-left'), 10) * 2 : 0) - defaultValue.tableBorder * 2 - (me.options.offsetWidth || 0) + 'px'\r\n                    }\r\n                })\r\n            });\r\n            me.addListener('blur', function () {\r\n                tableCopyList = null;\r\n            });\r\n            var timer;\r\n            me.addListener('keydown', function () {\r\n                clearTimeout(timer);\r\n                timer = setTimeout(function () {\r\n                    var rng = me.selection.getRange(),\r\n                        cell = domUtils.findParentByTagName(rng.startContainer, ['th', 'td'], true);\r\n                    if (cell) {\r\n                        var table = cell.parentNode.parentNode.parentNode;\r\n                        if (table.offsetWidth > table.getAttribute(\"width\")) {\r\n                            cell.style.wordBreak = \"break-all\";\r\n                        }\r\n                    }\r\n\r\n                }, 100);\r\n            });\r\n            me.addListener(\"selectionchange\", function () {\r\n                toggleDraggableState(me, false, \"\", null);\r\n            });\r\n\r\n\r\n            //内容变化时触发索引更新\r\n            //todo 可否考虑标记检测，如果不涉及表格的变化就不进行索引重建和更新\r\n            me.addListener(\"contentchange\", function () {\r\n                var me = this;\r\n                //尽可能排除一些不需要更新的状况\r\n                hideDragLine(me);\r\n                if (getUETableBySelected(me)) return;\r\n                var rng = me.selection.getRange();\r\n                var start = rng.startContainer;\r\n                start = domUtils.findParentByTagName(start, ['td', 'th'], true);\r\n                utils.each(domUtils.getElementsByTagName(me.document, 'table'), function (table) {\r\n                    if (me.fireEvent(\"excludetable\", table) === true) return;\r\n                    table.ueTable = new UT(table);\r\n                    //trace:3742\r\n                    //                utils.each(domUtils.getElementsByTagName(me.document, 'td'), function (td) {\r\n                    //\r\n                    //                    if (domUtils.isEmptyBlock(td) && td !== start) {\r\n                    //                        domUtils.fillNode(me.document, td);\r\n                    //                        if (browser.ie && browser.version == 6) {\r\n                    //                            td.innerHTML = '&nbsp;'\r\n                    //                        }\r\n                    //                    }\r\n                    //                });\r\n                    //                utils.each(domUtils.getElementsByTagName(me.document, 'th'), function (th) {\r\n                    //                    if (domUtils.isEmptyBlock(th) && th !== start) {\r\n                    //                        domUtils.fillNode(me.document, th);\r\n                    //                        if (browser.ie && browser.version == 6) {\r\n                    //                            th.innerHTML = '&nbsp;'\r\n                    //                        }\r\n                    //                    }\r\n                    //                });\r\n                    table.onmouseover = function () {\r\n                        me.fireEvent('tablemouseover', table);\r\n                    };\r\n                    table.onmousemove = function () {\r\n                        me.fireEvent('tablemousemove', table);\r\n                        me.options.tableDragable && toggleDragButton(true, this, me);\r\n                        utils.defer(function () {\r\n                            me.fireEvent('contentchange', 50)\r\n                        }, true)\r\n                    };\r\n                    table.onmouseout = function () {\r\n                        me.fireEvent('tablemouseout', table);\r\n                        toggleDraggableState(me, false, \"\", null);\r\n                        hideDragLine(me);\r\n                    };\r\n                    table.onclick = function (evt) {\r\n                        evt = me.window.event || evt;\r\n                        var target = getParentTdOrTh(evt.target || evt.srcElement);\r\n                        if (!target) return;\r\n                        var ut = getUETable(target),\r\n                            table = ut.table,\r\n                            cellInfo = ut.getCellInfo(target),\r\n                            cellsRange,\r\n                            rng = me.selection.getRange();\r\n                        //                    if (\"topLeft\" == inPosition(table, mouseCoords(evt))) {\r\n                        //                        cellsRange = ut.getCellsRange(ut.table.rows[0].cells[0], ut.getLastCell());\r\n                        //                        ut.setSelected(cellsRange);\r\n                        //                        return;\r\n                        //                    }\r\n                        //                    if (\"bottomRight\" == inPosition(table, mouseCoords(evt))) {\r\n                        //\r\n                        //                        return;\r\n                        //                    }\r\n                        if (inTableSide(table, target, evt, true)) {\r\n                            var endTdCol = ut.getCell(ut.indexTable[ut.rowsNum - 1][cellInfo.colIndex].rowIndex, ut.indexTable[ut.rowsNum - 1][cellInfo.colIndex].cellIndex);\r\n                            if (evt.shiftKey && ut.selectedTds.length) {\r\n                                if (ut.selectedTds[0] !== endTdCol) {\r\n                                    cellsRange = ut.getCellsRange(ut.selectedTds[0], endTdCol);\r\n                                    ut.setSelected(cellsRange);\r\n                                } else {\r\n                                    rng && rng.selectNodeContents(endTdCol).select();\r\n                                }\r\n                            } else {\r\n                                if (target !== endTdCol) {\r\n                                    cellsRange = ut.getCellsRange(target, endTdCol);\r\n                                    ut.setSelected(cellsRange);\r\n                                } else {\r\n                                    rng && rng.selectNodeContents(endTdCol).select();\r\n                                }\r\n                            }\r\n                            return;\r\n                        }\r\n                        if (inTableSide(table, target, evt)) {\r\n                            var endTdRow = ut.getCell(ut.indexTable[cellInfo.rowIndex][ut.colsNum - 1].rowIndex, ut.indexTable[cellInfo.rowIndex][ut.colsNum - 1].cellIndex);\r\n                            if (evt.shiftKey && ut.selectedTds.length) {\r\n                                if (ut.selectedTds[0] !== endTdRow) {\r\n                                    cellsRange = ut.getCellsRange(ut.selectedTds[0], endTdRow);\r\n                                    ut.setSelected(cellsRange);\r\n                                } else {\r\n                                    rng && rng.selectNodeContents(endTdRow).select();\r\n                                }\r\n                            } else {\r\n                                if (target !== endTdRow) {\r\n                                    cellsRange = ut.getCellsRange(target, endTdRow);\r\n                                    ut.setSelected(cellsRange);\r\n                                } else {\r\n                                    rng && rng.selectNodeContents(endTdRow).select();\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                });\r\n\r\n                switchBorderColor(me, true);\r\n            });\r\n\r\n            domUtils.on(me.document, \"mousemove\", mouseMoveEvent);\r\n\r\n            domUtils.on(me.document, \"mouseout\", function (evt) {\r\n                var target = evt.target || evt.srcElement;\r\n                if (target.tagName == \"TABLE\") {\r\n                    toggleDraggableState(me, false, \"\", null);\r\n                }\r\n            });\r\n            /**\r\n             * 表格隔行变色\r\n             */\r\n            me.addListener(\"interlacetable\", function (type, table, classList) {\r\n                if (!table) return;\r\n                var me = this,\r\n                    rows = table.rows,\r\n                    len = rows.length,\r\n                    getClass = function (list, index, repeat) {\r\n                        return list[index] ? list[index] : repeat ? list[index % list.length] : \"\";\r\n                    };\r\n                for (var i = 0; i < len; i++) {\r\n                    rows[i].className = getClass(classList || me.options.classList, i, true);\r\n                }\r\n            });\r\n            me.addListener(\"uninterlacetable\", function (type, table) {\r\n                if (!table) return;\r\n                var me = this,\r\n                    rows = table.rows,\r\n                    classList = me.options.classList,\r\n                    len = rows.length;\r\n                for (var i = 0; i < len; i++) {\r\n                    domUtils.removeClasses(rows[i], classList);\r\n                }\r\n            });\r\n\r\n            me.addListener(\"mousedown\", mouseDownEvent);\r\n            me.addListener(\"mouseup\", mouseUpEvent);\r\n            //拖动的时候触发mouseup\r\n            domUtils.on(me.body, 'dragstart', function (evt) {\r\n                mouseUpEvent.call(me, 'dragstart', evt);\r\n            });\r\n            me.addOutputRule(function (root) {\r\n                utils.each(root.getNodesByTagName('div'), function (n) {\r\n                    if (n.getAttr('id') == 'ue_tableDragLine') {\r\n                        n.parentNode.removeChild(n);\r\n                    }\r\n                });\r\n            });\r\n\r\n            var currentRowIndex = 0;\r\n            me.addListener(\"mousedown\", function () {\r\n                currentRowIndex = 0;\r\n            });\r\n            me.addListener('tabkeydown', function () {\r\n                var range = this.selection.getRange(),\r\n                    common = range.getCommonAncestor(true, true),\r\n                    table = domUtils.findParentByTagName(common, 'table');\r\n                if (table) {\r\n                    if (domUtils.findParentByTagName(common, 'caption', true)) {\r\n                        var cell = domUtils.getElementsByTagName(table, 'th td');\r\n                        if (cell && cell.length) {\r\n                            range.setStart(cell[0], 0).setCursor(false, true)\r\n                        }\r\n                    } else {\r\n                        var cell = domUtils.findParentByTagName(common, ['td', 'th'], true),\r\n                            ua = getUETable(cell);\r\n                        currentRowIndex = cell.rowSpan > 1 ? currentRowIndex : ua.getCellInfo(cell).rowIndex;\r\n                        var nextCell = ua.getTabNextCell(cell, currentRowIndex);\r\n                        if (nextCell) {\r\n                            if (isEmptyBlock(nextCell)) {\r\n                                range.setStart(nextCell, 0).setCursor(false, true)\r\n                            } else {\r\n                                range.selectNodeContents(nextCell).select()\r\n                            }\r\n                        } else {\r\n                            me.fireEvent('saveScene');\r\n                            me.__hasEnterExecCommand = true;\r\n                            this.execCommand('insertrownext');\r\n                            me.__hasEnterExecCommand = false;\r\n                            range = this.selection.getRange();\r\n                            range.setStart(table.rows[table.rows.length - 1].cells[0], 0).setCursor();\r\n                            me.fireEvent('saveScene');\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n\r\n            });\r\n            browser.ie && me.addListener('selectionchange', function () {\r\n                toggleDraggableState(this, false, \"\", null);\r\n            });\r\n            me.addListener(\"keydown\", function (type, evt) {\r\n                var me = this;\r\n                //处理在表格的最后一个输入tab产生新的表格\r\n                var keyCode = evt.keyCode || evt.which;\r\n                if (keyCode == 8 || keyCode == 46) {\r\n                    return;\r\n                }\r\n                var notCtrlKey = !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey;\r\n                notCtrlKey && removeSelectedClass(domUtils.getElementsByTagName(me.body, \"td\"));\r\n                var ut = getUETableBySelected(me);\r\n                if (!ut) return;\r\n                notCtrlKey && ut.clearSelected();\r\n            });\r\n\r\n            me.addListener(\"beforegetcontent\", function () {\r\n                switchBorderColor(this, false);\r\n                browser.ie && utils.each(this.document.getElementsByTagName('caption'), function (ci) {\r\n                    if (domUtils.isEmptyNode(ci)) {\r\n                        ci.innerHTML = '&nbsp;'\r\n                    }\r\n                });\r\n            });\r\n            me.addListener(\"aftergetcontent\", function () {\r\n                switchBorderColor(this, true);\r\n            });\r\n            me.addListener(\"getAllHtml\", function () {\r\n                removeSelectedClass(me.document.getElementsByTagName(\"td\"));\r\n            });\r\n            //修正全屏状态下插入的表格宽度在非全屏状态下撑开编辑器的情况\r\n            me.addListener(\"fullscreenchanged\", function (type, fullscreen) {\r\n                if (!fullscreen) {\r\n                    var ratio = this.body.offsetWidth / document.body.offsetWidth,\r\n                        tables = domUtils.getElementsByTagName(this.body, \"table\");\r\n                    utils.each(tables, function (table) {\r\n                        if (table.offsetWidth < me.body.offsetWidth) return false;\r\n                        var tds = domUtils.getElementsByTagName(table, \"td\"),\r\n                            backWidths = [];\r\n                        utils.each(tds, function (td) {\r\n                            backWidths.push(td.offsetWidth);\r\n                        });\r\n                        for (var i = 0, td; td = tds[i]; i++) {\r\n                            td.setAttribute(\"width\", Math.floor(backWidths[i] * ratio));\r\n                        }\r\n                        table.setAttribute(\"width\", Math.floor(getTableWidth(me, needIEHack, getDefaultValue(me))))\r\n                    });\r\n                }\r\n            });\r\n\r\n            //重写execCommand命令，用于处理框选时的处理\r\n            var oldExecCommand = me.execCommand;\r\n            me.execCommand = function (cmd, datatat) {\r\n\r\n                var me = this,\r\n                    args = arguments;\r\n\r\n                cmd = cmd.toLowerCase();\r\n                var ut = getUETableBySelected(me), tds,\r\n                    range = new dom.Range(me.document),\r\n                    cmdFun = me.commands[cmd] || UE.commands[cmd],\r\n                    result;\r\n                if (!cmdFun) return;\r\n                if (ut && !commands[cmd] && !cmdFun.notNeedUndo && !me.__hasEnterExecCommand) {\r\n                    me.__hasEnterExecCommand = true;\r\n                    me.fireEvent(\"beforeexeccommand\", cmd);\r\n                    tds = ut.selectedTds;\r\n                    var lastState = -2, lastValue = -2, value, state;\r\n                    for (var i = 0, td; td = tds[i]; i++) {\r\n                        if (isEmptyBlock(td)) {\r\n                            range.setStart(td, 0).setCursor(false, true)\r\n                        } else {\r\n                            range.selectNode(td).select(true);\r\n                        }\r\n                        state = me.queryCommandState(cmd);\r\n                        value = me.queryCommandValue(cmd);\r\n                        if (state != -1) {\r\n                            if (lastState !== state || lastValue !== value) {\r\n                                me._ignoreContentChange = true;\r\n                                result = oldExecCommand.apply(me, arguments);\r\n                                me._ignoreContentChange = false;\r\n\r\n                            }\r\n                            lastState = me.queryCommandState(cmd);\r\n                            lastValue = me.queryCommandValue(cmd);\r\n                            if (domUtils.isEmptyBlock(td)) {\r\n                                domUtils.fillNode(me.document, td)\r\n                            }\r\n                        }\r\n                    }\r\n                    range.setStart(tds[0], 0).shrinkBoundary(true).setCursor(false, true);\r\n                    me.fireEvent('contentchange');\r\n                    me.fireEvent(\"afterexeccommand\", cmd);\r\n                    me.__hasEnterExecCommand = false;\r\n                    me._selectionChange();\r\n                } else {\r\n                    result = oldExecCommand.apply(me, arguments);\r\n                }\r\n                return result;\r\n            };\r\n\r\n\r\n        });\r\n        /**\r\n         * 删除obj的宽高style，改成属性宽高\r\n         * @param obj\r\n         * @param replaceToProperty\r\n         */\r\n        function removeStyleSize(obj, replaceToProperty) {\r\n            removeStyle(obj, \"width\", true);\r\n            removeStyle(obj, \"height\", true);\r\n        }\r\n\r\n        function removeStyle(obj, styleName, replaceToProperty) {\r\n            if (obj.style[styleName]) {\r\n                replaceToProperty && obj.setAttribute(styleName, parseInt(obj.style[styleName], 10));\r\n                obj.style[styleName] = \"\";\r\n            }\r\n        }\r\n\r\n        function getParentTdOrTh(ele) {\r\n            if (ele.tagName == \"TD\" || ele.tagName == \"TH\") return ele;\r\n            var td;\r\n            if (td = domUtils.findParentByTagName(ele, \"td\", true) || domUtils.findParentByTagName(ele, \"th\", true)) return td;\r\n            return null;\r\n        }\r\n\r\n        function isEmptyBlock(node) {\r\n            var reg = new RegExp(domUtils.fillChar, 'g');\r\n            if (node[browser.ie ? 'innerText' : 'textContent'].replace(/^\\s*$/, '').replace(reg, '').length > 0) {\r\n                return 0;\r\n            }\r\n            for (var n in dtd.$isNotEmpty) {\r\n                if (node.getElementsByTagName(n).length) {\r\n                    return 0;\r\n                }\r\n            }\r\n            return 1;\r\n        }\r\n\r\n\r\n        function mouseCoords(evt) {\r\n            if (evt.pageX || evt.pageY) {\r\n                return { x: evt.pageX, y: evt.pageY };\r\n            }\r\n            return {\r\n                x: evt.clientX + me.document.body.scrollLeft - me.document.body.clientLeft,\r\n                y: evt.clientY + me.document.body.scrollTop - me.document.body.clientTop\r\n            };\r\n        }\r\n\r\n        function mouseMoveEvent(evt) {\r\n\r\n            if (isEditorDisabled()) {\r\n                return;\r\n            }\r\n\r\n            try {\r\n\r\n                //普通状态下鼠标移动\r\n                var target = getParentTdOrTh(evt.target || evt.srcElement),\r\n                    pos;\r\n\r\n                //区分用户的行为是拖动还是双击\r\n                if (isInResizeBuffer) {\r\n\r\n                    me.body.style.webkitUserSelect = 'none';\r\n\r\n                    if (Math.abs(userActionStatus.x - evt.clientX) > offsetOfTableCell || Math.abs(userActionStatus.y - evt.clientY) > offsetOfTableCell) {\r\n                        clearTableDragTimer();\r\n                        isInResizeBuffer = false;\r\n                        singleClickState = 0;\r\n                        //drag action\r\n                        tableBorderDrag(evt);\r\n                    }\r\n                }\r\n\r\n                //修改单元格大小时的鼠标移动\r\n                if (onDrag && dragTd) {\r\n                    singleClickState = 0;\r\n                    me.body.style.webkitUserSelect = 'none';\r\n                    me.selection.getNative()[browser.ie9below ? 'empty' : 'removeAllRanges']();\r\n                    pos = mouseCoords(evt);\r\n                    toggleDraggableState(me, true, onDrag, pos, target);\r\n                    if (onDrag == \"h\") {\r\n                        dragLine.style.left = getPermissionX(dragTd, evt) + \"px\";\r\n                    } else if (onDrag == \"v\") {\r\n                        dragLine.style.top = getPermissionY(dragTd, evt) + \"px\";\r\n                    }\r\n                    return;\r\n                }\r\n                //当鼠标处于table上时，修改移动过程中的光标状态\r\n                if (target) {\r\n                    //针对使用table作为容器的组件不触发拖拽效果\r\n                    if (me.fireEvent('excludetable', target) === true)\r\n                        return;\r\n                    pos = mouseCoords(evt);\r\n                    var state = getRelation(target, pos),\r\n                        table = domUtils.findParentByTagName(target, \"table\", true);\r\n\r\n                    if (inTableSide(table, target, evt, true)) {\r\n                        if (me.fireEvent(\"excludetable\", table) === true) return;\r\n                        me.body.style.cursor = \"url(\" + me.options.cursorpath + \"h.png),pointer\";\r\n                    } else if (inTableSide(table, target, evt)) {\r\n                        if (me.fireEvent(\"excludetable\", table) === true) return;\r\n                        me.body.style.cursor = \"url(\" + me.options.cursorpath + \"v.png),pointer\";\r\n                    } else {\r\n                        me.body.style.cursor = \"text\";\r\n                        var curCell = target;\r\n                        if (/\\d/.test(state)) {\r\n                            state = state.replace(/\\d/, '');\r\n                            target = getUETable(target).getPreviewCell(target, state == \"v\");\r\n                        }\r\n                        //位于第一行的顶部或者第一列的左边时不可拖动\r\n                        toggleDraggableState(me, target ? !!state : false, target ? state : '', pos, target);\r\n\r\n                    }\r\n                } else {\r\n                    toggleDragButton(false, table, me);\r\n                }\r\n\r\n            } catch (e) {\r\n                showError(e);\r\n            }\r\n        }\r\n\r\n        var dragButtonTimer;\r\n\r\n        function toggleDragButton(show, table, editor) {\r\n            if (!show) {\r\n                if (dragOver) return;\r\n                dragButtonTimer = setTimeout(function () {\r\n                    !dragOver && dragButton && dragButton.parentNode && dragButton.parentNode.removeChild(dragButton);\r\n                }, 2000);\r\n            } else {\r\n                createDragButton(table, editor);\r\n            }\r\n        }\r\n\r\n        function createDragButton(table, editor) {\r\n            var pos = domUtils.getXY(table),\r\n                doc = table.ownerDocument;\r\n            if (dragButton && dragButton.parentNode) return dragButton;\r\n            dragButton = doc.createElement(\"div\");\r\n            dragButton.contentEditable = false;\r\n            dragButton.innerHTML = \"\";\r\n            dragButton.style.cssText = \"width:15px;height:15px;background-image:url(\" + editor.options.UEDITOR_HOME_URL + \"dialogs/table/dragicon.png);position: absolute;cursor:move;top:\" + (pos.y - 15) + \"px;left:\" + (pos.x) + \"px;\";\r\n            domUtils.unSelectable(dragButton);\r\n            dragButton.onmouseover = function (evt) {\r\n                dragOver = true;\r\n            };\r\n            dragButton.onmouseout = function (evt) {\r\n                dragOver = false;\r\n            };\r\n            domUtils.on(dragButton, 'click', function (type, evt) {\r\n                doClick(evt, this);\r\n            });\r\n            domUtils.on(dragButton, 'dblclick', function (type, evt) {\r\n                doDblClick(evt);\r\n            });\r\n            domUtils.on(dragButton, 'dragstart', function (type, evt) {\r\n                domUtils.preventDefault(evt);\r\n            });\r\n            var timer;\r\n\r\n            function doClick(evt, button) {\r\n                // 部分浏览器下需要清理\r\n                clearTimeout(timer);\r\n                timer = setTimeout(function () {\r\n                    editor.fireEvent(\"tableClicked\", table, button);\r\n                }, 300);\r\n            }\r\n\r\n            function doDblClick(evt) {\r\n                clearTimeout(timer);\r\n                var ut = getUETable(table),\r\n                    start = table.rows[0].cells[0],\r\n                    end = ut.getLastCell(),\r\n                    range = ut.getCellsRange(start, end);\r\n                editor.selection.getRange().setStart(start, 0).setCursor(false, true);\r\n                ut.setSelected(range);\r\n            }\r\n\r\n            doc.body.appendChild(dragButton);\r\n        }\r\n\r\n\r\n        //    function inPosition(table, pos) {\r\n        //        var tablePos = domUtils.getXY(table),\r\n        //            width = table.offsetWidth,\r\n        //            height = table.offsetHeight;\r\n        //        if (pos.x - tablePos.x < 5 && pos.y - tablePos.y < 5) {\r\n        //            return \"topLeft\";\r\n        //        } else if (tablePos.x + width - pos.x < 5 && tablePos.y + height - pos.y < 5) {\r\n        //            return \"bottomRight\";\r\n        //        }\r\n        //    }\r\n\r\n        function inTableSide(table, cell, evt, top) {\r\n            var pos = mouseCoords(evt),\r\n                state = getRelation(cell, pos);\r\n\r\n            if (top) {\r\n                var caption = table.getElementsByTagName(\"caption\")[0],\r\n                    capHeight = caption ? caption.offsetHeight : 0;\r\n                return (state == \"v1\") && ((pos.y - domUtils.getXY(table).y - capHeight) < 8);\r\n            } else {\r\n                return (state == \"h1\") && ((pos.x - domUtils.getXY(table).x) < 8);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 获取拖动时允许的X轴坐标\r\n         * @param dragTd\r\n         * @param evt\r\n         */\r\n        function getPermissionX(dragTd, evt) {\r\n            var ut = getUETable(dragTd);\r\n            if (ut) {\r\n                var preTd = ut.getSameEndPosCells(dragTd, \"x\")[0],\r\n                    nextTd = ut.getSameStartPosXCells(dragTd)[0],\r\n                    mouseX = mouseCoords(evt).x,\r\n                    left = (preTd ? domUtils.getXY(preTd).x : domUtils.getXY(ut.table).x) + 20,\r\n                    right = nextTd ? domUtils.getXY(nextTd).x + nextTd.offsetWidth - 20 : (me.body.offsetWidth + 5 || parseInt(domUtils.getComputedStyle(me.body, \"width\"), 10));\r\n\r\n                left += cellMinWidth;\r\n                right -= cellMinWidth;\r\n\r\n                return mouseX < left ? left : mouseX > right ? right : mouseX;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 获取拖动时允许的Y轴坐标\r\n         */\r\n        function getPermissionY(dragTd, evt) {\r\n            try {\r\n                var top = domUtils.getXY(dragTd).y,\r\n                    mousePosY = mouseCoords(evt).y;\r\n                return mousePosY < top ? top : mousePosY;\r\n            } catch (e) {\r\n                showError(e);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 移动状态切换\r\n         */\r\n        function toggleDraggableState(editor, draggable, dir, mousePos, cell) {\r\n            try {\r\n                editor.body.style.cursor = dir == \"h\" ? \"col-resize\" : dir == \"v\" ? \"row-resize\" : \"text\";\r\n                if (browser.ie) {\r\n                    if (dir && !mousedown && !getUETableBySelected(editor)) {\r\n                        getDragLine(editor, editor.document);\r\n                        showDragLineAt(dir, cell);\r\n                    } else {\r\n                        hideDragLine(editor)\r\n                    }\r\n                }\r\n                onBorder = draggable;\r\n            } catch (e) {\r\n                showError(e);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 获取与UETable相关的resize line\r\n         * @param uetable UETable对象\r\n         */\r\n        function getResizeLineByUETable() {\r\n\r\n            var lineId = '_UETableResizeLine',\r\n                line = this.document.getElementById(lineId);\r\n\r\n            if (!line) {\r\n                line = this.document.createElement(\"div\");\r\n                line.id = lineId;\r\n                line.contnetEditable = false;\r\n                line.setAttribute(\"unselectable\", \"on\");\r\n\r\n                var styles = {\r\n                    width: 2 * cellBorderWidth + 1 + 'px',\r\n                    position: 'absolute',\r\n                    'z-index': 100000,\r\n                    cursor: 'col-resize',\r\n                    background: 'red',\r\n                    display: 'none'\r\n                };\r\n\r\n                //切换状态\r\n                line.onmouseout = function () {\r\n                    this.style.display = 'none';\r\n                };\r\n\r\n                utils.extend(line.style, styles);\r\n\r\n                this.document.body.appendChild(line);\r\n\r\n            }\r\n\r\n            return line;\r\n\r\n        }\r\n\r\n        /**\r\n         * 更新resize-line\r\n         */\r\n        function updateResizeLine(cell, uetable) {\r\n\r\n            var line = getResizeLineByUETable.call(this),\r\n                table = uetable.table,\r\n                styles = {\r\n                    top: domUtils.getXY(table).y + 'px',\r\n                    left: domUtils.getXY(cell).x + cell.offsetWidth - cellBorderWidth + 'px',\r\n                    display: 'block',\r\n                    height: table.offsetHeight + 'px'\r\n                };\r\n\r\n            utils.extend(line.style, styles);\r\n\r\n        }\r\n\r\n        /**\r\n         * 显示resize-line\r\n         */\r\n        function showResizeLine(cell) {\r\n\r\n            var uetable = getUETable(cell);\r\n\r\n            updateResizeLine.call(this, cell, uetable);\r\n\r\n        }\r\n\r\n        /**\r\n         * 获取鼠标与当前单元格的相对位置\r\n         * @param ele\r\n         * @param mousePos\r\n         */\r\n        function getRelation(ele, mousePos) {\r\n            var elePos = domUtils.getXY(ele);\r\n\r\n            if (!elePos) {\r\n                return '';\r\n            }\r\n\r\n            if (elePos.x + ele.offsetWidth - mousePos.x < cellBorderWidth) {\r\n                return \"h\";\r\n            }\r\n            if (mousePos.x - elePos.x < cellBorderWidth) {\r\n                return 'h1'\r\n            }\r\n            if (elePos.y + ele.offsetHeight - mousePos.y < cellBorderWidth) {\r\n                return \"v\";\r\n            }\r\n            if (mousePos.y - elePos.y < cellBorderWidth) {\r\n                return 'v1'\r\n            }\r\n            return '';\r\n        }\r\n\r\n        function mouseDownEvent(type, evt) {\r\n\r\n            if (isEditorDisabled()) {\r\n                return;\r\n            }\r\n\r\n            userActionStatus = {\r\n                x: evt.clientX,\r\n                y: evt.clientY\r\n            };\r\n\r\n            //右键菜单单独处理\r\n            if (evt.button == 2) {\r\n                var ut = getUETableBySelected(me),\r\n                    flag = false;\r\n\r\n                if (ut) {\r\n                    var td = getTargetTd(me, evt);\r\n                    utils.each(ut.selectedTds, function (ti) {\r\n                        if (ti === td) {\r\n                            flag = true;\r\n                        }\r\n                    });\r\n                    if (!flag) {\r\n                        removeSelectedClass(domUtils.getElementsByTagName(me.body, \"th td\"));\r\n                        ut.clearSelected()\r\n                    } else {\r\n                        td = ut.selectedTds[0];\r\n                        setTimeout(function () {\r\n                            me.selection.getRange().setStart(td, 0).setCursor(false, true);\r\n                        }, 0);\r\n\r\n                    }\r\n                }\r\n            } else {\r\n                tableClickHander(evt);\r\n            }\r\n\r\n        }\r\n\r\n        //清除表格的计时器\r\n        function clearTableTimer() {\r\n            tabTimer && clearTimeout(tabTimer);\r\n            tabTimer = null;\r\n        }\r\n\r\n        //双击收缩\r\n        function tableDbclickHandler(evt) {\r\n            singleClickState = 0;\r\n            evt = evt || me.window.event;\r\n            var target = getParentTdOrTh(evt.target || evt.srcElement);\r\n            if (target) {\r\n                var h;\r\n                if (h = getRelation(target, mouseCoords(evt))) {\r\n\r\n                    hideDragLine(me);\r\n\r\n                    if (h == 'h1') {\r\n                        h = 'h';\r\n                        if (inTableSide(domUtils.findParentByTagName(target, \"table\"), target, evt)) {\r\n                            me.execCommand('adaptbywindow');\r\n                        } else {\r\n                            target = getUETable(target).getPreviewCell(target);\r\n                            if (target) {\r\n                                var rng = me.selection.getRange();\r\n                                rng.selectNodeContents(target).setCursor(true, true)\r\n                            }\r\n                        }\r\n                    }\r\n                    if (h == 'h') {\r\n                        var ut = getUETable(target),\r\n                            table = ut.table,\r\n                            cells = getCellsByMoveBorder(target, table, true);\r\n\r\n                        cells = extractArray(cells, 'left');\r\n\r\n                        ut.width = ut.offsetWidth;\r\n\r\n                        var oldWidth = [],\r\n                            newWidth = [];\r\n\r\n                        utils.each(cells, function (cell) {\r\n\r\n                            oldWidth.push(cell.offsetWidth);\r\n\r\n                        });\r\n\r\n                        utils.each(cells, function (cell) {\r\n\r\n                            cell.removeAttribute(\"width\");\r\n\r\n                        });\r\n\r\n                        window.setTimeout(function () {\r\n\r\n                            //是否允许改变\r\n                            var changeable = true;\r\n\r\n                            utils.each(cells, function (cell, index) {\r\n\r\n                                var width = cell.offsetWidth;\r\n\r\n                                if (width > oldWidth[index]) {\r\n                                    changeable = false;\r\n                                    return false;\r\n                                }\r\n\r\n                                newWidth.push(width);\r\n\r\n                            });\r\n\r\n                            var change = changeable ? newWidth : oldWidth;\r\n\r\n                            utils.each(cells, function (cell, index) {\r\n\r\n                                cell.width = change[index] - getTabcellSpace();\r\n\r\n                            });\r\n\r\n\r\n                        }, 0);\r\n\r\n                        //                    minWidth -= cellMinWidth;\r\n                        //\r\n                        //                    table.removeAttribute(\"width\");\r\n                        //                    utils.each(cells, function (cell) {\r\n                        //                        cell.style.width = \"\";\r\n                        //                        cell.width -= minWidth;\r\n                        //                    });\r\n\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function tableClickHander(evt) {\r\n\r\n            removeSelectedClass(domUtils.getElementsByTagName(me.body, \"td th\"));\r\n            //trace:3113\r\n            //选中单元格，点击table外部，不会清掉table上挂的ueTable,会引起getUETableBySelected方法返回值\r\n            utils.each(me.document.getElementsByTagName('table'), function (t) {\r\n                t.ueTable = null;\r\n            });\r\n            startTd = getTargetTd(me, evt);\r\n            if (!startTd) return;\r\n            var table = domUtils.findParentByTagName(startTd, \"table\", true);\r\n            ut = getUETable(table);\r\n            ut && ut.clearSelected();\r\n\r\n            //判断当前鼠标状态\r\n            if (!onBorder) {\r\n                me.document.body.style.webkitUserSelect = '';\r\n                mousedown = true;\r\n                me.addListener('mouseover', mouseOverEvent);\r\n            } else {\r\n                //边框上的动作处理\r\n                borderActionHandler(evt);\r\n            }\r\n\r\n\r\n        }\r\n\r\n        //处理表格边框上的动作, 这里做延时处理，避免两种动作互相影响\r\n        function borderActionHandler(evt) {\r\n\r\n            if (browser.ie) {\r\n                evt = reconstruct(evt);\r\n            }\r\n\r\n            clearTableDragTimer();\r\n\r\n            //是否正在等待resize的缓冲中\r\n            isInResizeBuffer = true;\r\n\r\n            tableDragTimer = setTimeout(function () {\r\n                tableBorderDrag(evt);\r\n            }, dblclickTime);\r\n\r\n        }\r\n\r\n        function extractArray(originArr, key) {\r\n\r\n            var result = [],\r\n                tmp = null;\r\n\r\n            for (var i = 0, len = originArr.length; i < len; i++) {\r\n\r\n                tmp = originArr[i][key];\r\n\r\n                if (tmp) {\r\n                    result.push(tmp);\r\n                }\r\n\r\n            }\r\n\r\n            return result;\r\n\r\n        }\r\n\r\n        function clearTableDragTimer() {\r\n            tableDragTimer && clearTimeout(tableDragTimer);\r\n            tableDragTimer = null;\r\n        }\r\n\r\n        function reconstruct(obj) {\r\n\r\n            var attrs = ['pageX', 'pageY', 'clientX', 'clientY', 'srcElement', 'target'],\r\n                newObj = {};\r\n\r\n            if (obj) {\r\n\r\n                for (var i = 0, key, val; key = attrs[i]; i++) {\r\n                    val = obj[key];\r\n                    val && (newObj[key] = val);\r\n                }\r\n\r\n            }\r\n\r\n            return newObj;\r\n\r\n        }\r\n\r\n        //边框拖动\r\n        function tableBorderDrag(evt) {\r\n\r\n            isInResizeBuffer = false;\r\n\r\n            startTd = evt.target || evt.srcElement;\r\n            if (!startTd) return;\r\n            var state = getRelation(startTd, mouseCoords(evt));\r\n            if (/\\d/.test(state)) {\r\n                state = state.replace(/\\d/, '');\r\n                startTd = getUETable(startTd).getPreviewCell(startTd, state == 'v');\r\n            }\r\n            hideDragLine(me);\r\n            getDragLine(me, me.document);\r\n            me.fireEvent('saveScene');\r\n            showDragLineAt(state, startTd);\r\n            mousedown = true;\r\n            //拖动开始\r\n            onDrag = state;\r\n            dragTd = startTd;\r\n        }\r\n\r\n        function mouseUpEvent(type, evt) {\r\n\r\n            if (isEditorDisabled()) {\r\n                return;\r\n            }\r\n\r\n            clearTableDragTimer();\r\n\r\n            isInResizeBuffer = false;\r\n\r\n            if (onBorder) {\r\n                singleClickState = ++singleClickState % 3;\r\n\r\n                userActionStatus = {\r\n                    x: evt.clientX,\r\n                    y: evt.clientY\r\n                };\r\n\r\n                tableResizeTimer = setTimeout(function () {\r\n                    singleClickState > 0 && singleClickState--;\r\n                }, dblclickTime);\r\n\r\n                if (singleClickState === 2) {\r\n\r\n                    singleClickState = 0;\r\n                    tableDbclickHandler(evt);\r\n                    return;\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (evt.button == 2) return;\r\n            var me = this;\r\n            //清除表格上原生跨选问题\r\n            var range = me.selection.getRange(),\r\n                start = domUtils.findParentByTagName(range.startContainer, 'table', true),\r\n                end = domUtils.findParentByTagName(range.endContainer, 'table', true);\r\n\r\n            if (start || end) {\r\n                if (start === end) {\r\n                    start = domUtils.findParentByTagName(range.startContainer, ['td', 'th', 'caption'], true);\r\n                    end = domUtils.findParentByTagName(range.endContainer, ['td', 'th', 'caption'], true);\r\n                    if (start !== end) {\r\n                        me.selection.clearRange()\r\n                    }\r\n                } else {\r\n                    me.selection.clearRange()\r\n                }\r\n            }\r\n            mousedown = false;\r\n            me.document.body.style.webkitUserSelect = '';\r\n            //拖拽状态下的mouseUP\r\n            if (onDrag && dragTd) {\r\n\r\n                me.selection.getNative()[browser.ie9below ? 'empty' : 'removeAllRanges']();\r\n\r\n                singleClickState = 0;\r\n                dragLine = me.document.getElementById('ue_tableDragLine');\r\n\r\n                // trace 3973\r\n                if (dragLine) {\r\n                    var dragTdPos = domUtils.getXY(dragTd),\r\n                        dragLinePos = domUtils.getXY(dragLine);\r\n\r\n                    switch (onDrag) {\r\n                        case \"h\":\r\n                            changeColWidth(dragTd, dragLinePos.x - dragTdPos.x);\r\n                            break;\r\n                        case \"v\":\r\n                            changeRowHeight(dragTd, dragLinePos.y - dragTdPos.y - dragTd.offsetHeight);\r\n                            break;\r\n                        default:\r\n                    }\r\n                    onDrag = \"\";\r\n                    dragTd = null;\r\n\r\n                    hideDragLine(me);\r\n                    me.fireEvent('saveScene');\r\n                    return;\r\n                }\r\n            }\r\n            //正常状态下的mouseup\r\n            if (!startTd) {\r\n                var target = domUtils.findParentByTagName(evt.target || evt.srcElement, \"td\", true);\r\n                if (!target) target = domUtils.findParentByTagName(evt.target || evt.srcElement, \"th\", true);\r\n                if (target && (target.tagName == \"TD\" || target.tagName == \"TH\")) {\r\n                    if (me.fireEvent(\"excludetable\", target) === true) return;\r\n                    range = new dom.Range(me.document);\r\n                    range.setStart(target, 0).setCursor(false, true);\r\n                }\r\n            } else {\r\n                var ut = getUETable(startTd),\r\n                    cell = ut ? ut.selectedTds[0] : null;\r\n                if (cell) {\r\n                    range = new dom.Range(me.document);\r\n                    if (domUtils.isEmptyBlock(cell)) {\r\n                        range.setStart(cell, 0).setCursor(false, true);\r\n                    } else {\r\n                        range.selectNodeContents(cell).shrinkBoundary().setCursor(false, true);\r\n                    }\r\n                } else {\r\n                    range = me.selection.getRange().shrinkBoundary();\r\n                    if (!range.collapsed) {\r\n                        var start = domUtils.findParentByTagName(range.startContainer, ['td', 'th'], true),\r\n                            end = domUtils.findParentByTagName(range.endContainer, ['td', 'th'], true);\r\n                        //在table里边的不能清除\r\n                        if (start && !end || !start && end || start && end && start !== end) {\r\n                            range.setCursor(false, true);\r\n                        }\r\n                    }\r\n                }\r\n                startTd = null;\r\n                me.removeListener('mouseover', mouseOverEvent);\r\n            }\r\n            me._selectionChange(250, evt);\r\n        }\r\n\r\n        function mouseOverEvent(type, evt) {\r\n\r\n            if (isEditorDisabled()) {\r\n                return;\r\n            }\r\n\r\n            var me = this,\r\n                tar = evt.target || evt.srcElement;\r\n            currentTd = domUtils.findParentByTagName(tar, \"td\", true) || domUtils.findParentByTagName(tar, \"th\", true);\r\n            //需要判断两个TD是否位于同一个表格内\r\n            if (startTd && currentTd &&\r\n                ((startTd.tagName == \"TD\" && currentTd.tagName == \"TD\") || (startTd.tagName == \"TH\" && currentTd.tagName == \"TH\")) &&\r\n                domUtils.findParentByTagName(startTd, 'table') == domUtils.findParentByTagName(currentTd, 'table')) {\r\n                var ut = getUETable(currentTd);\r\n                if (startTd != currentTd) {\r\n                    me.document.body.style.webkitUserSelect = 'none';\r\n                    me.selection.getNative()[browser.ie9below ? 'empty' : 'removeAllRanges']();\r\n                    var range = ut.getCellsRange(startTd, currentTd);\r\n                    ut.setSelected(range);\r\n                } else {\r\n                    me.document.body.style.webkitUserSelect = '';\r\n                    ut.clearSelected();\r\n                }\r\n\r\n            }\r\n            evt.preventDefault ? evt.preventDefault() : (evt.returnValue = false);\r\n        }\r\n\r\n        function setCellHeight(cell, height, backHeight) {\r\n            var lineHight = parseInt(domUtils.getComputedStyle(cell, \"line-height\"), 10),\r\n                tmpHeight = backHeight + height;\r\n            height = tmpHeight < lineHight ? lineHight : tmpHeight;\r\n            if (cell.style.height) cell.style.height = \"\";\r\n            cell.rowSpan == 1 ? cell.setAttribute(\"height\", height) : (cell.removeAttribute && cell.removeAttribute(\"height\"));\r\n        }\r\n\r\n        function getWidth(cell) {\r\n            if (!cell) return 0;\r\n            return parseInt(domUtils.getComputedStyle(cell, \"width\"), 10);\r\n        }\r\n\r\n        function changeColWidth(cell, changeValue) {\r\n\r\n            var ut = getUETable(cell);\r\n            if (ut) {\r\n\r\n                //根据当前移动的边框获取相关的单元格\r\n                var table = ut.table,\r\n                    cells = getCellsByMoveBorder(cell, table);\r\n\r\n                table.style.width = \"\";\r\n                table.removeAttribute(\"width\");\r\n\r\n                //修正改变量\r\n                changeValue = correctChangeValue(changeValue, cell, cells);\r\n\r\n                if (cell.nextSibling) {\r\n\r\n                    var i = 0;\r\n\r\n                    utils.each(cells, function (cellGroup) {\r\n\r\n                        cellGroup.left.width = (+cellGroup.left.width) + changeValue;\r\n                        cellGroup.right && (cellGroup.right.width = (+cellGroup.right.width) - changeValue);\r\n\r\n                    });\r\n\r\n                } else {\r\n\r\n                    utils.each(cells, function (cellGroup) {\r\n                        cellGroup.left.width -= -changeValue;\r\n                    });\r\n\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        function isEditorDisabled() {\r\n            return me.body.contentEditable === \"false\";\r\n        }\r\n\r\n        function changeRowHeight(td, changeValue) {\r\n            if (Math.abs(changeValue) < 10) return;\r\n            var ut = getUETable(td);\r\n            if (ut) {\r\n                var cells = ut.getSameEndPosCells(td, \"y\"),\r\n                    //备份需要连带变化的td的原始高度，否则后期无法获取正确的值\r\n                    backHeight = cells[0] ? cells[0].offsetHeight : 0;\r\n                for (var i = 0, cell; cell = cells[i++];) {\r\n                    setCellHeight(cell, changeValue, backHeight);\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * 获取调整单元格大小的相关单元格\r\n         * @isContainMergeCell 返回的结果中是否包含发生合并后的单元格\r\n         */\r\n        function getCellsByMoveBorder(cell, table, isContainMergeCell) {\r\n\r\n            if (!table) {\r\n                table = domUtils.findParentByTagName(cell, 'table');\r\n            }\r\n\r\n            if (!table) {\r\n                return null;\r\n            }\r\n\r\n            //获取到该单元格所在行的序列号\r\n            var index = domUtils.getNodeIndex(cell),\r\n                temp = cell,\r\n                rows = table.rows,\r\n                colIndex = 0;\r\n\r\n            while (temp) {\r\n                //获取到当前单元格在未发生单元格合并时的序列\r\n                if (temp.nodeType === 1) {\r\n                    colIndex += (temp.colSpan || 1);\r\n                }\r\n                temp = temp.previousSibling;\r\n            }\r\n\r\n            temp = null;\r\n\r\n            //记录想关的单元格\r\n            var borderCells = [];\r\n\r\n            utils.each(rows, function (tabRow) {\r\n\r\n                var cells = tabRow.cells,\r\n                    currIndex = 0;\r\n\r\n                utils.each(cells, function (tabCell) {\r\n\r\n                    currIndex += (tabCell.colSpan || 1);\r\n\r\n                    if (currIndex === colIndex) {\r\n\r\n                        borderCells.push({\r\n                            left: tabCell,\r\n                            right: tabCell.nextSibling || null\r\n                        });\r\n\r\n                        return false;\r\n\r\n                    } else if (currIndex > colIndex) {\r\n\r\n                        if (isContainMergeCell) {\r\n                            borderCells.push({\r\n                                left: tabCell\r\n                            });\r\n                        }\r\n\r\n                        return false;\r\n                    }\r\n\r\n\r\n                });\r\n\r\n            });\r\n\r\n            return borderCells;\r\n\r\n        }\r\n\r\n\r\n        /**\r\n         * 通过给定的单元格集合获取最小的单元格width\r\n         */\r\n        function getMinWidthByTableCells(cells) {\r\n\r\n            var minWidth = Number.MAX_VALUE;\r\n\r\n            for (var i = 0, curCell; curCell = cells[i]; i++) {\r\n\r\n                minWidth = Math.min(minWidth, curCell.width || getTableCellWidth(curCell));\r\n\r\n            }\r\n\r\n            return minWidth;\r\n\r\n        }\r\n\r\n        function correctChangeValue(changeValue, relatedCell, cells) {\r\n\r\n            //为单元格的paading预留空间\r\n            changeValue -= getTabcellSpace();\r\n\r\n            if (changeValue < 0) {\r\n                return 0;\r\n            }\r\n\r\n            changeValue -= getTableCellWidth(relatedCell);\r\n\r\n            //确定方向\r\n            var direction = changeValue < 0 ? 'left' : 'right';\r\n\r\n            changeValue = Math.abs(changeValue);\r\n\r\n            //只关心非最后一个单元格就可以\r\n            utils.each(cells, function (cellGroup) {\r\n\r\n                var curCell = cellGroup[direction];\r\n\r\n                //为单元格保留最小空间\r\n                if (curCell) {\r\n                    changeValue = Math.min(changeValue, getTableCellWidth(curCell) - cellMinWidth);\r\n                }\r\n\r\n\r\n            });\r\n\r\n\r\n            //修正越界\r\n            changeValue = changeValue < 0 ? 0 : changeValue;\r\n\r\n            return direction === 'left' ? -changeValue : changeValue;\r\n\r\n        }\r\n\r\n        function getTableCellWidth(cell) {\r\n\r\n            var width = 0,\r\n                //偏移纠正量\r\n                offset = 0,\r\n                width = cell.offsetWidth - getTabcellSpace();\r\n\r\n            //最后一个节点纠正一下\r\n            if (!cell.nextSibling) {\r\n\r\n                width -= getTableCellOffset(cell);\r\n\r\n            }\r\n\r\n            width = width < 0 ? 0 : width;\r\n\r\n            try {\r\n                cell.width = width;\r\n            } catch (e) {\r\n            }\r\n\r\n            return width;\r\n\r\n        }\r\n\r\n        /**\r\n         * 获取单元格所在表格的最末单元格的偏移量\r\n         */\r\n        function getTableCellOffset(cell) {\r\n\r\n            tab = domUtils.findParentByTagName(cell, \"table\", false);\r\n\r\n            if (tab.offsetVal === undefined) {\r\n\r\n                var prev = cell.previousSibling;\r\n\r\n                if (prev) {\r\n\r\n                    //最后一个单元格和前一个单元格的width diff结果 如果恰好为一个border width， 则条件成立\r\n                    tab.offsetVal = cell.offsetWidth - prev.offsetWidth === UT.borderWidth ? UT.borderWidth : 0;\r\n\r\n                } else {\r\n                    tab.offsetVal = 0;\r\n                }\r\n\r\n            }\r\n\r\n            return tab.offsetVal;\r\n\r\n        }\r\n\r\n        function getTabcellSpace() {\r\n\r\n            if (UT.tabcellSpace === undefined) {\r\n\r\n                var cell = null,\r\n                    tab = me.document.createElement(\"table\"),\r\n                    tbody = me.document.createElement(\"tbody\"),\r\n                    trow = me.document.createElement(\"tr\"),\r\n                    tabcell = me.document.createElement(\"td\"),\r\n                    mirror = null;\r\n\r\n                tabcell.style.cssText = 'border: 0;';\r\n                tabcell.width = 1;\r\n\r\n                trow.appendChild(tabcell);\r\n                trow.appendChild(mirror = tabcell.cloneNode(false));\r\n\r\n                tbody.appendChild(trow);\r\n\r\n                tab.appendChild(tbody);\r\n\r\n                tab.style.cssText = \"visibility: hidden;\";\r\n\r\n                me.body.appendChild(tab);\r\n\r\n                UT.paddingSpace = tabcell.offsetWidth - 1;\r\n\r\n                var tmpTabWidth = tab.offsetWidth;\r\n\r\n                tabcell.style.cssText = '';\r\n                mirror.style.cssText = '';\r\n\r\n                UT.borderWidth = (tab.offsetWidth - tmpTabWidth) / 3;\r\n\r\n                UT.tabcellSpace = UT.paddingSpace + UT.borderWidth;\r\n\r\n                me.body.removeChild(tab);\r\n\r\n            }\r\n\r\n            getTabcellSpace = function () { return UT.tabcellSpace; };\r\n\r\n            return UT.tabcellSpace;\r\n\r\n        }\r\n\r\n        function getDragLine(editor, doc) {\r\n            if (mousedown) return;\r\n            dragLine = editor.document.createElement(\"div\");\r\n            domUtils.setAttributes(dragLine, {\r\n                id: \"ue_tableDragLine\",\r\n                unselectable: 'on',\r\n                contenteditable: false,\r\n                'onresizestart': 'return false',\r\n                'ondragstart': 'return false',\r\n                'onselectstart': 'return false',\r\n                style: \"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)\"\r\n            });\r\n            editor.body.appendChild(dragLine);\r\n        }\r\n\r\n        function hideDragLine(editor) {\r\n            if (mousedown) return;\r\n            var line;\r\n            while (line = editor.document.getElementById('ue_tableDragLine')) {\r\n                domUtils.remove(line)\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 依据state（v|h）在cell位置显示横线\r\n         * @param state\r\n         * @param cell\r\n         */\r\n        function showDragLineAt(state, cell) {\r\n            if (!cell) return;\r\n            var table = domUtils.findParentByTagName(cell, \"table\"),\r\n                caption = table.getElementsByTagName('caption'),\r\n                width = table.offsetWidth,\r\n                height = table.offsetHeight - (caption.length > 0 ? caption[0].offsetHeight : 0),\r\n                tablePos = domUtils.getXY(table),\r\n                cellPos = domUtils.getXY(cell), css;\r\n            switch (state) {\r\n                case \"h\":\r\n                    css = 'height:' + height + 'px;top:' + (tablePos.y + (caption.length > 0 ? caption[0].offsetHeight : 0)) + 'px;left:' + (cellPos.x + cell.offsetWidth);\r\n                    dragLine.style.cssText = css + 'px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)';\r\n                    break;\r\n                case \"v\":\r\n                    css = 'width:' + width + 'px;left:' + tablePos.x + 'px;top:' + (cellPos.y + cell.offsetHeight);\r\n                    //必须加上border:0和color:blue，否则低版ie不支持背景色显示\r\n                    dragLine.style.cssText = css + 'px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)';\r\n                    break;\r\n                default:\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 当表格边框颜色为白色时设置为虚线,true为添加虚线\r\n         * @param editor\r\n         * @param flag\r\n         */\r\n        function switchBorderColor(editor, flag) {\r\n            var tableArr = domUtils.getElementsByTagName(editor.body, \"table\"), color;\r\n            for (var i = 0, node; node = tableArr[i++];) {\r\n                var td = domUtils.getElementsByTagName(node, \"td\");\r\n                if (td[0]) {\r\n                    if (flag) {\r\n                        color = (td[0].style.borderColor).replace(/\\s/g, \"\");\r\n                        if (/(#ffffff)|(rgb\\(255,255,255\\))/ig.test(color))\r\n                            domUtils.addClass(node, \"noBorderTable\")\r\n                    } else {\r\n                        domUtils.removeClasses(node, \"noBorderTable\")\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        function getTableWidth(editor, needIEHack, defaultValue) {\r\n            var body = editor.body;\r\n            return body.offsetWidth - (needIEHack ? parseInt(domUtils.getComputedStyle(body, 'margin-left'), 10) * 2 : 0) - defaultValue.tableBorder * 2 - (editor.options.offsetWidth || 0);\r\n        }\r\n\r\n        /**\r\n         * 获取当前拖动的单元格\r\n         */\r\n        function getTargetTd(editor, evt) {\r\n\r\n            var target = domUtils.findParentByTagName(evt.target || evt.srcElement, [\"td\", \"th\"], true),\r\n                dir = null;\r\n\r\n            if (!target) {\r\n                return null;\r\n            }\r\n\r\n            dir = getRelation(target, mouseCoords(evt));\r\n\r\n            //如果有前一个节点， 需要做一个修正， 否则可能会得到一个错误的td\r\n\r\n            if (!target) {\r\n                return null;\r\n            }\r\n\r\n            if (dir === 'h1' && target.previousSibling) {\r\n\r\n                var position = domUtils.getXY(target),\r\n                    cellWidth = target.offsetWidth;\r\n\r\n                if (Math.abs(position.x + cellWidth - evt.clientX) > cellWidth / 3) {\r\n                    target = target.previousSibling;\r\n                }\r\n\r\n            } else if (dir === 'v1' && target.parentNode.previousSibling) {\r\n\r\n                var position = domUtils.getXY(target),\r\n                    cellHeight = target.offsetHeight;\r\n\r\n                if (Math.abs(position.y + cellHeight - evt.clientY) > cellHeight / 3) {\r\n                    target = target.parentNode.previousSibling.firstChild;\r\n                }\r\n\r\n            }\r\n\r\n\r\n            //排除了非td内部以及用于代码高亮部分的td\r\n            return target && !(editor.fireEvent(\"excludetable\", target) === true) ? target : null;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    // plugins/table.sort.js\r\n    /**\r\n     * Created with JetBrains PhpStorm.\r\n     * User: Jinqn\r\n     * Date: 13-10-12\r\n     * Time: 上午10:20\r\n     * To change this template use File | Settings | File Templates.\r\n     */\r\n\r\n    UE.UETable.prototype.sortTable = function (sortByCellIndex, compareFn) {\r\n        var table = this.table,\r\n            rows = table.rows,\r\n            trArray = [],\r\n            flag = rows[0].cells[0].tagName === \"TH\",\r\n            lastRowIndex = 0;\r\n        if (this.selectedTds.length) {\r\n            var range = this.cellsRange,\r\n                len = range.endRowIndex + 1;\r\n            for (var i = range.beginRowIndex; i < len; i++) {\r\n                trArray[i] = rows[i];\r\n            }\r\n            trArray.splice(0, range.beginRowIndex);\r\n            lastRowIndex = (range.endRowIndex + 1) === this.rowsNum ? 0 : range.endRowIndex + 1;\r\n        } else {\r\n            for (var i = 0, len = rows.length; i < len; i++) {\r\n                trArray[i] = rows[i];\r\n            }\r\n        }\r\n\r\n        var Fn = {\r\n            'reversecurrent': function (td1, td2) {\r\n                return 1;\r\n            },\r\n            'orderbyasc': function (td1, td2) {\r\n                var value1 = td1.innerText || td1.textContent,\r\n                    value2 = td2.innerText || td2.textContent;\r\n                return value1.localeCompare(value2);\r\n            },\r\n            'reversebyasc': function (td1, td2) {\r\n                var value1 = td1.innerHTML,\r\n                    value2 = td2.innerHTML;\r\n                return value2.localeCompare(value1);\r\n            },\r\n            'orderbynum': function (td1, td2) {\r\n                var value1 = td1[browser.ie ? 'innerText' : 'textContent'].match(/\\d+/),\r\n                    value2 = td2[browser.ie ? 'innerText' : 'textContent'].match(/\\d+/);\r\n                if (value1) value1 = +value1[0];\r\n                if (value2) value2 = +value2[0];\r\n                return (value1 || 0) - (value2 || 0);\r\n            },\r\n            'reversebynum': function (td1, td2) {\r\n                var value1 = td1[browser.ie ? 'innerText' : 'textContent'].match(/\\d+/),\r\n                    value2 = td2[browser.ie ? 'innerText' : 'textContent'].match(/\\d+/);\r\n                if (value1) value1 = +value1[0];\r\n                if (value2) value2 = +value2[0];\r\n                return (value2 || 0) - (value1 || 0);\r\n            }\r\n        };\r\n\r\n        //对表格设置排序的标记data-sort-type\r\n        table.setAttribute('data-sort-type', compareFn && typeof compareFn === \"string\" && Fn[compareFn] ? compareFn : '');\r\n\r\n        //th不参与排序\r\n        flag && trArray.splice(0, 1);\r\n        trArray = utils.sort(trArray, function (tr1, tr2) {\r\n            var result;\r\n            if (compareFn && typeof compareFn === \"function\") {\r\n                result = compareFn.call(this, tr1.cells[sortByCellIndex], tr2.cells[sortByCellIndex]);\r\n            } else if (compareFn && typeof compareFn === \"number\") {\r\n                result = 1;\r\n            } else if (compareFn && typeof compareFn === \"string\" && Fn[compareFn]) {\r\n                result = Fn[compareFn].call(this, tr1.cells[sortByCellIndex], tr2.cells[sortByCellIndex]);\r\n            } else {\r\n                result = Fn['orderbyasc'].call(this, tr1.cells[sortByCellIndex], tr2.cells[sortByCellIndex]);\r\n            }\r\n            return result;\r\n        });\r\n        var fragment = table.ownerDocument.createDocumentFragment();\r\n        for (var j = 0, len = trArray.length; j < len; j++) {\r\n            fragment.appendChild(trArray[j]);\r\n        }\r\n        var tbody = table.getElementsByTagName(\"tbody\")[0];\r\n        if (!lastRowIndex) {\r\n            tbody.appendChild(fragment);\r\n        } else {\r\n            tbody.insertBefore(fragment, rows[lastRowIndex - range.endRowIndex + range.beginRowIndex - 1])\r\n        }\r\n    };\r\n\r\n    UE.plugins['tablesort'] = function () {\r\n        var me = this,\r\n            UT = UE.UETable,\r\n            getUETable = function (tdOrTable) {\r\n                return UT.getUETable(tdOrTable);\r\n            },\r\n            getTableItemsByRange = function (editor) {\r\n                return UT.getTableItemsByRange(editor);\r\n            };\r\n\r\n\r\n        me.ready(function () {\r\n            //添加表格可排序的样式\r\n            utils.cssRule('tablesort',\r\n                'table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;' +\r\n                '   background-image:url(' + me.options.themePath + me.options.theme + '/images/sortable.png);}',\r\n                me.document);\r\n\r\n            //做单元格合并操作时,清除可排序标识\r\n            me.addListener(\"afterexeccommand\", function (type, cmd) {\r\n                if (cmd == 'mergeright' || cmd == 'mergedown' || cmd == 'mergecells') {\r\n                    this.execCommand('disablesort');\r\n                }\r\n            });\r\n        });\r\n\r\n\r\n\r\n        //表格排序\r\n        UE.commands['sorttable'] = {\r\n            queryCommandState: function () {\r\n                var me = this,\r\n                    tableItems = getTableItemsByRange(me);\r\n                if (!tableItems.cell) return -1;\r\n                var table = tableItems.table,\r\n                    cells = table.getElementsByTagName(\"td\");\r\n                for (var i = 0, cell; cell = cells[i++];) {\r\n                    if (cell.rowSpan != 1 || cell.colSpan != 1) return -1;\r\n                }\r\n                return 0;\r\n            },\r\n            execCommand: function (cmd, fn) {\r\n                var me = this,\r\n                    range = me.selection.getRange(),\r\n                    bk = range.createBookmark(true),\r\n                    tableItems = getTableItemsByRange(me),\r\n                    cell = tableItems.cell,\r\n                    ut = getUETable(tableItems.table),\r\n                    cellInfo = ut.getCellInfo(cell);\r\n                ut.sortTable(cellInfo.cellIndex, fn);\r\n                range.moveToBookmark(bk);\r\n                try {\r\n                    range.select();\r\n                } catch (e) { }\r\n            }\r\n        };\r\n\r\n        //设置表格可排序,清除表格可排序\r\n        UE.commands[\"enablesort\"] = UE.commands[\"disablesort\"] = {\r\n            queryCommandState: function (cmd) {\r\n                var table = getTableItemsByRange(this).table;\r\n                if (table && cmd == 'enablesort') {\r\n                    var cells = domUtils.getElementsByTagName(table, 'th td');\r\n                    for (var i = 0; i < cells.length; i++) {\r\n                        if (cells[i].getAttribute('colspan') > 1 || cells[i].getAttribute('rowspan') > 1) return -1;\r\n                    }\r\n                }\r\n\r\n                return !table ? -1 : cmd == 'enablesort' ^ table.getAttribute('data-sort') != 'sortEnabled' ? -1 : 0;\r\n            },\r\n            execCommand: function (cmd) {\r\n                var table = getTableItemsByRange(this).table;\r\n                table.setAttribute(\"data-sort\", cmd == \"enablesort\" ? \"sortEnabled\" : \"sortDisabled\");\r\n                cmd == \"enablesort\" ? domUtils.addClass(table, \"sortEnabled\") : domUtils.removeClasses(table, \"sortEnabled\");\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n    // plugins/contextmenu.js\r\n    ///import core\r\n    ///commands 右键菜单\r\n    ///commandsName  ContextMenu\r\n    ///commandsTitle  右键菜单\r\n    /**\r\n     * 右键菜单\r\n     * @function\r\n     * @name baidu.editor.plugins.contextmenu\r\n     * @author zhanyi\r\n     */\r\n\r\n    UE.plugins['contextmenu'] = function () {\r\n        var me = this;\r\n        me.setOpt('enableContextMenu', true);\r\n        if (me.getOpt('enableContextMenu') === false) {\r\n            return;\r\n        }\r\n        var lang = me.getLang(\"contextMenu\"),\r\n            menu,\r\n            items = me.options.contextMenu || [\r\n                { label: lang['selectall'], cmdName: 'selectall' },\r\n                {\r\n                    label: lang.cleardoc,\r\n                    cmdName: 'cleardoc',\r\n                    exec: function () {\r\n                        if (confirm(lang.confirmclear)) {\r\n                            this.execCommand('cleardoc');\r\n                        }\r\n                    }\r\n                },\r\n                '-',\r\n                {\r\n                    label: lang.unlink,\r\n                    cmdName: 'unlink'\r\n                },\r\n                '-',\r\n                {\r\n                    group: lang.paragraph,\r\n                    icon: 'justifyjustify',\r\n                    subMenu: [\r\n                        {\r\n                            label: lang.justifyleft,\r\n                            cmdName: 'justify',\r\n                            value: 'left'\r\n                        },\r\n                        {\r\n                            label: lang.justifyright,\r\n                            cmdName: 'justify',\r\n                            value: 'right'\r\n                        },\r\n                        {\r\n                            label: lang.justifycenter,\r\n                            cmdName: 'justify',\r\n                            value: 'center'\r\n                        },\r\n                        {\r\n                            label: lang.justifyjustify,\r\n                            cmdName: 'justify',\r\n                            value: 'justify'\r\n                        }\r\n                    ]\r\n                },\r\n                '-',\r\n                {\r\n                    group: lang.table,\r\n                    icon: 'table',\r\n                    subMenu: [\r\n                        {\r\n                            label: lang.inserttable,\r\n                            cmdName: 'inserttable'\r\n                        },\r\n                        {\r\n                            label: lang.deletetable,\r\n                            cmdName: 'deletetable'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.deleterow,\r\n                            cmdName: 'deleterow'\r\n                        },\r\n                        {\r\n                            label: lang.deletecol,\r\n                            cmdName: 'deletecol'\r\n                        },\r\n                        {\r\n                            label: lang.insertcol,\r\n                            cmdName: 'insertcol'\r\n                        },\r\n                        {\r\n                            label: lang.insertcolnext,\r\n                            cmdName: 'insertcolnext'\r\n                        },\r\n                        {\r\n                            label: lang.insertrow,\r\n                            cmdName: 'insertrow'\r\n                        },\r\n                        {\r\n                            label: lang.insertrownext,\r\n                            cmdName: 'insertrownext'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.insertcaption,\r\n                            cmdName: 'insertcaption'\r\n                        },\r\n                        {\r\n                            label: lang.deletecaption,\r\n                            cmdName: 'deletecaption'\r\n                        },\r\n                        {\r\n                            label: lang.inserttitle,\r\n                            cmdName: 'inserttitle'\r\n                        },\r\n                        {\r\n                            label: lang.deletetitle,\r\n                            cmdName: 'deletetitle'\r\n                        },\r\n                        {\r\n                            label: lang.inserttitlecol,\r\n                            cmdName: 'inserttitlecol'\r\n                        },\r\n                        {\r\n                            label: lang.deletetitlecol,\r\n                            cmdName: 'deletetitlecol'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.mergecells,\r\n                            cmdName: 'mergecells'\r\n                        },\r\n                        {\r\n                            label: lang.mergeright,\r\n                            cmdName: 'mergeright'\r\n                        },\r\n                        {\r\n                            label: lang.mergedown,\r\n                            cmdName: 'mergedown'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.splittorows,\r\n                            cmdName: 'splittorows'\r\n                        },\r\n                        {\r\n                            label: lang.splittocols,\r\n                            cmdName: 'splittocols'\r\n                        },\r\n                        {\r\n                            label: lang.splittocells,\r\n                            cmdName: 'splittocells'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.averageDiseRow,\r\n                            cmdName: 'averagedistributerow'\r\n                        },\r\n                        {\r\n                            label: lang.averageDisCol,\r\n                            cmdName: 'averagedistributecol'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.edittd,\r\n                            cmdName: 'edittd',\r\n                            exec: function () {\r\n                                if (UE.ui['edittd']) {\r\n                                    new UE.ui['edittd'](this);\r\n                                }\r\n                                this.getDialog('edittd').open();\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.edittable,\r\n                            cmdName: 'edittable',\r\n                            exec: function () {\r\n                                if (UE.ui['edittable']) {\r\n                                    new UE.ui['edittable'](this);\r\n                                }\r\n                                this.getDialog('edittable').open();\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.setbordervisible,\r\n                            cmdName: 'setbordervisible'\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    group: lang.tablesort,\r\n                    icon: 'tablesort',\r\n                    subMenu: [\r\n                        {\r\n                            label: lang.enablesort,\r\n                            cmdName: 'enablesort'\r\n                        },\r\n                        {\r\n                            label: lang.disablesort,\r\n                            cmdName: 'disablesort'\r\n                        },\r\n                        '-',\r\n                        {\r\n                            label: lang.reversecurrent,\r\n                            cmdName: 'sorttable',\r\n                            value: 'reversecurrent'\r\n                        },\r\n                        {\r\n                            label: lang.orderbyasc,\r\n                            cmdName: 'sorttable',\r\n                            value: 'orderbyasc'\r\n                        },\r\n                        {\r\n                            label: lang.reversebyasc,\r\n                            cmdName: 'sorttable',\r\n                            value: 'reversebyasc'\r\n                        },\r\n                        {\r\n                            label: lang.orderbynum,\r\n                            cmdName: 'sorttable',\r\n                            value: 'orderbynum'\r\n                        },\r\n                        {\r\n                            label: lang.reversebynum,\r\n                            cmdName: 'sorttable',\r\n                            value: 'reversebynum'\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    group: lang.borderbk,\r\n                    icon: 'borderBack',\r\n                    subMenu: [\r\n                        {\r\n                            label: lang.setcolor,\r\n                            cmdName: \"interlacetable\",\r\n                            exec: function () {\r\n                                this.execCommand(\"interlacetable\");\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.unsetcolor,\r\n                            cmdName: \"uninterlacetable\",\r\n                            exec: function () {\r\n                                this.execCommand(\"uninterlacetable\");\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.setbackground,\r\n                            cmdName: \"settablebackground\",\r\n                            exec: function () {\r\n                                this.execCommand(\"settablebackground\", { repeat: true, colorList: [\"#bbb\", \"#ccc\"] });\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.unsetbackground,\r\n                            cmdName: \"cleartablebackground\",\r\n                            exec: function () {\r\n                                this.execCommand(\"cleartablebackground\");\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.redandblue,\r\n                            cmdName: \"settablebackground\",\r\n                            exec: function () {\r\n                                this.execCommand(\"settablebackground\", { repeat: true, colorList: [\"red\", \"blue\"] });\r\n                            }\r\n                        },\r\n                        {\r\n                            label: lang.threecolorgradient,\r\n                            cmdName: \"settablebackground\",\r\n                            exec: function () {\r\n                                this.execCommand(\"settablebackground\", { repeat: true, colorList: [\"#aaa\", \"#bbb\", \"#ccc\"] });\r\n                            }\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    group: lang.aligntd,\r\n                    icon: 'aligntd',\r\n                    subMenu: [\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'left', vAlign: 'top' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'center', vAlign: 'top' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'right', vAlign: 'top' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'left', vAlign: 'middle' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'center', vAlign: 'middle' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'right', vAlign: 'middle' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'left', vAlign: 'bottom' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'center', vAlign: 'bottom' }\r\n                        },\r\n                        {\r\n                            cmdName: 'cellalignment',\r\n                            value: { align: 'right', vAlign: 'bottom' }\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    group: lang.aligntable,\r\n                    icon: 'aligntable',\r\n                    subMenu: [\r\n                        {\r\n                            cmdName: 'tablealignment',\r\n                            className: 'left',\r\n                            label: lang.tableleft,\r\n                            value: \"left\"\r\n                        },\r\n                        {\r\n                            cmdName: 'tablealignment',\r\n                            className: 'center',\r\n                            label: lang.tablecenter,\r\n                            value: \"center\"\r\n                        },\r\n                        {\r\n                            cmdName: 'tablealignment',\r\n                            className: 'right',\r\n                            label: lang.tableright,\r\n                            value: \"right\"\r\n                        }\r\n                    ]\r\n                },\r\n                '-',\r\n                {\r\n                    label: lang.insertparagraphbefore,\r\n                    cmdName: 'insertparagraph',\r\n                    value: true\r\n                },\r\n                {\r\n                    label: lang.insertparagraphafter,\r\n                    cmdName: 'insertparagraph'\r\n                },\r\n                {\r\n                    label: lang['copy'],\r\n                    cmdName: 'copy'\r\n                },\r\n                {\r\n                    label: lang['paste'],\r\n                    cmdName: 'paste'\r\n                }\r\n            ];\r\n        if (!items.length) {\r\n            return;\r\n        }\r\n        var uiUtils = UE.ui.uiUtils;\r\n\r\n        me.addListener('contextmenu', function (type, evt) {\r\n\r\n            var offset = uiUtils.getViewportOffsetByEvent(evt);\r\n            me.fireEvent('beforeselectionchange');\r\n            if (menu) {\r\n                menu.destroy();\r\n            }\r\n            for (var i = 0, ti, contextItems = []; ti = items[i]; i++) {\r\n                var last;\r\n                (function (item) {\r\n                    if (item == '-') {\r\n                        if ((last = contextItems[contextItems.length - 1]) && last !== '-') {\r\n                            contextItems.push('-');\r\n                        }\r\n                    } else if (item.hasOwnProperty(\"group\")) {\r\n                        for (var j = 0, cj, subMenu = []; cj = item.subMenu[j]; j++) {\r\n                            (function (subItem) {\r\n                                if (subItem == '-') {\r\n                                    if ((last = subMenu[subMenu.length - 1]) && last !== '-') {\r\n                                        subMenu.push('-');\r\n                                    } else {\r\n                                        subMenu.splice(subMenu.length - 1);\r\n                                    }\r\n                                } else {\r\n                                    if ((me.commands[subItem.cmdName] || UE.commands[subItem.cmdName] || subItem.query) &&\r\n                                        (subItem.query ? subItem.query() : me.queryCommandState(subItem.cmdName)) > -1) {\r\n                                        subMenu.push({\r\n                                            'label': subItem.label || me.getLang(\"contextMenu.\" + subItem.cmdName + (subItem.value || '')) || \"\",\r\n                                            'className': 'edui-for-' + subItem.cmdName + (subItem.className ? (' edui-for-' + subItem.cmdName + '-' + subItem.className) : ''),\r\n                                            onclick: subItem.exec ? function () {\r\n                                                subItem.exec.call(me);\r\n                                            } : function () {\r\n                                                me.execCommand(subItem.cmdName, subItem.value);\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                }\r\n                            })(cj);\r\n                        }\r\n                        if (subMenu.length) {\r\n                            function getLabel() {\r\n                                switch (item.icon) {\r\n                                    case \"table\":\r\n                                        return me.getLang(\"contextMenu.table\");\r\n                                    case \"justifyjustify\":\r\n                                        return me.getLang(\"contextMenu.paragraph\");\r\n                                    case \"aligntd\":\r\n                                        return me.getLang(\"contextMenu.aligntd\");\r\n                                    case \"aligntable\":\r\n                                        return me.getLang(\"contextMenu.aligntable\");\r\n                                    case \"tablesort\":\r\n                                        return lang.tablesort;\r\n                                    case \"borderBack\":\r\n                                        return lang.borderbk;\r\n                                    default:\r\n                                        return '';\r\n                                }\r\n                            }\r\n                            contextItems.push({\r\n                                //todo 修正成自动获取方式\r\n                                'label': getLabel(),\r\n                                className: 'edui-for-' + item.icon,\r\n                                'subMenu': {\r\n                                    items: subMenu,\r\n                                    editor: me\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                    } else {\r\n                        //有可能commmand没有加载右键不能出来，或者没有command也想能展示出来添加query方法\r\n                        if ((me.commands[item.cmdName] || UE.commands[item.cmdName] || item.query) &&\r\n                            (item.query ? item.query.call(me) : me.queryCommandState(item.cmdName)) > -1) {\r\n\r\n                            contextItems.push({\r\n                                'label': item.label || me.getLang(\"contextMenu.\" + item.cmdName),\r\n                                className: 'edui-for-' + (item.icon ? item.icon : item.cmdName + (item.value || '')),\r\n                                onclick: item.exec ? function () {\r\n                                    item.exec.call(me);\r\n                                } : function () {\r\n                                    me.execCommand(item.cmdName, item.value);\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                    }\r\n\r\n                })(ti);\r\n            }\r\n            if (contextItems[contextItems.length - 1] == '-') {\r\n                contextItems.pop();\r\n            }\r\n\r\n            menu = new UE.ui.Menu({\r\n                items: contextItems,\r\n                className: \"edui-contextmenu\",\r\n                editor: me\r\n            });\r\n            menu.render();\r\n            menu.showAt(offset);\r\n\r\n            me.fireEvent(\"aftershowcontextmenu\", menu);\r\n\r\n            domUtils.preventDefault(evt);\r\n            if (browser.ie) {\r\n                var ieRange;\r\n                try {\r\n                    ieRange = me.selection.getNative().createRange();\r\n                } catch (e) {\r\n                    return;\r\n                }\r\n                if (ieRange.item) {\r\n                    var range = new dom.Range(me.document);\r\n                    range.selectNode(ieRange.item(0)).select(true, true);\r\n                }\r\n            }\r\n        });\r\n\r\n        // 添加复制的flash按钮\r\n        me.addListener('aftershowcontextmenu', function (type, menu) {\r\n            if (me.zeroclipboard) {\r\n                var items = menu.items;\r\n                for (var key in items) {\r\n                    if (items[key].className == 'edui-for-copy') {\r\n                        me.zeroclipboard.clip(items[key].getDom());\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n    };\r\n\r\n\r\n    // plugins/shortcutmenu.js\r\n    ///import core\r\n    ///commands       弹出菜单\r\n    // commandsName  popupmenu\r\n    ///commandsTitle  弹出菜单\r\n    /**\r\n     * 弹出菜单\r\n     * @function\r\n     * @name baidu.editor.plugins.popupmenu\r\n     * @author xuheng\r\n     */\r\n\r\n    UE.plugins['shortcutmenu'] = function () {\r\n        var me = this,\r\n            menu,\r\n            items = me.options.shortcutMenu || [];\r\n\r\n        if (!items.length) {\r\n            return;\r\n        }\r\n\r\n        me.addListener('contextmenu mouseup', function (type, e) {\r\n            var me = this,\r\n                customEvt = {\r\n                    type: type,\r\n                    target: e.target || e.srcElement,\r\n                    screenX: e.screenX,\r\n                    screenY: e.screenY,\r\n                    clientX: e.clientX,\r\n                    clientY: e.clientY\r\n                };\r\n\r\n            setTimeout(function () {\r\n                var rng = me.selection.getRange();\r\n                if (rng.collapsed === false || type == \"contextmenu\") {\r\n\r\n                    if (!menu) {\r\n                        menu = new baidu.editor.ui.ShortCutMenu({\r\n                            editor: me,\r\n                            items: items,\r\n                            theme: me.options.theme,\r\n                            className: 'edui-shortcutmenu'\r\n                        });\r\n\r\n                        menu.render();\r\n                        me.fireEvent(\"afterrendershortcutmenu\", menu);\r\n                    }\r\n\r\n                    menu.show(customEvt, !!UE.plugins['contextmenu']);\r\n                }\r\n            });\r\n\r\n            if (type == 'contextmenu') {\r\n                domUtils.preventDefault(e);\r\n                if (browser.ie9below) {\r\n                    var ieRange;\r\n                    try {\r\n                        ieRange = me.selection.getNative().createRange();\r\n                    } catch (e) {\r\n                        return;\r\n                    }\r\n                    if (ieRange.item) {\r\n                        var range = new dom.Range(me.document);\r\n                        range.selectNode(ieRange.item(0)).select(true, true);\r\n\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        me.addListener('keydown', function (type) {\r\n            if (type == \"keydown\") {\r\n                menu && !menu.isHidden && menu.hide();\r\n            }\r\n\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n\r\n    // plugins/basestyle.js\r\n    /**\r\n     * B、I、sub、super命令支持\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    UE.plugins['basestyle'] = function () {\r\n\r\n        /**\r\n         * 字体加粗\r\n         * @command bold\r\n         * @param { String } cmd 命令字符串\r\n         * @remind 对已加粗的文本内容执行该命令， 将取消加粗\r\n         * @method execCommand\r\n         * @example\r\n         * ```javascript\r\n         * //editor是编辑器实例\r\n         * //对当前选中的文本内容执行加粗操作\r\n         * //第一次执行， 文本内容加粗\r\n         * editor.execCommand( 'bold' );\r\n         *\r\n         * //第二次执行， 文本内容取消加粗\r\n         * editor.execCommand( 'bold' );\r\n         * ```\r\n         */\r\n\r\n\r\n        /**\r\n         * 字体倾斜\r\n         * @command italic\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @remind 对已倾斜的文本内容执行该命令， 将取消倾斜\r\n         * @example\r\n         * ```javascript\r\n         * //editor是编辑器实例\r\n         * //对当前选中的文本内容执行斜体操作\r\n         * //第一次操作， 文本内容将变成斜体\r\n         * editor.execCommand( 'italic' );\r\n         *\r\n         * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n         * editor.execCommand( 'italic' );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 下标文本，与“superscript”命令互斥\r\n         * @command subscript\r\n         * @method execCommand\r\n         * @remind  把选中的文本内容切换成下标文本， 如果当前选中的文本已经是下标， 则该操作会把文本内容还原成正常文本\r\n         * @param { String } cmd 命令字符串\r\n         * @example\r\n         * ```javascript\r\n         * //editor是编辑器实例\r\n         * //对当前选中的文本内容执行下标操作\r\n         * //第一次操作， 文本内容将变成下标文本\r\n         * editor.execCommand( 'subscript' );\r\n         *\r\n         * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n         * editor.execCommand( 'subscript' );\r\n         * ```\r\n         */\r\n\r\n        /**\r\n         * 上标文本，与“subscript”命令互斥\r\n         * @command superscript\r\n         * @method execCommand\r\n         * @remind 把选中的文本内容切换成上标文本， 如果当前选中的文本已经是上标， 则该操作会把文本内容还原成正常文本\r\n         * @param { String } cmd 命令字符串\r\n         * @example\r\n         * ```javascript\r\n         * //editor是编辑器实例\r\n         * //对当前选中的文本内容执行上标操作\r\n         * //第一次操作， 文本内容将变成上标文本\r\n         * editor.execCommand( 'superscript' );\r\n         *\r\n         * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n         * editor.execCommand( 'superscript' );\r\n         * ```\r\n         */\r\n        var basestyles = {\r\n            'bold': ['strong', 'b'],\r\n            'italic': ['em', 'i'],\r\n            'subscript': ['sub'],\r\n            'superscript': ['sup']\r\n        },\r\n            getObj = function (editor, tagNames) {\r\n                return domUtils.filterNodeList(editor.selection.getStartElementPath(), tagNames);\r\n            },\r\n            me = this;\r\n        //添加快捷键\r\n        me.addshortcutkey({\r\n            \"Bold\": \"ctrl+66\",//^B\r\n            \"Italic\": \"ctrl+73\", //^I\r\n            \"Underline\": \"ctrl+85\"//^U\r\n        });\r\n        me.addInputRule(function (root) {\r\n            utils.each(root.getNodesByTagName('b i'), function (node) {\r\n                switch (node.tagName) {\r\n                    case 'b':\r\n                        node.tagName = 'strong';\r\n                        break;\r\n                    case 'i':\r\n                        node.tagName = 'em';\r\n                }\r\n            });\r\n        });\r\n        for (var style in basestyles) {\r\n            (function (cmd, tagNames) {\r\n                me.commands[cmd] = {\r\n                    execCommand: function (cmdName) {\r\n                        var range = me.selection.getRange(), obj = getObj(this, tagNames);\r\n                        if (range.collapsed) {\r\n                            if (obj) {\r\n                                var tmpText = me.document.createTextNode('');\r\n                                range.insertNode(tmpText).removeInlineStyle(tagNames);\r\n                                range.setStartBefore(tmpText);\r\n                                domUtils.remove(tmpText);\r\n                            } else {\r\n                                var tmpNode = range.document.createElement(tagNames[0]);\r\n                                if (cmdName == 'superscript' || cmdName == 'subscript') {\r\n                                    tmpText = me.document.createTextNode('');\r\n                                    range.insertNode(tmpText)\r\n                                        .removeInlineStyle(['sub', 'sup'])\r\n                                        .setStartBefore(tmpText)\r\n                                        .collapse(true);\r\n                                }\r\n                                range.insertNode(tmpNode).setStart(tmpNode, 0);\r\n                            }\r\n                            range.collapse(true);\r\n                        } else {\r\n                            if (cmdName == 'superscript' || cmdName == 'subscript') {\r\n                                if (!obj || obj.tagName.toLowerCase() != cmdName) {\r\n                                    range.removeInlineStyle(['sub', 'sup']);\r\n                                }\r\n                            }\r\n                            obj ? range.removeInlineStyle(tagNames) : range.applyInlineStyle(tagNames[0]);\r\n                        }\r\n                        range.select();\r\n                    },\r\n                    queryCommandState: function () {\r\n                        return getObj(this, tagNames) ? 1 : 0;\r\n                    }\r\n                };\r\n            })(style, basestyles[style]);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // plugins/elementpath.js\r\n    /**\r\n     * 选取路径命令\r\n     * @file\r\n     */\r\n    UE.plugins['elementpath'] = function () {\r\n        var currentLevel,\r\n            tagNames,\r\n            me = this;\r\n        me.setOpt('elementPathEnabled', true);\r\n        if (!me.options.elementPathEnabled) {\r\n            return;\r\n        }\r\n        me.commands['elementpath'] = {\r\n            execCommand: function (cmdName, level) {\r\n                var start = tagNames[level],\r\n                    range = me.selection.getRange();\r\n                currentLevel = level * 1;\r\n                range.selectNode(start).select();\r\n            },\r\n            queryCommandValue: function () {\r\n                //产生一个副本，不能修改原来的startElementPath;\r\n                var parents = [].concat(this.selection.getStartElementPath()).reverse(),\r\n                    names = [];\r\n                tagNames = parents;\r\n                for (var i = 0, ci; ci = parents[i]; i++) {\r\n                    if (ci.nodeType == 3) {\r\n                        continue;\r\n                    }\r\n                    var name = ci.tagName.toLowerCase();\r\n                    if (name == 'img' && ci.getAttribute('anchorname')) {\r\n                        name = 'anchor';\r\n                    }\r\n                    names[i] = name;\r\n                    if (currentLevel == i) {\r\n                        currentLevel = -1;\r\n                        break;\r\n                    }\r\n                }\r\n                return names;\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n\r\n    // plugins/formatmatch.js\r\n    /**\r\n     * 格式刷，只格式inline的\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 格式刷\r\n     * @command formatmatch\r\n     * @method execCommand\r\n     * @remind 该操作不能复制段落格式\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //获取格式刷\r\n     * editor.execCommand( 'formatmatch' );\r\n     * ```\r\n     */\r\n    UE.plugins['formatmatch'] = function () {\r\n\r\n        var me = this,\r\n            list = [], img,\r\n            flag = 0;\r\n\r\n        me.addListener('reset', function () {\r\n            list = [];\r\n            flag = 0;\r\n        });\r\n\r\n        function addList(type, evt) {\r\n\r\n            if (browser.webkit) {\r\n                var target = evt.target.tagName == 'IMG' ? evt.target : null;\r\n            }\r\n\r\n            function addFormat(range) {\r\n\r\n                if (text) {\r\n                    range.selectNode(text);\r\n                }\r\n                return range.applyInlineStyle(list[list.length - 1].tagName, null, list);\r\n\r\n            }\r\n\r\n            me.undoManger && me.undoManger.save();\r\n\r\n            var range = me.selection.getRange(),\r\n                imgT = target || range.getClosedNode();\r\n            if (img && imgT && imgT.tagName == 'IMG') {\r\n                //trace:964\r\n\r\n                imgT.style.cssText += ';float:' + (img.style.cssFloat || img.style.styleFloat || 'none') + ';display:' + (img.style.display || 'inline');\r\n\r\n                img = null;\r\n            } else {\r\n                if (!img) {\r\n                    var collapsed = range.collapsed;\r\n                    if (collapsed) {\r\n                        var text = me.document.createTextNode('match');\r\n                        range.insertNode(text).select();\r\n\r\n\r\n                    }\r\n                    me.__hasEnterExecCommand = true;\r\n                    //不能把block上的属性干掉\r\n                    //trace:1553\r\n                    var removeFormatAttributes = me.options.removeFormatAttributes;\r\n                    me.options.removeFormatAttributes = '';\r\n                    me.execCommand('removeformat');\r\n                    me.options.removeFormatAttributes = removeFormatAttributes;\r\n                    me.__hasEnterExecCommand = false;\r\n                    //trace:969\r\n                    range = me.selection.getRange();\r\n                    if (list.length) {\r\n                        addFormat(range);\r\n                    }\r\n                    if (text) {\r\n                        range.setStartBefore(text).collapse(true);\r\n\r\n                    }\r\n                    range.select();\r\n                    text && domUtils.remove(text);\r\n                }\r\n\r\n            }\r\n\r\n\r\n\r\n\r\n            me.undoManger && me.undoManger.save();\r\n            me.removeListener('mouseup', addList);\r\n            flag = 0;\r\n        }\r\n\r\n        me.commands['formatmatch'] = {\r\n            execCommand: function (cmdName) {\r\n\r\n                if (flag) {\r\n                    flag = 0;\r\n                    list = [];\r\n                    me.removeListener('mouseup', addList);\r\n                    return;\r\n                }\r\n\r\n\r\n\r\n                var range = me.selection.getRange();\r\n                img = range.getClosedNode();\r\n                if (!img || img.tagName != 'IMG') {\r\n                    range.collapse(true).shrinkBoundary();\r\n                    var start = range.startContainer;\r\n                    list = domUtils.findParents(start, true, function (node) {\r\n                        return !domUtils.isBlockElm(node) && node.nodeType == 1;\r\n                    });\r\n                    //a不能加入格式刷, 并且克隆节点\r\n                    for (var i = 0, ci; ci = list[i]; i++) {\r\n                        if (ci.tagName == 'A') {\r\n                            list.splice(i, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                }\r\n\r\n                me.addListener('mouseup', addList);\r\n                flag = 1;\r\n\r\n\r\n            },\r\n            queryCommandState: function () {\r\n                return flag;\r\n            },\r\n            notNeedUndo: 1\r\n        };\r\n    };\r\n\r\n\r\n\r\n    // plugins/searchreplace.js\r\n    ///import core\r\n    ///commands 查找替换\r\n    ///commandsName  SearchReplace\r\n    ///commandsTitle  查询替换\r\n    ///commandsDialog  dialogs\\searchreplace\r\n    /**\r\n     * @description 查找替换\r\n     * @author zhanyi\r\n     */\r\n\r\n    UE.plugin.register('searchreplace', function () {\r\n        var me = this;\r\n\r\n        var _blockElm = { 'table': 1, 'tbody': 1, 'tr': 1, 'ol': 1, 'ul': 1 };\r\n\r\n        function findTextInString(textContent, opt, currentIndex) {\r\n            var str = opt.searchStr;\r\n            if (opt.dir == -1) {\r\n                textContent = textContent.split('').reverse().join('');\r\n                str = str.split('').reverse().join('');\r\n                currentIndex = textContent.length - currentIndex;\r\n\r\n            }\r\n            var reg = new RegExp(str, 'g' + (opt.casesensitive ? '' : 'i')), match;\r\n\r\n            while (match = reg.exec(textContent)) {\r\n                if (match.index >= currentIndex) {\r\n                    return opt.dir == -1 ? textContent.length - match.index - opt.searchStr.length : match.index;\r\n                }\r\n            }\r\n            return -1\r\n        }\r\n        function findTextBlockElm(node, currentIndex, opt) {\r\n            var textContent, index, methodName = opt.all || opt.dir == 1 ? 'getNextDomNode' : 'getPreDomNode';\r\n            if (domUtils.isBody(node)) {\r\n                node = node.firstChild;\r\n            }\r\n            var first = 1;\r\n            while (node) {\r\n                textContent = node.nodeType == 3 ? node.nodeValue : node[browser.ie ? 'innerText' : 'textContent'];\r\n                index = findTextInString(textContent, opt, currentIndex);\r\n                first = 0;\r\n                if (index != -1) {\r\n                    return {\r\n                        'node': node,\r\n                        'index': index\r\n                    }\r\n                }\r\n                node = domUtils[methodName](node);\r\n                while (node && _blockElm[node.nodeName.toLowerCase()]) {\r\n                    node = domUtils[methodName](node, true);\r\n                }\r\n                if (node) {\r\n                    currentIndex = opt.dir == -1 ? (node.nodeType == 3 ? node.nodeValue : node[browser.ie ? 'innerText' : 'textContent']).length : 0;\r\n                }\r\n\r\n            }\r\n        }\r\n        function findNTextInBlockElm(node, index, str) {\r\n            var currentIndex = 0,\r\n                currentNode = node.firstChild,\r\n                currentNodeLength = 0,\r\n                result;\r\n            while (currentNode) {\r\n                if (currentNode.nodeType == 3) {\r\n                    currentNodeLength = currentNode.nodeValue.replace(/(^[\\t\\r\\n]+)|([\\t\\r\\n]+$)/, '').length;\r\n                    currentIndex += currentNodeLength;\r\n                    if (currentIndex >= index) {\r\n                        return {\r\n                            'node': currentNode,\r\n                            'index': currentNodeLength - (currentIndex - index)\r\n                        }\r\n                    }\r\n                } else if (!dtd.$empty[currentNode.tagName]) {\r\n                    currentNodeLength = currentNode[browser.ie ? 'innerText' : 'textContent'].replace(/(^[\\t\\r\\n]+)|([\\t\\r\\n]+$)/, '').length\r\n                    currentIndex += currentNodeLength;\r\n                    if (currentIndex >= index) {\r\n                        result = findNTextInBlockElm(currentNode, currentNodeLength - (currentIndex - index), str);\r\n                        if (result) {\r\n                            return result;\r\n                        }\r\n                    }\r\n                }\r\n                currentNode = domUtils.getNextDomNode(currentNode);\r\n\r\n            }\r\n        }\r\n\r\n        function searchReplace(me, opt) {\r\n\r\n            var rng = me.selection.getRange(),\r\n                startBlockNode,\r\n                searchStr = opt.searchStr,\r\n                span = me.document.createElement('span');\r\n            span.innerHTML = '$$ueditor_searchreplace_key$$';\r\n\r\n            rng.shrinkBoundary(true);\r\n\r\n            //判断是不是第一次选中\r\n            if (!rng.collapsed) {\r\n                rng.select();\r\n                var rngText = me.selection.getText();\r\n                if (new RegExp('^' + opt.searchStr + '$', (opt.casesensitive ? '' : 'i')).test(rngText)) {\r\n                    if (opt.replaceStr != undefined) {\r\n                        replaceText(rng, opt.replaceStr);\r\n                        rng.select();\r\n                        return true;\r\n                    } else {\r\n                        rng.collapse(opt.dir == -1)\r\n                    }\r\n\r\n                }\r\n            }\r\n\r\n\r\n            rng.insertNode(span);\r\n            rng.enlargeToBlockElm(true);\r\n            startBlockNode = rng.startContainer;\r\n            var currentIndex = startBlockNode[browser.ie ? 'innerText' : 'textContent'].indexOf('$$ueditor_searchreplace_key$$');\r\n            rng.setStartBefore(span);\r\n            domUtils.remove(span);\r\n            var result = findTextBlockElm(startBlockNode, currentIndex, opt);\r\n            if (result) {\r\n                var rngStart = findNTextInBlockElm(result.node, result.index, searchStr);\r\n                var rngEnd = findNTextInBlockElm(result.node, result.index + searchStr.length, searchStr);\r\n                rng.setStart(rngStart.node, rngStart.index).setEnd(rngEnd.node, rngEnd.index);\r\n\r\n                if (opt.replaceStr !== undefined) {\r\n                    replaceText(rng, opt.replaceStr)\r\n                }\r\n                rng.select();\r\n                return true;\r\n            } else {\r\n                rng.setCursor()\r\n            }\r\n\r\n        }\r\n        function replaceText(rng, str) {\r\n\r\n            str = me.document.createTextNode(str);\r\n            rng.deleteContents().insertNode(str);\r\n\r\n        }\r\n        return {\r\n            commands: {\r\n                'searchreplace': {\r\n                    execCommand: function (cmdName, opt) {\r\n                        utils.extend(opt, {\r\n                            all: false,\r\n                            casesensitive: false,\r\n                            dir: 1\r\n                        }, true);\r\n                        var num = 0;\r\n                        if (opt.all) {\r\n\r\n                            var rng = me.selection.getRange(),\r\n                                first = me.body.firstChild;\r\n                            if (first && first.nodeType == 1) {\r\n                                rng.setStart(first, 0);\r\n                                rng.shrinkBoundary(true);\r\n                            } else if (first.nodeType == 3) {\r\n                                rng.setStartBefore(first)\r\n                            }\r\n                            rng.collapse(true).select(true);\r\n                            if (opt.replaceStr !== undefined) {\r\n                                me.fireEvent('saveScene');\r\n                            }\r\n                            while (searchReplace(this, opt)) {\r\n                                num++;\r\n                            }\r\n                            if (num) {\r\n                                me.fireEvent('saveScene');\r\n                            }\r\n                        } else {\r\n                            if (opt.replaceStr !== undefined) {\r\n                                me.fireEvent('saveScene');\r\n                            }\r\n                            if (searchReplace(this, opt)) {\r\n                                num++\r\n                            }\r\n                            if (num) {\r\n                                me.fireEvent('saveScene');\r\n                            }\r\n\r\n                        }\r\n\r\n                        return num;\r\n                    },\r\n                    notNeedUndo: 1\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/customstyle.js\r\n    /**\r\n     * 自定义样式\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n    /**\r\n     * 根据config配置文件里“customstyle”选项的值对匹配的标签执行样式替换。\r\n     * @command customstyle\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'customstyle' );\r\n     * ```\r\n     */\r\n    UE.plugins['customstyle'] = function () {\r\n        var me = this;\r\n        me.setOpt({\r\n            'customstyle': [\r\n                { tag: 'h1', name: 'tc', style: 'font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;' },\r\n                { tag: 'h1', name: 'tl', style: 'font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;' },\r\n                { tag: 'span', name: 'im', style: 'font-size:16px;font-style:italic;font-weight:bold;line-height:18px;' },\r\n                { tag: 'span', name: 'hi', style: 'font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;' }\r\n            ]\r\n        });\r\n        me.commands['customstyle'] = {\r\n            execCommand: function (cmdName, obj) {\r\n                var me = this,\r\n                    tagName = obj.tag,\r\n                    node = domUtils.findParent(me.selection.getStart(), function (node) {\r\n                        return node.getAttribute('label');\r\n                    }, true),\r\n                    range, bk, tmpObj = {};\r\n                for (var p in obj) {\r\n                    if (obj[p] !== undefined)\r\n                        tmpObj[p] = obj[p];\r\n                }\r\n                delete tmpObj.tag;\r\n                if (node && node.getAttribute('label') == obj.label) {\r\n                    range = this.selection.getRange();\r\n                    bk = range.createBookmark();\r\n                    if (range.collapsed) {\r\n                        //trace:1732 删掉自定义标签，要有p来回填站位\r\n                        if (dtd.$block[node.tagName]) {\r\n                            var fillNode = me.document.createElement('p');\r\n                            domUtils.moveChild(node, fillNode);\r\n                            node.parentNode.insertBefore(fillNode, node);\r\n                            domUtils.remove(node);\r\n                        } else {\r\n                            domUtils.remove(node, true);\r\n                        }\r\n\r\n                    } else {\r\n\r\n                        var common = domUtils.getCommonAncestor(bk.start, bk.end),\r\n                            nodes = domUtils.getElementsByTagName(common, tagName);\r\n                        if (new RegExp(tagName, 'i').test(common.tagName)) {\r\n                            nodes.push(common);\r\n                        }\r\n                        for (var i = 0, ni; ni = nodes[i++];) {\r\n                            if (ni.getAttribute('label') == obj.label) {\r\n                                var ps = domUtils.getPosition(ni, bk.start), pe = domUtils.getPosition(ni, bk.end);\r\n                                if ((ps & domUtils.POSITION_FOLLOWING || ps & domUtils.POSITION_CONTAINS)\r\n                                    &&\r\n                                    (pe & domUtils.POSITION_PRECEDING || pe & domUtils.POSITION_CONTAINS)\r\n                                )\r\n                                    if (dtd.$block[tagName]) {\r\n                                        var fillNode = me.document.createElement('p');\r\n                                        domUtils.moveChild(ni, fillNode);\r\n                                        ni.parentNode.insertBefore(fillNode, ni);\r\n                                    }\r\n                                domUtils.remove(ni, true);\r\n                            }\r\n                        }\r\n                        node = domUtils.findParent(common, function (node) {\r\n                            return node.getAttribute('label') == obj.label;\r\n                        }, true);\r\n                        if (node) {\r\n\r\n                            domUtils.remove(node, true);\r\n\r\n                        }\r\n\r\n                    }\r\n                    range.moveToBookmark(bk).select();\r\n                } else {\r\n                    if (dtd.$block[tagName]) {\r\n                        this.execCommand('paragraph', tagName, tmpObj, 'customstyle');\r\n                        range = me.selection.getRange();\r\n                        if (!range.collapsed) {\r\n                            range.collapse();\r\n                            node = domUtils.findParent(me.selection.getStart(), function (node) {\r\n                                return node.getAttribute('label') == obj.label;\r\n                            }, true);\r\n                            var pNode = me.document.createElement('p');\r\n                            domUtils.insertAfter(node, pNode);\r\n                            domUtils.fillNode(me.document, pNode);\r\n                            range.setStart(pNode, 0).setCursor();\r\n                        }\r\n                    } else {\r\n\r\n                        range = me.selection.getRange();\r\n                        if (range.collapsed) {\r\n                            node = me.document.createElement(tagName);\r\n                            domUtils.setAttributes(node, tmpObj);\r\n                            range.insertNode(node).setStart(node, 0).setCursor();\r\n\r\n                            return;\r\n                        }\r\n\r\n                        bk = range.createBookmark();\r\n                        range.applyInlineStyle(tagName, tmpObj).moveToBookmark(bk).select();\r\n                    }\r\n                }\r\n\r\n            },\r\n            queryCommandValue: function () {\r\n                var parent = domUtils.filterNodeList(\r\n                    this.selection.getStartElementPath(),\r\n                    function (node) { return node.getAttribute('label') }\r\n                );\r\n                return parent ? parent.getAttribute('label') : '';\r\n            }\r\n        };\r\n        //当去掉customstyle是，如果是块元素，用p代替\r\n        me.addListener('keyup', function (type, evt) {\r\n            var keyCode = evt.keyCode || evt.which;\r\n\r\n            if (keyCode == 32 || keyCode == 13) {\r\n                var range = me.selection.getRange();\r\n                if (range.collapsed) {\r\n                    var node = domUtils.findParent(me.selection.getStart(), function (node) {\r\n                        return node.getAttribute('label');\r\n                    }, true);\r\n                    if (node && dtd.$block[node.tagName] && domUtils.isEmptyNode(node)) {\r\n                        var p = me.document.createElement('p');\r\n                        domUtils.insertAfter(node, p);\r\n                        domUtils.fillNode(me.document, p);\r\n                        domUtils.remove(node);\r\n                        range.setStart(p, 0).setCursor();\r\n\r\n\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    // plugins/catchremoteimage.js\r\n    ///import core\r\n    ///commands 远程图片抓取\r\n    ///commandsName  catchRemoteImage,catchremoteimageenable\r\n    ///commandsTitle  远程图片抓取\r\n    /**\r\n     * 远程图片抓取,当开启本插件时所有不符合本地域名的图片都将被抓取成为本地服务器上的图片\r\n     */\r\n    UE.plugins['catchremoteimage'] = function () {\r\n        var me = this,\r\n            ajax = UE.ajax;\r\n\r\n        /* 设置默认值 */\r\n        if (me.options.catchRemoteImageEnable === false) return;\r\n        me.setOpt({\r\n            catchRemoteImageEnable: false\r\n        });\r\n\r\n        me.addListener(\"afterpaste\", function () {\r\n            me.fireEvent(\"catchRemoteImage\");\r\n        });\r\n\r\n        me.addListener(\"catchRemoteImage\", function () {\r\n\r\n            var catcherLocalDomain = me.getOpt('catcherLocalDomain'),\r\n                catcherActionUrl = me.getActionUrl(me.getOpt('catcherActionName')),\r\n                catcherUrlPrefix = me.getOpt('catcherUrlPrefix'),\r\n                catcherFieldName = me.getOpt('catcherFieldName');\r\n\r\n            var remoteImages = [],\r\n                imgs = domUtils.getElementsByTagName(me.document, \"img\"),\r\n                test = function (src, urls) {\r\n                    if (src.indexOf(location.host) != -1 || /(^\\.)|(^\\/)/.test(src)) {\r\n                        return true;\r\n                    }\r\n                    if (urls) {\r\n                        for (var j = 0, url; url = urls[j++];) {\r\n                            if (src.indexOf(url) !== -1) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                    return false;\r\n                };\r\n\r\n            for (var i = 0, ci; ci = imgs[i++];) {\r\n                if (ci.getAttribute(\"word_img\")) {\r\n                    continue;\r\n                }\r\n                var src = ci.getAttribute(\"_src\") || ci.src || \"\";\r\n                if (/^(https?|ftp):/i.test(src) && !test(src, catcherLocalDomain)) {\r\n                    remoteImages.push(src);\r\n                }\r\n            }\r\n\r\n            if (remoteImages.length) {\r\n                catchremoteimage(remoteImages, {\r\n                    //成功抓取\r\n                    success: function (r) {\r\n                        try {\r\n                            var info = r.state !== undefined ? r : eval(\"(\" + r.responseText + \")\");\r\n                        } catch (e) {\r\n                            return;\r\n                        }\r\n\r\n                        /* 获取源路径和新路径 */\r\n                        var i, j, ci, cj, oldSrc, newSrc, list = info.list;\r\n\r\n                        for (i = 0; ci = imgs[i++];) {\r\n                            oldSrc = ci.getAttribute(\"_src\") || ci.src || \"\";\r\n                            for (j = 0; cj = list[j++];) {\r\n                                if (oldSrc == cj.source && cj.state == \"SUCCESS\") {  //抓取失败时不做替换处理\r\n                                    newSrc = catcherUrlPrefix + cj.url;\r\n                                    domUtils.setAttributes(ci, {\r\n                                        \"src\": newSrc,\r\n                                        \"_src\": newSrc\r\n                                    });\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        me.fireEvent('catchremotesuccess')\r\n                    },\r\n                    //回调失败，本次请求超时\r\n                    error: function () {\r\n                        me.fireEvent(\"catchremoteerror\");\r\n                    }\r\n                });\r\n            }\r\n\r\n            function catchremoteimage(imgs, callbacks) {\r\n                var params = utils.serializeParam(me.queryCommandValue('serverparam')) || '',\r\n                    url = utils.formatUrl(catcherActionUrl + (catcherActionUrl.indexOf('?') == -1 ? '?' : '&') + params),\r\n                    isJsonp = utils.isCrossDomainUrl(url),\r\n                    opt = {\r\n                        'method': 'POST',\r\n                        'dataType': isJsonp ? 'jsonp' : '',\r\n                        'timeout': 60000, //单位：毫秒，回调请求超时设置。目标用户如果网速不是很快的话此处建议设置一个较大的数值\r\n                        'onsuccess': callbacks[\"success\"],\r\n                        'onerror': callbacks[\"error\"]\r\n                    };\r\n                opt[catcherFieldName] = imgs;\r\n                ajax.request(url, opt);\r\n            }\r\n\r\n        });\r\n    };\r\n\r\n    // plugins/snapscreen.js\r\n    /**\r\n     * 截屏插件，为UEditor提供插入支持\r\n     * @file\r\n     * @since 1.4.2\r\n     */\r\n    UE.plugin.register('snapscreen', function () {\r\n\r\n        var me = this;\r\n        var snapplugin;\r\n\r\n        function getLocation(url) {\r\n            var search,\r\n                a = document.createElement('a'),\r\n                params = utils.serializeParam(me.queryCommandValue('serverparam')) || '';\r\n\r\n            a.href = url;\r\n            if (browser.ie) {\r\n                a.href = a.href;\r\n            }\r\n\r\n\r\n            search = a.search;\r\n            if (params) {\r\n                search = search + (search.indexOf('?') == -1 ? '?' : '&') + params;\r\n                search = search.replace(/[&]+/ig, '&');\r\n            }\r\n            return {\r\n                'port': a.port,\r\n                'hostname': a.hostname,\r\n                'path': a.pathname + search || + a.hash\r\n            }\r\n        }\r\n\r\n        return {\r\n            commands: {\r\n                /**\r\n                 * 字体背景颜色\r\n                 * @command snapscreen\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('snapscreen');\r\n                 * ```\r\n                 */\r\n                'snapscreen': {\r\n                    execCommand: function (cmd) {\r\n                        var url, local, res;\r\n                        var lang = me.getLang(\"snapScreen_plugin\");\r\n\r\n                        if (!snapplugin) {\r\n                            var container = me.container;\r\n                            var doc = me.container.ownerDocument || me.container.document;\r\n                            snapplugin = doc.createElement(\"object\");\r\n                            try { snapplugin.type = \"application/x-pluginbaidusnap\"; } catch (e) {\r\n                                return;\r\n                            }\r\n                            snapplugin.style.cssText = \"position:absolute;left:-9999px;width:0;height:0;\";\r\n                            snapplugin.setAttribute(\"width\", \"0\");\r\n                            snapplugin.setAttribute(\"height\", \"0\");\r\n                            container.appendChild(snapplugin);\r\n                        }\r\n\r\n                        function onSuccess(rs) {\r\n                            try {\r\n                                rs = eval(\"(\" + rs + \")\");\r\n                                if (rs.state == 'SUCCESS') {\r\n                                    var opt = me.options;\r\n                                    me.execCommand('insertimage', {\r\n                                        src: opt.snapscreenUrlPrefix + rs.url,\r\n                                        _src: opt.snapscreenUrlPrefix + rs.url,\r\n                                        alt: rs.title || '',\r\n                                        floatStyle: opt.snapscreenImgAlign\r\n                                    });\r\n                                } else {\r\n                                    alert(rs.state);\r\n                                }\r\n                            } catch (e) {\r\n                                alert(lang.callBackErrorMsg);\r\n                            }\r\n                        }\r\n                        url = me.getActionUrl(me.getOpt('snapscreenActionName'));\r\n                        local = getLocation(url);\r\n                        setTimeout(function () {\r\n                            try {\r\n                                res = snapplugin.saveSnapshot(local.hostname, local.path, local.port);\r\n                            } catch (e) {\r\n                                me.ui._dialogs['snapscreenDialog'].open();\r\n                                return;\r\n                            }\r\n\r\n                            onSuccess(res);\r\n                        }, 50);\r\n                    },\r\n                    queryCommandState: function () {\r\n                        return (navigator.userAgent.indexOf(\"Windows\", 0) != -1) ? 0 : -1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // plugins/insertparagraph.js\r\n    /**\r\n     * 插入段落\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n\r\n    /**\r\n     * 插入段落\r\n     * @command insertparagraph\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * editor.execCommand( 'insertparagraph' );\r\n     * ```\r\n     */\r\n\r\n    UE.commands['insertparagraph'] = {\r\n        execCommand: function (cmdName, front) {\r\n            var me = this,\r\n                range = me.selection.getRange(),\r\n                start = range.startContainer, tmpNode;\r\n            while (start) {\r\n                if (domUtils.isBody(start)) {\r\n                    break;\r\n                }\r\n                tmpNode = start;\r\n                start = start.parentNode;\r\n            }\r\n            if (tmpNode) {\r\n                var p = me.document.createElement('p');\r\n                if (front) {\r\n                    tmpNode.parentNode.insertBefore(p, tmpNode)\r\n                } else {\r\n                    tmpNode.parentNode.insertBefore(p, tmpNode.nextSibling)\r\n                }\r\n                domUtils.fillNode(me.document, p);\r\n                range.setStart(p, 0).setCursor(false, true);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // plugins/webapp.js\r\n    /**\r\n     * 百度应用\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n\r\n\r\n    /**\r\n     * 插入百度应用\r\n     * @command webapp\r\n     * @method execCommand\r\n     * @remind 需要百度APPKey\r\n     * @remind 百度应用主页： <a href=\"http://app.baidu.com/\" target=\"_blank\">http://app.baidu.com/</a>\r\n     * @param { Object } appOptions 应用所需的参数项， 支持的key有： title=>应用标题， width=>应用容器宽度，\r\n     * height=>应用容器高度，logo=>应用logo，url=>应用地址\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //在编辑器里插入一个“植物大战僵尸”的APP\r\n     * editor.execCommand( 'webapp' , {\r\n     *     title: '植物大战僵尸',\r\n     *     width: 560,\r\n     *     height: 465,\r\n     *     logo: '应用展示的图片',\r\n     *     url: '百度应用的地址'\r\n     * } );\r\n     * ```\r\n     */\r\n\r\n    //UE.plugins['webapp'] = function () {\r\n    //    var me = this;\r\n    //    function createInsertStr( obj, toIframe, addParagraph ) {\r\n    //        return !toIframe ?\r\n    //                (addParagraph ? '<p>' : '') + '<img title=\"'+obj.title+'\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"' +\r\n    //                        ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" style=\"background:url(' + obj.logo+') no-repeat center center; border:1px solid gray;\" class=\"edui-faked-webapp\" _url=\"' + obj.url + '\" />' +\r\n    //                        (addParagraph ? '</p>' : '')\r\n    //                :\r\n    //                '<iframe class=\"edui-faked-webapp\" title=\"'+obj.title+'\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"  scrolling=\"no\" frameborder=\"0\" src=\"' + obj.url + '\" logo_url = '+obj.logo+'></iframe>';\r\n    //    }\r\n    //\r\n    //    function switchImgAndIframe( img2frame ) {\r\n    //        var tmpdiv,\r\n    //                nodes = domUtils.getElementsByTagName( me.document, !img2frame ? \"iframe\" : \"img\" );\r\n    //        for ( var i = 0, node; node = nodes[i++]; ) {\r\n    //            if ( node.className != \"edui-faked-webapp\" ){\r\n    //                continue;\r\n    //            }\r\n    //            tmpdiv = me.document.createElement( \"div\" );\r\n    //            tmpdiv.innerHTML = createInsertStr( img2frame ? {url:node.getAttribute( \"_url\" ), width:node.width, height:node.height,title:node.title,logo:node.style.backgroundImage.replace(\"url(\",\"\").replace(\")\",\"\")} : {url:node.getAttribute( \"src\", 2 ),title:node.title, width:node.width, height:node.height,logo:node.getAttribute(\"logo_url\")}, img2frame ? true : false,false );\r\n    //            node.parentNode.replaceChild( tmpdiv.firstChild, node );\r\n    //        }\r\n    //    }\r\n    //\r\n    //    me.addListener( \"beforegetcontent\", function () {\r\n    //        switchImgAndIframe( true );\r\n    //    } );\r\n    //    me.addListener( 'aftersetcontent', function () {\r\n    //        switchImgAndIframe( false );\r\n    //    } );\r\n    //    me.addListener( 'aftergetcontent', function ( cmdName ) {\r\n    //        if ( cmdName == 'aftergetcontent' && me.queryCommandState( 'source' ) ){\r\n    //            return;\r\n    //        }\r\n    //        switchImgAndIframe( false );\r\n    //    } );\r\n    //\r\n    //    me.commands['webapp'] = {\r\n    //        execCommand:function ( cmd, obj ) {\r\n    //            me.execCommand( \"inserthtml\", createInsertStr( obj, false,true ) );\r\n    //        }\r\n    //    };\r\n    //};\r\n\r\n    UE.plugin.register('webapp', function () {\r\n        var me = this;\r\n        function createInsertStr(obj, toEmbed) {\r\n            return !toEmbed ?\r\n                '<img title=\"' + obj.title + '\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"' +\r\n                ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" _logo_url=\"' + obj.logo + '\" style=\"background:url(' + obj.logo\r\n                + ') no-repeat center center; border:1px solid gray;\" class=\"edui-faked-webapp\" _url=\"' + obj.url + '\" ' +\r\n                (obj.align && !obj.cssfloat ? 'align=\"' + obj.align + '\"' : '') +\r\n                (obj.cssfloat ? 'style=\"float:' + obj.cssfloat + '\"' : '') +\r\n                '/>'\r\n                :\r\n                '<iframe class=\"edui-faked-webapp\" title=\"' + obj.title + '\" ' +\r\n                (obj.align && !obj.cssfloat ? 'align=\"' + obj.align + '\"' : '') +\r\n                (obj.cssfloat ? 'style=\"float:' + obj.cssfloat + '\"' : '') +\r\n                'width=\"' + obj.width + '\" height=\"' + obj.height + '\"  scrolling=\"no\" frameborder=\"0\" src=\"' + obj.url + '\" logo_url = \"' + obj.logo + '\"></iframe>'\r\n\r\n        }\r\n        return {\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (node) {\r\n                    var html;\r\n                    if (node.getAttr('class') == 'edui-faked-webapp') {\r\n                        html = createInsertStr({\r\n                            title: node.getAttr('title'),\r\n                            'width': node.getAttr('width'),\r\n                            'height': node.getAttr('height'),\r\n                            'align': node.getAttr('align'),\r\n                            'cssfloat': node.getStyle('float'),\r\n                            'url': node.getAttr(\"_url\"),\r\n                            'logo': node.getAttr('_logo_url')\r\n                        }, true);\r\n                        var embed = UE.uNode.createElement(html);\r\n                        node.parentNode.replaceChild(embed, node);\r\n                    }\r\n                })\r\n            },\r\n            inputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('iframe'), function (node) {\r\n                    if (node.getAttr('class') == 'edui-faked-webapp') {\r\n                        var img = UE.uNode.createElement(createInsertStr({\r\n                            title: node.getAttr('title'),\r\n                            'width': node.getAttr('width'),\r\n                            'height': node.getAttr('height'),\r\n                            'align': node.getAttr('align'),\r\n                            'cssfloat': node.getStyle('float'),\r\n                            'url': node.getAttr(\"src\"),\r\n                            'logo': node.getAttr('logo_url')\r\n                        }));\r\n                        node.parentNode.replaceChild(img, node);\r\n                    }\r\n                })\r\n\r\n            },\r\n            commands: {\r\n                /**\r\n                 * 插入百度应用\r\n                 * @command webapp\r\n                 * @method execCommand\r\n                 * @remind 需要百度APPKey\r\n                 * @remind 百度应用主页： <a href=\"http://app.baidu.com/\" target=\"_blank\">http://app.baidu.com/</a>\r\n                 * @param { Object } appOptions 应用所需的参数项， 支持的key有： title=>应用标题， width=>应用容器宽度，\r\n                 * height=>应用容器高度，logo=>应用logo，url=>应用地址\r\n                 * @example\r\n                 * ```javascript\r\n                 * //editor是编辑器实例\r\n                 * //在编辑器里插入一个“植物大战僵尸”的APP\r\n                 * editor.execCommand( 'webapp' , {\r\n                 *     title: '植物大战僵尸',\r\n                 *     width: 560,\r\n                 *     height: 465,\r\n                 *     logo: '应用展示的图片',\r\n                 *     url: '百度应用的地址'\r\n                 * } );\r\n                 * ```\r\n                 */\r\n                'webapp': {\r\n                    execCommand: function (cmd, obj) {\r\n\r\n                        var me = this,\r\n                            str = createInsertStr(utils.extend(obj, {\r\n                                align: 'none'\r\n                            }), false);\r\n                        me.execCommand(\"inserthtml\", str);\r\n                    },\r\n                    queryCommandState: function () {\r\n                        var me = this,\r\n                            img = me.selection.getRange().getClosedNode(),\r\n                            flag = img && (img.className == \"edui-faked-webapp\");\r\n                        return flag ? 1 : 0;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/template.js\r\n    ///import core\r\n    ///import plugins\\inserthtml.js\r\n    ///import plugins\\cleardoc.js\r\n    ///commands 模板\r\n    ///commandsName  template\r\n    ///commandsTitle  模板\r\n    ///commandsDialog  dialogs\\template\r\n    UE.plugins['template'] = function () {\r\n        UE.commands['template'] = {\r\n            execCommand: function (cmd, obj) {\r\n                obj.html && this.execCommand(\"inserthtml\", obj.html);\r\n            }\r\n        };\r\n        this.addListener(\"click\", function (type, evt) {\r\n            var el = evt.target || evt.srcElement,\r\n                range = this.selection.getRange();\r\n            var tnode = domUtils.findParent(el, function (node) {\r\n                if (node.className && domUtils.hasClass(node, \"ue_t\")) {\r\n                    return node;\r\n                }\r\n            }, true);\r\n            tnode && range.selectNode(tnode).shrinkBoundary().select();\r\n        });\r\n        this.addListener(\"keydown\", function (type, evt) {\r\n            var range = this.selection.getRange();\r\n            if (!range.collapsed) {\r\n                if (!evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey) {\r\n                    var tnode = domUtils.findParent(range.startContainer, function (node) {\r\n                        if (node.className && domUtils.hasClass(node, \"ue_t\")) {\r\n                            return node;\r\n                        }\r\n                    }, true);\r\n                    if (tnode) {\r\n                        domUtils.removeClasses(tnode, [\"ue_t\"]);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    // plugins/music.js\r\n    /**\r\n     * 插入音乐命令\r\n     * @file\r\n     */\r\n    UE.plugin.register('music', function () {\r\n        var me = this;\r\n        function creatInsertStr(url, width, height, align, cssfloat, toEmbed) {\r\n            return !toEmbed ?\r\n                '<img ' +\r\n                (align && !cssfloat ? 'align=\"' + align + '\"' : '') +\r\n                (cssfloat ? 'style=\"float:' + cssfloat + '\"' : '') +\r\n                ' width=\"' + width + '\" height=\"' + height + '\" _url=\"' + url + '\" class=\"edui-faked-music\"' +\r\n                ' src=\"' + me.options.langPath + me.options.lang + '/images/music.png\" />'\r\n                :\r\n                '<embed type=\"application/x-shockwave-flash\" class=\"edui-faked-music\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"' +\r\n                ' src=\"' + url + '\" width=\"' + width + '\" height=\"' + height + '\" ' + (align && !cssfloat ? 'align=\"' + align + '\"' : '') +\r\n                (cssfloat ? 'style=\"float:' + cssfloat + '\"' : '') +\r\n                ' wmode=\"transparent\" play=\"true\" loop=\"false\" menu=\"false\" allowscriptaccess=\"never\" allowfullscreen=\"true\" >';\r\n        }\r\n        return {\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (node) {\r\n                    var html;\r\n                    if (node.getAttr('class') == 'edui-faked-music') {\r\n                        var cssfloat = node.getStyle('float');\r\n                        var align = node.getAttr('align');\r\n                        html = creatInsertStr(node.getAttr(\"_url\"), node.getAttr('width'), node.getAttr('height'), align, cssfloat, true);\r\n                        var embed = UE.uNode.createElement(html);\r\n                        node.parentNode.replaceChild(embed, node);\r\n                    }\r\n                })\r\n            },\r\n            inputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('embed'), function (node) {\r\n                    if (node.getAttr('class') == 'edui-faked-music') {\r\n                        var cssfloat = node.getStyle('float');\r\n                        var align = node.getAttr('align');\r\n                        html = creatInsertStr(node.getAttr(\"src\"), node.getAttr('width'), node.getAttr('height'), align, cssfloat, false);\r\n                        var img = UE.uNode.createElement(html);\r\n                        node.parentNode.replaceChild(img, node);\r\n                    }\r\n                })\r\n\r\n            },\r\n            commands: {\r\n                /**\r\n                 * 插入音乐\r\n                 * @command music\r\n                 * @method execCommand\r\n                 * @param { Object } musicOptions 插入音乐的参数项， 支持的key有： url=>音乐地址；\r\n                 * width=>音乐容器宽度；height=>音乐容器高度；align=>音乐文件的对齐方式， 可选值有: left, center, right, none\r\n                 * @example\r\n                 * ```javascript\r\n                 * //editor是编辑器实例\r\n                 * //在编辑器里插入一个“植物大战僵尸”的APP\r\n                 * editor.execCommand( 'music' , {\r\n                 *     width: 400,\r\n                 *     height: 95,\r\n                 *     align: \"center\",\r\n                 *     url: \"音乐地址\"\r\n                 * } );\r\n                 * ```\r\n                 */\r\n                'music': {\r\n                    execCommand: function (cmd, musicObj) {\r\n                        var me = this,\r\n                            str = creatInsertStr(musicObj.url, musicObj.width || 400, musicObj.height || 95, \"none\", false);\r\n                        me.execCommand(\"inserthtml\", str);\r\n                    },\r\n                    queryCommandState: function () {\r\n                        var me = this,\r\n                            img = me.selection.getRange().getClosedNode(),\r\n                            flag = img && (img.className == \"edui-faked-music\");\r\n                        return flag ? 1 : 0;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/autoupload.js\r\n    /**\r\n     * @description\r\n     * 1.拖放文件到编辑区域，自动上传并插入到选区\r\n     * 2.插入粘贴板的图片，自动上传并插入到选区\r\n     * @author Jinqn\r\n     * @date 2013-10-14\r\n     */\r\n    UE.plugin.register('autoupload', function () {\r\n\r\n        function sendAndInsertFile(file, editor) {\r\n            var me = editor;\r\n            //模拟数据\r\n            var fieldName, urlPrefix, maxSize, allowFiles, actionUrl,\r\n                loadingHtml, errorHandler, successHandler,\r\n                filetype = /image\\/\\w+/i.test(file.type) ? 'image' : 'file',\r\n                loadingId = 'loading_' + (+new Date()).toString(36);\r\n\r\n            fieldName = me.getOpt(filetype + 'FieldName');\r\n            urlPrefix = me.getOpt(filetype + 'UrlPrefix');\r\n            maxSize = me.getOpt(filetype + 'MaxSize');\r\n            allowFiles = me.getOpt(filetype + 'AllowFiles');\r\n            actionUrl = me.getActionUrl(me.getOpt(filetype + 'ActionName'));\r\n            errorHandler = function (title) {\r\n                var loader = me.document.getElementById(loadingId);\r\n                loader && domUtils.remove(loader);\r\n                me.fireEvent('showmessage', {\r\n                    'id': loadingId,\r\n                    'content': title,\r\n                    'type': 'error',\r\n                    'timeout': 4000\r\n                });\r\n            };\r\n\r\n            if (filetype == 'image') {\r\n                loadingHtml = '<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' +\r\n                    me.options.themePath + me.options.theme +\r\n                    '/images/spacer.gif\" title=\"' + (me.getLang('autoupload.loading') || '') + '\" >';\r\n                successHandler = function (data) {\r\n                    var link = urlPrefix + data.url,\r\n                        loader = me.document.getElementById(loadingId);\r\n                    if (loader) {\r\n                        loader.setAttribute('src', link);\r\n                        loader.setAttribute('_src', link);\r\n                        loader.setAttribute('title', data.title || '');\r\n                        loader.setAttribute('alt', data.original || '');\r\n                        loader.removeAttribute('id');\r\n                        domUtils.removeClasses(loader, 'loadingclass');\r\n                    }\r\n                };\r\n            } else {\r\n                loadingHtml = '<p>' +\r\n                    '<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' +\r\n                    me.options.themePath + me.options.theme +\r\n                    '/images/spacer.gif\" title=\"' + (me.getLang('autoupload.loading') || '') + '\" >' +\r\n                    '</p>';\r\n                successHandler = function (data) {\r\n                    var link = urlPrefix + data.url,\r\n                        loader = me.document.getElementById(loadingId);\r\n\r\n                    var rng = me.selection.getRange(),\r\n                        bk = rng.createBookmark();\r\n                    rng.selectNode(loader).select();\r\n                    me.execCommand('insertfile', { 'url': link });\r\n                    rng.moveToBookmark(bk).select();\r\n                };\r\n            }\r\n\r\n            /* 插入loading的占位符 */\r\n            me.execCommand('inserthtml', loadingHtml);\r\n\r\n            /* 判断后端配置是否没有加载成功 */\r\n            if (!me.getOpt(filetype + 'ActionName')) {\r\n                errorHandler(me.getLang('autoupload.errorLoadConfig'));\r\n                return;\r\n            }\r\n            /* 判断文件大小是否超出限制 */\r\n            if (file.size > maxSize) {\r\n                errorHandler(me.getLang('autoupload.exceedSizeError'));\r\n                return;\r\n            }\r\n            /* 判断文件格式是否超出允许 */\r\n            var fileext = file.name ? file.name.substr(file.name.lastIndexOf('.')) : '';\r\n            if ((fileext && filetype != 'image') || (allowFiles && (allowFiles.join('') + '.').indexOf(fileext.toLowerCase() + '.') == -1)) {\r\n                errorHandler(me.getLang('autoupload.exceedTypeError'));\r\n                return;\r\n            }\r\n\r\n            /* 创建Ajax并提交 */\r\n            var xhr = new XMLHttpRequest(),\r\n                fd = new FormData(),\r\n                params = utils.serializeParam(me.queryCommandValue('serverparam')) || '',\r\n                url = utils.formatUrl(actionUrl + (actionUrl.indexOf('?') == -1 ? '?' : '&') + params);\r\n\r\n            fd.append(fieldName, file, file.name || ('blob.' + file.type.substr('image/'.length)));\r\n            fd.append('type', 'ajax');\r\n            xhr.open(\"post\", url, true);\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            xhr.addEventListener('load', function (e) {\r\n                try {\r\n                    var json = (new Function(\"return \" + utils.trim(e.target.response)))();\r\n                    if (json.state == 'SUCCESS' && json.url) {\r\n                        successHandler(json);\r\n                    } else {\r\n                        errorHandler(json.state);\r\n                    }\r\n                } catch (er) {\r\n                    errorHandler(me.getLang('autoupload.loadError'));\r\n                }\r\n            });\r\n            xhr.send(fd);\r\n        }\r\n\r\n        function getPasteImage(e) {\r\n            return e.clipboardData && e.clipboardData.items && e.clipboardData.items.length == 1 && /^image\\//.test(e.clipboardData.items[0].type) ? e.clipboardData.items : null;\r\n        }\r\n        function getDropImage(e) {\r\n            return e.dataTransfer && e.dataTransfer.files ? e.dataTransfer.files : null;\r\n        }\r\n\r\n        return {\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (n) {\r\n                    if (/\\b(loaderrorclass)|(bloaderrorclass)\\b/.test(n.getAttr('class'))) {\r\n                        n.parentNode.removeChild(n);\r\n                    }\r\n                });\r\n                utils.each(root.getNodesByTagName('p'), function (n) {\r\n                    if (/\\bloadpara\\b/.test(n.getAttr('class'))) {\r\n                        n.parentNode.removeChild(n);\r\n                    }\r\n                });\r\n            },\r\n            bindEvents: {\r\n                //插入粘贴板的图片，拖放插入图片\r\n                'ready': function (e) {\r\n                    var me = this;\r\n                    if (window.FormData && window.FileReader) {\r\n                        domUtils.on(me.body, 'paste drop', function (e) {\r\n                            var hasImg = false,\r\n                                items;\r\n                            //获取粘贴板文件列表或者拖放文件列表\r\n                            items = e.type == 'paste' ? getPasteImage(e) : getDropImage(e);\r\n                            if (items) {\r\n                                var len = items.length,\r\n                                    file;\r\n                                while (len--) {\r\n                                    file = items[len];\r\n                                    if (file.getAsFile) file = file.getAsFile();\r\n                                    if (file && file.size > 0) {\r\n                                        sendAndInsertFile(file, me);\r\n                                        hasImg = true;\r\n                                    }\r\n                                }\r\n                                hasImg && e.preventDefault();\r\n                            }\r\n\r\n                        });\r\n                        //取消拖放图片时出现的文字光标位置提示\r\n                        domUtils.on(me.body, 'dragover', function (e) {\r\n                            if (e.dataTransfer.types[0] == 'Files') {\r\n                                e.preventDefault();\r\n                            }\r\n                        });\r\n\r\n                        //设置loading的样式\r\n                        utils.cssRule('loading',\r\n                            '.loadingclass{display:inline-block;cursor:default;background: url(\\''\r\n                            + this.options.themePath\r\n                            + this.options.theme + '/images/loading.gif\\') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\\n' +\r\n                            '.loaderrorclass{display:inline-block;cursor:default;background: url(\\''\r\n                            + this.options.themePath\r\n                            + this.options.theme + '/images/loaderror.png\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;' +\r\n                            '}',\r\n                            this.document);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/autosave.js\r\n    UE.plugin.register('autosave', function () {\r\n\r\n        var me = this,\r\n            //无限循环保护\r\n            lastSaveTime = new Date(),\r\n            //最小保存间隔时间\r\n            MIN_TIME = 20,\r\n            //auto save key\r\n            saveKey = null;\r\n\r\n        function save(editor) {\r\n\r\n            var saveData;\r\n\r\n            if (new Date() - lastSaveTime < MIN_TIME) {\r\n                return;\r\n            }\r\n\r\n            if (!editor.hasContents()) {\r\n                //这里不能调用命令来删除， 会造成事件死循环\r\n                saveKey && me.removePreferences(saveKey);\r\n                return;\r\n            }\r\n\r\n            lastSaveTime = new Date();\r\n\r\n            editor._saveFlag = null;\r\n\r\n            saveData = me.body.innerHTML;\r\n\r\n            if (editor.fireEvent(\"beforeautosave\", {\r\n                content: saveData\r\n            }) === false) {\r\n                return;\r\n            }\r\n\r\n            me.setPreferences(saveKey, saveData);\r\n\r\n            editor.fireEvent(\"afterautosave\", {\r\n                content: saveData\r\n            });\r\n\r\n        }\r\n\r\n        return {\r\n            defaultOptions: {\r\n                //默认间隔时间\r\n                saveInterval: 500\r\n            },\r\n            bindEvents: {\r\n                'ready': function () {\r\n\r\n                    var _suffix = \"-drafts-data\",\r\n                        key = null;\r\n\r\n                    if (me.key) {\r\n                        key = me.key + _suffix;\r\n                    } else {\r\n                        key = (me.container.parentNode.id || 'ue-common') + _suffix;\r\n                    }\r\n\r\n                    //页面地址+编辑器ID 保持唯一\r\n                    saveKey = (location.protocol + location.host + location.pathname).replace(/[.:\\/]/g, '_') + key;\r\n\r\n                },\r\n\r\n                'contentchange': function () {\r\n\r\n                    if (!saveKey) {\r\n                        return;\r\n                    }\r\n\r\n                    if (me._saveFlag) {\r\n                        window.clearTimeout(me._saveFlag);\r\n                    }\r\n\r\n                    if (me.options.saveInterval > 0) {\r\n\r\n                        me._saveFlag = window.setTimeout(function () {\r\n\r\n                            save(me);\r\n\r\n                        }, me.options.saveInterval);\r\n\r\n                    } else {\r\n\r\n                        save(me);\r\n\r\n                    }\r\n\r\n\r\n                }\r\n            },\r\n            commands: {\r\n                'clearlocaldata': {\r\n                    execCommand: function (cmd, name) {\r\n                        if (saveKey && me.getPreferences(saveKey)) {\r\n                            me.removePreferences(saveKey)\r\n                        }\r\n                    },\r\n                    notNeedUndo: true,\r\n                    ignoreContentChange: true\r\n                },\r\n\r\n                'getlocaldata': {\r\n                    execCommand: function (cmd, name) {\r\n                        return saveKey ? me.getPreferences(saveKey) || '' : '';\r\n                    },\r\n                    notNeedUndo: true,\r\n                    ignoreContentChange: true\r\n                },\r\n\r\n                'drafts': {\r\n                    execCommand: function (cmd, name) {\r\n                        if (saveKey) {\r\n                            me.body.innerHTML = me.getPreferences(saveKey) || '<p>' + domUtils.fillHtml + '</p>';\r\n                            me.focus(true);\r\n                        }\r\n                    },\r\n                    queryCommandState: function () {\r\n                        return saveKey ? (me.getPreferences(saveKey) === null ? -1 : 0) : -1;\r\n                    },\r\n                    notNeedUndo: true,\r\n                    ignoreContentChange: true\r\n                }\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    // plugins/charts.js\r\n    UE.plugin.register('charts', function () {\r\n\r\n        var me = this;\r\n\r\n        return {\r\n            bindEvents: {\r\n                'chartserror': function () {\r\n                }\r\n            },\r\n            commands: {\r\n                'charts': {\r\n                    execCommand: function (cmd, data) {\r\n\r\n                        var tableNode = domUtils.findParentByTagName(this.selection.getRange().startContainer, 'table', true),\r\n                            flagText = [],\r\n                            config = {};\r\n\r\n                        if (!tableNode) {\r\n                            return false;\r\n                        }\r\n\r\n                        if (!validData(tableNode)) {\r\n                            me.fireEvent(\"chartserror\");\r\n                            return false;\r\n                        }\r\n\r\n                        config.title = data.title || '';\r\n                        config.subTitle = data.subTitle || '';\r\n                        config.xTitle = data.xTitle || '';\r\n                        config.yTitle = data.yTitle || '';\r\n                        config.suffix = data.suffix || '';\r\n                        config.tip = data.tip || '';\r\n                        //数据对齐方式\r\n                        config.dataFormat = data.tableDataFormat || '';\r\n                        //图表类型\r\n                        config.chartType = data.chartType || 0;\r\n\r\n                        for (var key in config) {\r\n\r\n                            if (!config.hasOwnProperty(key)) {\r\n                                continue;\r\n                            }\r\n\r\n                            flagText.push(key + \":\" + config[key]);\r\n\r\n                        }\r\n\r\n                        tableNode.setAttribute(\"data-chart\", flagText.join(\";\"));\r\n                        domUtils.addClass(tableNode, \"edui-charts-table\");\r\n\r\n\r\n\r\n                    },\r\n                    queryCommandState: function (cmd, name) {\r\n\r\n                        var tableNode = domUtils.findParentByTagName(this.selection.getRange().startContainer, 'table', true);\r\n                        return tableNode && validData(tableNode) ? 0 : -1;\r\n\r\n                    }\r\n                }\r\n            },\r\n            inputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('table'), function (tableNode) {\r\n\r\n                    if (tableNode.getAttr(\"data-chart\") !== undefined) {\r\n                        tableNode.setAttr(\"style\");\r\n                    }\r\n\r\n                })\r\n\r\n            },\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('table'), function (tableNode) {\r\n\r\n                    if (tableNode.getAttr(\"data-chart\") !== undefined) {\r\n                        tableNode.setAttr(\"style\", \"display: none;\");\r\n                    }\r\n\r\n                })\r\n\r\n            }\r\n        }\r\n\r\n        function validData(table) {\r\n\r\n            var firstRows = null,\r\n                cellCount = 0;\r\n\r\n            //行数不够\r\n            if (table.rows.length < 2) {\r\n                return false;\r\n            }\r\n\r\n            //列数不够\r\n            if (table.rows[0].cells.length < 2) {\r\n                return false;\r\n            }\r\n\r\n            //第一行所有cell必须是th\r\n            firstRows = table.rows[0].cells;\r\n            cellCount = firstRows.length;\r\n\r\n            for (var i = 0, cell; cell = firstRows[i]; i++) {\r\n\r\n                if (cell.tagName.toLowerCase() !== 'th') {\r\n                    return false;\r\n                }\r\n\r\n            }\r\n\r\n            for (var i = 1, row; row = table.rows[i]; i++) {\r\n\r\n                //每行单元格数不匹配， 返回false\r\n                if (row.cells.length != cellCount) {\r\n                    return false;\r\n                }\r\n\r\n                //第一列不是th也返回false\r\n                if (row.cells[0].tagName.toLowerCase() !== 'th') {\r\n                    return false;\r\n                }\r\n\r\n                for (var j = 1, cell; cell = row.cells[j]; j++) {\r\n\r\n                    var value = utils.trim((cell.innerText || cell.textContent || ''));\r\n\r\n                    value = value.replace(new RegExp(UE.dom.domUtils.fillChar, 'g'), '').replace(/^\\s+|\\s+$/g, '');\r\n\r\n                    //必须是数字\r\n                    if (!/^\\d*\\.?\\d+$/.test(value)) {\r\n                        return false;\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n            return true;\r\n\r\n        }\r\n\r\n    });\r\n\r\n    // plugins/section.js\r\n    /**\r\n     * 目录大纲支持插件\r\n     * @file\r\n     * @since 1.3.0\r\n     */\r\n    UE.plugin.register('section', function () {\r\n        /* 目录节点对象 */\r\n        function Section(option) {\r\n            this.tag = '';\r\n            this.level = -1,\r\n                this.dom = null;\r\n            this.nextSection = null;\r\n            this.previousSection = null;\r\n            this.parentSection = null;\r\n            this.startAddress = [];\r\n            this.endAddress = [];\r\n            this.children = [];\r\n        }\r\n        function getSection(option) {\r\n            var section = new Section();\r\n            return utils.extend(section, option);\r\n        }\r\n        function getNodeFromAddress(startAddress, root) {\r\n            var current = root;\r\n            for (var i = 0; i < startAddress.length; i++) {\r\n                if (!current.childNodes) return null;\r\n                current = current.childNodes[startAddress[i]];\r\n            }\r\n            return current;\r\n        }\r\n\r\n        var me = this;\r\n\r\n        return {\r\n            bindMultiEvents: {\r\n                type: 'aftersetcontent afterscencerestore',\r\n                handler: function () {\r\n                    me.fireEvent('updateSections');\r\n                }\r\n            },\r\n            bindEvents: {\r\n                /* 初始化、拖拽、粘贴、执行setcontent之后 */\r\n                'ready': function () {\r\n                    me.fireEvent('updateSections');\r\n                    domUtils.on(me.body, 'drop paste', function () {\r\n                        me.fireEvent('updateSections');\r\n                    });\r\n                },\r\n                /* 执行paragraph命令之后 */\r\n                'afterexeccommand': function (type, cmd) {\r\n                    if (cmd == 'paragraph') {\r\n                        me.fireEvent('updateSections');\r\n                    }\r\n                },\r\n                /* 部分键盘操作，触发updateSections事件 */\r\n                'keyup': function (type, e) {\r\n                    var me = this,\r\n                        range = me.selection.getRange();\r\n                    if (range.collapsed != true) {\r\n                        me.fireEvent('updateSections');\r\n                    } else {\r\n                        var keyCode = e.keyCode || e.which;\r\n                        if (keyCode == 13 || keyCode == 8 || keyCode == 46) {\r\n                            me.fireEvent('updateSections');\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            commands: {\r\n                'getsections': {\r\n                    execCommand: function (cmd, levels) {\r\n                        var levelFn = levels || ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\r\n\r\n                        for (var i = 0; i < levelFn.length; i++) {\r\n                            if (typeof levelFn[i] == 'string') {\r\n                                levelFn[i] = function (fn) {\r\n                                    return function (node) {\r\n                                        return node.tagName == fn.toUpperCase()\r\n                                    };\r\n                                }(levelFn[i]);\r\n                            } else if (typeof levelFn[i] != 'function') {\r\n                                levelFn[i] = function (node) {\r\n                                    return null;\r\n                                }\r\n                            }\r\n                        }\r\n                        function getSectionLevel(node) {\r\n                            for (var i = 0; i < levelFn.length; i++) {\r\n                                if (levelFn[i](node)) return i;\r\n                            }\r\n                            return -1;\r\n                        }\r\n\r\n                        var me = this,\r\n                            Directory = getSection({ 'level': -1, 'title': 'root' }),\r\n                            previous = Directory;\r\n\r\n                        function traversal(node, Directory) {\r\n                            var level,\r\n                                tmpSection = null,\r\n                                parent,\r\n                                child,\r\n                                children = node.childNodes;\r\n                            for (var i = 0, len = children.length; i < len; i++) {\r\n                                child = children[i];\r\n                                level = getSectionLevel(child);\r\n                                if (level >= 0) {\r\n                                    var address = me.selection.getRange().selectNode(child).createAddress(true).startAddress,\r\n                                        current = getSection({\r\n                                            'tag': child.tagName,\r\n                                            'title': child.innerText || child.textContent || '',\r\n                                            'level': level,\r\n                                            'dom': child,\r\n                                            'startAddress': utils.clone(address, []),\r\n                                            'endAddress': utils.clone(address, []),\r\n                                            'children': []\r\n                                        });\r\n                                    previous.nextSection = current;\r\n                                    current.previousSection = previous;\r\n                                    parent = previous;\r\n                                    while (level <= parent.level) {\r\n                                        parent = parent.parentSection;\r\n                                    }\r\n                                    current.parentSection = parent;\r\n                                    parent.children.push(current);\r\n                                    tmpSection = previous = current;\r\n                                } else {\r\n                                    child.nodeType === 1 && traversal(child, Directory);\r\n                                    tmpSection && tmpSection.endAddress[tmpSection.endAddress.length - 1]++;\r\n                                }\r\n                            }\r\n                        }\r\n                        traversal(me.body, Directory);\r\n                        return Directory;\r\n                    },\r\n                    notNeedUndo: true\r\n                },\r\n                'movesection': {\r\n                    execCommand: function (cmd, sourceSection, targetSection, isAfter) {\r\n\r\n                        var me = this,\r\n                            targetAddress,\r\n                            target;\r\n\r\n                        if (!sourceSection || !targetSection || targetSection.level == -1) return;\r\n\r\n                        targetAddress = isAfter ? targetSection.endAddress : targetSection.startAddress;\r\n                        target = getNodeFromAddress(targetAddress, me.body);\r\n\r\n                        /* 判断目标地址是否被源章节包含 */\r\n                        if (!targetAddress || !target || isContainsAddress(sourceSection.startAddress, sourceSection.endAddress, targetAddress)) return;\r\n\r\n                        var startNode = getNodeFromAddress(sourceSection.startAddress, me.body),\r\n                            endNode = getNodeFromAddress(sourceSection.endAddress, me.body),\r\n                            current,\r\n                            nextNode;\r\n\r\n                        if (isAfter) {\r\n                            current = endNode;\r\n                            while (current && !(domUtils.getPosition(startNode, current) & domUtils.POSITION_FOLLOWING)) {\r\n                                nextNode = current.previousSibling;\r\n                                domUtils.insertAfter(target, current);\r\n                                if (current == startNode) break;\r\n                                current = nextNode;\r\n                            }\r\n                        } else {\r\n                            current = startNode;\r\n                            while (current && !(domUtils.getPosition(current, endNode) & domUtils.POSITION_FOLLOWING)) {\r\n                                nextNode = current.nextSibling;\r\n                                target.parentNode.insertBefore(current, target);\r\n                                if (current == endNode) break;\r\n                                current = nextNode;\r\n                            }\r\n                        }\r\n\r\n                        me.fireEvent('updateSections');\r\n\r\n                        /* 获取地址的包含关系 */\r\n                        function isContainsAddress(startAddress, endAddress, addressTarget) {\r\n                            var isAfterStartAddress = false,\r\n                                isBeforeEndAddress = false;\r\n                            for (var i = 0; i < startAddress.length; i++) {\r\n                                if (i >= addressTarget.length) break;\r\n                                if (addressTarget[i] > startAddress[i]) {\r\n                                    isAfterStartAddress = true;\r\n                                    break;\r\n                                } else if (addressTarget[i] < startAddress[i]) {\r\n                                    break;\r\n                                }\r\n                            }\r\n                            for (var i = 0; i < endAddress.length; i++) {\r\n                                if (i >= addressTarget.length) break;\r\n                                if (addressTarget[i] < startAddress[i]) {\r\n                                    isBeforeEndAddress = true;\r\n                                    break;\r\n                                } else if (addressTarget[i] > startAddress[i]) {\r\n                                    break;\r\n                                }\r\n                            }\r\n                            return isAfterStartAddress && isBeforeEndAddress;\r\n                        }\r\n                    }\r\n                },\r\n                'deletesection': {\r\n                    execCommand: function (cmd, section, keepChildren) {\r\n                        var me = this;\r\n\r\n                        if (!section) return;\r\n\r\n                        function getNodeFromAddress(startAddress) {\r\n                            var current = me.body;\r\n                            for (var i = 0; i < startAddress.length; i++) {\r\n                                if (!current.childNodes) return null;\r\n                                current = current.childNodes[startAddress[i]];\r\n                            }\r\n                            return current;\r\n                        }\r\n\r\n                        var startNode = getNodeFromAddress(section.startAddress),\r\n                            endNode = getNodeFromAddress(section.endAddress),\r\n                            current = startNode,\r\n                            nextNode;\r\n\r\n                        if (!keepChildren) {\r\n                            while (current && domUtils.inDoc(endNode, me.document) && !(domUtils.getPosition(current, endNode) & domUtils.POSITION_FOLLOWING)) {\r\n                                nextNode = current.nextSibling;\r\n                                domUtils.remove(current);\r\n                                current = nextNode;\r\n                            }\r\n                        } else {\r\n                            domUtils.remove(current);\r\n                        }\r\n\r\n                        me.fireEvent('updateSections');\r\n                    }\r\n                },\r\n                'selectsection': {\r\n                    execCommand: function (cmd, section) {\r\n                        if (!section && !section.dom) return false;\r\n                        var me = this,\r\n                            range = me.selection.getRange(),\r\n                            address = {\r\n                                'startAddress': utils.clone(section.startAddress, []),\r\n                                'endAddress': utils.clone(section.endAddress, [])\r\n                            };\r\n                        address.endAddress[address.endAddress.length - 1]++;\r\n                        range.moveToAddress(address).select().scrollToView();\r\n                        return true;\r\n                    },\r\n                    notNeedUndo: true\r\n                },\r\n                'scrolltosection': {\r\n                    execCommand: function (cmd, section) {\r\n                        if (!section && !section.dom) return false;\r\n                        var me = this,\r\n                            range = me.selection.getRange(),\r\n                            address = {\r\n                                'startAddress': section.startAddress,\r\n                                'endAddress': section.endAddress\r\n                            };\r\n                        address.endAddress[address.endAddress.length - 1]++;\r\n                        range.moveToAddress(address).scrollToView();\r\n                        return true;\r\n                    },\r\n                    notNeedUndo: true\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/simpleupload.js\r\n    /**\r\n     * @description\r\n     * 简单上传:点击按钮,直接选择文件上传\r\n     * @author Jinqn\r\n     * @date 2014-03-31\r\n     */\r\n    UE.plugin.register('simpleupload', function () {\r\n        var me = this,\r\n            isLoaded = false,\r\n            containerBtn;\r\n\r\n        function initUploadBtn() {\r\n            var w = containerBtn.offsetWidth || 20,\r\n                h = containerBtn.offsetHeight || 20,\r\n                btnIframe = document.createElement('iframe'),\r\n                btnStyle = 'display:block;width:' + w + 'px;height:' + h + 'px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;';\r\n\r\n            domUtils.on(btnIframe, 'load', function () {\r\n\r\n                var timestrap = (+new Date()).toString(36),\r\n                    wrapper,\r\n                    btnIframeDoc,\r\n                    btnIframeBody;\r\n\r\n                btnIframeDoc = (btnIframe.contentDocument || btnIframe.contentWindow.document);\r\n                btnIframeBody = btnIframeDoc.body;\r\n                wrapper = btnIframeDoc.createElement('div');\r\n\r\n                wrapper.innerHTML = '<form id=\"edui_form_' + timestrap + '\" target=\"edui_iframe_' + timestrap + '\" method=\"POST\" enctype=\"multipart/form-data\" action=\"' + me.getOpt('serverUrl') + '\" ' +\r\n                    'style=\"' + btnStyle + '\">' +\r\n                    '<input id=\"edui_input_' + timestrap + '\" type=\"file\" accept=\"image/*\" name=\"' + me.options.imageFieldName + '\" ' +\r\n                    'style=\"' + btnStyle + '\">' +\r\n                    '</form>' +\r\n                    '<iframe id=\"edui_iframe_' + timestrap + '\" name=\"edui_iframe_' + timestrap + '\" style=\"display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;\"></iframe>';\r\n\r\n                wrapper.className = 'edui-' + me.options.theme;\r\n                wrapper.id = me.ui.id + '_iframeupload';\r\n                btnIframeBody.style.cssText = btnStyle;\r\n                btnIframeBody.style.width = w + 'px';\r\n                btnIframeBody.style.height = h + 'px';\r\n                btnIframeBody.appendChild(wrapper);\r\n\r\n                if (btnIframeBody.parentNode) {\r\n                    btnIframeBody.parentNode.style.width = w + 'px';\r\n                    btnIframeBody.parentNode.style.height = w + 'px';\r\n                }\r\n\r\n                var form = btnIframeDoc.getElementById('edui_form_' + timestrap);\r\n                var input = btnIframeDoc.getElementById('edui_input_' + timestrap);\r\n                var iframe = btnIframeDoc.getElementById('edui_iframe_' + timestrap);\r\n\r\n                domUtils.on(input, 'change', function () {\r\n                    if (!input.value) return;\r\n                    var loadingId = 'loading_' + (+new Date()).toString(36);\r\n                    var params = utils.serializeParam(me.queryCommandValue('serverparam')) || '';\r\n\r\n                    var imageActionUrl = me.getActionUrl(me.getOpt('imageActionName'));\r\n                    var allowFiles = me.getOpt('imageAllowFiles');\r\n\r\n                    me.focus();\r\n                    me.execCommand('inserthtml', '<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' + me.options.themePath + me.options.theme + '/images/spacer.gif\" title=\"' + (me.getLang('simpleupload.loading') || '') + '\" >');\r\n\r\n                    function callback() {\r\n                        try {\r\n                            var link, json, loader,\r\n                                body = (iframe.contentDocument || iframe.contentWindow.document).body,\r\n                                result = body.innerText || body.textContent || '';\r\n                            json = (new Function(\"return \" + result))();\r\n                            // console.log(json,result,33333333333333);\r\n                            json.url = json.data[0].imageurl;\r\n                            json.state = json.result;\r\n                            link = me.options.imageUrlPrefix + json.url;\r\n                            if ((json.state == 'SUCCESS' || json.state == 'success') && json.url) {\r\n                                loader = me.document.getElementById(loadingId);\r\n                                loader.setAttribute('src', link);\r\n                                loader.setAttribute('_src', link);\r\n                                loader.setAttribute('title', json.title || '');\r\n                                loader.setAttribute('alt', json.original || '');\r\n                                loader.removeAttribute('id');\r\n                                domUtils.removeClasses(loader, 'loadingclass');\r\n                            } else {\r\n                                showErrorLoader && showErrorLoader(json.state);\r\n                            }\r\n                        } catch (er) {\r\n                            showErrorLoader && showErrorLoader(me.getLang('simpleupload.loadError'));\r\n                        }\r\n                        form.reset();\r\n                        domUtils.un(iframe, 'load', callback);\r\n                    }\r\n                    function showErrorLoader(title) {\r\n                        if (loadingId) {\r\n                            var loader = me.document.getElementById(loadingId);\r\n                            loader && domUtils.remove(loader);\r\n                            me.fireEvent('showmessage', {\r\n                                'id': loadingId,\r\n                                'content': title,\r\n                                'type': 'error',\r\n                                'timeout': 4000\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    /* 判断后端配置是否没有加载成功 */\r\n                    if (!me.getOpt('imageActionName')) {\r\n                        errorHandler(me.getLang('autoupload.errorLoadConfig'));\r\n                        return;\r\n                    }\r\n                    // 判断文件格式是否错误\r\n                    var filename = input.value,\r\n                        fileext = filename ? filename.substr(filename.lastIndexOf('.')) : '';\r\n                    if (!fileext || (allowFiles && (allowFiles.join('') + '.').indexOf(fileext.toLowerCase() + '.') == -1)) {\r\n                        showErrorLoader(me.getLang('simpleupload.exceedTypeError'));\r\n                        return;\r\n                    }\r\n\r\n                    domUtils.on(iframe, 'load', callback);\r\n                    form.action = utils.formatUrl(imageActionUrl + (imageActionUrl.indexOf('?') == -1 ? '?' : '&') + params);\r\n                    form.submit();\r\n                });\r\n\r\n                var stateTimer;\r\n                me.addListener('selectionchange', function () {\r\n                    clearTimeout(stateTimer);\r\n                    stateTimer = setTimeout(function () {\r\n                        var state = me.queryCommandState('simpleupload');\r\n                        if (state == -1) {\r\n                            input.disabled = 'disabled';\r\n                        } else {\r\n                            input.disabled = false;\r\n                        }\r\n                    }, 400);\r\n                });\r\n                isLoaded = true;\r\n            });\r\n\r\n            btnIframe.style.cssText = btnStyle;\r\n            containerBtn.appendChild(btnIframe);\r\n        }\r\n\r\n        return {\r\n            bindEvents: {\r\n                'ready': function () {\r\n                    //设置loading的样式\r\n                    utils.cssRule('loading',\r\n                        '.loadingclass{display:inline-block;cursor:default;background: url(\\''\r\n                        + this.options.themePath\r\n                        + this.options.theme + '/images/loading.gif\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\\n' +\r\n                        '.loaderrorclass{display:inline-block;cursor:default;background: url(\\''\r\n                        + this.options.themePath\r\n                        + this.options.theme + '/images/loaderror.png\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;' +\r\n                        '}',\r\n                        this.document);\r\n                },\r\n                /* 初始化简单上传按钮 */\r\n                'simpleuploadbtnready': function (type, container) {\r\n                    containerBtn = container;\r\n                    me.afterConfigReady(initUploadBtn);\r\n                }\r\n            },\r\n            outputRule: function (root) {\r\n                utils.each(root.getNodesByTagName('img'), function (n) {\r\n                    if (/\\b(loaderrorclass)|(bloaderrorclass)\\b/.test(n.getAttr('class'))) {\r\n                        n.parentNode.removeChild(n);\r\n                    }\r\n                });\r\n            },\r\n            commands: {\r\n                'simpleupload': {\r\n                    queryCommandState: function () {\r\n                        return isLoaded ? 0 : -1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // plugins/serverparam.js\r\n    /**\r\n     * 服务器提交的额外参数列表设置插件\r\n     * @file\r\n     * @since 1.2.6.1\r\n     */\r\n    UE.plugin.register('serverparam', function () {\r\n\r\n        var me = this,\r\n            serverParam = {};\r\n\r\n        return {\r\n            commands: {\r\n                /**\r\n                 * 修改服务器提交的额外参数列表,清除所有项\r\n                 * @command serverparam\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('serverparam');\r\n                 * editor.queryCommandValue('serverparam'); //返回空\r\n                 * ```\r\n                 */\r\n                /**\r\n                 * 修改服务器提交的额外参数列表,删除指定项\r\n                 * @command serverparam\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @param { String } key 要清除的属性\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('serverparam', 'name'); //删除属性name\r\n                 * ```\r\n                 */\r\n                /**\r\n                 * 修改服务器提交的额外参数列表,使用键值添加项\r\n                 * @command serverparam\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @param { String } key 要添加的属性\r\n                 * @param { String } value 要添加属性的值\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('serverparam', 'name', 'hello');\r\n                 * editor.queryCommandValue('serverparam'); //返回对象 {'name': 'hello'}\r\n                 * ```\r\n                 */\r\n                /**\r\n                 * 修改服务器提交的额外参数列表,传入键值对对象添加多项\r\n                 * @command serverparam\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @param { Object } key 传入的键值对对象\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('serverparam', {'name': 'hello'});\r\n                 * editor.queryCommandValue('serverparam'); //返回对象 {'name': 'hello'}\r\n                 * ```\r\n                 */\r\n                /**\r\n                 * 修改服务器提交的额外参数列表,使用自定义函数添加多项\r\n                 * @command serverparam\r\n                 * @method execCommand\r\n                 * @param { String } cmd 命令字符串\r\n                 * @param { Function } key 自定义获取参数的函数\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.execCommand('serverparam', function(editor){\r\n                 *     return {'key': 'value'};\r\n                 * });\r\n                 * editor.queryCommandValue('serverparam'); //返回对象 {'key': 'value'}\r\n                 * ```\r\n                 */\r\n\r\n                /**\r\n                 * 获取服务器提交的额外参数列表\r\n                 * @command serverparam\r\n                 * @method queryCommandValue\r\n                 * @param { String } cmd 命令字符串\r\n                 * @example\r\n                 * ```javascript\r\n                 * editor.queryCommandValue( 'serverparam' ); //返回对象 {'key': 'value'}\r\n                 * ```\r\n                 */\r\n                'serverparam': {\r\n                    execCommand: function (cmd, key, value) {\r\n                        if (key === undefined || key === null) { //不传参数,清空列表\r\n                            serverParam = {};\r\n                        } else if (utils.isString(key)) { //传入键值\r\n                            if (value === undefined || value === null) {\r\n                                delete serverParam[key];\r\n                            } else {\r\n                                serverParam[key] = value;\r\n                            }\r\n                        } else if (utils.isObject(key)) { //传入对象,覆盖列表项\r\n                            utils.extend(serverParam, key, true);\r\n                        } else if (utils.isFunction(key)) { //传入函数,添加列表项\r\n                            utils.extend(serverParam, key(), true);\r\n                        }\r\n                    },\r\n                    queryCommandValue: function () {\r\n                        return serverParam || {};\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // plugins/insertfile.js\r\n    /**\r\n     * 插入附件\r\n     */\r\n    UE.plugin.register('insertfile', function () {\r\n\r\n        var me = this;\r\n\r\n        function getFileIcon(url) {\r\n            var ext = url.substr(url.lastIndexOf('.') + 1).toLowerCase(),\r\n                maps = {\r\n                    \"rar\": \"icon_rar.gif\",\r\n                    \"zip\": \"icon_rar.gif\",\r\n                    \"tar\": \"icon_rar.gif\",\r\n                    \"gz\": \"icon_rar.gif\",\r\n                    \"bz2\": \"icon_rar.gif\",\r\n                    \"doc\": \"icon_doc.gif\",\r\n                    \"docx\": \"icon_doc.gif\",\r\n                    \"pdf\": \"icon_pdf.gif\",\r\n                    \"mp3\": \"icon_mp3.gif\",\r\n                    \"xls\": \"icon_xls.gif\",\r\n                    \"chm\": \"icon_chm.gif\",\r\n                    \"ppt\": \"icon_ppt.gif\",\r\n                    \"pptx\": \"icon_ppt.gif\",\r\n                    \"avi\": \"icon_mv.gif\",\r\n                    \"rmvb\": \"icon_mv.gif\",\r\n                    \"wmv\": \"icon_mv.gif\",\r\n                    \"flv\": \"icon_mv.gif\",\r\n                    \"swf\": \"icon_mv.gif\",\r\n                    \"rm\": \"icon_mv.gif\",\r\n                    \"exe\": \"icon_exe.gif\",\r\n                    \"psd\": \"icon_psd.gif\",\r\n                    \"txt\": \"icon_txt.gif\",\r\n                    \"jpg\": \"icon_jpg.gif\",\r\n                    \"png\": \"icon_jpg.gif\",\r\n                    \"jpeg\": \"icon_jpg.gif\",\r\n                    \"gif\": \"icon_jpg.gif\",\r\n                    \"ico\": \"icon_jpg.gif\",\r\n                    \"bmp\": \"icon_jpg.gif\"\r\n                };\r\n            return maps[ext] ? maps[ext] : maps['txt'];\r\n        }\r\n\r\n        return {\r\n            commands: {\r\n                'insertfile': {\r\n                    execCommand: function (command, filelist) {\r\n                        filelist = utils.isArray(filelist) ? filelist : [filelist];\r\n                        // console.log(filelist,3333333333);\r\n                        var i, item, icon, title,\r\n                            html = '',\r\n                            URL = me.getOpt('UEDITOR_HOME_URL'),\r\n                            iconDir = URL + (URL.substr(URL.length - 1) == '/' ? '' : '/') + 'dialogs/attachment/fileTypeImages/';\r\n                        for (i = 0; i < filelist.length; i++) {\r\n                            item = filelist[i];\r\n                            icon = iconDir + getFileIcon(item.url);\r\n                            title = item.title || item.url.substr(item.url.lastIndexOf('/') + 1);\r\n                            html += '<p style=\"line-height: 16px;\">' +\r\n                                '<img style=\"vertical-align: middle; margin-right: 2px;\" src=\"' + icon + '\" _src=\"' + icon + '\" />' +\r\n                                '<a style=\"font-size:12px; color:#0066cc;\" href=\"' + item.url + '\" title=\"' + title + '\">' + title + '</a>' +\r\n                                '</p>';\r\n                        }\r\n                        me.execCommand('insertHtml', html);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    // plugins/xssFilter.js\r\n    /**\r\n     * @file xssFilter.js\r\n     * @desc xss过滤器\r\n     * @author robbenmu\r\n     */\r\n\r\n    UE.plugins.xssFilter = function () {\r\n\r\n        var config = UEDITOR_CONFIG;\r\n        var whitList = config.whitList;\r\n\r\n        function filter(node) {\r\n\r\n            var tagName = node.tagName;\r\n            var attrs = node.attrs;\r\n\r\n            if (!whitList.hasOwnProperty(tagName)) {\r\n                node.parentNode.removeChild(node);\r\n                return false;\r\n            }\r\n\r\n            UE.utils.each(attrs, function (val, key) {\r\n\r\n                if (whitList[tagName].indexOf(key) === -1) {\r\n                    node.setAttr(key);\r\n                }\r\n            });\r\n        }\r\n\r\n        // 添加inserthtml\\paste等操作用的过滤规则\r\n        if (whitList && config.xssFilterRules) {\r\n            this.options.filterRules = function () {\r\n\r\n                var result = {};\r\n\r\n                UE.utils.each(whitList, function (val, key) {\r\n                    result[key] = function (node) {\r\n                        return filter(node);\r\n                    };\r\n                });\r\n\r\n                return result;\r\n            }();\r\n        }\r\n\r\n        var tagList = [];\r\n\r\n        UE.utils.each(whitList, function (val, key) {\r\n            tagList.push(key);\r\n        });\r\n\r\n        // 添加input过滤规则\r\n        //\r\n        if (whitList && config.inputXssFilter) {\r\n            this.addInputRule(function (root) {\r\n\r\n                root.traversal(function (node) {\r\n                    if (node.type !== 'element') {\r\n                        return false;\r\n                    }\r\n                    filter(node);\r\n                });\r\n            });\r\n        }\r\n        // 添加output过滤规则\r\n        //\r\n        if (whitList && config.outputXssFilter) {\r\n            this.addOutputRule(function (root) {\r\n\r\n                root.traversal(function (node) {\r\n                    if (node.type !== 'element') {\r\n                        return false;\r\n                    }\r\n                    filter(node);\r\n                });\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n\r\n    // ui/ui.js\r\n    var baidu = baidu || {};\r\n    baidu.editor = baidu.editor || {};\r\n    UE.ui = baidu.editor.ui = {};\r\n\r\n    // ui/uiutils.js\r\n    (function () {\r\n        var browser = baidu.editor.browser,\r\n            domUtils = baidu.editor.dom.domUtils;\r\n\r\n        var magic = '$EDITORUI';\r\n        var root = window[magic] = {};\r\n        var uidMagic = 'ID' + magic;\r\n        var uidCount = 0;\r\n\r\n        var uiUtils = baidu.editor.ui.uiUtils = {\r\n            uid: function (obj) {\r\n                return (obj ? obj[uidMagic] || (obj[uidMagic] = ++uidCount) : ++uidCount);\r\n            },\r\n            hook: function (fn, callback) {\r\n                var dg;\r\n                if (fn && fn._callbacks) {\r\n                    dg = fn;\r\n                } else {\r\n                    dg = function () {\r\n                        var q;\r\n                        if (fn) {\r\n                            q = fn.apply(this, arguments);\r\n                        }\r\n                        var callbacks = dg._callbacks;\r\n                        var k = callbacks.length;\r\n                        while (k--) {\r\n                            var r = callbacks[k].apply(this, arguments);\r\n                            if (q === undefined) {\r\n                                q = r;\r\n                            }\r\n                        }\r\n                        return q;\r\n                    };\r\n                    dg._callbacks = [];\r\n                }\r\n                dg._callbacks.push(callback);\r\n                return dg;\r\n            },\r\n            createElementByHtml: function (html) {\r\n                var el = document.createElement('div');\r\n                el.innerHTML = html;\r\n                el = el.firstChild;\r\n                el.parentNode.removeChild(el);\r\n                return el;\r\n            },\r\n            getViewportElement: function () {\r\n                return (browser.ie && browser.quirks) ?\r\n                    document.body : document.documentElement;\r\n            },\r\n            getClientRect: function (element) {\r\n                var bcr;\r\n                //trace  IE6下在控制编辑器显隐时可能会报错，catch一下\r\n                try {\r\n                    bcr = element.getBoundingClientRect();\r\n                } catch (e) {\r\n                    bcr = { left: 0, top: 0, height: 0, width: 0 }\r\n                }\r\n                var rect = {\r\n                    left: Math.round(bcr.left),\r\n                    top: Math.round(bcr.top),\r\n                    height: Math.round(bcr.bottom - bcr.top),\r\n                    width: Math.round(bcr.right - bcr.left)\r\n                };\r\n                var doc;\r\n                while ((doc = element.ownerDocument) !== document &&\r\n                    (element = domUtils.getWindow(doc).frameElement)) {\r\n                    bcr = element.getBoundingClientRect();\r\n                    rect.left += bcr.left;\r\n                    rect.top += bcr.top;\r\n                }\r\n                rect.bottom = rect.top + rect.height;\r\n                rect.right = rect.left + rect.width;\r\n                return rect;\r\n            },\r\n            getViewportRect: function () {\r\n                var viewportEl = uiUtils.getViewportElement();\r\n                var width = (window.innerWidth || viewportEl.clientWidth) | 0;\r\n                var height = (window.innerHeight || viewportEl.clientHeight) | 0;\r\n                return {\r\n                    left: 0,\r\n                    top: 0,\r\n                    height: height,\r\n                    width: width,\r\n                    bottom: height,\r\n                    right: width\r\n                };\r\n            },\r\n            setViewportOffset: function (element, offset) {\r\n                var rect;\r\n                var fixedLayer = uiUtils.getFixedLayer();\r\n                if (element.parentNode === fixedLayer) {\r\n                    element.style.left = offset.left + 'px';\r\n                    element.style.top = offset.top + 'px';\r\n                } else {\r\n                    domUtils.setViewportOffset(element, offset);\r\n                }\r\n            },\r\n            getEventOffset: function (evt) {\r\n                var el = evt.target || evt.srcElement;\r\n                var rect = uiUtils.getClientRect(el);\r\n                var offset = uiUtils.getViewportOffsetByEvent(evt);\r\n                return {\r\n                    left: offset.left - rect.left,\r\n                    top: offset.top - rect.top\r\n                };\r\n            },\r\n            getViewportOffsetByEvent: function (evt) {\r\n                var el = evt.target || evt.srcElement;\r\n                var frameEl = domUtils.getWindow(el).frameElement;\r\n                var offset = {\r\n                    left: evt.clientX,\r\n                    top: evt.clientY\r\n                };\r\n                if (frameEl && el.ownerDocument !== document) {\r\n                    var rect = uiUtils.getClientRect(frameEl);\r\n                    offset.left += rect.left;\r\n                    offset.top += rect.top;\r\n                }\r\n                return offset;\r\n            },\r\n            setGlobal: function (id, obj) {\r\n                root[id] = obj;\r\n                return magic + '[\"' + id + '\"]';\r\n            },\r\n            unsetGlobal: function (id) {\r\n                delete root[id];\r\n            },\r\n            copyAttributes: function (tgt, src) {\r\n                var attributes = src.attributes;\r\n                var k = attributes.length;\r\n                while (k--) {\r\n                    var attrNode = attributes[k];\r\n                    if (attrNode.nodeName != 'style' && attrNode.nodeName != 'class' && (!browser.ie || attrNode.specified)) {\r\n                        tgt.setAttribute(attrNode.nodeName, attrNode.nodeValue);\r\n                    }\r\n                }\r\n                if (src.className) {\r\n                    domUtils.addClass(tgt, src.className);\r\n                }\r\n                if (src.style.cssText) {\r\n                    tgt.style.cssText += ';' + src.style.cssText;\r\n                }\r\n            },\r\n            removeStyle: function (el, styleName) {\r\n                if (el.style.removeProperty) {\r\n                    el.style.removeProperty(styleName);\r\n                } else if (el.style.removeAttribute) {\r\n                    el.style.removeAttribute(styleName);\r\n                } else throw '';\r\n            },\r\n            contains: function (elA, elB) {\r\n                return elA && elB && (elA === elB ? false : (\r\n                    elA.contains ? elA.contains(elB) :\r\n                        elA.compareDocumentPosition(elB) & 16\r\n                ));\r\n            },\r\n            startDrag: function (evt, callbacks, doc) {\r\n                var doc = doc || document;\r\n                var startX = evt.clientX;\r\n                var startY = evt.clientY;\r\n                function handleMouseMove(evt) {\r\n                    var x = evt.clientX - startX;\r\n                    var y = evt.clientY - startY;\r\n                    callbacks.ondragmove(x, y, evt);\r\n                    if (evt.stopPropagation) {\r\n                        evt.stopPropagation();\r\n                    } else {\r\n                        evt.cancelBubble = true;\r\n                    }\r\n                }\r\n                if (doc.addEventListener) {\r\n                    function handleMouseUp(evt) {\r\n                        doc.removeEventListener('mousemove', handleMouseMove, true);\r\n                        doc.removeEventListener('mouseup', handleMouseUp, true);\r\n                        window.removeEventListener('mouseup', handleMouseUp, true);\r\n                        callbacks.ondragstop();\r\n                    }\r\n                    doc.addEventListener('mousemove', handleMouseMove, true);\r\n                    doc.addEventListener('mouseup', handleMouseUp, true);\r\n                    window.addEventListener('mouseup', handleMouseUp, true);\r\n\r\n                    evt.preventDefault();\r\n                } else {\r\n                    var elm = evt.srcElement;\r\n                    elm.setCapture();\r\n                    function releaseCaptrue() {\r\n                        elm.releaseCapture();\r\n                        elm.detachEvent('onmousemove', handleMouseMove);\r\n                        elm.detachEvent('onmouseup', releaseCaptrue);\r\n                        elm.detachEvent('onlosecaptrue', releaseCaptrue);\r\n                        callbacks.ondragstop();\r\n                    }\r\n                    elm.attachEvent('onmousemove', handleMouseMove);\r\n                    elm.attachEvent('onmouseup', releaseCaptrue);\r\n                    elm.attachEvent('onlosecaptrue', releaseCaptrue);\r\n                    evt.returnValue = false;\r\n                }\r\n                callbacks.ondragstart();\r\n            },\r\n            getFixedLayer: function () {\r\n                var layer = document.getElementById('edui_fixedlayer');\r\n                if (layer == null) {\r\n                    layer = document.createElement('div');\r\n                    layer.id = 'edui_fixedlayer';\r\n                    document.body.appendChild(layer);\r\n                    if (browser.ie && browser.version <= 8) {\r\n                        layer.style.position = 'absolute';\r\n                        bindFixedLayer();\r\n                        setTimeout(updateFixedOffset);\r\n                    } else {\r\n                        layer.style.position = 'fixed';\r\n                    }\r\n                    layer.style.left = '0';\r\n                    layer.style.top = '0';\r\n                    layer.style.width = '0';\r\n                    layer.style.height = '0';\r\n                }\r\n                return layer;\r\n            },\r\n            makeUnselectable: function (element) {\r\n                if (browser.opera || (browser.ie && browser.version < 9)) {\r\n                    element.unselectable = 'on';\r\n                    if (element.hasChildNodes()) {\r\n                        for (var i = 0; i < element.childNodes.length; i++) {\r\n                            if (element.childNodes[i].nodeType == 1) {\r\n                                uiUtils.makeUnselectable(element.childNodes[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (element.style.MozUserSelect !== undefined) {\r\n                        element.style.MozUserSelect = 'none';\r\n                    } else if (element.style.WebkitUserSelect !== undefined) {\r\n                        element.style.WebkitUserSelect = 'none';\r\n                    } else if (element.style.KhtmlUserSelect !== undefined) {\r\n                        element.style.KhtmlUserSelect = 'none';\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        function updateFixedOffset() {\r\n            var layer = document.getElementById('edui_fixedlayer');\r\n            uiUtils.setViewportOffset(layer, {\r\n                left: 0,\r\n                top: 0\r\n            });\r\n            //        layer.style.display = 'none';\r\n            //        layer.style.display = 'block';\r\n\r\n            //#trace: 1354\r\n            //        setTimeout(updateFixedOffset);\r\n        }\r\n        function bindFixedLayer(adjOffset) {\r\n            domUtils.on(window, 'scroll', updateFixedOffset);\r\n            domUtils.on(window, 'resize', baidu.editor.utils.defer(updateFixedOffset, 0, true));\r\n        }\r\n    })();\r\n\r\n\r\n    // ui/uibase.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            EventBase = baidu.editor.EventBase,\r\n            UIBase = baidu.editor.ui.UIBase = function () {\r\n            };\r\n\r\n        UIBase.prototype = {\r\n            className: '',\r\n            uiName: '',\r\n            initOptions: function (options) {\r\n                var me = this;\r\n                for (var k in options) {\r\n                    me[k] = options[k];\r\n                }\r\n                this.id = this.id || 'edui' + uiUtils.uid();\r\n            },\r\n            initUIBase: function () {\r\n                this._globalKey = utils.unhtml(uiUtils.setGlobal(this.id, this));\r\n            },\r\n            render: function (holder) {\r\n                var html = this.renderHtml();\r\n                var el = uiUtils.createElementByHtml(html);\r\n\r\n                //by xuheng 给每个node添加class\r\n                var list = domUtils.getElementsByTagName(el, \"*\");\r\n                var theme = \"edui-\" + (this.theme || this.editor.options.theme);\r\n                var layer = document.getElementById('edui_fixedlayer');\r\n                for (var i = 0, node; node = list[i++];) {\r\n                    domUtils.addClass(node, theme);\r\n                }\r\n                domUtils.addClass(el, theme);\r\n                if (layer) {\r\n                    layer.className = \"\";\r\n                    domUtils.addClass(layer, theme);\r\n                }\r\n\r\n                var seatEl = this.getDom();\r\n                if (seatEl != null) {\r\n                    seatEl.parentNode.replaceChild(el, seatEl);\r\n                    uiUtils.copyAttributes(el, seatEl);\r\n                } else {\r\n                    if (typeof holder == 'string') {\r\n                        holder = document.getElementById(holder);\r\n                    }\r\n                    holder = holder || uiUtils.getFixedLayer();\r\n                    domUtils.addClass(holder, theme);\r\n                    holder.appendChild(el);\r\n                }\r\n                this.postRender();\r\n            },\r\n            getDom: function (name) {\r\n                if (!name) {\r\n                    return document.getElementById(this.id);\r\n                } else {\r\n                    return document.getElementById(this.id + '_' + name);\r\n                }\r\n            },\r\n            postRender: function () {\r\n                this.fireEvent('postrender');\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '';\r\n            },\r\n            formatHtml: function (tpl) {\r\n                var prefix = 'edui-' + this.uiName;\r\n                return (tpl\r\n                    .replace(/##/g, this.id)\r\n                    .replace(/%%-/g, this.uiName ? prefix + '-' : '')\r\n                    .replace(/%%/g, (this.uiName ? prefix : '') + ' ' + this.className)\r\n                    .replace(/\\$\\$/g, this._globalKey));\r\n            },\r\n            renderHtml: function () {\r\n                return this.formatHtml(this.getHtmlTpl());\r\n            },\r\n            dispose: function () {\r\n                var box = this.getDom();\r\n                if (box) baidu.editor.dom.domUtils.remove(box);\r\n                uiUtils.unsetGlobal(this.id);\r\n            }\r\n        };\r\n        utils.inherits(UIBase, EventBase);\r\n    })();\r\n\r\n\r\n    // ui/separator.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Separator = baidu.editor.ui.Separator = function (options) {\r\n                this.initOptions(options);\r\n                this.initSeparator();\r\n            };\r\n        Separator.prototype = {\r\n            uiName: 'separator',\r\n            initSeparator: function () {\r\n                this.initUIBase();\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-box %%\"></div>';\r\n            }\r\n        };\r\n        utils.inherits(Separator, UIBase);\r\n\r\n    })();\r\n\r\n\r\n    // ui/mask.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            uiUtils = baidu.editor.ui.uiUtils;\r\n\r\n        var Mask = baidu.editor.ui.Mask = function (options) {\r\n            this.initOptions(options);\r\n            this.initUIBase();\r\n        };\r\n        Mask.prototype = {\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-mask %%\" onclick=\"return $$._onClick(event, this);\" onmousedown=\"return $$._onMouseDown(event, this);\"></div>';\r\n            },\r\n            postRender: function () {\r\n                var me = this;\r\n                domUtils.on(window, 'resize', function () {\r\n                    setTimeout(function () {\r\n                        if (!me.isHidden()) {\r\n                            me._fill();\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n            show: function (zIndex) {\r\n                this._fill();\r\n                this.getDom().style.display = '';\r\n                this.getDom().style.zIndex = zIndex;\r\n            },\r\n            hide: function () {\r\n                this.getDom().style.display = 'none';\r\n                this.getDom().style.zIndex = '';\r\n            },\r\n            isHidden: function () {\r\n                return this.getDom().style.display == 'none';\r\n            },\r\n            _onMouseDown: function () {\r\n                return false;\r\n            },\r\n            _onClick: function (e, target) {\r\n                this.fireEvent('click', e, target);\r\n            },\r\n            _fill: function () {\r\n                var el = this.getDom();\r\n                var vpRect = uiUtils.getViewportRect();\r\n                el.style.width = vpRect.width + 'px';\r\n                el.style.height = vpRect.height + 'px';\r\n            }\r\n        };\r\n        utils.inherits(Mask, UIBase);\r\n    })();\r\n\r\n\r\n    // ui/popup.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Popup = baidu.editor.ui.Popup = function (options) {\r\n                this.initOptions(options);\r\n                this.initPopup();\r\n            };\r\n\r\n        var allPopups = [];\r\n        function closeAllPopup(evt, el) {\r\n            for (var i = 0; i < allPopups.length; i++) {\r\n                var pop = allPopups[i];\r\n                if (!pop.isHidden()) {\r\n                    if (pop.queryAutoHide(el) !== false) {\r\n                        if (evt && /scroll/ig.test(evt.type) && pop.className == \"edui-wordpastepop\") return;\r\n                        pop.hide();\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (allPopups.length)\r\n                pop.editor.fireEvent(\"afterhidepop\");\r\n        }\r\n\r\n        Popup.postHide = closeAllPopup;\r\n\r\n        var ANCHOR_CLASSES = ['edui-anchor-topleft', 'edui-anchor-topright',\r\n            'edui-anchor-bottomleft', 'edui-anchor-bottomright'];\r\n        Popup.prototype = {\r\n            SHADOW_RADIUS: 5,\r\n            content: null,\r\n            _hidden: false,\r\n            autoRender: true,\r\n            canSideLeft: true,\r\n            canSideUp: true,\r\n            initPopup: function () {\r\n                this.initUIBase();\r\n                allPopups.push(this);\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-popup %%\" onmousedown=\"return false;\">' +\r\n                    ' <div id=\"##_body\" class=\"edui-popup-body\">' +\r\n                    ' <iframe style=\"position:absolute;z-index:-1;left:0;top:0;background-color: transparent;\" frameborder=\"0\" width=\"100%\" height=\"100%\" src=\"about:blank\"></iframe>' +\r\n                    ' <div class=\"edui-shadow\"></div>' +\r\n                    ' <div id=\"##_content\" class=\"edui-popup-content\">' +\r\n                    this.getContentHtmlTpl() +\r\n                    '  </div>' +\r\n                    ' </div>' +\r\n                    '</div>';\r\n            },\r\n            getContentHtmlTpl: function () {\r\n                if (this.content) {\r\n                    if (typeof this.content == 'string') {\r\n                        return this.content;\r\n                    }\r\n                    return this.content.renderHtml();\r\n                } else {\r\n                    return ''\r\n                }\r\n\r\n            },\r\n            _UIBase_postRender: UIBase.prototype.postRender,\r\n            postRender: function () {\r\n\r\n\r\n                if (this.content instanceof UIBase) {\r\n                    this.content.postRender();\r\n                }\r\n\r\n                //捕获鼠标滚轮\r\n                if (this.captureWheel && !this.captured) {\r\n\r\n                    this.captured = true;\r\n\r\n                    var winHeight = (document.documentElement.clientHeight || document.body.clientHeight) - 80,\r\n                        _height = this.getDom().offsetHeight,\r\n                        _top = uiUtils.getClientRect(this.combox.getDom()).top,\r\n                        content = this.getDom('content'),\r\n                        ifr = this.getDom('body').getElementsByTagName('iframe'),\r\n                        me = this;\r\n\r\n                    ifr.length && (ifr = ifr[0]);\r\n\r\n                    while (_top + _height > winHeight) {\r\n                        _height -= 30;\r\n                    }\r\n                    content.style.height = _height + 'px';\r\n                    //同步更改iframe高度\r\n                    ifr && (ifr.style.height = _height + 'px');\r\n\r\n                    //阻止在combox上的鼠标滚轮事件, 防止用户的正常操作被误解\r\n                    if (window.XMLHttpRequest) {\r\n\r\n                        domUtils.on(content, ('onmousewheel' in document.body) ? 'mousewheel' : 'DOMMouseScroll', function (e) {\r\n\r\n                            if (e.preventDefault) {\r\n                                e.preventDefault();\r\n                            } else {\r\n                                e.returnValue = false;\r\n                            }\r\n\r\n                            if (e.wheelDelta) {\r\n\r\n                                content.scrollTop -= (e.wheelDelta / 120) * 60;\r\n\r\n                            } else {\r\n\r\n                                content.scrollTop -= (e.detail / -3) * 60;\r\n\r\n                            }\r\n\r\n                        });\r\n\r\n                    } else {\r\n\r\n                        //ie6\r\n                        domUtils.on(this.getDom(), 'mousewheel', function (e) {\r\n\r\n                            e.returnValue = false;\r\n\r\n                            me.getDom('content').scrollTop -= (e.wheelDelta / 120) * 60;\r\n\r\n                        });\r\n\r\n                    }\r\n\r\n                }\r\n                this.fireEvent('postRenderAfter');\r\n                this.hide(true);\r\n                this._UIBase_postRender();\r\n            },\r\n            _doAutoRender: function () {\r\n                if (!this.getDom() && this.autoRender) {\r\n                    this.render();\r\n                }\r\n            },\r\n            mesureSize: function () {\r\n                var box = this.getDom('content');\r\n                return uiUtils.getClientRect(box);\r\n            },\r\n            fitSize: function () {\r\n                if (this.captureWheel && this.sized) {\r\n                    return this.__size;\r\n                }\r\n                this.sized = true;\r\n                var popBodyEl = this.getDom('body');\r\n                popBodyEl.style.width = '';\r\n                popBodyEl.style.height = '';\r\n                var size = this.mesureSize();\r\n                if (this.captureWheel) {\r\n                    popBodyEl.style.width = -(-20 - size.width) + 'px';\r\n                    var height = parseInt(this.getDom('content').style.height, 10);\r\n                    !window.isNaN(height) && (size.height = height);\r\n                } else {\r\n                    popBodyEl.style.width = size.width + 'px';\r\n                }\r\n                popBodyEl.style.height = size.height + 'px';\r\n                this.__size = size;\r\n                this.captureWheel && (this.getDom('content').style.overflow = 'auto');\r\n                return size;\r\n            },\r\n            showAnchor: function (element, hoz) {\r\n                this.showAnchorRect(uiUtils.getClientRect(element), hoz);\r\n            },\r\n            showAnchorRect: function (rect, hoz, adj) {\r\n                this._doAutoRender();\r\n                var vpRect = uiUtils.getViewportRect();\r\n                this.getDom().style.visibility = 'hidden';\r\n                this._show();\r\n                var popSize = this.fitSize();\r\n\r\n                var sideLeft, sideUp, left, top;\r\n                if (hoz) {\r\n                    sideLeft = this.canSideLeft && (rect.right + popSize.width > vpRect.right && rect.left > popSize.width);\r\n                    sideUp = this.canSideUp && (rect.top + popSize.height > vpRect.bottom && rect.bottom > popSize.height);\r\n                    left = (sideLeft ? rect.left - popSize.width : rect.right);\r\n                    top = (sideUp ? rect.bottom - popSize.height : rect.top);\r\n                } else {\r\n                    sideLeft = this.canSideLeft && (rect.right + popSize.width > vpRect.right && rect.left > popSize.width);\r\n                    sideUp = this.canSideUp && (rect.top + popSize.height > vpRect.bottom && rect.bottom > popSize.height);\r\n                    left = (sideLeft ? rect.right - popSize.width : rect.left);\r\n                    top = (sideUp ? rect.top - popSize.height : rect.bottom);\r\n                }\r\n\r\n                var popEl = this.getDom();\r\n                uiUtils.setViewportOffset(popEl, {\r\n                    left: left,\r\n                    top: top\r\n                });\r\n                domUtils.removeClasses(popEl, ANCHOR_CLASSES);\r\n                popEl.className += ' ' + ANCHOR_CLASSES[(sideUp ? 1 : 0) * 2 + (sideLeft ? 1 : 0)];\r\n                if (this.editor) {\r\n                    popEl.style.zIndex = this.editor.container.style.zIndex * 1 + 10;\r\n                    baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex = popEl.style.zIndex - 1;\r\n                }\r\n                this.getDom().style.visibility = 'visible';\r\n\r\n            },\r\n            showAt: function (offset) {\r\n                var left = offset.left;\r\n                var top = offset.top;\r\n                var rect = {\r\n                    left: left,\r\n                    top: top,\r\n                    right: left,\r\n                    bottom: top,\r\n                    height: 0,\r\n                    width: 0\r\n                };\r\n                this.showAnchorRect(rect, false, true);\r\n            },\r\n            _show: function () {\r\n                if (this._hidden) {\r\n                    var box = this.getDom();\r\n                    box.style.display = '';\r\n                    this._hidden = false;\r\n                    //                if (box.setActive) {\r\n                    //                    box.setActive();\r\n                    //                }\r\n                    this.fireEvent('show');\r\n                }\r\n            },\r\n            isHidden: function () {\r\n                return this._hidden;\r\n            },\r\n            show: function () {\r\n                this._doAutoRender();\r\n                this._show();\r\n            },\r\n            hide: function (notNofity) {\r\n                if (!this._hidden && this.getDom()) {\r\n                    this.getDom().style.display = 'none';\r\n                    this._hidden = true;\r\n                    if (!notNofity) {\r\n                        this.fireEvent('hide');\r\n                    }\r\n                }\r\n            },\r\n            queryAutoHide: function (el) {\r\n                return !el || !uiUtils.contains(this.getDom(), el);\r\n            }\r\n        };\r\n        utils.inherits(Popup, UIBase);\r\n\r\n        domUtils.on(document, 'mousedown', function (evt) {\r\n            var el = evt.target || evt.srcElement;\r\n            closeAllPopup(evt, el);\r\n        });\r\n        domUtils.on(window, 'scroll', function (evt, el) {\r\n            closeAllPopup(evt, el);\r\n        });\r\n\r\n    })();\r\n\r\n\r\n    // ui/colorpicker.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            ColorPicker = baidu.editor.ui.ColorPicker = function (options) {\r\n                this.initOptions(options);\r\n                this.noColorText = this.noColorText || this.editor.getLang(\"clearColor\");\r\n                this.initUIBase();\r\n            };\r\n\r\n        ColorPicker.prototype = {\r\n            getHtmlTpl: function () {\r\n                return genColorPicker(this.noColorText, this.editor);\r\n            },\r\n            _onTableClick: function (evt) {\r\n                var tgt = evt.target || evt.srcElement;\r\n                var color = tgt.getAttribute('data-color');\r\n                if (color) {\r\n                    this.fireEvent('pickcolor', color);\r\n                }\r\n            },\r\n            _onTableOver: function (evt) {\r\n                var tgt = evt.target || evt.srcElement;\r\n                var color = tgt.getAttribute('data-color');\r\n                if (color) {\r\n                    this.getDom('preview').style.backgroundColor = color;\r\n                }\r\n            },\r\n            _onTableOut: function () {\r\n                this.getDom('preview').style.backgroundColor = '';\r\n            },\r\n            _onPickNoColor: function () {\r\n                this.fireEvent('picknocolor');\r\n            }\r\n        };\r\n        utils.inherits(ColorPicker, UIBase);\r\n\r\n        var COLORS = (\r\n            'ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,' +\r\n            'f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,' +\r\n            'd8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,' +\r\n            'bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,' +\r\n            'a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,' +\r\n            '7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,' +\r\n            'c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,').split(',');\r\n\r\n        function genColorPicker(noColorText, editor) {\r\n            var html = '<div id=\"##\" class=\"edui-colorpicker %%\">' +\r\n                '<div class=\"edui-colorpicker-topbar edui-clearfix\">' +\r\n                '<div unselectable=\"on\" id=\"##_preview\" class=\"edui-colorpicker-preview\"></div>' +\r\n                '<div unselectable=\"on\" class=\"edui-colorpicker-nocolor\" onclick=\"$$._onPickNoColor(event, this);\">' + noColorText + '</div>' +\r\n                '</div>' +\r\n                '<table  class=\"edui-box\" style=\"border-collapse: collapse;\" onmouseover=\"$$._onTableOver(event, this);\" onmouseout=\"$$._onTableOut(event, this);\" onclick=\"return $$._onTableClick(event, this);\" cellspacing=\"0\" cellpadding=\"0\">' +\r\n                '<tr style=\"border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px\"><td colspan=\"10\">' + editor.getLang(\"themeColor\") + '</td> </tr>' +\r\n                '<tr class=\"edui-colorpicker-tablefirstrow\" >';\r\n            for (var i = 0; i < COLORS.length; i++) {\r\n                if (i && i % 10 === 0) {\r\n                    html += '</tr>' + (i == 60 ? '<tr style=\"border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;\"><td colspan=\"10\">' + editor.getLang(\"standardColor\") + '</td></tr>' : '') + '<tr' + (i == 60 ? ' class=\"edui-colorpicker-tablefirstrow\"' : '') + '>';\r\n                }\r\n                html += i < 70 ? '<td style=\"padding: 0 2px;\"><a hidefocus title=\"' + COLORS[i] + '\" onclick=\"return false;\" href=\"javascript:\" unselectable=\"on\" class=\"edui-box edui-colorpicker-colorcell\"' +\r\n                    ' data-color=\"#' + COLORS[i] + '\"' +\r\n                    ' style=\"background-color:#' + COLORS[i] + ';border:solid #ccc;' +\r\n                    (i < 10 || i >= 60 ? 'border-width:1px;' :\r\n                        i >= 10 && i < 20 ? 'border-width:1px 1px 0 1px;' :\r\n\r\n                            'border-width:0 1px 0 1px;') +\r\n                    '\"' +\r\n                    '></a></td>' : '';\r\n            }\r\n            html += '</tr></table></div>';\r\n            return html;\r\n        }\r\n    })();\r\n\r\n\r\n    // ui/tablepicker.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            UIBase = baidu.editor.ui.UIBase;\r\n\r\n        var TablePicker = baidu.editor.ui.TablePicker = function (options) {\r\n            this.initOptions(options);\r\n            this.initTablePicker();\r\n        };\r\n        TablePicker.prototype = {\r\n            defaultNumRows: 10,\r\n            defaultNumCols: 10,\r\n            maxNumRows: 20,\r\n            maxNumCols: 20,\r\n            numRows: 10,\r\n            numCols: 10,\r\n            lengthOfCellSide: 22,\r\n            initTablePicker: function () {\r\n                this.initUIBase();\r\n            },\r\n            getHtmlTpl: function () {\r\n                var me = this;\r\n                return '<div id=\"##\" class=\"edui-tablepicker %%\">' +\r\n                    '<div class=\"edui-tablepicker-body\">' +\r\n                    '<div class=\"edui-infoarea\">' +\r\n                    '<span id=\"##_label\" class=\"edui-label\"></span>' +\r\n                    '</div>' +\r\n                    '<div class=\"edui-pickarea\"' +\r\n                    ' onmousemove=\"$$._onMouseMove(event, this);\"' +\r\n                    ' onmouseover=\"$$._onMouseOver(event, this);\"' +\r\n                    ' onmouseout=\"$$._onMouseOut(event, this);\"' +\r\n                    ' onclick=\"$$._onClick(event, this);\"' +\r\n                    '>' +\r\n                    '<div id=\"##_overlay\" class=\"edui-overlay\"></div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>';\r\n            },\r\n            _UIBase_render: UIBase.prototype.render,\r\n            render: function (holder) {\r\n                this._UIBase_render(holder);\r\n                this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_row\") + ' x 0' + this.editor.getLang(\"t_col\");\r\n            },\r\n            _track: function (numCols, numRows) {\r\n                var style = this.getDom('overlay').style;\r\n                var sideLen = this.lengthOfCellSide;\r\n                style.width = numCols * sideLen + 'px';\r\n                style.height = numRows * sideLen + 'px';\r\n                var label = this.getDom('label');\r\n                label.innerHTML = numCols + this.editor.getLang(\"t_col\") + ' x ' + numRows + this.editor.getLang(\"t_row\");\r\n                this.numCols = numCols;\r\n                this.numRows = numRows;\r\n            },\r\n            _onMouseOver: function (evt, el) {\r\n                var rel = evt.relatedTarget || evt.fromElement;\r\n                if (!uiUtils.contains(el, rel) && el !== rel) {\r\n                    this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_col\") + ' x 0' + this.editor.getLang(\"t_row\");\r\n                    this.getDom('overlay').style.visibility = '';\r\n                }\r\n            },\r\n            _onMouseOut: function (evt, el) {\r\n                var rel = evt.relatedTarget || evt.toElement;\r\n                if (!uiUtils.contains(el, rel) && el !== rel) {\r\n                    this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_col\") + ' x 0' + this.editor.getLang(\"t_row\");\r\n                    this.getDom('overlay').style.visibility = 'hidden';\r\n                }\r\n            },\r\n            _onMouseMove: function (evt, el) {\r\n                var style = this.getDom('overlay').style;\r\n                var offset = uiUtils.getEventOffset(evt);\r\n                var sideLen = this.lengthOfCellSide;\r\n                var numCols = Math.ceil(offset.left / sideLen);\r\n                var numRows = Math.ceil(offset.top / sideLen);\r\n                this._track(numCols, numRows);\r\n            },\r\n            _onClick: function () {\r\n                this.fireEvent('picktable', this.numCols, this.numRows);\r\n            }\r\n        };\r\n        utils.inherits(TablePicker, UIBase);\r\n    })();\r\n\r\n\r\n    // ui/stateful.js\r\n    (function () {\r\n        var browser = baidu.editor.browser,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            uiUtils = baidu.editor.ui.uiUtils;\r\n\r\n        var TPL_STATEFUL = 'onmousedown=\"$$.Stateful_onMouseDown(event, this);\"' +\r\n            ' onmouseup=\"$$.Stateful_onMouseUp(event, this);\"' +\r\n            (browser.ie ? (\r\n                ' onmouseenter=\"$$.Stateful_onMouseEnter(event, this);\"' +\r\n                ' onmouseleave=\"$$.Stateful_onMouseLeave(event, this);\"')\r\n                : (\r\n                    ' onmouseover=\"$$.Stateful_onMouseOver(event, this);\"' +\r\n                    ' onmouseout=\"$$.Stateful_onMouseOut(event, this);\"'));\r\n\r\n        baidu.editor.ui.Stateful = {\r\n            alwalysHoverable: false,\r\n            target: null,//目标元素和this指向dom不一样\r\n            Stateful_init: function () {\r\n                this._Stateful_dGetHtmlTpl = this.getHtmlTpl;\r\n                this.getHtmlTpl = this.Stateful_getHtmlTpl;\r\n            },\r\n            Stateful_getHtmlTpl: function () {\r\n                var tpl = this._Stateful_dGetHtmlTpl();\r\n                // 使用function避免$转义\r\n                return tpl.replace(/stateful/g, function () { return TPL_STATEFUL; });\r\n            },\r\n            Stateful_onMouseEnter: function (evt, el) {\r\n                this.target = el;\r\n                if (!this.isDisabled() || this.alwalysHoverable) {\r\n                    this.addState('hover');\r\n                    this.fireEvent('over');\r\n                }\r\n            },\r\n            Stateful_onMouseLeave: function (evt, el) {\r\n                if (!this.isDisabled() || this.alwalysHoverable) {\r\n                    this.removeState('hover');\r\n                    this.removeState('active');\r\n                    this.fireEvent('out');\r\n                }\r\n            },\r\n            Stateful_onMouseOver: function (evt, el) {\r\n                var rel = evt.relatedTarget;\r\n                if (!uiUtils.contains(el, rel) && el !== rel) {\r\n                    this.Stateful_onMouseEnter(evt, el);\r\n                }\r\n            },\r\n            Stateful_onMouseOut: function (evt, el) {\r\n                var rel = evt.relatedTarget;\r\n                if (!uiUtils.contains(el, rel) && el !== rel) {\r\n                    this.Stateful_onMouseLeave(evt, el);\r\n                }\r\n            },\r\n            Stateful_onMouseDown: function (evt, el) {\r\n                if (!this.isDisabled()) {\r\n                    this.addState('active');\r\n                }\r\n            },\r\n            Stateful_onMouseUp: function (evt, el) {\r\n                if (!this.isDisabled()) {\r\n                    this.removeState('active');\r\n                }\r\n            },\r\n            Stateful_postRender: function () {\r\n                if (this.disabled && !this.hasState('disabled')) {\r\n                    this.addState('disabled');\r\n                }\r\n            },\r\n            hasState: function (state) {\r\n                return domUtils.hasClass(this.getStateDom(), 'edui-state-' + state);\r\n            },\r\n            addState: function (state) {\r\n                if (!this.hasState(state)) {\r\n                    this.getStateDom().className += ' edui-state-' + state;\r\n                }\r\n            },\r\n            removeState: function (state) {\r\n                if (this.hasState(state)) {\r\n                    domUtils.removeClasses(this.getStateDom(), ['edui-state-' + state]);\r\n                }\r\n            },\r\n            getStateDom: function () {\r\n                return this.getDom('state');\r\n            },\r\n            isChecked: function () {\r\n                return this.hasState('checked');\r\n            },\r\n            setChecked: function (checked) {\r\n                if (!this.isDisabled() && checked) {\r\n                    this.addState('checked');\r\n                } else {\r\n                    this.removeState('checked');\r\n                }\r\n            },\r\n            isDisabled: function () {\r\n                return this.hasState('disabled');\r\n            },\r\n            setDisabled: function (disabled) {\r\n                if (disabled) {\r\n                    this.removeState('hover');\r\n                    this.removeState('checked');\r\n                    this.removeState('active');\r\n                    this.addState('disabled');\r\n                } else {\r\n                    this.removeState('disabled');\r\n                }\r\n            }\r\n        };\r\n    })();\r\n\r\n\r\n    // ui/button.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/stateful.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Stateful = baidu.editor.ui.Stateful,\r\n            Button = baidu.editor.ui.Button = function (options) {\r\n                if (options.name) {\r\n                    var btnName = options.name;\r\n                    var cssRules = options.cssRules;\r\n                    if (!options.className) {\r\n                        options.className = 'edui-for-' + btnName;\r\n                    }\r\n                    options.cssRules = '.edui-default  .edui-for-' + btnName + ' .edui-icon {' + cssRules + '}'\r\n                }\r\n                this.initOptions(options);\r\n                this.initButton();\r\n            };\r\n        Button.prototype = {\r\n            uiName: 'button',\r\n            label: '',\r\n            title: '',\r\n            showIcon: true,\r\n            showText: true,\r\n            cssRules: '',\r\n            initButton: function () {\r\n                this.initUIBase();\r\n                this.Stateful_init();\r\n                if (this.cssRules) {\r\n                    utils.cssRule('edui-customize-' + this.name + '-style', this.cssRules);\r\n                }\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-box %%\">' +\r\n                    '<div id=\"##_state\" stateful>' +\r\n                    '<div class=\"%%-wrap\"><div id=\"##_body\" unselectable=\"on\" ' + (this.title ? 'title=\"' + this.title + '\"' : '') +\r\n                    ' class=\"%%-body\" onmousedown=\"return $$._onMouseDown(event, this);\" onclick=\"return $$._onClick(event, this);\">' +\r\n                    (this.showIcon ? '<div class=\"edui-box edui-icon\"></div>' : '') +\r\n                    (this.showText ? '<div class=\"edui-box edui-label\">' + this.label + '</div>' : '') +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div></div>';\r\n            },\r\n            postRender: function () {\r\n                this.Stateful_postRender();\r\n                this.setDisabled(this.disabled)\r\n            },\r\n            _onMouseDown: function (e) {\r\n                var target = e.target || e.srcElement,\r\n                    tagName = target && target.tagName && target.tagName.toLowerCase();\r\n                if (tagName == 'input' || tagName == 'object' || tagName == 'object') {\r\n                    return false;\r\n                }\r\n            },\r\n            _onClick: function () {\r\n                if (!this.isDisabled()) {\r\n                    this.fireEvent('click');\r\n                }\r\n            },\r\n            setTitle: function (text) {\r\n                var label = this.getDom('label');\r\n                label.innerHTML = text;\r\n            }\r\n        };\r\n        utils.inherits(Button, UIBase);\r\n        utils.extend(Button.prototype, Stateful);\r\n\r\n    })();\r\n\r\n\r\n    // ui/splitbutton.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/stateful.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Stateful = baidu.editor.ui.Stateful,\r\n            SplitButton = baidu.editor.ui.SplitButton = function (options) {\r\n                this.initOptions(options);\r\n                this.initSplitButton();\r\n            };\r\n        SplitButton.prototype = {\r\n            popup: null,\r\n            uiName: 'splitbutton',\r\n            title: '',\r\n            initSplitButton: function () {\r\n                this.initUIBase();\r\n                this.Stateful_init();\r\n                var me = this;\r\n                if (this.popup != null) {\r\n                    var popup = this.popup;\r\n                    this.popup = null;\r\n                    this.setPopup(popup);\r\n                }\r\n            },\r\n            _UIBase_postRender: UIBase.prototype.postRender,\r\n            postRender: function () {\r\n                this.Stateful_postRender();\r\n                this._UIBase_postRender();\r\n            },\r\n            setPopup: function (popup) {\r\n                if (this.popup === popup) return;\r\n                if (this.popup != null) {\r\n                    this.popup.dispose();\r\n                }\r\n                popup.addListener('show', utils.bind(this._onPopupShow, this));\r\n                popup.addListener('hide', utils.bind(this._onPopupHide, this));\r\n                popup.addListener('postrender', utils.bind(function () {\r\n                    popup.getDom('body').appendChild(\r\n                        uiUtils.createElementByHtml('<div id=\"' +\r\n                            this.popup.id + '_bordereraser\" class=\"edui-bordereraser edui-background\" style=\"width:' +\r\n                            (uiUtils.getClientRect(this.getDom()).width + 20) + 'px\"></div>')\r\n                    );\r\n                    popup.getDom().className += ' ' + this.className;\r\n                }, this));\r\n                this.popup = popup;\r\n            },\r\n            _onPopupShow: function () {\r\n                this.addState('opened');\r\n            },\r\n            _onPopupHide: function () {\r\n                this.removeState('opened');\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-box %%\">' +\r\n                    '<div ' + (this.title ? 'title=\"' + this.title + '\"' : '') + ' id=\"##_state\" stateful><div class=\"%%-body\">' +\r\n                    '<div id=\"##_button_body\" class=\"edui-box edui-button-body\" onclick=\"$$._onButtonClick(event, this);\">' +\r\n                    '<div class=\"edui-box edui-icon\"></div>' +\r\n                    '</div>' +\r\n                    '<div class=\"edui-box edui-splitborder\"></div>' +\r\n                    '<div class=\"edui-box edui-arrow\" onclick=\"$$._onArrowClick();\"></div>' +\r\n                    '</div></div></div>';\r\n            },\r\n            showPopup: function () {\r\n                // 当popup往上弹出的时候，做特殊处理\r\n                var rect = uiUtils.getClientRect(this.getDom());\r\n                rect.top -= this.popup.SHADOW_RADIUS;\r\n                rect.height += this.popup.SHADOW_RADIUS;\r\n                this.popup.showAnchorRect(rect);\r\n            },\r\n            _onArrowClick: function (event, el) {\r\n                if (!this.isDisabled()) {\r\n                    this.showPopup();\r\n                }\r\n            },\r\n            _onButtonClick: function () {\r\n                if (!this.isDisabled()) {\r\n                    this.fireEvent('buttonclick');\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(SplitButton, UIBase);\r\n        utils.extend(SplitButton.prototype, Stateful, true);\r\n\r\n    })();\r\n\r\n\r\n    // ui/colorbutton.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/colorpicker.js\r\n    ///import ui/popup.js\r\n    ///import ui/splitbutton.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            ColorPicker = baidu.editor.ui.ColorPicker,\r\n            Popup = baidu.editor.ui.Popup,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            ColorButton = baidu.editor.ui.ColorButton = function (options) {\r\n                this.initOptions(options);\r\n                this.initColorButton();\r\n            };\r\n        ColorButton.prototype = {\r\n            initColorButton: function () {\r\n                var me = this;\r\n                this.popup = new Popup({\r\n                    content: new ColorPicker({\r\n                        noColorText: me.editor.getLang(\"clearColor\"),\r\n                        editor: me.editor,\r\n                        onpickcolor: function (t, color) {\r\n                            me._onPickColor(color);\r\n                        },\r\n                        onpicknocolor: function (t, color) {\r\n                            me._onPickNoColor(color);\r\n                        }\r\n                    }),\r\n                    editor: me.editor\r\n                });\r\n                this.initSplitButton();\r\n            },\r\n            _SplitButton_postRender: SplitButton.prototype.postRender,\r\n            postRender: function () {\r\n                this._SplitButton_postRender();\r\n                this.getDom('button_body').appendChild(\r\n                    uiUtils.createElementByHtml('<div id=\"' + this.id + '_colorlump\" class=\"edui-colorlump\"></div>')\r\n                );\r\n                this.getDom().className += ' edui-colorbutton';\r\n            },\r\n            setColor: function (color) {\r\n                this.getDom('colorlump').style.backgroundColor = color;\r\n                this.color = color;\r\n            },\r\n            _onPickColor: function (color) {\r\n                if (this.fireEvent('pickcolor', color) !== false) {\r\n                    this.setColor(color);\r\n                    this.popup.hide();\r\n                }\r\n            },\r\n            _onPickNoColor: function (color) {\r\n                if (this.fireEvent('picknocolor') !== false) {\r\n                    this.popup.hide();\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(ColorButton, SplitButton);\r\n\r\n    })();\r\n\r\n\r\n    // ui/tablebutton.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/popup.js\r\n    ///import ui/tablepicker.js\r\n    ///import ui/splitbutton.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Popup = baidu.editor.ui.Popup,\r\n            TablePicker = baidu.editor.ui.TablePicker,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            TableButton = baidu.editor.ui.TableButton = function (options) {\r\n                this.initOptions(options);\r\n                this.initTableButton();\r\n            };\r\n        TableButton.prototype = {\r\n            initTableButton: function () {\r\n                var me = this;\r\n                this.popup = new Popup({\r\n                    content: new TablePicker({\r\n                        editor: me.editor,\r\n                        onpicktable: function (t, numCols, numRows) {\r\n                            me._onPickTable(numCols, numRows);\r\n                        }\r\n                    }),\r\n                    'editor': me.editor\r\n                });\r\n                this.initSplitButton();\r\n            },\r\n            _onPickTable: function (numCols, numRows) {\r\n                if (this.fireEvent('picktable', numCols, numRows) !== false) {\r\n                    this.popup.hide();\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(TableButton, SplitButton);\r\n\r\n    })();\r\n\r\n\r\n    // ui/autotypesetpicker.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            UIBase = baidu.editor.ui.UIBase;\r\n\r\n        var AutoTypeSetPicker = baidu.editor.ui.AutoTypeSetPicker = function (options) {\r\n            this.initOptions(options);\r\n            this.initAutoTypeSetPicker();\r\n        };\r\n        AutoTypeSetPicker.prototype = {\r\n            initAutoTypeSetPicker: function () {\r\n                this.initUIBase();\r\n            },\r\n            getHtmlTpl: function () {\r\n                var me = this.editor,\r\n                    opt = me.options.autotypeset,\r\n                    lang = me.getLang(\"autoTypeSet\");\r\n\r\n                var textAlignInputName = 'textAlignValue' + me.uid,\r\n                    imageBlockInputName = 'imageBlockLineValue' + me.uid,\r\n                    symbolConverInputName = 'symbolConverValue' + me.uid;\r\n\r\n                return '<div id=\"##\" class=\"edui-autotypesetpicker %%\">' +\r\n                    '<div class=\"edui-autotypesetpicker-body\">' +\r\n                    '<table >' +\r\n                    '<tr><td nowrap><input type=\"checkbox\" name=\"mergeEmptyline\" ' + (opt[\"mergeEmptyline\"] ? \"checked\" : \"\") + '>' + lang.mergeLine + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"removeEmptyline\" ' + (opt[\"removeEmptyline\"] ? \"checked\" : \"\") + '>' + lang.delLine + '</td></tr>' +\r\n                    '<tr><td nowrap><input type=\"checkbox\" name=\"removeClass\" ' + (opt[\"removeClass\"] ? \"checked\" : \"\") + '>' + lang.removeFormat + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"indent\" ' + (opt[\"indent\"] ? \"checked\" : \"\") + '>' + lang.indent + '</td></tr>' +\r\n                    '<tr>' +\r\n                    '<td nowrap><input type=\"checkbox\" name=\"textAlign\" ' + (opt[\"textAlign\"] ? \"checked\" : \"\") + '>' + lang.alignment + '</td>' +\r\n                    '<td colspan=\"2\" id=\"' + textAlignInputName + '\">' +\r\n                    '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"left\" ' + ((opt[\"textAlign\"] && opt[\"textAlign\"] == \"left\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifyleft\") +\r\n                    '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"center\" ' + ((opt[\"textAlign\"] && opt[\"textAlign\"] == \"center\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifycenter\") +\r\n                    '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"right\" ' + ((opt[\"textAlign\"] && opt[\"textAlign\"] == \"right\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifyright\") +\r\n                    '</td>' +\r\n                    '</tr>' +\r\n                    '<tr>' +\r\n                    '<td nowrap><input type=\"checkbox\" name=\"imageBlockLine\" ' + (opt[\"imageBlockLine\"] ? \"checked\" : \"\") + '>' + lang.imageFloat + '</td>' +\r\n                    '<td nowrap id=\"' + imageBlockInputName + '\">' +\r\n                    '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"none\" ' + ((opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"none\") ? \"checked\" : \"\") + '>' + me.getLang(\"default\") +\r\n                    '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"left\" ' + ((opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"left\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifyleft\") +\r\n                    '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"center\" ' + ((opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"center\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifycenter\") +\r\n                    '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"right\" ' + ((opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"right\") ? \"checked\" : \"\") + '>' + me.getLang(\"justifyright\") +\r\n                    '</td>' +\r\n                    '</tr>' +\r\n                    '<tr><td nowrap><input type=\"checkbox\" name=\"clearFontSize\" ' + (opt[\"clearFontSize\"] ? \"checked\" : \"\") + '>' + lang.removeFontsize + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"clearFontFamily\" ' + (opt[\"clearFontFamily\"] ? \"checked\" : \"\") + '>' + lang.removeFontFamily + '</td></tr>' +\r\n                    '<tr><td nowrap colspan=\"3\"><input type=\"checkbox\" name=\"removeEmptyNode\" ' + (opt[\"removeEmptyNode\"] ? \"checked\" : \"\") + '>' + lang.removeHtml + '</td></tr>' +\r\n                    '<tr><td nowrap colspan=\"3\"><input type=\"checkbox\" name=\"pasteFilter\" ' + (opt[\"pasteFilter\"] ? \"checked\" : \"\") + '>' + lang.pasteFilter + '</td></tr>' +\r\n                    '<tr>' +\r\n                    '<td nowrap><input type=\"checkbox\" name=\"symbolConver\" ' + (opt[\"bdc2sb\"] || opt[\"tobdc\"] ? \"checked\" : \"\") + '>' + lang.symbol + '</td>' +\r\n                    '<td id=\"' + symbolConverInputName + '\">' +\r\n                    '<input type=\"radio\" name=\"bdc\" value=\"bdc2sb\" ' + (opt[\"bdc2sb\"] ? \"checked\" : \"\") + '>' + lang.bdc2sb +\r\n                    '<input type=\"radio\" name=\"bdc\" value=\"tobdc\" ' + (opt[\"tobdc\"] ? \"checked\" : \"\") + '>' + lang.tobdc + '' +\r\n                    '</td>' +\r\n                    '<td nowrap align=\"right\"><button >' + lang.run + '</button></td>' +\r\n                    '</tr>' +\r\n                    '</table>' +\r\n                    '</div>' +\r\n                    '</div>';\r\n\r\n\r\n            },\r\n            _UIBase_render: UIBase.prototype.render\r\n        };\r\n        utils.inherits(AutoTypeSetPicker, UIBase);\r\n    })();\r\n\r\n\r\n    // ui/autotypesetbutton.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/popup.js\r\n    ///import ui/autotypesetpicker.js\r\n    ///import ui/splitbutton.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Popup = baidu.editor.ui.Popup,\r\n            AutoTypeSetPicker = baidu.editor.ui.AutoTypeSetPicker,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            AutoTypeSetButton = baidu.editor.ui.AutoTypeSetButton = function (options) {\r\n                this.initOptions(options);\r\n                this.initAutoTypeSetButton();\r\n            };\r\n        function getPara(me) {\r\n\r\n            var opt = {},\r\n                cont = me.getDom(),\r\n                editorId = me.editor.uid,\r\n                inputType = null,\r\n                attrName = null,\r\n                ipts = domUtils.getElementsByTagName(cont, \"input\");\r\n            for (var i = ipts.length - 1, ipt; ipt = ipts[i--];) {\r\n                inputType = ipt.getAttribute(\"type\");\r\n                if (inputType == \"checkbox\") {\r\n                    attrName = ipt.getAttribute(\"name\");\r\n                    opt[attrName] && delete opt[attrName];\r\n                    if (ipt.checked) {\r\n                        var attrValue = document.getElementById(attrName + \"Value\" + editorId);\r\n                        if (attrValue) {\r\n                            if (/input/ig.test(attrValue.tagName)) {\r\n                                opt[attrName] = attrValue.value;\r\n                            } else {\r\n                                var iptChilds = attrValue.getElementsByTagName(\"input\");\r\n                                for (var j = iptChilds.length - 1, iptchild; iptchild = iptChilds[j--];) {\r\n                                    if (iptchild.checked) {\r\n                                        opt[attrName] = iptchild.value;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        } else {\r\n                            opt[attrName] = true;\r\n                        }\r\n                    } else {\r\n                        opt[attrName] = false;\r\n                    }\r\n                } else {\r\n                    opt[ipt.getAttribute(\"value\")] = ipt.checked;\r\n                }\r\n\r\n            }\r\n\r\n            var selects = domUtils.getElementsByTagName(cont, \"select\");\r\n            for (var i = 0, si; si = selects[i++];) {\r\n                var attr = si.getAttribute('name');\r\n                opt[attr] = opt[attr] ? si.value : '';\r\n            }\r\n\r\n            utils.extend(me.editor.options.autotypeset, opt);\r\n\r\n            me.editor.setPreferences('autotypeset', opt);\r\n        }\r\n\r\n        AutoTypeSetButton.prototype = {\r\n            initAutoTypeSetButton: function () {\r\n\r\n                var me = this;\r\n                this.popup = new Popup({\r\n                    //传入配置参数\r\n                    content: new AutoTypeSetPicker({ editor: me.editor }),\r\n                    'editor': me.editor,\r\n                    hide: function () {\r\n                        if (!this._hidden && this.getDom()) {\r\n                            getPara(this);\r\n                            this.getDom().style.display = 'none';\r\n                            this._hidden = true;\r\n                            this.fireEvent('hide');\r\n                        }\r\n                    }\r\n                });\r\n                var flag = 0;\r\n                this.popup.addListener('postRenderAfter', function () {\r\n                    var popupUI = this;\r\n                    if (flag) return;\r\n                    var cont = this.getDom(),\r\n                        btn = cont.getElementsByTagName('button')[0];\r\n\r\n                    btn.onclick = function () {\r\n                        getPara(popupUI);\r\n                        me.editor.execCommand('autotypeset');\r\n                        popupUI.hide()\r\n                    };\r\n\r\n                    domUtils.on(cont, 'click', function (e) {\r\n                        var target = e.target || e.srcElement,\r\n                            editorId = me.editor.uid;\r\n                        if (target && target.tagName == 'INPUT') {\r\n\r\n                            // 点击图片浮动的checkbox,去除对应的radio\r\n                            if (target.name == 'imageBlockLine' || target.name == 'textAlign' || target.name == 'symbolConver') {\r\n                                var checked = target.checked,\r\n                                    radioTd = document.getElementById(target.name + 'Value' + editorId),\r\n                                    radios = radioTd.getElementsByTagName('input'),\r\n                                    defalutSelect = {\r\n                                        'imageBlockLine': 'none',\r\n                                        'textAlign': 'left',\r\n                                        'symbolConver': 'tobdc'\r\n                                    };\r\n\r\n                                for (var i = 0; i < radios.length; i++) {\r\n                                    if (checked) {\r\n                                        if (radios[i].value == defalutSelect[target.name]) {\r\n                                            radios[i].checked = 'checked';\r\n                                        }\r\n                                    } else {\r\n                                        radios[i].checked = false;\r\n                                    }\r\n                                }\r\n                            }\r\n                            // 点击radio,选中对应的checkbox\r\n                            if (target.name == ('imageBlockLineValue' + editorId) || target.name == ('textAlignValue' + editorId) || target.name == 'bdc') {\r\n                                var checkboxs = target.parentNode.previousSibling.getElementsByTagName('input');\r\n                                checkboxs && (checkboxs[0].checked = true);\r\n                            }\r\n\r\n                            getPara(popupUI);\r\n                        }\r\n                    });\r\n\r\n                    flag = 1;\r\n                });\r\n                this.initSplitButton();\r\n            }\r\n        };\r\n        utils.inherits(AutoTypeSetButton, SplitButton);\r\n\r\n    })();\r\n\r\n\r\n    // ui/cellalignpicker.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Popup = baidu.editor.ui.Popup,\r\n            Stateful = baidu.editor.ui.Stateful,\r\n            UIBase = baidu.editor.ui.UIBase;\r\n\r\n        /**\r\n         * 该参数将新增一个参数： selected， 参数类型为一个Object， 形如{ 'align': 'center', 'valign': 'top' }， 表示单元格的初始\r\n         * 对齐状态为： 竖直居上，水平居中; 其中 align的取值为：'center', 'left', 'right'; valign的取值为: 'top', 'middle', 'bottom'\r\n         * @update 2013/4/2 hancong03@baidu.com\r\n         */\r\n        var CellAlignPicker = baidu.editor.ui.CellAlignPicker = function (options) {\r\n            this.initOptions(options);\r\n            this.initSelected();\r\n            this.initCellAlignPicker();\r\n        };\r\n        CellAlignPicker.prototype = {\r\n            //初始化选中状态， 该方法将根据传递进来的参数获取到应该选中的对齐方式图标的索引\r\n            initSelected: function () {\r\n\r\n                var status = {\r\n\r\n                    valign: {\r\n                        top: 0,\r\n                        middle: 1,\r\n                        bottom: 2\r\n                    },\r\n                    align: {\r\n                        left: 0,\r\n                        center: 1,\r\n                        right: 2\r\n                    },\r\n                    count: 3\r\n\r\n                },\r\n                    result = -1;\r\n\r\n                if (this.selected) {\r\n                    this.selectedIndex = status.valign[this.selected.valign] * status.count + status.align[this.selected.align];\r\n                }\r\n\r\n            },\r\n            initCellAlignPicker: function () {\r\n                this.initUIBase();\r\n                this.Stateful_init();\r\n            },\r\n            getHtmlTpl: function () {\r\n\r\n                var alignType = ['left', 'center', 'right'],\r\n                    COUNT = 9,\r\n                    tempClassName = null,\r\n                    tempIndex = -1,\r\n                    tmpl = [];\r\n\r\n\r\n                for (var i = 0; i < COUNT; i++) {\r\n\r\n                    tempClassName = this.selectedIndex === i ? ' class=\"edui-cellalign-selected\" ' : '';\r\n                    tempIndex = i % 3;\r\n\r\n                    tempIndex === 0 && tmpl.push('<tr>');\r\n\r\n                    tmpl.push('<td index=\"' + i + '\" ' + tempClassName + ' stateful><div class=\"edui-icon edui-' + alignType[tempIndex] + '\"></div></td>');\r\n\r\n                    tempIndex === 2 && tmpl.push('</tr>');\r\n\r\n                }\r\n\r\n                return '<div id=\"##\" class=\"edui-cellalignpicker %%\">' +\r\n                    '<div class=\"edui-cellalignpicker-body\">' +\r\n                    '<table onclick=\"$$._onClick(event);\">' +\r\n                    tmpl.join('') +\r\n                    '</table>' +\r\n                    '</div>' +\r\n                    '</div>';\r\n            },\r\n            getStateDom: function () {\r\n                return this.target;\r\n            },\r\n            _onClick: function (evt) {\r\n                var target = evt.target || evt.srcElement;\r\n                if (/icon/.test(target.className)) {\r\n                    this.items[target.parentNode.getAttribute(\"index\")].onclick();\r\n                    Popup.postHide(evt);\r\n                }\r\n            },\r\n            _UIBase_render: UIBase.prototype.render\r\n        };\r\n        utils.inherits(CellAlignPicker, UIBase);\r\n        utils.extend(CellAlignPicker.prototype, Stateful, true);\r\n    })();\r\n\r\n\r\n\r\n\r\n\r\n    // ui/pastepicker.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Stateful = baidu.editor.ui.Stateful,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            UIBase = baidu.editor.ui.UIBase;\r\n\r\n        var PastePicker = baidu.editor.ui.PastePicker = function (options) {\r\n            this.initOptions(options);\r\n            this.initPastePicker();\r\n        };\r\n        PastePicker.prototype = {\r\n            initPastePicker: function () {\r\n                this.initUIBase();\r\n                this.Stateful_init();\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div class=\"edui-pasteicon\" onclick=\"$$._onClick(this)\"></div>' +\r\n                    '<div class=\"edui-pastecontainer\">' +\r\n                    '<div class=\"edui-title\">' + this.editor.getLang(\"pasteOpt\") + '</div>' +\r\n                    '<div class=\"edui-button\">' +\r\n                    '<div title=\"' + this.editor.getLang(\"pasteSourceFormat\") + '\" onclick=\"$$.format(false)\" stateful>' +\r\n                    '<div class=\"edui-richtxticon\"></div></div>' +\r\n                    '<div title=\"' + this.editor.getLang(\"tagFormat\") + '\" onclick=\"$$.format(2)\" stateful>' +\r\n                    '<div class=\"edui-tagicon\"></div></div>' +\r\n                    '<div title=\"' + this.editor.getLang(\"pasteTextFormat\") + '\" onclick=\"$$.format(true)\" stateful>' +\r\n                    '<div class=\"edui-plaintxticon\"></div></div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>'\r\n            },\r\n            getStateDom: function () {\r\n                return this.target;\r\n            },\r\n            format: function (param) {\r\n                this.editor.ui._isTransfer = true;\r\n                this.editor.fireEvent('pasteTransfer', param);\r\n            },\r\n            _onClick: function (cur) {\r\n                var node = domUtils.getNextDomNode(cur),\r\n                    screenHt = uiUtils.getViewportRect().height,\r\n                    subPop = uiUtils.getClientRect(node);\r\n\r\n                if ((subPop.top + subPop.height) > screenHt)\r\n                    node.style.top = (-subPop.height - cur.offsetHeight) + \"px\";\r\n                else\r\n                    node.style.top = \"\";\r\n\r\n                if (/hidden/ig.test(domUtils.getComputedStyle(node, \"visibility\"))) {\r\n                    node.style.visibility = \"visible\";\r\n                    domUtils.addClass(cur, \"edui-state-opened\");\r\n                } else {\r\n                    node.style.visibility = \"hidden\";\r\n                    domUtils.removeClasses(cur, \"edui-state-opened\")\r\n                }\r\n            },\r\n            _UIBase_render: UIBase.prototype.render\r\n        };\r\n        utils.inherits(PastePicker, UIBase);\r\n        utils.extend(PastePicker.prototype, Stateful, true);\r\n    })();\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // ui/toolbar.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Toolbar = baidu.editor.ui.Toolbar = function (options) {\r\n                this.initOptions(options);\r\n                this.initToolbar();\r\n            };\r\n        Toolbar.prototype = {\r\n            items: null,\r\n            initToolbar: function () {\r\n                this.items = this.items || [];\r\n                this.initUIBase();\r\n            },\r\n            add: function (item, index) {\r\n                if (index === undefined) {\r\n                    this.items.push(item);\r\n                } else {\r\n                    this.items.splice(index, 0, item)\r\n                }\r\n\r\n            },\r\n            getHtmlTpl: function () {\r\n                var buff = [];\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    buff[i] = this.items[i].renderHtml();\r\n                }\r\n                return '<div id=\"##\" class=\"edui-toolbar %%\" onselectstart=\"return false;\" onmousedown=\"return $$._onMouseDown(event, this);\">' +\r\n                    buff.join('') +\r\n                    '</div>'\r\n            },\r\n            postRender: function () {\r\n                var box = this.getDom();\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    this.items[i].postRender();\r\n                }\r\n                uiUtils.makeUnselectable(box);\r\n            },\r\n            _onMouseDown: function (e) {\r\n                var target = e.target || e.srcElement,\r\n                    tagName = target && target.tagName && target.tagName.toLowerCase();\r\n                if (tagName == 'input' || tagName == 'object' || tagName == 'object') {\r\n                    return false;\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(Toolbar, UIBase);\r\n\r\n    })();\r\n\r\n\r\n    // ui/menu.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui\\popup.js\r\n    ///import ui\\stateful.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Popup = baidu.editor.ui.Popup,\r\n            Stateful = baidu.editor.ui.Stateful,\r\n            CellAlignPicker = baidu.editor.ui.CellAlignPicker,\r\n\r\n            Menu = baidu.editor.ui.Menu = function (options) {\r\n                this.initOptions(options);\r\n                this.initMenu();\r\n            };\r\n\r\n        var menuSeparator = {\r\n            renderHtml: function () {\r\n                return '<div class=\"edui-menuitem edui-menuseparator\"><div class=\"edui-menuseparator-inner\"></div></div>';\r\n            },\r\n            postRender: function () {\r\n            },\r\n            queryAutoHide: function () {\r\n                return true;\r\n            }\r\n        };\r\n        Menu.prototype = {\r\n            items: null,\r\n            uiName: 'menu',\r\n            initMenu: function () {\r\n                this.items = this.items || [];\r\n                this.initPopup();\r\n                this.initItems();\r\n            },\r\n            initItems: function () {\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    var item = this.items[i];\r\n                    if (item == '-') {\r\n                        this.items[i] = this.getSeparator();\r\n                    } else if (!(item instanceof MenuItem)) {\r\n                        item.editor = this.editor;\r\n                        item.theme = this.editor.options.theme;\r\n                        this.items[i] = this.createItem(item);\r\n                    }\r\n                }\r\n            },\r\n            getSeparator: function () {\r\n                return menuSeparator;\r\n            },\r\n            createItem: function (item) {\r\n                //新增一个参数menu, 该参数存储了menuItem所对应的menu引用\r\n                item.menu = this;\r\n                return new MenuItem(item);\r\n            },\r\n            _Popup_getContentHtmlTpl: Popup.prototype.getContentHtmlTpl,\r\n            getContentHtmlTpl: function () {\r\n                if (this.items.length == 0) {\r\n                    return this._Popup_getContentHtmlTpl();\r\n                }\r\n                var buff = [];\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    var item = this.items[i];\r\n                    buff[i] = item.renderHtml();\r\n                }\r\n                return ('<div class=\"%%-body\">' + buff.join('') + '</div>');\r\n            },\r\n            _Popup_postRender: Popup.prototype.postRender,\r\n            postRender: function () {\r\n                var me = this;\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    var item = this.items[i];\r\n                    item.ownerMenu = this;\r\n                    item.postRender();\r\n                }\r\n                domUtils.on(this.getDom(), 'mouseover', function (evt) {\r\n                    evt = evt || event;\r\n                    var rel = evt.relatedTarget || evt.fromElement;\r\n                    var el = me.getDom();\r\n                    if (!uiUtils.contains(el, rel) && el !== rel) {\r\n                        me.fireEvent('over');\r\n                    }\r\n                });\r\n                this._Popup_postRender();\r\n            },\r\n            queryAutoHide: function (el) {\r\n                if (el) {\r\n                    if (uiUtils.contains(this.getDom(), el)) {\r\n                        return false;\r\n                    }\r\n                    for (var i = 0; i < this.items.length; i++) {\r\n                        var item = this.items[i];\r\n                        if (item.queryAutoHide(el) === false) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            clearItems: function () {\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    var item = this.items[i];\r\n                    clearTimeout(item._showingTimer);\r\n                    clearTimeout(item._closingTimer);\r\n                    if (item.subMenu) {\r\n                        item.subMenu.destroy();\r\n                    }\r\n                }\r\n                this.items = [];\r\n            },\r\n            destroy: function () {\r\n                if (this.getDom()) {\r\n                    domUtils.remove(this.getDom());\r\n                }\r\n                this.clearItems();\r\n            },\r\n            dispose: function () {\r\n                this.destroy();\r\n            }\r\n        };\r\n        utils.inherits(Menu, Popup);\r\n\r\n        /**\r\n         * @update 2013/04/03 hancong03 新增一个参数menu, 该参数存储了menuItem所对应的menu引用\r\n         * @type {Function}\r\n         */\r\n        var MenuItem = baidu.editor.ui.MenuItem = function (options) {\r\n            this.initOptions(options);\r\n            this.initUIBase();\r\n            this.Stateful_init();\r\n            if (this.subMenu && !(this.subMenu instanceof Menu)) {\r\n                if (options.className && options.className.indexOf(\"aligntd\") != -1) {\r\n                    var me = this;\r\n\r\n                    //获取单元格对齐初始状态\r\n                    this.subMenu.selected = this.editor.queryCommandValue('cellalignment');\r\n\r\n                    this.subMenu = new Popup({\r\n                        content: new CellAlignPicker(this.subMenu),\r\n                        parentMenu: me,\r\n                        editor: me.editor,\r\n                        destroy: function () {\r\n                            if (this.getDom()) {\r\n                                domUtils.remove(this.getDom());\r\n                            }\r\n                        }\r\n                    });\r\n                    this.subMenu.addListener(\"postRenderAfter\", function () {\r\n                        domUtils.on(this.getDom(), \"mouseover\", function () {\r\n                            me.addState('opened');\r\n                        });\r\n                    });\r\n                } else {\r\n                    this.subMenu = new Menu(this.subMenu);\r\n                }\r\n            }\r\n        };\r\n        MenuItem.prototype = {\r\n            label: '',\r\n            subMenu: null,\r\n            ownerMenu: null,\r\n            uiName: 'menuitem',\r\n            alwalysHoverable: true,\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"%%\" stateful onclick=\"$$._onClick(event, this);\">' +\r\n                    '<div class=\"%%-body\">' +\r\n                    this.renderLabelHtml() +\r\n                    '</div>' +\r\n                    '</div>';\r\n            },\r\n            postRender: function () {\r\n                var me = this;\r\n                this.addListener('over', function () {\r\n                    me.ownerMenu.fireEvent('submenuover', me);\r\n                    if (me.subMenu) {\r\n                        me.delayShowSubMenu();\r\n                    }\r\n                });\r\n                if (this.subMenu) {\r\n                    this.getDom().className += ' edui-hassubmenu';\r\n                    this.subMenu.render();\r\n                    this.addListener('out', function () {\r\n                        me.delayHideSubMenu();\r\n                    });\r\n                    this.subMenu.addListener('over', function () {\r\n                        clearTimeout(me._closingTimer);\r\n                        me._closingTimer = null;\r\n                        me.addState('opened');\r\n                    });\r\n                    this.ownerMenu.addListener('hide', function () {\r\n                        me.hideSubMenu();\r\n                    });\r\n                    this.ownerMenu.addListener('submenuover', function (t, subMenu) {\r\n                        if (subMenu !== me) {\r\n                            me.delayHideSubMenu();\r\n                        }\r\n                    });\r\n                    this.subMenu._bakQueryAutoHide = this.subMenu.queryAutoHide;\r\n                    this.subMenu.queryAutoHide = function (el) {\r\n                        if (el && uiUtils.contains(me.getDom(), el)) {\r\n                            return false;\r\n                        }\r\n                        return this._bakQueryAutoHide(el);\r\n                    };\r\n                }\r\n                this.getDom().style.tabIndex = '-1';\r\n                uiUtils.makeUnselectable(this.getDom());\r\n                this.Stateful_postRender();\r\n            },\r\n            delayShowSubMenu: function () {\r\n                var me = this;\r\n                if (!me.isDisabled()) {\r\n                    me.addState('opened');\r\n                    clearTimeout(me._showingTimer);\r\n                    clearTimeout(me._closingTimer);\r\n                    me._closingTimer = null;\r\n                    me._showingTimer = setTimeout(function () {\r\n                        me.showSubMenu();\r\n                    }, 250);\r\n                }\r\n            },\r\n            delayHideSubMenu: function () {\r\n                var me = this;\r\n                if (!me.isDisabled()) {\r\n                    me.removeState('opened');\r\n                    clearTimeout(me._showingTimer);\r\n                    if (!me._closingTimer) {\r\n                        me._closingTimer = setTimeout(function () {\r\n                            if (!me.hasState('opened')) {\r\n                                me.hideSubMenu();\r\n                            }\r\n                            me._closingTimer = null;\r\n                        }, 400);\r\n                    }\r\n                }\r\n            },\r\n            renderLabelHtml: function () {\r\n                return '<div class=\"edui-arrow\"></div>' +\r\n                    '<div class=\"edui-box edui-icon\"></div>' +\r\n                    '<div class=\"edui-box edui-label %%-label\">' + (this.label || '') + '</div>';\r\n            },\r\n            getStateDom: function () {\r\n                return this.getDom();\r\n            },\r\n            queryAutoHide: function (el) {\r\n                if (this.subMenu && this.hasState('opened')) {\r\n                    return this.subMenu.queryAutoHide(el);\r\n                }\r\n            },\r\n            _onClick: function (event, this_) {\r\n                if (this.hasState('disabled')) return;\r\n                if (this.fireEvent('click', event, this_) !== false) {\r\n                    if (this.subMenu) {\r\n                        this.showSubMenu();\r\n                    } else {\r\n                        Popup.postHide(event);\r\n                    }\r\n                }\r\n            },\r\n            showSubMenu: function () {\r\n                var rect = uiUtils.getClientRect(this.getDom());\r\n                rect.right -= 5;\r\n                rect.left += 2;\r\n                rect.width -= 7;\r\n                rect.top -= 4;\r\n                rect.bottom += 4;\r\n                rect.height += 8;\r\n                this.subMenu.showAnchorRect(rect, true, true);\r\n            },\r\n            hideSubMenu: function () {\r\n                this.subMenu.hide();\r\n            }\r\n        };\r\n        utils.inherits(MenuItem, UIBase);\r\n        utils.extend(MenuItem.prototype, Stateful, true);\r\n    })();\r\n\r\n\r\n    // ui/combox.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/menu.js\r\n    ///import ui/splitbutton.js\r\n    (function () {\r\n        // todo: menu和item提成通用list\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            Menu = baidu.editor.ui.Menu,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            Combox = baidu.editor.ui.Combox = function (options) {\r\n                this.initOptions(options);\r\n                this.initCombox();\r\n            };\r\n        Combox.prototype = {\r\n            uiName: 'combox',\r\n            onbuttonclick: function () {\r\n                this.showPopup();\r\n            },\r\n            initCombox: function () {\r\n                var me = this;\r\n                this.items = this.items || [];\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    var item = this.items[i];\r\n                    item.uiName = 'listitem';\r\n                    item.index = i;\r\n                    item.onclick = function () {\r\n                        me.selectByIndex(this.index);\r\n                    };\r\n                }\r\n                this.popup = new Menu({\r\n                    items: this.items,\r\n                    uiName: 'list',\r\n                    editor: this.editor,\r\n                    captureWheel: true,\r\n                    combox: this\r\n                });\r\n\r\n                this.initSplitButton();\r\n            },\r\n            _SplitButton_postRender: SplitButton.prototype.postRender,\r\n            postRender: function () {\r\n                this._SplitButton_postRender();\r\n                this.setLabel(this.label || '');\r\n                this.setValue(this.initValue || '');\r\n            },\r\n            showPopup: function () {\r\n                var rect = uiUtils.getClientRect(this.getDom());\r\n                rect.top += 1;\r\n                rect.bottom -= 1;\r\n                rect.height -= 2;\r\n                this.popup.showAnchorRect(rect);\r\n            },\r\n            getValue: function () {\r\n                return this.value;\r\n            },\r\n            setValue: function (value) {\r\n                var index = this.indexByValue(value);\r\n                if (index != -1) {\r\n                    this.selectedIndex = index;\r\n                    this.setLabel(this.items[index].label);\r\n                    this.value = this.items[index].value;\r\n                } else {\r\n                    this.selectedIndex = -1;\r\n                    this.setLabel(this.getLabelForUnknowValue(value));\r\n                    this.value = value;\r\n                }\r\n            },\r\n            setLabel: function (label) {\r\n                this.getDom('button_body').innerHTML = label;\r\n                this.label = label;\r\n            },\r\n            getLabelForUnknowValue: function (value) {\r\n                return value;\r\n            },\r\n            indexByValue: function (value) {\r\n                for (var i = 0; i < this.items.length; i++) {\r\n                    if (value == this.items[i].value) {\r\n                        return i;\r\n                    }\r\n                }\r\n                return -1;\r\n            },\r\n            getItem: function (index) {\r\n                return this.items[index];\r\n            },\r\n            selectByIndex: function (index) {\r\n                if (index < this.items.length && this.fireEvent('select', index) !== false) {\r\n                    this.selectedIndex = index;\r\n                    this.value = this.items[index].value;\r\n                    this.setLabel(this.items[index].label);\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(Combox, SplitButton);\r\n    })();\r\n\r\n\r\n    // ui/dialog.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/mask.js\r\n    ///import ui/button.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            Mask = baidu.editor.ui.Mask,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Button = baidu.editor.ui.Button,\r\n            Dialog = baidu.editor.ui.Dialog = function (options) {\r\n                if (options.name) {\r\n                    var name = options.name;\r\n                    var cssRules = options.cssRules;\r\n                    if (!options.className) {\r\n                        options.className = 'edui-for-' + name;\r\n                    }\r\n                    if (cssRules) {\r\n                        options.cssRules = '.edui-default .edui-for-' + name + ' .edui-dialog-content  {' + cssRules + '}'\r\n                    }\r\n                }\r\n                this.initOptions(utils.extend({\r\n                    autoReset: true,\r\n                    draggable: true,\r\n                    onok: function () { },\r\n                    oncancel: function () { },\r\n                    onclose: function (t, ok) {\r\n                        return ok ? this.onok() : this.oncancel();\r\n                    },\r\n                    //是否控制dialog中的scroll事件， 默认为不阻止\r\n                    holdScroll: false\r\n                }, options));\r\n                this.initDialog();\r\n            };\r\n        var modalMask;\r\n        var dragMask;\r\n        var activeDialog;\r\n        Dialog.prototype = {\r\n            draggable: false,\r\n            uiName: 'dialog',\r\n            initDialog: function () {\r\n                var me = this,\r\n                    theme = this.editor.options.theme;\r\n                if (this.cssRules) {\r\n                    utils.cssRule('edui-customize-' + this.name + '-style', this.cssRules);\r\n                }\r\n                this.initUIBase();\r\n                this.modalMask = (modalMask || (modalMask = new Mask({\r\n                    className: 'edui-dialog-modalmask',\r\n                    theme: theme,\r\n                    onclick: function () {\r\n                        activeDialog && activeDialog.close(false);\r\n                    }\r\n                })));\r\n                this.dragMask = (dragMask || (dragMask = new Mask({\r\n                    className: 'edui-dialog-dragmask',\r\n                    theme: theme\r\n                })));\r\n                this.closeButton = new Button({\r\n                    className: 'edui-dialog-closebutton',\r\n                    title: me.closeDialog,\r\n                    theme: theme,\r\n                    onclick: function () {\r\n                        me.close(false);\r\n                    }\r\n                });\r\n\r\n                this.fullscreen && this.initResizeEvent();\r\n\r\n                if (this.buttons) {\r\n                    for (var i = 0; i < this.buttons.length; i++) {\r\n                        if (!(this.buttons[i] instanceof Button)) {\r\n                            this.buttons[i] = new Button(utils.extend(this.buttons[i], {\r\n                                editor: this.editor\r\n                            }, true));\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            initResizeEvent: function () {\r\n\r\n                var me = this;\r\n\r\n                domUtils.on(window, \"resize\", function () {\r\n\r\n                    if (me._hidden || me._hidden === undefined) {\r\n                        return;\r\n                    }\r\n\r\n                    if (me.__resizeTimer) {\r\n                        window.clearTimeout(me.__resizeTimer);\r\n                    }\r\n\r\n                    me.__resizeTimer = window.setTimeout(function () {\r\n\r\n                        me.__resizeTimer = null;\r\n\r\n                        var dialogWrapNode = me.getDom(),\r\n                            contentNode = me.getDom('content'),\r\n                            wrapRect = UE.ui.uiUtils.getClientRect(dialogWrapNode),\r\n                            contentRect = UE.ui.uiUtils.getClientRect(contentNode),\r\n                            vpRect = uiUtils.getViewportRect();\r\n\r\n                        contentNode.style.width = (vpRect.width - wrapRect.width + contentRect.width) + \"px\";\r\n                        contentNode.style.height = (vpRect.height - wrapRect.height + contentRect.height) + \"px\";\r\n\r\n                        dialogWrapNode.style.width = vpRect.width + \"px\";\r\n                        dialogWrapNode.style.height = vpRect.height + \"px\";\r\n\r\n                        me.fireEvent(\"resize\");\r\n\r\n                    }, 100);\r\n\r\n                });\r\n\r\n            },\r\n            fitSize: function () {\r\n                var popBodyEl = this.getDom('body');\r\n                //            if (!(baidu.editor.browser.ie && baidu.editor.browser.version == 7)) {\r\n                //                uiUtils.removeStyle(popBodyEl, 'width');\r\n                //                uiUtils.removeStyle(popBodyEl, 'height');\r\n                //            }\r\n                var size = this.mesureSize();\r\n                popBodyEl.style.width = size.width + 'px';\r\n                popBodyEl.style.height = size.height + 'px';\r\n                return size;\r\n            },\r\n            safeSetOffset: function (offset) {\r\n                var me = this;\r\n                var el = me.getDom();\r\n                var vpRect = uiUtils.getViewportRect();\r\n                var rect = uiUtils.getClientRect(el);\r\n                var left = offset.left;\r\n                if (left + rect.width > vpRect.right) {\r\n                    left = vpRect.right - rect.width;\r\n                }\r\n                var top = offset.top;\r\n                if (top + rect.height > vpRect.bottom) {\r\n                    top = vpRect.bottom - rect.height;\r\n                }\r\n                el.style.left = Math.max(left, 0) + 'px';\r\n                el.style.top = Math.max(top, 0) + 'px';\r\n            },\r\n            showAtCenter: function () {\r\n\r\n                var vpRect = uiUtils.getViewportRect();\r\n\r\n                if (!this.fullscreen) {\r\n                    this.getDom().style.display = '';\r\n                    var popSize = this.fitSize();\r\n                    var titleHeight = this.getDom('titlebar').offsetHeight | 0;\r\n                    var left = vpRect.width / 2 - popSize.width / 2;\r\n                    var top = vpRect.height / 2 - (popSize.height - titleHeight) / 2 - titleHeight;\r\n                    var popEl = this.getDom();\r\n                    this.safeSetOffset({\r\n                        left: Math.max(left | 0, 0),\r\n                        top: Math.max(top | 0, 0)\r\n                    });\r\n                    if (!domUtils.hasClass(popEl, 'edui-state-centered')) {\r\n                        popEl.className += ' edui-state-centered';\r\n                    }\r\n                } else {\r\n                    var dialogWrapNode = this.getDom(),\r\n                        contentNode = this.getDom('content');\r\n\r\n                    dialogWrapNode.style.display = \"block\";\r\n\r\n                    var wrapRect = UE.ui.uiUtils.getClientRect(dialogWrapNode),\r\n                        contentRect = UE.ui.uiUtils.getClientRect(contentNode);\r\n                    dialogWrapNode.style.left = \"-100000px\";\r\n\r\n                    contentNode.style.width = (vpRect.width - wrapRect.width + contentRect.width) + \"px\";\r\n                    contentNode.style.height = (vpRect.height - wrapRect.height + contentRect.height) + \"px\";\r\n\r\n                    dialogWrapNode.style.width = vpRect.width + \"px\";\r\n                    dialogWrapNode.style.height = vpRect.height + \"px\";\r\n                    dialogWrapNode.style.left = 0;\r\n\r\n                    //保存环境的overflow值\r\n                    this._originalContext = {\r\n                        html: {\r\n                            overflowX: document.documentElement.style.overflowX,\r\n                            overflowY: document.documentElement.style.overflowY\r\n                        },\r\n                        body: {\r\n                            overflowX: document.body.style.overflowX,\r\n                            overflowY: document.body.style.overflowY\r\n                        }\r\n                    };\r\n\r\n                    document.documentElement.style.overflowX = 'hidden';\r\n                    document.documentElement.style.overflowY = 'hidden';\r\n                    document.body.style.overflowX = 'hidden';\r\n                    document.body.style.overflowY = 'hidden';\r\n\r\n                }\r\n\r\n                this._show();\r\n            },\r\n            getContentHtml: function () {\r\n                var contentHtml = '';\r\n                if (typeof this.content == 'string') {\r\n                    contentHtml = this.content;\r\n                } else if (this.iframeUrl) {\r\n                    contentHtml = '<span id=\"' + this.id + '_contmask\" class=\"dialogcontmask\"></span><iframe id=\"' + this.id +\r\n                        '_iframe\" class=\"%%-iframe\" height=\"100%\" width=\"100%\" frameborder=\"0\" src=\"' + this.iframeUrl + '\"></iframe>';\r\n                }\r\n                return contentHtml;\r\n            },\r\n            getHtmlTpl: function () {\r\n                var footHtml = '';\r\n\r\n                if (this.buttons) {\r\n                    var buff = [];\r\n                    for (var i = 0; i < this.buttons.length; i++) {\r\n                        buff[i] = this.buttons[i].renderHtml();\r\n                    }\r\n                    footHtml = '<div class=\"%%-foot\">' +\r\n                        '<div id=\"##_buttons\" class=\"%%-buttons\">' + buff.join('') + '</div>' +\r\n                        '</div>';\r\n                }\r\n\r\n                return '<div id=\"##\" class=\"%%\"><div ' + (!this.fullscreen ? 'class=\"%%\"' : 'class=\"%%-wrap edui-dialog-fullscreen-flag\"') + '><div id=\"##_body\" class=\"%%-body\">' +\r\n                    '<div class=\"%%-shadow\"></div>' +\r\n                    '<div id=\"##_titlebar\" class=\"%%-titlebar\">' +\r\n                    '<div class=\"%%-draghandle\" onmousedown=\"$$._onTitlebarMouseDown(event, this);\">' +\r\n                    '<span class=\"%%-caption\">' + (this.title || '') + '</span>' +\r\n                    '</div>' +\r\n                    this.closeButton.renderHtml() +\r\n                    '</div>' +\r\n                    '<div id=\"##_content\" class=\"%%-content\">' + (this.autoReset ? '' : this.getContentHtml()) + '</div>' +\r\n                    footHtml +\r\n                    '</div></div></div>';\r\n            },\r\n            postRender: function () {\r\n                // todo: 保持居中/记住上次关闭位置选项\r\n                if (!this.modalMask.getDom()) {\r\n                    this.modalMask.render();\r\n                    this.modalMask.hide();\r\n                }\r\n                if (!this.dragMask.getDom()) {\r\n                    this.dragMask.render();\r\n                    this.dragMask.hide();\r\n                }\r\n                var me = this;\r\n                this.addListener('show', function () {\r\n                    me.modalMask.show(this.getDom().style.zIndex - 2);\r\n                });\r\n                this.addListener('hide', function () {\r\n                    me.modalMask.hide();\r\n                });\r\n                if (this.buttons) {\r\n                    for (var i = 0; i < this.buttons.length; i++) {\r\n                        this.buttons[i].postRender();\r\n                    }\r\n                }\r\n                domUtils.on(window, 'resize', function () {\r\n                    setTimeout(function () {\r\n                        if (!me.isHidden()) {\r\n                            me.safeSetOffset(uiUtils.getClientRect(me.getDom()));\r\n                        }\r\n                    });\r\n                });\r\n\r\n                //hold住scroll事件，防止dialog的滚动影响页面\r\n                //            if( this.holdScroll ) {\r\n                //\r\n                //                if( !me.iframeUrl ) {\r\n                //                    domUtils.on( document.getElementById( me.id + \"_iframe\"), !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\r\n                //                        domUtils.preventDefault(e);\r\n                //                    } );\r\n                //                } else {\r\n                //                    me.addListener('dialogafterreset', function(){\r\n                //                        window.setTimeout(function(){\r\n                //                            var iframeWindow = document.getElementById( me.id + \"_iframe\").contentWindow;\r\n                //\r\n                //                            if( browser.ie ) {\r\n                //\r\n                //                                var timer = window.setInterval(function(){\r\n                //\r\n                //                                    if( iframeWindow.document && iframeWindow.document.body ) {\r\n                //                                        window.clearInterval( timer );\r\n                //                                        timer = null;\r\n                //                                        domUtils.on( iframeWindow.document.body, !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\r\n                //                                            domUtils.preventDefault(e);\r\n                //                                        } );\r\n                //                                    }\r\n                //\r\n                //                                }, 100);\r\n                //\r\n                //                            } else {\r\n                //                                domUtils.on( iframeWindow, !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\r\n                //                                    domUtils.preventDefault(e);\r\n                //                                } );\r\n                //                            }\r\n                //\r\n                //                        }, 1);\r\n                //                    });\r\n                //                }\r\n                //\r\n                //            }\r\n                this._hide();\r\n            },\r\n            mesureSize: function () {\r\n                var body = this.getDom('body');\r\n                var width = uiUtils.getClientRect(this.getDom('content')).width;\r\n                var dialogBodyStyle = body.style;\r\n                dialogBodyStyle.width = width;\r\n                return uiUtils.getClientRect(body);\r\n            },\r\n            _onTitlebarMouseDown: function (evt, el) {\r\n                if (this.draggable) {\r\n                    var rect;\r\n                    var vpRect = uiUtils.getViewportRect();\r\n                    var me = this;\r\n                    uiUtils.startDrag(evt, {\r\n                        ondragstart: function () {\r\n                            rect = uiUtils.getClientRect(me.getDom());\r\n                            me.getDom('contmask').style.visibility = 'visible';\r\n                            me.dragMask.show(me.getDom().style.zIndex - 1);\r\n                        },\r\n                        ondragmove: function (x, y) {\r\n                            var left = rect.left + x;\r\n                            var top = rect.top + y;\r\n                            me.safeSetOffset({\r\n                                left: left,\r\n                                top: top\r\n                            });\r\n                        },\r\n                        ondragstop: function () {\r\n                            me.getDom('contmask').style.visibility = 'hidden';\r\n                            domUtils.removeClasses(me.getDom(), ['edui-state-centered']);\r\n                            me.dragMask.hide();\r\n                        }\r\n                    });\r\n                }\r\n            },\r\n            reset: function () {\r\n                this.getDom('content').innerHTML = this.getContentHtml();\r\n                this.fireEvent('dialogafterreset');\r\n            },\r\n            _show: function () {\r\n                if (this._hidden) {\r\n                    this.getDom().style.display = '';\r\n\r\n                    //要高过编辑器的zindxe\r\n                    this.editor.container.style.zIndex && (this.getDom().style.zIndex = this.editor.container.style.zIndex * 1 + 10);\r\n                    this._hidden = false;\r\n                    this.fireEvent('show');\r\n                    baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex = this.getDom().style.zIndex - 4;\r\n                }\r\n            },\r\n            isHidden: function () {\r\n                return this._hidden;\r\n            },\r\n            _hide: function () {\r\n                if (!this._hidden) {\r\n                    var wrapNode = this.getDom();\r\n                    wrapNode.style.display = 'none';\r\n                    wrapNode.style.zIndex = '';\r\n                    wrapNode.style.width = '';\r\n                    wrapNode.style.height = '';\r\n                    this._hidden = true;\r\n                    this.fireEvent('hide');\r\n                }\r\n            },\r\n            open: function () {\r\n                if (this.autoReset) {\r\n                    //有可能还没有渲染\r\n                    try {\r\n                        this.reset();\r\n                    } catch (e) {\r\n                        this.render();\r\n                        this.open()\r\n                    }\r\n                }\r\n                this.showAtCenter();\r\n                if (this.iframeUrl) {\r\n                    try {\r\n                        this.getDom('iframe').focus();\r\n                    } catch (ex) { }\r\n                }\r\n                activeDialog = this;\r\n            },\r\n            _onCloseButtonClick: function (evt, el) {\r\n                this.close(false);\r\n            },\r\n            close: function (ok) {\r\n                if (this.fireEvent('close', ok) !== false) {\r\n                    //还原环境\r\n                    if (this.fullscreen) {\r\n\r\n                        document.documentElement.style.overflowX = this._originalContext.html.overflowX;\r\n                        document.documentElement.style.overflowY = this._originalContext.html.overflowY;\r\n                        document.body.style.overflowX = this._originalContext.body.overflowX;\r\n                        document.body.style.overflowY = this._originalContext.body.overflowY;\r\n                        delete this._originalContext;\r\n\r\n                    }\r\n                    this._hide();\r\n\r\n                    //销毁content\r\n                    var content = this.getDom('content');\r\n                    var iframe = this.getDom('iframe');\r\n                    if (content && iframe) {\r\n                        var doc = iframe.contentDocument || iframe.contentWindow.document;\r\n                        doc && (doc.body.innerHTML = '');\r\n                        domUtils.remove(content);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(Dialog, UIBase);\r\n    })();\r\n\r\n\r\n    // ui/menubutton.js\r\n    ///import core\r\n    ///import uicore\r\n    ///import ui/menu.js\r\n    ///import ui/splitbutton.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Menu = baidu.editor.ui.Menu,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            MenuButton = baidu.editor.ui.MenuButton = function (options) {\r\n                this.initOptions(options);\r\n                this.initMenuButton();\r\n            };\r\n        MenuButton.prototype = {\r\n            initMenuButton: function () {\r\n                var me = this;\r\n                this.uiName = \"menubutton\";\r\n                this.popup = new Menu({\r\n                    items: me.items,\r\n                    className: me.className,\r\n                    editor: me.editor\r\n                });\r\n                this.popup.addListener('show', function () {\r\n                    var list = this;\r\n                    for (var i = 0; i < list.items.length; i++) {\r\n                        list.items[i].removeState('checked');\r\n                        if (list.items[i].value == me._value) {\r\n                            list.items[i].addState('checked');\r\n                            this.value = me._value;\r\n                        }\r\n                    }\r\n                });\r\n                this.initSplitButton();\r\n            },\r\n            setValue: function (value) {\r\n                this._value = value;\r\n            }\r\n\r\n        };\r\n        utils.inherits(MenuButton, SplitButton);\r\n    })();\r\n\r\n    // ui/multiMenu.js\r\n    ///import core\r\n    ///import uicore\r\n    ///commands 表情\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            Popup = baidu.editor.ui.Popup,\r\n            SplitButton = baidu.editor.ui.SplitButton,\r\n            MultiMenuPop = baidu.editor.ui.MultiMenuPop = function (options) {\r\n                this.initOptions(options);\r\n                this.initMultiMenu();\r\n            };\r\n\r\n        MultiMenuPop.prototype = {\r\n            initMultiMenu: function () {\r\n                var me = this;\r\n                this.popup = new Popup({\r\n                    content: '',\r\n                    editor: me.editor,\r\n                    iframe_rendered: false,\r\n                    onshow: function () {\r\n                        if (!this.iframe_rendered) {\r\n                            this.iframe_rendered = true;\r\n                            this.getDom('content').innerHTML = '<iframe id=\"' + me.id + '_iframe\" src=\"' + me.iframeUrl + '\" frameborder=\"0\"></iframe>';\r\n                            me.editor.container.style.zIndex && (this.getDom().style.zIndex = me.editor.container.style.zIndex * 1 + 1);\r\n                        }\r\n                    }\r\n                    // canSideUp:false,\r\n                    // canSideLeft:false\r\n                });\r\n                this.onbuttonclick = function () {\r\n                    this.showPopup();\r\n                };\r\n                this.initSplitButton();\r\n            }\r\n\r\n        };\r\n\r\n        utils.inherits(MultiMenuPop, SplitButton);\r\n    })();\r\n\r\n\r\n    // ui/shortcutmenu.js\r\n    (function () {\r\n        var UI = baidu.editor.ui,\r\n            UIBase = UI.UIBase,\r\n            uiUtils = UI.uiUtils,\r\n            utils = baidu.editor.utils,\r\n            domUtils = baidu.editor.dom.domUtils;\r\n\r\n        var allMenus = [],//存储所有快捷菜单\r\n            timeID,\r\n            isSubMenuShow = false;//是否有子pop显示\r\n\r\n        var ShortCutMenu = UI.ShortCutMenu = function (options) {\r\n            this.initOptions(options);\r\n            this.initShortCutMenu();\r\n        };\r\n\r\n        ShortCutMenu.postHide = hideAllMenu;\r\n\r\n        ShortCutMenu.prototype = {\r\n            isHidden: true,\r\n            SPACE: 5,\r\n            initShortCutMenu: function () {\r\n                this.items = this.items || [];\r\n                this.initUIBase();\r\n                this.initItems();\r\n                this.initEvent();\r\n                allMenus.push(this);\r\n            },\r\n            initEvent: function () {\r\n                var me = this,\r\n                    doc = me.editor.document;\r\n\r\n                domUtils.on(doc, \"mousemove\", function (e) {\r\n                    if (me.isHidden === false) {\r\n                        //有pop显示就不隐藏快捷菜单\r\n                        if (me.getSubMenuMark() || me.eventType == \"contextmenu\") return;\r\n\r\n\r\n                        var flag = true,\r\n                            el = me.getDom(),\r\n                            wt = el.offsetWidth,\r\n                            ht = el.offsetHeight,\r\n                            distanceX = wt / 2 + me.SPACE,//距离中心X标准\r\n                            distanceY = ht / 2,//距离中心Y标准\r\n                            x = Math.abs(e.screenX - me.left),//离中心距离横坐标\r\n                            y = Math.abs(e.screenY - me.top);//离中心距离纵坐标\r\n\r\n                        clearTimeout(timeID);\r\n                        timeID = setTimeout(function () {\r\n                            if (y > 0 && y < distanceY) {\r\n                                me.setOpacity(el, \"1\");\r\n                            } else if (y > distanceY && y < distanceY + 70) {\r\n                                me.setOpacity(el, \"0.5\");\r\n                                flag = false;\r\n                            } else if (y > distanceY + 70 && y < distanceY + 140) {\r\n                                me.hide();\r\n                            }\r\n\r\n                            if (flag && x > 0 && x < distanceX) {\r\n                                me.setOpacity(el, \"1\")\r\n                            } else if (x > distanceX && x < distanceX + 70) {\r\n                                me.setOpacity(el, \"0.5\")\r\n                            } else if (x > distanceX + 70 && x < distanceX + 140) {\r\n                                me.hide();\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n                //ie\\ff下 mouseout不准\r\n                if (browser.chrome) {\r\n                    domUtils.on(doc, \"mouseout\", function (e) {\r\n                        var relatedTgt = e.relatedTarget || e.toElement;\r\n\r\n                        if (relatedTgt == null || relatedTgt.tagName == \"HTML\") {\r\n                            me.hide();\r\n                        }\r\n                    });\r\n                }\r\n\r\n                me.editor.addListener(\"afterhidepop\", function () {\r\n                    if (!me.isHidden) {\r\n                        isSubMenuShow = true;\r\n                    }\r\n                });\r\n\r\n            },\r\n            initItems: function () {\r\n                if (utils.isArray(this.items)) {\r\n                    for (var i = 0, len = this.items.length; i < len; i++) {\r\n                        var item = this.items[i].toLowerCase();\r\n\r\n                        if (UI[item]) {\r\n                            this.items[i] = new UI[item](this.editor);\r\n                            this.items[i].className += \" edui-shortcutsubmenu \";\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            setOpacity: function (el, value) {\r\n                if (browser.ie && browser.version < 9) {\r\n                    el.style.filter = \"alpha(opacity = \" + parseFloat(value) * 100 + \");\"\r\n                } else {\r\n                    el.style.opacity = value;\r\n                }\r\n            },\r\n            getSubMenuMark: function () {\r\n                isSubMenuShow = false;\r\n                var layerEle = uiUtils.getFixedLayer();\r\n                var list = domUtils.getElementsByTagName(layerEle, \"div\", function (node) {\r\n                    return domUtils.hasClass(node, \"edui-shortcutsubmenu edui-popup\")\r\n                });\r\n\r\n                for (var i = 0, node; node = list[i++];) {\r\n                    if (node.style.display != \"none\") {\r\n                        isSubMenuShow = true;\r\n                    }\r\n                }\r\n                return isSubMenuShow;\r\n            },\r\n            show: function (e, hasContextmenu) {\r\n                var me = this,\r\n                    offset = {},\r\n                    el = this.getDom(),\r\n                    fixedlayer = uiUtils.getFixedLayer();\r\n\r\n                function setPos(offset) {\r\n                    if (offset.left < 0) {\r\n                        offset.left = 0;\r\n                    }\r\n                    if (offset.top < 0) {\r\n                        offset.top = 0;\r\n                    }\r\n                    el.style.cssText = \"position:absolute;left:\" + offset.left + \"px;top:\" + offset.top + \"px;\";\r\n                }\r\n\r\n                function setPosByCxtMenu(menu) {\r\n                    if (!menu.tagName) {\r\n                        menu = menu.getDom();\r\n                    }\r\n                    offset.left = parseInt(menu.style.left);\r\n                    offset.top = parseInt(menu.style.top);\r\n                    offset.top -= el.offsetHeight + 15;\r\n                    setPos(offset);\r\n                }\r\n\r\n\r\n                me.eventType = e.type;\r\n                el.style.cssText = \"display:block;left:-9999px\";\r\n\r\n                if (e.type == \"contextmenu\" && hasContextmenu) {\r\n                    var menu = domUtils.getElementsByTagName(fixedlayer, \"div\", \"edui-contextmenu\")[0];\r\n                    if (menu) {\r\n                        setPosByCxtMenu(menu)\r\n                    } else {\r\n                        me.editor.addListener(\"aftershowcontextmenu\", function (type, menu) {\r\n                            setPosByCxtMenu(menu);\r\n                        });\r\n                    }\r\n                } else {\r\n                    offset = uiUtils.getViewportOffsetByEvent(e);\r\n                    offset.top -= el.offsetHeight + me.SPACE;\r\n                    offset.left += me.SPACE + 20;\r\n                    setPos(offset);\r\n                    me.setOpacity(el, 0.2);\r\n                }\r\n\r\n\r\n                me.isHidden = false;\r\n                me.left = e.screenX + el.offsetWidth / 2 - me.SPACE;\r\n                me.top = e.screenY - (el.offsetHeight / 2) - me.SPACE;\r\n\r\n                if (me.editor) {\r\n                    el.style.zIndex = me.editor.container.style.zIndex * 1 + 10;\r\n                    fixedlayer.style.zIndex = el.style.zIndex - 1;\r\n                }\r\n            },\r\n            hide: function () {\r\n                if (this.getDom()) {\r\n                    this.getDom().style.display = \"none\";\r\n                }\r\n                this.isHidden = true;\r\n            },\r\n            postRender: function () {\r\n                if (utils.isArray(this.items)) {\r\n                    for (var i = 0, item; item = this.items[i++];) {\r\n                        item.postRender();\r\n                    }\r\n                }\r\n            },\r\n            getHtmlTpl: function () {\r\n                var buff;\r\n                if (utils.isArray(this.items)) {\r\n                    buff = [];\r\n                    for (var i = 0; i < this.items.length; i++) {\r\n                        buff[i] = this.items[i].renderHtml();\r\n                    }\r\n                    buff = buff.join(\"\");\r\n                } else {\r\n                    buff = this.items;\r\n                }\r\n\r\n                return '<div id=\"##\" class=\"%% edui-toolbar\" data-src=\"shortcutmenu\" onmousedown=\"return false;\" onselectstart=\"return false;\" >' +\r\n                    buff +\r\n                    '</div>';\r\n            }\r\n        };\r\n\r\n        utils.inherits(ShortCutMenu, UIBase);\r\n\r\n        function hideAllMenu(e) {\r\n            var tgt = e.target || e.srcElement,\r\n                cur = domUtils.findParent(tgt, function (node) {\r\n                    return domUtils.hasClass(node, \"edui-shortcutmenu\") || domUtils.hasClass(node, \"edui-popup\");\r\n                }, true);\r\n\r\n            if (!cur) {\r\n                for (var i = 0, menu; menu = allMenus[i++];) {\r\n                    menu.hide()\r\n                }\r\n            }\r\n        }\r\n\r\n        domUtils.on(document, 'mousedown', function (e) {\r\n            hideAllMenu(e);\r\n        });\r\n\r\n        domUtils.on(window, 'scroll', function (e) {\r\n            hideAllMenu(e);\r\n        });\r\n\r\n    })();\r\n\r\n\r\n    // ui/breakline.js\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Breakline = baidu.editor.ui.Breakline = function (options) {\r\n                this.initOptions(options);\r\n                this.initSeparator();\r\n            };\r\n        Breakline.prototype = {\r\n            uiName: 'Breakline',\r\n            initSeparator: function () {\r\n                this.initUIBase();\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<br/>';\r\n            }\r\n        };\r\n        utils.inherits(Breakline, UIBase);\r\n\r\n    })();\r\n\r\n\r\n    // ui/message.js\r\n    ///import core\r\n    ///import uicore\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            domUtils = baidu.editor.dom.domUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            Message = baidu.editor.ui.Message = function (options) {\r\n                this.initOptions(options);\r\n                this.initMessage();\r\n            };\r\n\r\n        Message.prototype = {\r\n            initMessage: function () {\r\n                this.initUIBase();\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"edui-message %%\">' +\r\n                    ' <div id=\"##_closer\" class=\"edui-message-closer\">×</div>' +\r\n                    ' <div id=\"##_body\" class=\"edui-message-body edui-message-type-info\">' +\r\n                    ' <iframe style=\"position:absolute;z-index:-1;left:0;top:0;background-color: transparent;\" frameborder=\"0\" width=\"100%\" height=\"100%\" src=\"about:blank\"></iframe>' +\r\n                    ' <div class=\"edui-shadow\"></div>' +\r\n                    ' <div id=\"##_content\" class=\"edui-message-content\">' +\r\n                    '  </div>' +\r\n                    ' </div>' +\r\n                    '</div>';\r\n            },\r\n            reset: function (opt) {\r\n                var me = this;\r\n                if (!opt.keepshow) {\r\n                    clearTimeout(this.timer);\r\n                    me.timer = setTimeout(function () {\r\n                        me.hide();\r\n                    }, opt.timeout || 4000);\r\n                }\r\n\r\n                opt.content !== undefined && me.setContent(opt.content);\r\n                opt.type !== undefined && me.setType(opt.type);\r\n\r\n                me.show();\r\n            },\r\n            postRender: function () {\r\n                var me = this,\r\n                    closer = this.getDom('closer');\r\n                closer && domUtils.on(closer, 'click', function () {\r\n                    me.hide();\r\n                });\r\n            },\r\n            setContent: function (content) {\r\n                if (this.getDom('content')) {\r\n                    this.getDom('content').innerHTML = content;\r\n                }\r\n            },\r\n            setType: function (type) {\r\n                type = type || 'info';\r\n                var body = this.getDom('body');\r\n                body.className = body.className.replace(/edui-message-type-[\\w-]+/, 'edui-message-type-' + type);\r\n            },\r\n            getContent: function () {\r\n                return this.getDom('content').innerHTML;\r\n            },\r\n            getType: function () {\r\n                var arr = this.getDom('body').match(/edui-message-type-([\\w-]+)/);\r\n                return arr ? arr[1] : '';\r\n            },\r\n            show: function () {\r\n                this.getDom().style.display = 'block';\r\n            },\r\n            hide: function () {\r\n                var dom = this.getDom();\r\n                if (dom) {\r\n                    dom.style.display = 'none';\r\n                    dom.parentNode && dom.parentNode.removeChild(dom);\r\n                }\r\n            }\r\n        };\r\n\r\n        utils.inherits(Message, UIBase);\r\n\r\n    })();\r\n\r\n\r\n    // adapter/editorui.js\r\n    //ui跟编辑器的适配層\r\n    //那个按钮弹出是dialog，是下拉筐等都是在这个js中配置\r\n    //自己写的ui也要在这里配置，放到baidu.editor.ui下边，当编辑器实例化的时候会根据ueditor.config中的toolbars找到相应的进行实例化\r\n    (function () {\r\n        var utils = baidu.editor.utils;\r\n        var editorui = baidu.editor.ui;\r\n        var _Dialog = editorui.Dialog;\r\n        editorui.buttons = {};\r\n\r\n        editorui.Dialog = function (options) {\r\n            var dialog = new _Dialog(options);\r\n            dialog.addListener('hide', function () {\r\n\r\n                if (dialog.editor) {\r\n                    var editor = dialog.editor;\r\n                    try {\r\n                        if (browser.gecko) {\r\n                            var y = editor.window.scrollY,\r\n                                x = editor.window.scrollX;\r\n                            editor.body.focus();\r\n                            editor.window.scrollTo(x, y);\r\n                        } else {\r\n                            editor.focus();\r\n                        }\r\n\r\n\r\n                    } catch (ex) {\r\n                    }\r\n                }\r\n            });\r\n            return dialog;\r\n        };\r\n\r\n        var iframeUrlMap = {\r\n            'anchor': '~/dialogs/anchor/anchor.html',\r\n            'insertimage': '~/dialogs/image/image.html',\r\n            'link': '~/dialogs/link/link.html',\r\n            'spechars': '~/dialogs/spechars/spechars.html',\r\n            'searchreplace': '~/dialogs/searchreplace/searchreplace.html',\r\n            'map': '~/dialogs/map/map.html',\r\n            'gmap': '~/dialogs/gmap/gmap.html',\r\n            'insertvideo': '~/dialogs/video/video.html',\r\n            'help': '~/dialogs/help/help.html',\r\n            'preview': '~/dialogs/preview/preview.html',\r\n            'emotion': '~/dialogs/emotion/emotion.html',\r\n            'wordimage': '~/dialogs/wordimage/wordimage.html',\r\n            'attachment': '~/dialogs/attachment/attachment.html',\r\n            'insertframe': '~/dialogs/insertframe/insertframe.html',\r\n            'edittip': '~/dialogs/table/edittip.html',\r\n            'edittable': '~/dialogs/table/edittable.html',\r\n            'edittd': '~/dialogs/table/edittd.html',\r\n            'webapp': '~/dialogs/webapp/webapp.html',\r\n            'snapscreen': '~/dialogs/snapscreen/snapscreen.html',\r\n            'scrawl': '~/dialogs/scrawl/scrawl.html',\r\n            'music': '~/dialogs/music/music.html',\r\n            'template': '~/dialogs/template/template.html',\r\n            'background': '~/dialogs/background/background.html',\r\n            'charts': '~/dialogs/charts/charts.html'\r\n        };\r\n        //为工具栏添加按钮，以下都是统一的按钮触发命令，所以写在一起\r\n        var btnCmds = ['undo', 'redo', 'formatmatch',\r\n            'bold', 'italic', 'underline', 'fontborder', 'touppercase', 'tolowercase',\r\n            'strikethrough', 'subscript', 'superscript', 'source', 'indent', 'outdent',\r\n            'blockquote', 'pasteplain', 'pagebreak',\r\n            'selectall', 'print', 'horizontal', 'removeformat', 'time', 'date', 'unlink',\r\n            'insertparagraphbeforetable', 'insertrow', 'insertcol', 'mergeright', 'mergedown', 'deleterow',\r\n            'deletecol', 'splittorows', 'splittocols', 'splittocells', 'mergecells', 'deletetable', 'drafts'];\r\n\r\n        for (var i = 0, ci; ci = btnCmds[i++];) {\r\n            ci = ci.toLowerCase();\r\n            editorui[ci] = function (cmd) {\r\n                return function (editor) {\r\n                    var ui = new editorui.Button({\r\n                        className: 'edui-for-' + cmd,\r\n                        title: editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '',\r\n                        onclick: function () {\r\n                            editor.execCommand(cmd);\r\n                        },\r\n                        theme: editor.options.theme,\r\n                        showText: false\r\n                    });\r\n                    editorui.buttons[cmd] = ui;\r\n                    editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                        var state = editor.queryCommandState(cmd);\r\n                        if (state == -1) {\r\n                            ui.setDisabled(true);\r\n                            ui.setChecked(false);\r\n                        } else {\r\n                            if (!uiReady) {\r\n                                ui.setDisabled(false);\r\n                                ui.setChecked(state);\r\n                            }\r\n                        }\r\n                    });\r\n                    return ui;\r\n                };\r\n            }(ci);\r\n        }\r\n\r\n        //清除文档\r\n        editorui.cleardoc = function (editor) {\r\n            var ui = new editorui.Button({\r\n                className: 'edui-for-cleardoc',\r\n                title: editor.options.labelMap.cleardoc || editor.getLang(\"labelMap.cleardoc\") || '',\r\n                theme: editor.options.theme,\r\n                onclick: function () {\r\n                    if (confirm(editor.getLang(\"confirmClear\"))) {\r\n                        editor.execCommand('cleardoc');\r\n                    }\r\n                }\r\n            });\r\n            editorui.buttons[\"cleardoc\"] = ui;\r\n            editor.addListener('selectionchange', function () {\r\n                ui.setDisabled(editor.queryCommandState('cleardoc') == -1);\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        //排版，图片排版，文字方向\r\n        var typeset = {\r\n            'justify': ['left', 'right', 'center', 'justify'],\r\n            'imagefloat': ['none', 'left', 'center', 'right'],\r\n            'directionality': ['ltr', 'rtl']\r\n        };\r\n\r\n        for (var p in typeset) {\r\n\r\n            (function (cmd, val) {\r\n                for (var i = 0, ci; ci = val[i++];) {\r\n                    (function (cmd2) {\r\n                        editorui[cmd.replace('float', '') + cmd2] = function (editor) {\r\n                            var ui = new editorui.Button({\r\n                                className: 'edui-for-' + cmd.replace('float', '') + cmd2,\r\n                                title: editor.options.labelMap[cmd.replace('float', '') + cmd2] || editor.getLang(\"labelMap.\" + cmd.replace('float', '') + cmd2) || '',\r\n                                theme: editor.options.theme,\r\n                                onclick: function () {\r\n                                    editor.execCommand(cmd, cmd2);\r\n                                }\r\n                            });\r\n                            editorui.buttons[cmd] = ui;\r\n                            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                                ui.setDisabled(editor.queryCommandState(cmd) == -1);\r\n                                ui.setChecked(editor.queryCommandValue(cmd) == cmd2 && !uiReady);\r\n                            });\r\n                            return ui;\r\n                        };\r\n                    })(ci)\r\n                }\r\n            })(p, typeset[p])\r\n        }\r\n\r\n        //字体颜色和背景颜色\r\n        for (var i = 0, ci; ci = ['backcolor', 'forecolor'][i++];) {\r\n            editorui[ci] = function (cmd) {\r\n                return function (editor) {\r\n                    var ui = new editorui.ColorButton({\r\n                        className: 'edui-for-' + cmd,\r\n                        color: 'default',\r\n                        title: editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '',\r\n                        editor: editor,\r\n                        onpickcolor: function (t, color) {\r\n                            editor.execCommand(cmd, color);\r\n                        },\r\n                        onpicknocolor: function () {\r\n                            editor.execCommand(cmd, 'default');\r\n                            this.setColor('transparent');\r\n                            this.color = 'default';\r\n                        },\r\n                        onbuttonclick: function () {\r\n                            editor.execCommand(cmd, this.color);\r\n                        }\r\n                    });\r\n                    editorui.buttons[cmd] = ui;\r\n                    editor.addListener('selectionchange', function () {\r\n                        ui.setDisabled(editor.queryCommandState(cmd) == -1);\r\n                    });\r\n                    return ui;\r\n                };\r\n            }(ci);\r\n        }\r\n\r\n\r\n        var dialogBtns = {\r\n            noOk: ['searchreplace', 'help', 'spechars', 'webapp', 'preview'],\r\n            ok: ['attachment', 'anchor', 'link', 'insertimage', 'map', 'gmap', 'insertframe', 'wordimage',\r\n                'insertvideo', 'insertframe', 'edittip', 'edittable', 'edittd', 'scrawl', 'template', 'music', 'background', 'charts']\r\n        };\r\n\r\n        for (var p in dialogBtns) {\r\n            (function (type, vals) {\r\n                for (var i = 0, ci; ci = vals[i++];) {\r\n                    //todo opera下存在问题\r\n                    if (browser.opera && ci === \"searchreplace\") {\r\n                        continue;\r\n                    }\r\n                    (function (cmd) {\r\n                        editorui[cmd] = function (editor, iframeUrl, title) {\r\n                            iframeUrl = iframeUrl || (editor.options.iframeUrlMap || {})[cmd] || iframeUrlMap[cmd];\r\n                            title = editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '';\r\n\r\n                            var dialog;\r\n                            //没有iframeUrl不创建dialog\r\n                            if (iframeUrl) {\r\n                                dialog = new editorui.Dialog(utils.extend({\r\n                                    iframeUrl: editor.ui.mapUrl(iframeUrl),\r\n                                    editor: editor,\r\n                                    className: 'edui-for-' + cmd,\r\n                                    title: title,\r\n                                    holdScroll: cmd === 'insertimage',\r\n                                    fullscreen: /charts|preview/.test(cmd),\r\n                                    closeDialog: editor.getLang(\"closeDialog\")\r\n                                }, type == 'ok' ? {\r\n                                    buttons: [\r\n                                        {\r\n                                            className: 'edui-okbutton',\r\n                                            label: editor.getLang(\"ok\"),\r\n                                            editor: editor,\r\n                                            onclick: function () {\r\n                                                dialog.close(true);\r\n                                            }\r\n                                        },\r\n                                        {\r\n                                            className: 'edui-cancelbutton',\r\n                                            label: editor.getLang(\"cancel\"),\r\n                                            editor: editor,\r\n                                            onclick: function () {\r\n                                                dialog.close(false);\r\n                                            }\r\n                                        }\r\n                                    ]\r\n                                } : {}));\r\n\r\n                                editor.ui._dialogs[cmd + \"Dialog\"] = dialog;\r\n                            }\r\n\r\n                            var ui = new editorui.Button({\r\n                                className: 'edui-for-' + cmd,\r\n                                title: title,\r\n                                onclick: function () {\r\n                                    if (dialog) {\r\n                                        switch (cmd) {\r\n                                            case \"wordimage\":\r\n                                                var images = editor.execCommand(\"wordimage\");\r\n                                                if (images && images.length) {\r\n                                                    dialog.render();\r\n                                                    dialog.open();\r\n                                                }\r\n                                                break;\r\n                                            case \"scrawl\":\r\n                                                if (editor.queryCommandState(\"scrawl\") != -1) {\r\n                                                    dialog.render();\r\n                                                    dialog.open();\r\n                                                }\r\n\r\n                                                break;\r\n                                            default:\r\n                                                dialog.render();\r\n                                                dialog.open();\r\n                                        }\r\n                                    }\r\n                                },\r\n                                theme: editor.options.theme,\r\n                                disabled: (cmd == 'scrawl' && editor.queryCommandState(\"scrawl\") == -1) || (cmd == 'charts')\r\n                            });\r\n                            editorui.buttons[cmd] = ui;\r\n                            editor.addListener('selectionchange', function () {\r\n                                //只存在于右键菜单而无工具栏按钮的ui不需要检测状态\r\n                                var unNeedCheckState = { 'edittable': 1 };\r\n                                if (cmd in unNeedCheckState) return;\r\n\r\n                                var state = editor.queryCommandState(cmd);\r\n                                if (ui.getDom()) {\r\n                                    ui.setDisabled(state == -1);\r\n                                    ui.setChecked(state);\r\n                                }\r\n\r\n                            });\r\n\r\n                            return ui;\r\n                        };\r\n                    })(ci.toLowerCase())\r\n                }\r\n            })(p, dialogBtns[p]);\r\n        }\r\n\r\n        editorui.snapscreen = function (editor, iframeUrl, title) {\r\n            title = editor.options.labelMap['snapscreen'] || editor.getLang(\"labelMap.snapscreen\") || '';\r\n            var ui = new editorui.Button({\r\n                className: 'edui-for-snapscreen',\r\n                title: title,\r\n                onclick: function () {\r\n                    editor.execCommand(\"snapscreen\");\r\n                },\r\n                theme: editor.options.theme\r\n\r\n            });\r\n            editorui.buttons['snapscreen'] = ui;\r\n            iframeUrl = iframeUrl || (editor.options.iframeUrlMap || {})[\"snapscreen\"] || iframeUrlMap[\"snapscreen\"];\r\n            if (iframeUrl) {\r\n                var dialog = new editorui.Dialog({\r\n                    iframeUrl: editor.ui.mapUrl(iframeUrl),\r\n                    editor: editor,\r\n                    className: 'edui-for-snapscreen',\r\n                    title: title,\r\n                    buttons: [\r\n                        {\r\n                            className: 'edui-okbutton',\r\n                            label: editor.getLang(\"ok\"),\r\n                            editor: editor,\r\n                            onclick: function () {\r\n                                dialog.close(true);\r\n                            }\r\n                        },\r\n                        {\r\n                            className: 'edui-cancelbutton',\r\n                            label: editor.getLang(\"cancel\"),\r\n                            editor: editor,\r\n                            onclick: function () {\r\n                                dialog.close(false);\r\n                            }\r\n                        }\r\n                    ]\r\n\r\n                });\r\n                dialog.render();\r\n                editor.ui._dialogs[\"snapscreenDialog\"] = dialog;\r\n            }\r\n            editor.addListener('selectionchange', function () {\r\n                ui.setDisabled(editor.queryCommandState('snapscreen') == -1);\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        editorui.insertcode = function (editor, list, title) {\r\n            list = editor.options['insertcode'] || [];\r\n            title = editor.options.labelMap['insertcode'] || editor.getLang(\"labelMap.insertcode\") || '';\r\n            // if (!list.length) return;\r\n            var items = [];\r\n            utils.each(list, function (key, val) {\r\n                items.push({\r\n                    label: key,\r\n                    value: val,\r\n                    theme: editor.options.theme,\r\n                    renderLabelHtml: function () {\r\n                        return '<div class=\"edui-label %%-label\" >' + (this.label || '') + '</div>';\r\n                    }\r\n                });\r\n            });\r\n\r\n            var ui = new editorui.Combox({\r\n                editor: editor,\r\n                items: items,\r\n                onselect: function (t, index) {\r\n                    editor.execCommand('insertcode', this.items[index].value);\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                },\r\n                title: title,\r\n                initValue: title,\r\n                className: 'edui-for-insertcode',\r\n                indexByValue: function (value) {\r\n                    if (value) {\r\n                        for (var i = 0, ci; ci = this.items[i]; i++) {\r\n                            if (ci.value.indexOf(value) != -1)\r\n                                return i;\r\n                        }\r\n                    }\r\n\r\n                    return -1;\r\n                }\r\n            });\r\n            editorui.buttons['insertcode'] = ui;\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                if (!uiReady) {\r\n                    var state = editor.queryCommandState('insertcode');\r\n                    if (state == -1) {\r\n                        ui.setDisabled(true);\r\n                    } else {\r\n                        ui.setDisabled(false);\r\n                        var value = editor.queryCommandValue('insertcode');\r\n                        if (!value) {\r\n                            ui.setValue(title);\r\n                            return;\r\n                        }\r\n                        //trace:1871 ie下从源码模式切换回来时，字体会带单引号，而且会有逗号\r\n                        value && (value = value.replace(/['\"]/g, '').split(',')[0]);\r\n                        ui.setValue(value);\r\n\r\n                    }\r\n                }\r\n\r\n            });\r\n            return ui;\r\n        };\r\n        editorui.fontfamily = function (editor, list, title) {\r\n\r\n            list = editor.options['fontfamily'] || [];\r\n            title = editor.options.labelMap['fontfamily'] || editor.getLang(\"labelMap.fontfamily\") || '';\r\n            if (!list.length) return;\r\n            for (var i = 0, ci, items = []; ci = list[i]; i++) {\r\n                var langLabel = editor.getLang('fontfamily')[ci.name] || \"\";\r\n                (function (key, val) {\r\n                    items.push({\r\n                        label: key,\r\n                        value: val,\r\n                        theme: editor.options.theme,\r\n                        renderLabelHtml: function () {\r\n                            return '<div class=\"edui-label %%-label\" style=\"font-family:' +\r\n                                utils.unhtml(this.value) + '\">' + (this.label || '') + '</div>';\r\n                        }\r\n                    });\r\n                })(ci.label || langLabel, ci.val)\r\n            }\r\n            var ui = new editorui.Combox({\r\n                editor: editor,\r\n                items: items,\r\n                onselect: function (t, index) {\r\n                    editor.execCommand('FontFamily', this.items[index].value);\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                },\r\n                title: title,\r\n                initValue: title,\r\n                className: 'edui-for-fontfamily',\r\n                indexByValue: function (value) {\r\n                    if (value) {\r\n                        for (var i = 0, ci; ci = this.items[i]; i++) {\r\n                            if (ci.value.indexOf(value) != -1)\r\n                                return i;\r\n                        }\r\n                    }\r\n\r\n                    return -1;\r\n                }\r\n            });\r\n            editorui.buttons['fontfamily'] = ui;\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                if (!uiReady) {\r\n                    var state = editor.queryCommandState('FontFamily');\r\n                    if (state == -1) {\r\n                        ui.setDisabled(true);\r\n                    } else {\r\n                        ui.setDisabled(false);\r\n                        var value = editor.queryCommandValue('FontFamily');\r\n                        //trace:1871 ie下从源码模式切换回来时，字体会带单引号，而且会有逗号\r\n                        value && (value = value.replace(/['\"]/g, '').split(',')[0]);\r\n                        ui.setValue(value);\r\n\r\n                    }\r\n                }\r\n\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        editorui.fontsize = function (editor, list, title) {\r\n            title = editor.options.labelMap['fontsize'] || editor.getLang(\"labelMap.fontsize\") || '';\r\n            list = list || editor.options['fontsize'] || [];\r\n            if (!list.length) return;\r\n            var items = [];\r\n            for (var i = 0; i < list.length; i++) {\r\n                var size = list[i] + 'px';\r\n                items.push({\r\n                    label: size,\r\n                    value: size,\r\n                    theme: editor.options.theme,\r\n                    renderLabelHtml: function () {\r\n                        return '<div class=\"edui-label %%-label\" style=\"line-height:1;font-size:' +\r\n                            this.value + '\">' + (this.label || '') + '</div>';\r\n                    }\r\n                });\r\n            }\r\n            var ui = new editorui.Combox({\r\n                editor: editor,\r\n                items: items,\r\n                title: title,\r\n                initValue: title,\r\n                onselect: function (t, index) {\r\n                    editor.execCommand('FontSize', this.items[index].value);\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                },\r\n                className: 'edui-for-fontsize'\r\n            });\r\n            editorui.buttons['fontsize'] = ui;\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                if (!uiReady) {\r\n                    var state = editor.queryCommandState('FontSize');\r\n                    if (state == -1) {\r\n                        ui.setDisabled(true);\r\n                    } else {\r\n                        ui.setDisabled(false);\r\n                        ui.setValue(editor.queryCommandValue('FontSize'));\r\n                    }\r\n                }\r\n\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        editorui.paragraph = function (editor, list, title) {\r\n            title = editor.options.labelMap['paragraph'] || editor.getLang(\"labelMap.paragraph\") || '';\r\n            list = editor.options['paragraph'] || [];\r\n            if (utils.isEmptyObject(list)) return;\r\n            var items = [];\r\n            for (var i in list) {\r\n                items.push({\r\n                    value: i,\r\n                    label: list[i] || editor.getLang(\"paragraph\")[i],\r\n                    theme: editor.options.theme,\r\n                    renderLabelHtml: function () {\r\n                        return '<div class=\"edui-label %%-label\"><span class=\"edui-for-' + this.value + '\">' + (this.label || '') + '</span></div>';\r\n                    }\r\n                })\r\n            }\r\n            var ui = new editorui.Combox({\r\n                editor: editor,\r\n                items: items,\r\n                title: title,\r\n                initValue: title,\r\n                className: 'edui-for-paragraph',\r\n                onselect: function (t, index) {\r\n                    editor.execCommand('Paragraph', this.items[index].value);\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                }\r\n            });\r\n            editorui.buttons['paragraph'] = ui;\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                if (!uiReady) {\r\n                    var state = editor.queryCommandState('Paragraph');\r\n                    if (state == -1) {\r\n                        ui.setDisabled(true);\r\n                    } else {\r\n                        ui.setDisabled(false);\r\n                        var value = editor.queryCommandValue('Paragraph');\r\n                        var index = ui.indexByValue(value);\r\n                        if (index != -1) {\r\n                            ui.setValue(value);\r\n                        } else {\r\n                            ui.setValue(ui.initValue);\r\n                        }\r\n                    }\r\n                }\r\n\r\n            });\r\n            return ui;\r\n        };\r\n\r\n\r\n        //自定义标题\r\n        editorui.customstyle = function (editor) {\r\n            var list = editor.options['customstyle'] || [],\r\n                title = editor.options.labelMap['customstyle'] || editor.getLang(\"labelMap.customstyle\") || '';\r\n            if (!list.length) return;\r\n            var langCs = editor.getLang('customstyle');\r\n            for (var i = 0, items = [], t; t = list[i++];) {\r\n                (function (t) {\r\n                    var ck = {};\r\n                    ck.label = t.label ? t.label : langCs[t.name];\r\n                    ck.style = t.style;\r\n                    ck.className = t.className;\r\n                    ck.tag = t.tag;\r\n                    items.push({\r\n                        label: ck.label,\r\n                        value: ck,\r\n                        theme: editor.options.theme,\r\n                        renderLabelHtml: function () {\r\n                            return '<div class=\"edui-label %%-label\">' + '<' + ck.tag + ' ' + (ck.className ? ' class=\"' + ck.className + '\"' : \"\")\r\n                                + (ck.style ? ' style=\"' + ck.style + '\"' : \"\") + '>' + ck.label + \"<\\/\" + ck.tag + \">\"\r\n                                + '</div>';\r\n                        }\r\n                    });\r\n                })(t);\r\n            }\r\n\r\n            var ui = new editorui.Combox({\r\n                editor: editor,\r\n                items: items,\r\n                title: title,\r\n                initValue: title,\r\n                className: 'edui-for-customstyle',\r\n                onselect: function (t, index) {\r\n                    editor.execCommand('customstyle', this.items[index].value);\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                },\r\n                indexByValue: function (value) {\r\n                    for (var i = 0, ti; ti = this.items[i++];) {\r\n                        if (ti.label == value) {\r\n                            return i - 1\r\n                        }\r\n                    }\r\n                    return -1;\r\n                }\r\n            });\r\n            editorui.buttons['customstyle'] = ui;\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                if (!uiReady) {\r\n                    var state = editor.queryCommandState('customstyle');\r\n                    if (state == -1) {\r\n                        ui.setDisabled(true);\r\n                    } else {\r\n                        ui.setDisabled(false);\r\n                        var value = editor.queryCommandValue('customstyle');\r\n                        var index = ui.indexByValue(value);\r\n                        if (index != -1) {\r\n                            ui.setValue(value);\r\n                        } else {\r\n                            ui.setValue(ui.initValue);\r\n                        }\r\n                    }\r\n                }\r\n\r\n            });\r\n            return ui;\r\n        };\r\n        editorui.inserttable = function (editor, iframeUrl, title) {\r\n            title = editor.options.labelMap['inserttable'] || editor.getLang(\"labelMap.inserttable\") || '';\r\n            var ui = new editorui.TableButton({\r\n                editor: editor,\r\n                title: title,\r\n                className: 'edui-for-inserttable',\r\n                onpicktable: function (t, numCols, numRows) {\r\n                    editor.execCommand('InsertTable', { numRows: numRows, numCols: numCols, border: 1 });\r\n                },\r\n                onbuttonclick: function () {\r\n                    this.showPopup();\r\n                }\r\n            });\r\n            editorui.buttons['inserttable'] = ui;\r\n            editor.addListener('selectionchange', function () {\r\n                ui.setDisabled(editor.queryCommandState('inserttable') == -1);\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        editorui.lineheight = function (editor) {\r\n            var val = editor.options.lineheight || [];\r\n            if (!val.length) return;\r\n            for (var i = 0, ci, items = []; ci = val[i++];) {\r\n                items.push({\r\n                    //todo:写死了\r\n                    label: ci,\r\n                    value: ci,\r\n                    theme: editor.options.theme,\r\n                    onclick: function () {\r\n                        editor.execCommand(\"lineheight\", this.value);\r\n                    }\r\n                })\r\n            }\r\n            var ui = new editorui.MenuButton({\r\n                editor: editor,\r\n                className: 'edui-for-lineheight',\r\n                title: editor.options.labelMap['lineheight'] || editor.getLang(\"labelMap.lineheight\") || '',\r\n                items: items,\r\n                onbuttonclick: function () {\r\n                    var value = editor.queryCommandValue('LineHeight') || this.value;\r\n                    editor.execCommand(\"LineHeight\", value);\r\n                }\r\n            });\r\n            editorui.buttons['lineheight'] = ui;\r\n            editor.addListener('selectionchange', function () {\r\n                var state = editor.queryCommandState('LineHeight');\r\n                if (state == -1) {\r\n                    ui.setDisabled(true);\r\n                } else {\r\n                    ui.setDisabled(false);\r\n                    var value = editor.queryCommandValue('LineHeight');\r\n                    value && ui.setValue((value + '').replace(/cm/, ''));\r\n                    ui.setChecked(state)\r\n                }\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        var rowspacings = ['top', 'bottom'];\r\n        for (var r = 0, ri; ri = rowspacings[r++];) {\r\n            (function (cmd) {\r\n                editorui['rowspacing' + cmd] = function (editor) {\r\n                    var val = editor.options['rowspacing' + cmd] || [];\r\n                    if (!val.length) return null;\r\n                    for (var i = 0, ci, items = []; ci = val[i++];) {\r\n                        items.push({\r\n                            label: ci,\r\n                            value: ci,\r\n                            theme: editor.options.theme,\r\n                            onclick: function () {\r\n                                editor.execCommand(\"rowspacing\", this.value, cmd);\r\n                            }\r\n                        })\r\n                    }\r\n                    var ui = new editorui.MenuButton({\r\n                        editor: editor,\r\n                        className: 'edui-for-rowspacing' + cmd,\r\n                        title: editor.options.labelMap['rowspacing' + cmd] || editor.getLang(\"labelMap.rowspacing\" + cmd) || '',\r\n                        items: items,\r\n                        onbuttonclick: function () {\r\n                            var value = editor.queryCommandValue('rowspacing', cmd) || this.value;\r\n                            editor.execCommand(\"rowspacing\", value, cmd);\r\n                        }\r\n                    });\r\n                    editorui.buttons[cmd] = ui;\r\n                    editor.addListener('selectionchange', function () {\r\n                        var state = editor.queryCommandState('rowspacing', cmd);\r\n                        if (state == -1) {\r\n                            ui.setDisabled(true);\r\n                        } else {\r\n                            ui.setDisabled(false);\r\n                            var value = editor.queryCommandValue('rowspacing', cmd);\r\n                            value && ui.setValue((value + '').replace(/%/, ''));\r\n                            ui.setChecked(state)\r\n                        }\r\n                    });\r\n                    return ui;\r\n                }\r\n            })(ri)\r\n        }\r\n        //有序，无序列表\r\n        var lists = ['insertorderedlist', 'insertunorderedlist'];\r\n        for (var l = 0, cl; cl = lists[l++];) {\r\n            (function (cmd) {\r\n                editorui[cmd] = function (editor) {\r\n                    var vals = editor.options[cmd],\r\n                        _onMenuClick = function () {\r\n                            editor.execCommand(cmd, this.value);\r\n                        }, items = [];\r\n                    for (var i in vals) {\r\n                        items.push({\r\n                            label: vals[i] || editor.getLang()[cmd][i] || \"\",\r\n                            value: i,\r\n                            theme: editor.options.theme,\r\n                            onclick: _onMenuClick\r\n                        })\r\n                    }\r\n                    var ui = new editorui.MenuButton({\r\n                        editor: editor,\r\n                        className: 'edui-for-' + cmd,\r\n                        title: editor.getLang(\"labelMap.\" + cmd) || '',\r\n                        'items': items,\r\n                        onbuttonclick: function () {\r\n                            var value = editor.queryCommandValue(cmd) || this.value;\r\n                            editor.execCommand(cmd, value);\r\n                        }\r\n                    });\r\n                    editorui.buttons[cmd] = ui;\r\n                    editor.addListener('selectionchange', function () {\r\n                        var state = editor.queryCommandState(cmd);\r\n                        if (state == -1) {\r\n                            ui.setDisabled(true);\r\n                        } else {\r\n                            ui.setDisabled(false);\r\n                            var value = editor.queryCommandValue(cmd);\r\n                            ui.setValue(value);\r\n                            ui.setChecked(state)\r\n                        }\r\n                    });\r\n                    return ui;\r\n                };\r\n            })(cl)\r\n        }\r\n\r\n        editorui.fullscreen = function (editor, title) {\r\n            title = editor.options.labelMap['fullscreen'] || editor.getLang(\"labelMap.fullscreen\") || '';\r\n            var ui = new editorui.Button({\r\n                className: 'edui-for-fullscreen',\r\n                title: title,\r\n                theme: editor.options.theme,\r\n                onclick: function () {\r\n                    if (editor.ui) {\r\n                        editor.ui.setFullScreen(!editor.ui.isFullScreen());\r\n                    }\r\n                    this.setChecked(editor.ui.isFullScreen());\r\n                }\r\n            });\r\n            editorui.buttons['fullscreen'] = ui;\r\n            editor.addListener('selectionchange', function () {\r\n                var state = editor.queryCommandState('fullscreen');\r\n                ui.setDisabled(state == -1);\r\n                ui.setChecked(editor.ui.isFullScreen());\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        // 表情\r\n        editorui[\"emotion\"] = function (editor, iframeUrl) {\r\n            var cmd = \"emotion\";\r\n            var ui = new editorui.MultiMenuPop({\r\n                title: editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd + \"\") || '',\r\n                editor: editor,\r\n                className: 'edui-for-' + cmd,\r\n                iframeUrl: editor.ui.mapUrl(iframeUrl || (editor.options.iframeUrlMap || {})[cmd] || iframeUrlMap[cmd])\r\n            });\r\n            editorui.buttons[cmd] = ui;\r\n\r\n            editor.addListener('selectionchange', function () {\r\n                ui.setDisabled(editor.queryCommandState(cmd) == -1)\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        editorui.autotypeset = function (editor) {\r\n            var ui = new editorui.AutoTypeSetButton({\r\n                editor: editor,\r\n                title: editor.options.labelMap['autotypeset'] || editor.getLang(\"labelMap.autotypeset\") || '',\r\n                className: 'edui-for-autotypeset',\r\n                onbuttonclick: function () {\r\n                    editor.execCommand('autotypeset')\r\n                }\r\n            });\r\n            editorui.buttons['autotypeset'] = ui;\r\n            editor.addListener('selectionchange', function () {\r\n                ui.setDisabled(editor.queryCommandState('autotypeset') == -1);\r\n            });\r\n            return ui;\r\n        };\r\n\r\n        /* 简单上传插件 */\r\n        editorui[\"simpleupload\"] = function (editor) {\r\n            var name = 'simpleupload',\r\n                ui = new editorui.Button({\r\n                    className: 'edui-for-' + name,\r\n                    title: editor.options.labelMap[name] || editor.getLang(\"labelMap.\" + name) || '',\r\n                    onclick: function () { },\r\n                    theme: editor.options.theme,\r\n                    showText: false\r\n                });\r\n            editorui.buttons[name] = ui;\r\n            editor.addListener('ready', function () {\r\n                var b = ui.getDom('body'),\r\n                    iconSpan = b.children[0];\r\n                editor.fireEvent('simpleuploadbtnready', iconSpan);\r\n            });\r\n            editor.addListener('selectionchange', function (type, causeByUi, uiReady) {\r\n                var state = editor.queryCommandState(name);\r\n                if (state == -1) {\r\n                    ui.setDisabled(true);\r\n                    ui.setChecked(false);\r\n                } else {\r\n                    if (!uiReady) {\r\n                        ui.setDisabled(false);\r\n                        ui.setChecked(state);\r\n                    }\r\n                }\r\n            });\r\n            return ui;\r\n        };\r\n\r\n    })();\r\n\r\n\r\n    // adapter/editor.js\r\n    ///import core\r\n    ///commands 全屏\r\n    ///commandsName FullScreen\r\n    ///commandsTitle  全屏\r\n    (function () {\r\n        var utils = baidu.editor.utils,\r\n            uiUtils = baidu.editor.ui.uiUtils,\r\n            UIBase = baidu.editor.ui.UIBase,\r\n            domUtils = baidu.editor.dom.domUtils;\r\n        var nodeStack = [];\r\n\r\n        function EditorUI(options) {\r\n            this.initOptions(options);\r\n            this.initEditorUI();\r\n        }\r\n\r\n        EditorUI.prototype = {\r\n            uiName: 'editor',\r\n            initEditorUI: function () {\r\n                this.editor.ui = this;\r\n                this._dialogs = {};\r\n                this.initUIBase();\r\n                this._initToolbars();\r\n                var editor = this.editor,\r\n                    me = this;\r\n\r\n                editor.addListener('ready', function () {\r\n                    //提供getDialog方法\r\n                    editor.getDialog = function (name) {\r\n                        return editor.ui._dialogs[name + \"Dialog\"];\r\n                    };\r\n                    domUtils.on(editor.window, 'scroll', function (evt) {\r\n                        baidu.editor.ui.Popup.postHide(evt);\r\n                    });\r\n                    //提供编辑器实时宽高(全屏时宽高不变化)\r\n                    editor.ui._actualFrameWidth = editor.options.initialFrameWidth;\r\n\r\n                    UE.browser.ie && UE.browser.version === 6 && editor.container.ownerDocument.execCommand(\"BackgroundImageCache\", false, true);\r\n\r\n                    //display bottom-bar label based on config\r\n                    if (editor.options.elementPathEnabled) {\r\n                        editor.ui.getDom('elementpath').innerHTML = '<div class=\"edui-editor-breadcrumb\">' + editor.getLang(\"elementPathTip\") + ':</div>';\r\n                    }\r\n                    if (editor.options.wordCount) {\r\n                        function countFn() {\r\n                            setCount(editor, me);\r\n                            domUtils.un(editor.document, \"click\", arguments.callee);\r\n                        }\r\n                        domUtils.on(editor.document, \"click\", countFn);\r\n                        editor.ui.getDom('wordcount').innerHTML = editor.getLang(\"wordCountTip\");\r\n                    }\r\n                    editor.ui._scale();\r\n                    if (editor.options.scaleEnabled) {\r\n                        if (editor.autoHeightEnabled) {\r\n                            editor.disableAutoHeight();\r\n                        }\r\n                        me.enableScale();\r\n                    } else {\r\n                        me.disableScale();\r\n                    }\r\n                    if (!editor.options.elementPathEnabled && !editor.options.wordCount && !editor.options.scaleEnabled) {\r\n                        editor.ui.getDom('elementpath').style.display = \"none\";\r\n                        editor.ui.getDom('wordcount').style.display = \"none\";\r\n                        editor.ui.getDom('scale').style.display = \"none\";\r\n                    }\r\n\r\n                    if (!editor.selection.isFocus()) return;\r\n                    editor.fireEvent('selectionchange', false, true);\r\n\r\n\r\n                });\r\n\r\n                editor.addListener('mousedown', function (t, evt) {\r\n                    var el = evt.target || evt.srcElement;\r\n                    baidu.editor.ui.Popup.postHide(evt, el);\r\n                    baidu.editor.ui.ShortCutMenu.postHide(evt);\r\n\r\n                });\r\n                editor.addListener(\"delcells\", function () {\r\n                    if (UE.ui['edittip']) {\r\n                        new UE.ui['edittip'](editor);\r\n                    }\r\n                    editor.getDialog('edittip').open();\r\n                });\r\n\r\n                var pastePop, isPaste = false, timer;\r\n                editor.addListener(\"afterpaste\", function () {\r\n                    if (editor.queryCommandState('pasteplain'))\r\n                        return;\r\n                    if (baidu.editor.ui.PastePicker) {\r\n                        pastePop = new baidu.editor.ui.Popup({\r\n                            content: new baidu.editor.ui.PastePicker({ editor: editor }),\r\n                            editor: editor,\r\n                            className: 'edui-wordpastepop'\r\n                        });\r\n                        pastePop.render();\r\n                    }\r\n                    isPaste = true;\r\n                });\r\n\r\n                editor.addListener(\"afterinserthtml\", function () {\r\n                    clearTimeout(timer);\r\n                    timer = setTimeout(function () {\r\n                        if (pastePop && (isPaste || editor.ui._isTransfer)) {\r\n                            if (pastePop.isHidden()) {\r\n                                var span = domUtils.createElement(editor.document, 'span', {\r\n                                    'style': \"line-height:0px;\",\r\n                                    'innerHTML': '\\ufeff'\r\n                                }),\r\n                                    range = editor.selection.getRange();\r\n                                range.insertNode(span);\r\n                                var tmp = getDomNode(span, 'firstChild', 'previousSibling');\r\n                                tmp && pastePop.showAnchor(tmp.nodeType == 3 ? tmp.parentNode : tmp);\r\n                                domUtils.remove(span);\r\n                            } else {\r\n                                pastePop.show();\r\n                            }\r\n                            delete editor.ui._isTransfer;\r\n                            isPaste = false;\r\n                        }\r\n                    }, 200)\r\n                });\r\n                editor.addListener('contextmenu', function (t, evt) {\r\n                    baidu.editor.ui.Popup.postHide(evt);\r\n                });\r\n                editor.addListener('keydown', function (t, evt) {\r\n                    if (pastePop) pastePop.dispose(evt);\r\n                    var keyCode = evt.keyCode || evt.which;\r\n                    if (evt.altKey && keyCode == 90) {\r\n                        UE.ui.buttons['fullscreen'].onclick();\r\n                    }\r\n                });\r\n                editor.addListener('wordcount', function (type) {\r\n                    setCount(this, me);\r\n                });\r\n                function setCount(editor, ui) {\r\n                    editor.setOpt({\r\n                        wordCount: true,\r\n                        maximumWords: 10000,\r\n                        wordCountMsg: editor.options.wordCountMsg || editor.getLang(\"wordCountMsg\"),\r\n                        wordOverFlowMsg: editor.options.wordOverFlowMsg || editor.getLang(\"wordOverFlowMsg\")\r\n                    });\r\n                    var opt = editor.options,\r\n                        max = opt.maximumWords,\r\n                        msg = opt.wordCountMsg,\r\n                        errMsg = opt.wordOverFlowMsg,\r\n                        countDom = ui.getDom('wordcount');\r\n                    if (!opt.wordCount) {\r\n                        return;\r\n                    }\r\n                    var count = editor.getContentLength(true);\r\n                    // console.log(countDom,'ccccccccc');\r\n                    if (count > max) {\r\n                        countDom.innerHTML = errMsg;\r\n                        editor.fireEvent(\"wordcountoverflow\");\r\n                    } else {\r\n                        countDom.innerHTML = msg.replace(\"{#leave}\", max - count).replace(\"{#count}\", count);\r\n                    }\r\n                }\r\n\r\n                editor.addListener('selectionchange', function () {\r\n                    if (editor.options.elementPathEnabled) {\r\n                        me[(editor.queryCommandState('elementpath') == -1 ? 'dis' : 'en') + 'ableElementPath']()\r\n                    }\r\n                    if (editor.options.scaleEnabled) {\r\n                        me[(editor.queryCommandState('scale') == -1 ? 'dis' : 'en') + 'ableScale']();\r\n\r\n                    }\r\n                });\r\n                var popup = new baidu.editor.ui.Popup({\r\n                    editor: editor,\r\n                    content: '',\r\n                    className: 'edui-bubble',\r\n                    _onEditButtonClick: function () {\r\n                        this.hide();\r\n                        editor.ui._dialogs.linkDialog.open();\r\n                    },\r\n                    _onImgEditButtonClick: function (name) {\r\n                        this.hide();\r\n                        editor.ui._dialogs[name] && editor.ui._dialogs[name].open();\r\n\r\n                    },\r\n                    _onImgSetFloat: function (value) {\r\n                        this.hide();\r\n                        editor.execCommand(\"imagefloat\", value);\r\n\r\n                    },\r\n                    _setIframeAlign: function (value) {\r\n                        var frame = popup.anchorEl;\r\n                        var newFrame = frame.cloneNode(true);\r\n                        switch (value) {\r\n                            case -2:\r\n                                newFrame.setAttribute(\"align\", \"\");\r\n                                break;\r\n                            case -1:\r\n                                newFrame.setAttribute(\"align\", \"left\");\r\n                                break;\r\n                            case 1:\r\n                                newFrame.setAttribute(\"align\", \"right\");\r\n                                break;\r\n                        }\r\n                        frame.parentNode.insertBefore(newFrame, frame);\r\n                        domUtils.remove(frame);\r\n                        popup.anchorEl = newFrame;\r\n                        popup.showAnchor(popup.anchorEl);\r\n                    },\r\n                    _updateIframe: function () {\r\n                        var frame = editor._iframe = popup.anchorEl;\r\n                        if (domUtils.hasClass(frame, 'ueditor_baidumap')) {\r\n                            editor.selection.getRange().selectNode(frame).select();\r\n                            editor.ui._dialogs.mapDialog.open();\r\n                            popup.hide();\r\n                        } else {\r\n                            editor.ui._dialogs.insertframeDialog.open();\r\n                            popup.hide();\r\n                        }\r\n                    },\r\n                    _onRemoveButtonClick: function (cmdName) {\r\n                        editor.execCommand(cmdName);\r\n                        this.hide();\r\n                    },\r\n                    queryAutoHide: function (el) {\r\n                        if (el && el.ownerDocument == editor.document) {\r\n                            if (el.tagName.toLowerCase() == 'img' || domUtils.findParentByTagName(el, 'a', true)) {\r\n                                return el !== popup.anchorEl;\r\n                            }\r\n                        }\r\n                        return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this, el);\r\n                    }\r\n                });\r\n                popup.render();\r\n                if (editor.options.imagePopup) {\r\n                    editor.addListener('mouseover', function (t, evt) {\r\n                        evt = evt || window.event;\r\n                        var el = evt.target || evt.srcElement;\r\n                        if (editor.ui._dialogs.insertframeDialog && /iframe/ig.test(el.tagName)) {\r\n                            var html = popup.formatHtml(\r\n                                '<nobr>' + editor.getLang(\"property\") + ': <span onclick=$$._setIframeAlign(-2) class=\"edui-clickable\">' + editor.getLang(\"default\") + '</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class=\"edui-clickable\">' + editor.getLang(\"justifyleft\") + '</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class=\"edui-clickable\">' + editor.getLang(\"justifyright\") + '</span>&nbsp;&nbsp;' +\r\n                                ' <span onclick=\"$$._updateIframe( this);\" class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span></nobr>');\r\n                            if (html) {\r\n                                popup.getDom('content').innerHTML = html;\r\n                                popup.anchorEl = el;\r\n                                popup.showAnchor(popup.anchorEl);\r\n                            } else {\r\n                                popup.hide();\r\n                            }\r\n                        }\r\n                    });\r\n                    editor.addListener('selectionchange', function (t, causeByUi) {\r\n                        if (!causeByUi) return;\r\n                        var html = '', str = \"\",\r\n                            img = editor.selection.getRange().getClosedNode(),\r\n                            dialogs = editor.ui._dialogs;\r\n                        if (img && img.tagName == 'IMG') {\r\n                            var dialogName = 'insertimageDialog';\r\n                            if (img.className.indexOf(\"edui-faked-video\") != -1 || img.className.indexOf(\"edui-upload-video\") != -1) {\r\n                                dialogName = \"insertvideoDialog\"\r\n                            }\r\n                            if (img.className.indexOf(\"edui-faked-webapp\") != -1) {\r\n                                dialogName = \"webappDialog\"\r\n                            }\r\n                            if (img.src.indexOf(\"http://api.map.baidu.com\") != -1) {\r\n                                dialogName = \"mapDialog\"\r\n                            }\r\n                            if (img.className.indexOf(\"edui-faked-music\") != -1) {\r\n                                dialogName = \"musicDialog\"\r\n                            }\r\n                            if (img.src.indexOf(\"http://maps.google.com/maps/api/staticmap\") != -1) {\r\n                                dialogName = \"gmapDialog\"\r\n                            }\r\n                            if (img.getAttribute(\"anchorname\")) {\r\n                                dialogName = \"anchorDialog\";\r\n                                html = popup.formatHtml(\r\n                                    '<nobr>' + editor.getLang(\"property\") + ': <span onclick=$$._onImgEditButtonClick(\"anchorDialog\") class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span>&nbsp;&nbsp;' +\r\n                                    '<span onclick=$$._onRemoveButtonClick(\\'anchor\\') class=\"edui-clickable\">' + editor.getLang(\"delete\") + '</span></nobr>');\r\n                            }\r\n                            if (img.getAttribute(\"word_img\")) {\r\n                                //todo 放到dialog去做查询\r\n                                editor.word_img = [img.getAttribute(\"word_img\")];\r\n                                dialogName = \"wordimageDialog\"\r\n                            }\r\n                            if (domUtils.hasClass(img, 'loadingclass') || domUtils.hasClass(img, 'loaderrorclass')) {\r\n                                dialogName = \"\";\r\n                            }\r\n                            if (!dialogs[dialogName]) {\r\n                                return;\r\n                            }\r\n                            str = '<nobr>' + editor.getLang(\"property\") + ': ' +\r\n                                '<span onclick=$$._onImgSetFloat(\"none\") class=\"edui-clickable\">' + editor.getLang(\"default\") + '</span>&nbsp;&nbsp;' +\r\n                                '<span onclick=$$._onImgSetFloat(\"left\") class=\"edui-clickable\">' + editor.getLang(\"justifyleft\") + '</span>&nbsp;&nbsp;' +\r\n                                '<span onclick=$$._onImgSetFloat(\"right\") class=\"edui-clickable\">' + editor.getLang(\"justifyright\") + '</span>&nbsp;&nbsp;' +\r\n                                '<span onclick=$$._onImgSetFloat(\"center\") class=\"edui-clickable\">' + editor.getLang(\"justifycenter\") + '</span>&nbsp;&nbsp;' +\r\n                                '<span onclick=\"$$._onImgEditButtonClick(\\'' + dialogName + '\\');\" class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span></nobr>';\r\n\r\n                            !html && (html = popup.formatHtml(str))\r\n\r\n                        }\r\n                        if (editor.ui._dialogs.linkDialog) {\r\n                            var link = editor.queryCommandValue('link');\r\n                            var url;\r\n                            if (link && (url = (link.getAttribute('_href') || link.getAttribute('href', 2)))) {\r\n                                var txt = url;\r\n                                if (url.length > 30) {\r\n                                    txt = url.substring(0, 20) + \"...\";\r\n                                }\r\n                                if (html) {\r\n                                    html += '<div style=\"height:5px;\"></div>'\r\n                                }\r\n                                html += popup.formatHtml(\r\n                                    '<nobr>' + editor.getLang(\"anthorMsg\") + ': <a target=\"_blank\" href=\"' + url + '\" title=\"' + url + '\" >' + txt + '</a>' +\r\n                                    ' <span class=\"edui-clickable\" onclick=\"$$._onEditButtonClick();\">' + editor.getLang(\"modify\") + '</span>' +\r\n                                    ' <span class=\"edui-clickable\" onclick=\"$$._onRemoveButtonClick(\\'unlink\\');\"> ' + editor.getLang(\"clear\") + '</span></nobr>');\r\n                                popup.showAnchor(link);\r\n                            }\r\n                        }\r\n\r\n                        if (html) {\r\n                            popup.getDom('content').innerHTML = html;\r\n                            popup.anchorEl = img || link;\r\n                            popup.showAnchor(popup.anchorEl);\r\n                        } else {\r\n                            popup.hide();\r\n                        }\r\n                    });\r\n                }\r\n\r\n            },\r\n            _initToolbars: function () {\r\n                var editor = this.editor;\r\n                var toolbars = this.toolbars || [];\r\n                var toolbarUis = [];\r\n                for (var i = 0; i < toolbars.length; i++) {\r\n                    var toolbar = toolbars[i];\r\n                    var toolbarUi = new baidu.editor.ui.Toolbar({ theme: editor.options.theme });\r\n                    for (var j = 0; j < toolbar.length; j++) {\r\n                        var toolbarItem = toolbar[j];\r\n                        var toolbarItemUi = null;\r\n                        if (typeof toolbarItem == 'string') {\r\n                            toolbarItem = toolbarItem.toLowerCase();\r\n                            if (toolbarItem == '|') {\r\n                                toolbarItem = 'Separator';\r\n                            }\r\n                            if (toolbarItem == '||') {\r\n                                toolbarItem = 'Breakline';\r\n                            }\r\n                            if (baidu.editor.ui[toolbarItem]) {\r\n                                toolbarItemUi = new baidu.editor.ui[toolbarItem](editor);\r\n                            }\r\n\r\n                            //fullscreen这里单独处理一下，放到首行去\r\n                            if (toolbarItem == 'fullscreen') {\r\n                                if (toolbarUis && toolbarUis[0]) {\r\n                                    toolbarUis[0].items.splice(0, 0, toolbarItemUi);\r\n                                } else {\r\n                                    toolbarItemUi && toolbarUi.items.splice(0, 0, toolbarItemUi);\r\n                                }\r\n\r\n                                continue;\r\n\r\n\r\n                            }\r\n                        } else {\r\n                            toolbarItemUi = toolbarItem;\r\n                        }\r\n                        if (toolbarItemUi && toolbarItemUi.id) {\r\n\r\n                            toolbarUi.add(toolbarItemUi);\r\n                        }\r\n                    }\r\n                    toolbarUis[i] = toolbarUi;\r\n                }\r\n\r\n                //接受外部定制的UI\r\n\r\n                utils.each(UE._customizeUI, function (obj, key) {\r\n                    var itemUI, index;\r\n                    if (obj.id && obj.id != editor.key) {\r\n                        return false;\r\n                    }\r\n                    itemUI = obj.execFn.call(editor, editor, key);\r\n                    if (itemUI) {\r\n                        index = obj.index;\r\n                        if (index === undefined) {\r\n                            index = toolbarUi.items.length;\r\n                        }\r\n                        toolbarUi.add(itemUI, index)\r\n                    }\r\n                });\r\n\r\n                this.toolbars = toolbarUis;\r\n            },\r\n            getHtmlTpl: function () {\r\n                return '<div id=\"##\" class=\"%%\">' +\r\n                    '<div id=\"##_toolbarbox\" class=\"%%-toolbarbox\">' +\r\n                    (this.toolbars.length ?\r\n                        '<div id=\"##_toolbarboxouter\" class=\"%%-toolbarboxouter\"><div class=\"%%-toolbarboxinner\">' +\r\n                        this.renderToolbarBoxHtml() +\r\n                        '</div></div>' : '') +\r\n                    '<div id=\"##_toolbarmsg\" class=\"%%-toolbarmsg\" style=\"display:none;\">' +\r\n                    '<div id = \"##_upload_dialog\" class=\"%%-toolbarmsg-upload\" onclick=\"$$.showWordImageDialog();\">' + this.editor.getLang(\"clickToUpload\") + '</div>' +\r\n                    '<div class=\"%%-toolbarmsg-close\" onclick=\"$$.hideToolbarMsg();\">x</div>' +\r\n                    '<div id=\"##_toolbarmsg_label\" class=\"%%-toolbarmsg-label\"></div>' +\r\n                    '<div style=\"height:0;overflow:hidden;clear:both;\"></div>' +\r\n                    '</div>' +\r\n                    '<div id=\"##_message_holder\" class=\"%%-messageholder\"></div>' +\r\n                    '</div>' +\r\n                    '<div id=\"##_iframeholder\" class=\"%%-iframeholder\">' +\r\n                    '</div>' +\r\n                    //modify wdcount by matao\r\n                    '<div id=\"##_bottombar\" class=\"%%-bottomContainer\"><table><tr>' +\r\n                    '<td id=\"##_elementpath\" class=\"%%-bottombar\"></td>' +\r\n                    '<td id=\"##_wordcount\" class=\"%%-wordcount\"></td>' +\r\n                    '<td id=\"##_scale\" class=\"%%-scale\"><div class=\"%%-icon\"></div></td>' +\r\n                    '</tr></table></div>' +\r\n                    '<div id=\"##_scalelayer\"></div>' +\r\n                    '</div>';\r\n            },\r\n            showWordImageDialog: function () {\r\n                this._dialogs['wordimageDialog'].open();\r\n            },\r\n            renderToolbarBoxHtml: function () {\r\n                var buff = [];\r\n                for (var i = 0; i < this.toolbars.length; i++) {\r\n                    buff.push(this.toolbars[i].renderHtml());\r\n                }\r\n                return buff.join('');\r\n            },\r\n            setFullScreen: function (fullscreen) {\r\n\r\n                var editor = this.editor,\r\n                    container = editor.container.parentNode.parentNode;\r\n                if (this._fullscreen != fullscreen) {\r\n                    this._fullscreen = fullscreen;\r\n                    this.editor.fireEvent('beforefullscreenchange', fullscreen);\r\n                    if (baidu.editor.browser.gecko) {\r\n                        var bk = editor.selection.getRange().createBookmark();\r\n                    }\r\n                    if (fullscreen) {\r\n                        while (container.tagName != \"BODY\") {\r\n                            var position = baidu.editor.dom.domUtils.getComputedStyle(container, \"position\");\r\n                            nodeStack.push(position);\r\n                            container.style.position = \"static\";\r\n                            container = container.parentNode;\r\n                        }\r\n                        this._bakHtmlOverflow = document.documentElement.style.overflow;\r\n                        this._bakBodyOverflow = document.body.style.overflow;\r\n                        this._bakAutoHeight = this.editor.autoHeightEnabled;\r\n                        this._bakScrollTop = Math.max(document.documentElement.scrollTop, document.body.scrollTop);\r\n\r\n                        this._bakEditorContaninerWidth = editor.iframe.parentNode.offsetWidth;\r\n                        if (this._bakAutoHeight) {\r\n                            //当全屏时不能执行自动长高\r\n                            editor.autoHeightEnabled = false;\r\n                            this.editor.disableAutoHeight();\r\n                        }\r\n\r\n                        document.documentElement.style.overflow = 'hidden';\r\n                        //修复，滚动条不收起的问题\r\n\r\n                        window.scrollTo(0, window.scrollY);\r\n                        this._bakCssText = this.getDom().style.cssText;\r\n                        this._bakCssText1 = this.getDom('iframeholder').style.cssText;\r\n                        editor.iframe.parentNode.style.width = '';\r\n                        this._updateFullScreen();\r\n                    } else {\r\n                        while (container.tagName != \"BODY\") {\r\n                            container.style.position = nodeStack.shift();\r\n                            container = container.parentNode;\r\n                        }\r\n                        this.getDom().style.cssText = this._bakCssText;\r\n                        this.getDom('iframeholder').style.cssText = this._bakCssText1;\r\n                        if (this._bakAutoHeight) {\r\n                            editor.autoHeightEnabled = true;\r\n                            this.editor.enableAutoHeight();\r\n                        }\r\n\r\n                        document.documentElement.style.overflow = this._bakHtmlOverflow;\r\n                        document.body.style.overflow = this._bakBodyOverflow;\r\n                        editor.iframe.parentNode.style.width = this._bakEditorContaninerWidth + 'px';\r\n                        window.scrollTo(0, this._bakScrollTop);\r\n                    }\r\n                    if (browser.gecko && editor.body.contentEditable === 'true') {\r\n                        var input = document.createElement('input');\r\n                        document.body.appendChild(input);\r\n                        editor.body.contentEditable = false;\r\n                        setTimeout(function () {\r\n                            input.focus();\r\n                            setTimeout(function () {\r\n                                editor.body.contentEditable = true;\r\n                                editor.fireEvent('fullscreenchanged', fullscreen);\r\n                                editor.selection.getRange().moveToBookmark(bk).select(true);\r\n                                baidu.editor.dom.domUtils.remove(input);\r\n                                fullscreen && window.scroll(0, 0);\r\n                            }, 0)\r\n                        }, 0)\r\n                    }\r\n\r\n                    if (editor.body.contentEditable === 'true') {\r\n                        this.editor.fireEvent('fullscreenchanged', fullscreen);\r\n                        this.triggerLayout();\r\n                    }\r\n\r\n                }\r\n            },\r\n            _updateFullScreen: function () {\r\n                if (this._fullscreen) {\r\n                    var vpRect = uiUtils.getViewportRect();\r\n                    this.getDom().style.cssText = 'border:0;position:absolute;left:0;top:' + (this.editor.options.topOffset || 0) + 'px;width:' + vpRect.width + 'px;height:' + vpRect.height + 'px;z-index:' + (this.getDom().style.zIndex * 1 + 100);\r\n                    uiUtils.setViewportOffset(this.getDom(), { left: 0, top: this.editor.options.topOffset || 0 });\r\n                    this.editor.setHeight(vpRect.height - this.getDom('toolbarbox').offsetHeight - this.getDom('bottombar').offsetHeight - (this.editor.options.topOffset || 0), true);\r\n                    //不手动调一下，会导致全屏失效\r\n                    if (browser.gecko) {\r\n                        try {\r\n                            window.onresize();\r\n                        } catch (e) {\r\n\r\n                        }\r\n\r\n                    }\r\n                }\r\n            },\r\n            _updateElementPath: function () {\r\n                var bottom = this.getDom('elementpath'), list;\r\n                if (this.elementPathEnabled && (list = this.editor.queryCommandValue('elementpath'))) {\r\n\r\n                    var buff = [];\r\n                    for (var i = 0, ci; ci = list[i]; i++) {\r\n                        buff[i] = this.formatHtml('<span unselectable=\"on\" onclick=\"$$.editor.execCommand(&quot;elementpath&quot;, &quot;' + i + '&quot;);\">' + ci + '</span>');\r\n                    }\r\n                    bottom.innerHTML = '<div class=\"edui-editor-breadcrumb\" onmousedown=\"return false;\">' + this.editor.getLang(\"elementPathTip\") + ': ' + buff.join(' &gt; ') + '</div>';\r\n\r\n                } else {\r\n                    bottom.style.display = 'none'\r\n                }\r\n            },\r\n            disableElementPath: function () {\r\n                var bottom = this.getDom('elementpath');\r\n                bottom.innerHTML = '';\r\n                bottom.style.display = 'none';\r\n                this.elementPathEnabled = false;\r\n\r\n            },\r\n            enableElementPath: function () {\r\n                var bottom = this.getDom('elementpath');\r\n                bottom.style.display = '';\r\n                this.elementPathEnabled = true;\r\n                this._updateElementPath();\r\n            },\r\n            _scale: function () {\r\n                var doc = document,\r\n                    editor = this.editor,\r\n                    editorHolder = editor.container,\r\n                    editorDocument = editor.document,\r\n                    toolbarBox = this.getDom(\"toolbarbox\"),\r\n                    bottombar = this.getDom(\"bottombar\"),\r\n                    scale = this.getDom(\"scale\"),\r\n                    scalelayer = this.getDom(\"scalelayer\");\r\n\r\n                var isMouseMove = false,\r\n                    position = null,\r\n                    minEditorHeight = 0,\r\n                    minEditorWidth = editor.options.minFrameWidth,\r\n                    pageX = 0,\r\n                    pageY = 0,\r\n                    scaleWidth = 0,\r\n                    scaleHeight = 0;\r\n\r\n                function down() {\r\n                    position = domUtils.getXY(editorHolder);\r\n\r\n                    if (!minEditorHeight) {\r\n                        minEditorHeight = editor.options.minFrameHeight + toolbarBox.offsetHeight + bottombar.offsetHeight;\r\n                    }\r\n\r\n                    scalelayer.style.cssText = \"position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:\" + editorHolder.offsetWidth + \"px;height:\"\r\n                        + editorHolder.offsetHeight + \"px;z-index:\" + (editor.options.zIndex + 1);\r\n\r\n                    domUtils.on(doc, \"mousemove\", move);\r\n                    domUtils.on(editorDocument, \"mouseup\", up);\r\n                    domUtils.on(doc, \"mouseup\", up);\r\n                }\r\n\r\n                var me = this;\r\n                //by xuheng 全屏时关掉缩放\r\n                this.editor.addListener('fullscreenchanged', function (e, fullScreen) {\r\n                    if (fullScreen) {\r\n                        me.disableScale();\r\n\r\n                    } else {\r\n                        if (me.editor.options.scaleEnabled) {\r\n                            me.enableScale();\r\n                            var tmpNode = me.editor.document.createElement('span');\r\n                            me.editor.body.appendChild(tmpNode);\r\n                            me.editor.body.style.height = Math.max(domUtils.getXY(tmpNode).y, me.editor.iframe.offsetHeight - 20) + 'px';\r\n                            domUtils.remove(tmpNode)\r\n                        }\r\n                    }\r\n                });\r\n                function move(event) {\r\n                    clearSelection();\r\n                    var e = event || window.event;\r\n                    pageX = e.pageX || (doc.documentElement.scrollLeft + e.clientX);\r\n                    pageY = e.pageY || (doc.documentElement.scrollTop + e.clientY);\r\n                    scaleWidth = pageX - position.x;\r\n                    scaleHeight = pageY - position.y;\r\n\r\n                    if (scaleWidth >= minEditorWidth) {\r\n                        isMouseMove = true;\r\n                        scalelayer.style.width = scaleWidth + 'px';\r\n                    }\r\n                    if (scaleHeight >= minEditorHeight) {\r\n                        isMouseMove = true;\r\n                        scalelayer.style.height = scaleHeight + \"px\";\r\n                    }\r\n                }\r\n\r\n                function up() {\r\n                    if (isMouseMove) {\r\n                        isMouseMove = false;\r\n                        editor.ui._actualFrameWidth = scalelayer.offsetWidth - 2;\r\n                        editorHolder.style.width = editor.ui._actualFrameWidth + 'px';\r\n\r\n                        editor.setHeight(scalelayer.offsetHeight - bottombar.offsetHeight - toolbarBox.offsetHeight - 2, true);\r\n                    }\r\n                    if (scalelayer) {\r\n                        scalelayer.style.display = \"none\";\r\n                    }\r\n                    clearSelection();\r\n                    domUtils.un(doc, \"mousemove\", move);\r\n                    domUtils.un(editorDocument, \"mouseup\", up);\r\n                    domUtils.un(doc, \"mouseup\", up);\r\n                }\r\n\r\n                function clearSelection() {\r\n                    if (browser.ie)\r\n                        doc.selection.clear();\r\n                    else\r\n                        window.getSelection().removeAllRanges();\r\n                }\r\n\r\n                this.enableScale = function () {\r\n                    //trace:2868\r\n                    if (editor.queryCommandState(\"source\") == 1) return;\r\n                    scale.style.display = \"\";\r\n                    this.scaleEnabled = true;\r\n                    domUtils.on(scale, \"mousedown\", down);\r\n                };\r\n                this.disableScale = function () {\r\n                    scale.style.display = \"none\";\r\n                    this.scaleEnabled = false;\r\n                    domUtils.un(scale, \"mousedown\", down);\r\n                };\r\n            },\r\n            isFullScreen: function () {\r\n                return this._fullscreen;\r\n            },\r\n            postRender: function () {\r\n                UIBase.prototype.postRender.call(this);\r\n                for (var i = 0; i < this.toolbars.length; i++) {\r\n                    this.toolbars[i].postRender();\r\n                }\r\n                var me = this;\r\n                var timerId,\r\n                    domUtils = baidu.editor.dom.domUtils,\r\n                    updateFullScreenTime = function () {\r\n                        clearTimeout(timerId);\r\n                        timerId = setTimeout(function () {\r\n                            me._updateFullScreen();\r\n                        });\r\n                    };\r\n                domUtils.on(window, 'resize', updateFullScreenTime);\r\n\r\n                me.addListener('destroy', function () {\r\n                    domUtils.un(window, 'resize', updateFullScreenTime);\r\n                    clearTimeout(timerId);\r\n                })\r\n            },\r\n            showToolbarMsg: function (msg, flag) {\r\n                this.getDom('toolbarmsg_label').innerHTML = msg;\r\n                this.getDom('toolbarmsg').style.display = '';\r\n                //\r\n                if (!flag) {\r\n                    var w = this.getDom('upload_dialog');\r\n                    w.style.display = 'none';\r\n                }\r\n            },\r\n            hideToolbarMsg: function () {\r\n                this.getDom('toolbarmsg').style.display = 'none';\r\n            },\r\n            mapUrl: function (url) {\r\n                return url ? url.replace('~/', this.editor.options.UEDITOR_HOME_URL || '') : ''\r\n            },\r\n            triggerLayout: function () {\r\n                var dom = this.getDom();\r\n                if (dom.style.zoom == '1') {\r\n                    dom.style.zoom = '100%';\r\n                } else {\r\n                    dom.style.zoom = '1';\r\n                }\r\n            }\r\n        };\r\n        utils.inherits(EditorUI, baidu.editor.ui.UIBase);\r\n\r\n\r\n        var instances = {};\r\n\r\n\r\n        UE.ui.Editor = function (options) {\r\n            // console.log(options,'eeeeeee');\r\n            var editor = new UE.Editor(options);\r\n            editor.options.editor = editor;\r\n            // utils.loadFile(document, {\r\n            //     href: editor.options.themePath + editor.options.theme + \"/css/ueditor.css\",\r\n            //     tag: \"link\",\r\n            //     type: \"text/css\",\r\n            //     rel: \"stylesheet\"\r\n            // });\r\n\r\n            var oldRender = editor.render;\r\n\r\n            editor.render = function (holder) {\r\n                // console.log(holder,'rrrrrrrr');\r\n                if (holder.constructor === String) {\r\n                    editor.key = holder;\r\n                    instances[holder] = editor;\r\n                }\r\n                utils.domReady(function () {\r\n                    editor.langIsReady ? renderUI() : editor.addListener(\"langReady\", renderUI);\r\n                    function renderUI() {\r\n                        editor.setOpt({\r\n                            labelMap: editor.options.labelMap || editor.getLang('labelMap')\r\n                        });\r\n                        new EditorUI(editor.options);\r\n                        if (holder) {\r\n                            if (holder.constructor === String) {\r\n                                holder = document.getElementById(holder);\r\n                            }\r\n                            holder && holder.getAttribute('name') && (editor.options.textarea = holder.getAttribute('name'));\r\n                            if (holder && /script|textarea/ig.test(holder.tagName)) {\r\n                                var newDiv = document.createElement('div');\r\n                                holder.parentNode.insertBefore(newDiv, holder);\r\n                                var cont = holder.value || holder.innerHTML;\r\n                                editor.options.initialContent = /^[\\t\\r\\n ]*$/.test(cont) ? editor.options.initialContent :\r\n                                    cont.replace(/>[\\n\\r\\t]+([ ]{4})+/g, '>')\r\n                                        .replace(/[\\n\\r\\t]+([ ]{4})+</g, '<')\r\n                                        .replace(/>[\\n\\r\\t]+</g, '><');\r\n                                holder.className && (newDiv.className = holder.className);\r\n                                holder.style.cssText && (newDiv.style.cssText = holder.style.cssText);\r\n                                if (/textarea/i.test(holder.tagName)) {\r\n                                    editor.textarea = holder;\r\n                                    editor.textarea.style.display = 'none';\r\n\r\n\r\n                                } else {\r\n                                    holder.parentNode.removeChild(holder);\r\n\r\n\r\n                                }\r\n                                if (holder.id) {\r\n                                    newDiv.id = holder.id;\r\n                                    domUtils.removeAttributes(holder, 'id');\r\n                                }\r\n                                holder = newDiv;\r\n                                holder.innerHTML = '';\r\n                            }\r\n\r\n                        }\r\n                        domUtils.addClass(holder, \"edui-\" + editor.options.theme);\r\n                        editor.ui.render(holder);\r\n                        var opt = editor.options;\r\n                        //给实例添加一个编辑器的容器引用\r\n                        editor.container = editor.ui.getDom();\r\n                        var parents = domUtils.findParents(holder, true);\r\n                        var displays = [];\r\n                        for (var i = 0, ci; ci = parents[i]; i++) {\r\n                            displays[i] = ci.style.display;\r\n                            ci.style.display = 'block'\r\n                        }\r\n                        if (opt.initialFrameWidth) {\r\n                            opt.minFrameWidth = opt.initialFrameWidth;\r\n                        } else {\r\n                            opt.minFrameWidth = opt.initialFrameWidth = holder.offsetWidth;\r\n                            var styleWidth = holder.style.width;\r\n                            if (/%$/.test(styleWidth)) {\r\n                                opt.initialFrameWidth = styleWidth;\r\n                            }\r\n                        }\r\n                        if (opt.initialFrameHeight) {\r\n                            opt.minFrameHeight = opt.initialFrameHeight;\r\n                        } else {\r\n                            opt.initialFrameHeight = opt.minFrameHeight = holder.offsetHeight;\r\n                        }\r\n                        for (var i = 0, ci; ci = parents[i]; i++) {\r\n                            ci.style.display = displays[i]\r\n                        }\r\n                        //编辑器最外容器设置了高度，会导致，编辑器不占位\r\n                        //todo 先去掉，没有找到原因\r\n                        if (holder.style.height) {\r\n                            holder.style.height = ''\r\n                        }\r\n                        editor.container.style.width = opt.initialFrameWidth + (/%$/.test(opt.initialFrameWidth) ? '' : 'px');\r\n                        editor.container.style.zIndex = opt.zIndex;\r\n                        oldRender.call(editor, editor.ui.getDom('iframeholder'));\r\n                        editor.fireEvent(\"afteruiready\");\r\n                    }\r\n                })\r\n            };\r\n            return editor;\r\n        };\r\n\r\n\r\n        /**\r\n         * @file\r\n         * @name UE\r\n         * @short UE\r\n         * @desc UEditor的顶部命名空间\r\n         */\r\n        /**\r\n         * @name getEditor\r\n         * @since 1.2.4+\r\n         * @grammar UE.getEditor(id,[opt])  =>  Editor实例\r\n         * @desc 提供一个全局的方法得到编辑器实例\r\n         *\r\n         * * ''id''  放置编辑器的容器id, 如果容器下的编辑器已经存在，就直接返回\r\n         * * ''opt'' 编辑器的可选参数\r\n         * @example\r\n         *  UE.getEditor('containerId',{onready:function(){//创建一个编辑器实例\r\n         *      this.setContent('hello')\r\n         *  }});\r\n         *  UE.getEditor('containerId'); //返回刚创建的实例\r\n         *\r\n         */\r\n        UE.getEditor = function (id, opt) {\r\n            // console.log(instances,111111);\r\n            var editor = instances[id];\r\n            // console.log(editor,111111111);\r\n            if (!editor) {\r\n                editor = instances[id] = new UE.ui.Editor(opt);\r\n                editor.render(id);\r\n            }\r\n            return editor;\r\n        };\r\n\r\n\r\n        UE.delEditor = function (id) {\r\n            var editor;\r\n            if (editor = instances[id]) {\r\n                editor.key && editor.destroy();\r\n                delete instances[id]\r\n            }\r\n        };\r\n\r\n        UE.registerUI = function (uiName, fn, index, editorId) {\r\n            utils.each(uiName.split(/\\s+/), function (name) {\r\n                UE._customizeUI[name] = {\r\n                    id: editorId,\r\n                    execFn: fn,\r\n                    index: index\r\n                };\r\n            })\r\n\r\n        }\r\n\r\n    })();\r\n\r\n    // adapter/message.js\r\n    UE.registerUI('message', function (editor) {\r\n\r\n        var editorui = baidu.editor.ui;\r\n        var Message = editorui.Message;\r\n        var holder;\r\n        var _messageItems = [];\r\n        var me = editor;\r\n\r\n        me.addListener('ready', function () {\r\n            holder = document.getElementById(me.ui.id + '_message_holder');\r\n            updateHolderPos();\r\n            setTimeout(function () {\r\n                updateHolderPos();\r\n            }, 500);\r\n        });\r\n\r\n        me.addListener('showmessage', function (type, opt) {\r\n            opt = utils.isString(opt) ? {\r\n                'content': opt\r\n            } : opt;\r\n            var message = new Message({\r\n                'timeout': opt.timeout,\r\n                'type': opt.type,\r\n                'content': opt.content,\r\n                'keepshow': opt.keepshow,\r\n                'editor': me\r\n            }),\r\n                mid = opt.id || ('msg_' + (+new Date()).toString(36));\r\n            message.render(holder);\r\n            _messageItems[mid] = message;\r\n            message.reset(opt);\r\n            updateHolderPos();\r\n            return mid;\r\n        });\r\n\r\n        me.addListener('updatemessage', function (type, id, opt) {\r\n            opt = utils.isString(opt) ? {\r\n                'content': opt\r\n            } : opt;\r\n            var message = _messageItems[id];\r\n            message.render(holder);\r\n            message && message.reset(opt);\r\n        });\r\n\r\n        me.addListener('hidemessage', function (type, id) {\r\n            var message = _messageItems[id];\r\n            message && message.hide();\r\n        });\r\n\r\n        function updateHolderPos() {\r\n            var toolbarbox = me.ui.getDom('toolbarbox');\r\n            if (toolbarbox) {\r\n                holder.style.top = toolbarbox.offsetHeight + 3 + 'px';\r\n            }\r\n            holder.style.zIndex = Math.max(me.options.zIndex, me.iframe.style.zIndex) + 1;\r\n        }\r\n\r\n    });\r\n\r\n\r\n    // adapter/autosave.js\r\n    UE.registerUI('autosave', function (editor) {\r\n        var timer = null, uid = null;\r\n        editor.on('afterautosave', function () {\r\n            clearTimeout(timer);\r\n\r\n            timer = setTimeout(function () {\r\n                if (uid) {\r\n                    editor.trigger('hidemessage', uid);\r\n                }\r\n                uid = editor.trigger('showmessage', {\r\n                    content: editor.getLang('autosave.success'),\r\n                    timeout: 2000\r\n                });\r\n\r\n            }, 2000)\r\n        })\r\n\r\n    });","import './ueditor.config';\nimport './ueditor.all';\nimport './lang/zh-cn/zh-cn';","/**\r\n * Created with JetBrains PhpStorm.\r\n * User: taoqili\r\n * Date: 12-6-12\r\n * Time: 下午5:02\r\n * To change this template use File | Settings | File Templates.\r\n */\r\nUE.I18N['zh-cn'] = {\r\n    'labelMap':{\r\n        'anchor':'锚点', 'undo':'撤销', 'redo':'重做', 'bold':'加粗', 'indent':'首行缩进', 'snapscreen':'截图',\r\n        'italic':'斜体', 'underline':'下划线', 'strikethrough':'删除线', 'subscript':'下标','fontborder':'字符边框',\r\n        'superscript':'上标', 'formatmatch':'格式刷', 'source':'源代码', 'blockquote':'引用',\r\n        'pasteplain':'纯文本粘贴模式', 'selectall':'全选', 'print':'打印', 'preview':'预览',\r\n        'horizontal':'分隔线', 'removeformat':'清除格式', 'time':'时间', 'date':'日期',\r\n        'unlink':'取消链接', 'insertrow':'前插入行', 'insertcol':'前插入列', 'mergeright':'右合并单元格', 'mergedown':'下合并单元格',\r\n        'deleterow':'删除行', 'deletecol':'删除列', 'splittorows':'拆分成行',\r\n        'splittocols':'拆分成列', 'splittocells':'完全拆分单元格','deletecaption':'删除表格标题','inserttitle':'插入标题',\r\n        'mergecells':'合并多个单元格', 'deletetable':'删除表格', 'cleardoc':'清空文档','insertparagraphbeforetable':\"表格前插入行\",'insertcode':'代码语言',\r\n        'fontfamily':'字体', 'fontsize':'字号', 'paragraph':'段落格式', 'simpleupload':'单图上传', 'insertimage':'多图上传','edittable':'表格属性','edittd':'单元格属性', 'link':'超链接',\r\n        'emotion':'表情', 'spechars':'特殊字符', 'searchreplace':'查询替换', 'map':'Baidu地图', 'gmap':'Google地图',\r\n        'insertvideo':'视频', 'help':'帮助', 'justifyleft':'居左对齐', 'justifyright':'居右对齐', 'justifycenter':'居中对齐',\r\n        'justifyjustify':'两端对齐', 'forecolor':'字体颜色', 'backcolor':'背景色', 'insertorderedlist':'有序列表',\r\n        'insertunorderedlist':'无序列表', 'fullscreen':'全屏', 'directionalityltr':'从左向右输入', 'directionalityrtl':'从右向左输入',\r\n        'rowspacingtop':'段前距', 'rowspacingbottom':'段后距',  'pagebreak':'分页', 'insertframe':'插入Iframe', 'imagenone':'默认',\r\n        'imageleft':'左浮动', 'imageright':'右浮动', 'attachment':'附件', 'imagecenter':'居中', 'wordimage':'图片转存',\r\n        'lineheight':'行间距','edittip' :'编辑提示','customstyle':'自定义标题', 'autotypeset':'自动排版',\r\n        'webapp':'百度应用','touppercase':'字母大写', 'tolowercase':'字母小写','background':'背景','template':'模板','scrawl':'涂鸦',\r\n        'music':'音乐','inserttable':'插入表格','drafts': '从草稿箱加载', 'charts': '图表'\r\n    },\r\n    'insertorderedlist':{\r\n        'num':'1,2,3...',\r\n        'num1':'1),2),3)...',\r\n        'num2':'(1),(2),(3)...',\r\n        'cn':'一,二,三....',\r\n        'cn1':'一),二),三)....',\r\n        'cn2':'(一),(二),(三)....',\r\n        'decimal':'1,2,3...',\r\n        'lower-alpha':'a,b,c...',\r\n        'lower-roman':'i,ii,iii...',\r\n        'upper-alpha':'A,B,C...',\r\n        'upper-roman':'I,II,III...'\r\n    },\r\n    'insertunorderedlist':{\r\n        'circle':'○ 大圆圈',\r\n        'disc':'● 小黑点',\r\n        'square':'■ 小方块 ',\r\n        'dash' :'— 破折号',\r\n        'dot':' 。 小圆圈'\r\n    },\r\n    'paragraph':{'p':'段落', 'h1':'标题 1', 'h2':'标题 2', 'h3':'标题 3', 'h4':'标题 4', 'h5':'标题 5', 'h6':'标题 6'},\r\n    'fontfamily':{\r\n        'songti':'宋体',\r\n        'kaiti':'楷体',\r\n        'heiti':'黑体',\r\n        'lishu':'隶书',\r\n        'yahei':'微软雅黑',\r\n        'andaleMono':'andale mono',\r\n        'arial': 'arial',\r\n        'arialBlack':'arial black',\r\n        'comicSansMs':'comic sans ms',\r\n        'impact':'impact',\r\n        'timesNewRoman':'times new roman'\r\n    },\r\n    'customstyle':{\r\n        'tc':'标题居中',\r\n        'tl':'标题居左',\r\n        'im':'强调',\r\n        'hi':'明显强调'\r\n    },\r\n    'autoupload': {\r\n        'exceedSizeError': '文件大小超出限制',\r\n        'exceedTypeError': '文件格式不允许',\r\n        'jsonEncodeError': '服务器返回格式错误',\r\n        'loading':\"正在上传...\",\r\n        'loadError':\"上传错误\",\r\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！'\r\n    },\r\n    'simpleupload':{\r\n        'exceedSizeError': '文件大小超出限制',\r\n        'exceedTypeError': '文件格式不允许',\r\n        'jsonEncodeError': '服务器返回格式错误',\r\n        'loading':\"正在上传...\",\r\n        'loadError':\"上传错误\",\r\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！'\r\n    },\r\n    'elementPathTip':\"元素路径\",\r\n    'wordCountTip':\"字数统计\",\r\n    'wordCountMsg':'当前已输入{#count}个字符, 您还可以输入{#leave}个字符。 ',\r\n    'wordOverFlowMsg':'<span style=\"color:red;\">字数超出最大允许值，服务器可能拒绝保存！</span>',\r\n    'ok':\"确认\",\r\n    'cancel':\"取消\",\r\n    'closeDialog':\"关闭对话框\",\r\n    'tableDrag':\"表格拖动必须引入uiUtils.js文件！\",\r\n    'autofloatMsg':\"工具栏浮动依赖编辑器UI，您首先需要引入UI文件!\",\r\n    'loadconfigError': '获取后台配置项请求出错，上传功能将不能正常使用！',\r\n    'loadconfigFormatError': '后台配置项返回格式出错，上传功能将不能正常使用！',\r\n    'loadconfigHttpError': '请求后台配置项http错误，上传功能将不能正常使用！',\r\n    'snapScreen_plugin':{\r\n        'browserMsg':\"仅支持IE浏览器！\",\r\n        'callBackErrorMsg':\"服务器返回数据有误，请检查配置项之后重试。\",\r\n        'uploadErrorMsg':\"截图上传失败，请检查服务器端环境! \"\r\n    },\r\n    'insertcode':{\r\n        'as3':'ActionScript 3',\r\n        'bash':'Bash/Shell',\r\n        'cpp':'C/C++',\r\n        'css':'CSS',\r\n        'cf':'ColdFusion',\r\n        'c#':'C#',\r\n        'delphi':'Delphi',\r\n        'diff':'Diff',\r\n        'erlang':'Erlang',\r\n        'groovy':'Groovy',\r\n        'html':'HTML',\r\n        'java':'Java',\r\n        'jfx':'JavaFX',\r\n        'js':'JavaScript',\r\n        'pl':'Perl',\r\n        'php':'PHP',\r\n        'plain':'Plain Text',\r\n        'ps':'PowerShell',\r\n        'python':'Python',\r\n        'ruby':'Ruby',\r\n        'scala':'Scala',\r\n        'sql':'SQL',\r\n        'vb':'Visual Basic',\r\n        'xml':'XML'\r\n    },\r\n    'confirmClear':\"确定清空当前文档么？\",\r\n    'contextMenu':{\r\n        'delete':\"删除\",\r\n        'selectall':\"全选\",\r\n        'deletecode':\"删除代码\",\r\n        'cleardoc':\"清空文档\",\r\n        'confirmclear':\"确定清空当前文档么？\",\r\n        'unlink':\"删除超链接\",\r\n        'paragraph':\"段落格式\",\r\n        'edittable':\"表格属性\",\r\n        'aligntd':\"单元格对齐方式\",\r\n        'aligntable':'表格对齐方式',\r\n        'tableleft':'左浮动',\r\n        'tablecenter':'居中显示',\r\n        'tableright':'右浮动',\r\n        'edittd':\"单元格属性\",\r\n        'setbordervisible':'设置表格边线可见',\r\n        'justifyleft':'左对齐',\r\n        'justifyright':'右对齐',\r\n        'justifycenter':'居中对齐',\r\n        'justifyjustify':'两端对齐',\r\n        'table':\"表格\",\r\n        'inserttable':'插入表格',\r\n        'deletetable':\"删除表格\",\r\n        'insertparagraphbefore':\"前插入段落\",\r\n        'insertparagraphafter':'后插入段落',\r\n        'deleterow':\"删除当前行\",\r\n        'deletecol':\"删除当前列\",\r\n        'insertrow':\"前插入行\",\r\n        'insertcol':\"左插入列\",\r\n        'insertrownext':'后插入行',\r\n        'insertcolnext':'右插入列',\r\n        'insertcaption':'插入表格名称',\r\n        'deletecaption':'删除表格名称',\r\n        'inserttitle':'插入表格标题行',\r\n        'deletetitle':'删除表格标题行',\r\n        'inserttitlecol':'插入表格标题列',\r\n        'deletetitlecol':'删除表格标题列',\r\n        'averageDiseRow':'平均分布各行',\r\n        'averageDisCol':'平均分布各列',\r\n        'mergeright':\"向右合并\",\r\n        'mergeleft':\"向左合并\",\r\n        'mergedown':\"向下合并\",\r\n        'mergecells':\"合并单元格\",\r\n        'splittocells':\"完全拆分单元格\",\r\n        'splittocols':\"拆分成列\",\r\n        'splittorows':\"拆分成行\",\r\n        'tablesort':'表格排序',\r\n        'enablesort':'设置表格可排序',\r\n        'disablesort':'取消表格可排序',\r\n        'reversecurrent':'逆序当前',\r\n        'orderbyasc':'按ASCII字符升序',\r\n        'reversebyasc':'按ASCII字符降序',\r\n        'orderbynum':'按数值大小升序',\r\n        'reversebynum':'按数值大小降序',\r\n        'borderbk':'边框底纹',\r\n        'setcolor':'表格隔行变色',\r\n        'unsetcolor':'取消表格隔行变色',\r\n        'setbackground':'选区背景隔行',\r\n        'unsetbackground':'取消选区背景',\r\n        'redandblue':'红蓝相间',\r\n        'threecolorgradient':'三色渐变',\r\n        'copy':\"复制(Ctrl + c)\",\r\n        'copymsg': \"浏览器不支持,请使用 'Ctrl + c'\",\r\n        'paste':\"粘贴(Ctrl + v)\",\r\n         'pastemsg': \"浏览器不支持,请使用 'Ctrl + v'\"\r\n    },\r\n    'copymsg': \"浏览器不支持,请使用 'Ctrl + c'\",\r\n    'pastemsg': \"浏览器不支持,请使用 'Ctrl + v'\",\r\n    'anthorMsg':\"链接\",\r\n    'clearColor':'清空颜色',\r\n    'standardColor':'标准颜色',\r\n    'themeColor':'主题颜色',\r\n    'property':'属性',\r\n    'default':'默认',\r\n    'modify':'修改',\r\n    'justifyleft':'左对齐',\r\n    'justifyright':'右对齐',\r\n    'justifycenter':'居中',\r\n    'justify':'默认',\r\n    'clear':'清除',\r\n    'anchorMsg':'锚点',\r\n    'delete':'删除',\r\n    'clickToUpload':\"点击上传\",\r\n    'unset':'尚未设置语言文件',\r\n    't_row':'行',\r\n    't_col':'列',\r\n    'more':'更多',\r\n    'pasteOpt':'粘贴选项',\r\n    'pasteSourceFormat':\"保留源格式\",\r\n    'tagFormat':'只保留标签',\r\n    'pasteTextFormat':'只保留文本',\r\n    'autoTypeSet':{\r\n        'mergeLine':\"合并空行\",\r\n        'delLine':\"清除空行\",\r\n        'removeFormat':\"清除格式\",\r\n        'indent':\"首行缩进\",\r\n        'alignment':\"对齐方式\",\r\n        'imageFloat':\"图片浮动\",\r\n        'removeFontsize':\"清除字号\",\r\n        'removeFontFamily':\"清除字体\",\r\n        'removeHtml':\"清除冗余HTML代码\",\r\n        'pasteFilter':\"粘贴过滤\",\r\n        'run':\"执行\",\r\n        'symbol':'符号转换',\r\n        'bdc2sb':'全角转半角',\r\n        'tobdc':'半角转全角'\r\n    },\r\n\r\n    'background':{\r\n        'static':{\r\n            'lang_background_normal':'背景设置',\r\n            'lang_background_local':'在线图片',\r\n            'lang_background_set':'选项',\r\n            'lang_background_none':'无背景色',\r\n            'lang_background_colored':'有背景色',\r\n            'lang_background_color':'颜色设置',\r\n            'lang_background_netimg':'网络图片',\r\n            'lang_background_align':'对齐方式',\r\n            'lang_background_position':'精确定位',\r\n            'repeatType':{'options':[\"居中\", \"横向重复\", \"纵向重复\", \"平铺\",\"自定义\"]}\r\n\r\n        },\r\n        'noUploadImage':\"当前未上传过任何图片！\",\r\n        'toggleSelect':\"单击可切换选中状态\\n原图尺寸: \"\r\n    },\r\n    //===============dialog i18N=======================\r\n    'insertimage':{\r\n        'static':{\r\n            'lang_tab_remote':\"插入图片\", //节点\r\n            'lang_tab_upload':\"本地上传\",\r\n            'lang_tab_online':\"在线管理\",\r\n            'lang_tab_search':\"图片搜索\",\r\n            'lang_input_url':\"地 址：\",\r\n            'lang_input_size':\"大 小：\",\r\n            'lang_input_width':\"宽度\",\r\n            'lang_input_height':\"高度\",\r\n            'lang_input_border':\"边 框：\",\r\n            'lang_input_vhspace':\"边 距：\",\r\n            'lang_input_title':\"描 述：\",\r\n            'lang_input_align':'图片浮动方式：',\r\n            'lang_imgLoading':\"　图片加载中……\",\r\n            'lang_start_upload':\"开始上传\",\r\n            'lock':{'title':\"锁定宽高比例\"}, //属性\r\n            'searchType':{'title':\"图片类型\", 'options':[\"新闻\", \"壁纸\", \"表情\", \"头像\"]}, //select的option\r\n            'searchTxt':{'value':\"请输入搜索关键词\"},\r\n            'searchBtn':{'value':\"百度一下\"},\r\n            'searchReset':{'value':\"清空搜索\"},\r\n            'noneAlign':{'title':'无浮动'},\r\n            'leftAlign':{'title':'左浮动'},\r\n            'rightAlign':{'title':'右浮动'},\r\n            'centerAlign':{'title':'居中独占一行'}\r\n        },\r\n        'uploadSelectFile':'点击选择图片',\r\n        'uploadAddFile':'继续添加',\r\n        'uploadStart':'开始上传',\r\n        'uploadPause':'暂停上传',\r\n        'uploadContinue':'继续上传',\r\n        'uploadRetry':'重试上传',\r\n        'uploadDelete':'删除',\r\n        'uploadTurnLeft':'向左旋转',\r\n        'uploadTurnRight':'向右旋转',\r\n        'uploadPreview':'预览中',\r\n        'uploadNoPreview':'不能预览',\r\n        'updateStatusReady': '选中_张图片，共_KB。',\r\n        'updateStatusConfirm': '已成功上传_张照片，_张照片上传失败',\r\n        'updateStatusFinish': '共_张（_KB），_张上传成功',\r\n        'updateStatusError': '，_张上传失败。',\r\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\r\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\r\n        'errorExceedSize':'文件大小超出',\r\n        'errorFileType':'文件格式不允许',\r\n        'errorInterrupt':'文件传输中断',\r\n        'errorUploadRetry':'上传失败，请重试',\r\n        'errorHttp':'http请求错误',\r\n        'errorServerUpload':'服务器返回出错',\r\n        'remoteLockError':\"宽高不正确,不能所定比例\",\r\n        'numError':\"请输入正确的长度或者宽度值！例如：123，400\",\r\n        'imageUrlError':\"不允许的图片格式或者图片域！\",\r\n        'imageLoadError':\"图片加载失败！请检查链接地址或网络状态！\",\r\n        'searchRemind':\"请输入搜索关键词\",\r\n        'searchLoading':\"图片加载中，请稍后……\",\r\n        'searchRetry':\" :( ，抱歉，没有找到图片！请重试一次！\"\r\n    },\r\n    'attachment':{\r\n        'static':{\r\n            'lang_tab_upload': '上传附件',\r\n            'lang_tab_online': '在线附件',\r\n            'lang_start_upload':\"开始上传\",\r\n            'lang_drop_remind':\"可以将文件拖到这里，单次最多可选100个文件\"\r\n        },\r\n        'uploadSelectFile':'点击选择文件',\r\n        'uploadAddFile':'继续添加',\r\n        'uploadStart':'开始上传',\r\n        'uploadPause':'暂停上传',\r\n        'uploadContinue':'继续上传',\r\n        'uploadRetry':'重试上传',\r\n        'uploadDelete':'删除',\r\n        'uploadTurnLeft':'向左旋转',\r\n        'uploadTurnRight':'向右旋转',\r\n        'uploadPreview':'预览中',\r\n        'updateStatusReady': '选中_个文件，共_KB。',\r\n        'updateStatusConfirm': '已成功上传_个文件，_个文件上传失败',\r\n        'updateStatusFinish': '共_个（_KB），_个上传成功',\r\n        'updateStatusError': '，_张上传失败。',\r\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\r\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\r\n        'errorExceedSize':'文件大小超出',\r\n        'errorFileType':'文件格式不允许',\r\n        'errorInterrupt':'文件传输中断',\r\n        'errorUploadRetry':'上传失败，请重试',\r\n        'errorHttp':'http请求错误',\r\n        'errorServerUpload':'服务器返回出错'\r\n    },\r\n    'insertvideo':{\r\n        'static':{\r\n            'lang_tab_insertV':\"插入视频\",\r\n            'lang_tab_searchV':\"搜索视频\",\r\n            'lang_tab_uploadV':\"上传视频\",\r\n            'lang_video_url':\"视频网址\",\r\n            'lang_video_size':\"视频尺寸\",\r\n            'lang_videoW':\"宽度\",\r\n            'lang_videoH':\"高度\",\r\n            'lang_alignment':\"对齐方式\",\r\n            'videoSearchTxt':{'value':\"请输入搜索关键字！\"},\r\n            'videoType':{'options':[\"全部\", \"热门\", \"娱乐\", \"搞笑\", \"体育\", \"科技\", \"综艺\"]},\r\n            'videoSearchBtn':{'value':\"百度一下\"},\r\n            'videoSearchReset':{'value':\"清空结果\"},\r\n\r\n            'lang_input_fileStatus':' 当前未上传文件',\r\n            'startUpload':{'style':\"background:url(upload.png) no-repeat;\"},\r\n\r\n            'lang_upload_size':\"视频尺寸\",\r\n            'lang_upload_width':\"宽度\",\r\n            'lang_upload_height':\"高度\",\r\n            'lang_upload_alignment':\"对齐方式\",\r\n            'lang_format_advice':\"建议使用mp4格式.\"\r\n\r\n        },\r\n        'numError':\"请输入正确的数值，如123,400\",\r\n        'floatLeft':\"左浮动\",\r\n        'floatRight':\"右浮动\",\r\n        '\"default\"':\"默认\",\r\n        'block':\"独占一行\",\r\n        'urlError':\"输入的视频地址有误，请检查后再试！\",\r\n        'loading':\" &nbsp;视频加载中，请等待……\",\r\n        'clickToSelect':\"点击选中\",\r\n        'goToSource':'访问源视频',\r\n        'noVideo':\" &nbsp; &nbsp;抱歉，找不到对应的视频，请重试！\",\r\n\r\n        'browseFiles':'浏览文件',\r\n        'uploadSuccess':'上传成功!',\r\n        'delSuccessFile':'从成功队列中移除',\r\n        'delFailSaveFile':'移除保存失败文件',\r\n        'statusPrompt':' 个文件已上传！ ',\r\n        'flashVersionError':'当前Flash版本过低，请更新FlashPlayer后重试！',\r\n        'flashLoadingError':'Flash加载失败!请检查路径或网络状态',\r\n        'fileUploadReady':'等待上传……',\r\n        'delUploadQueue':'从上传队列中移除',\r\n        'limitPrompt1':'单次不能选择超过',\r\n        'limitPrompt2':'个文件！请重新选择！',\r\n        'delFailFile':'移除失败文件',\r\n        'fileSizeLimit':'文件大小超出限制！',\r\n        'emptyFile':'空文件无法上传！',\r\n        'fileTypeError':'文件类型不允许！',\r\n        'unknownError':'未知错误！',\r\n        'fileUploading':'上传中，请等待……',\r\n        'cancelUpload':'取消上传',\r\n        'netError':'网络错误',\r\n        'failUpload':'上传失败!',\r\n        'serverIOError':'服务器IO错误！',\r\n        'noAuthority':'无权限！',\r\n        'fileNumLimit':'上传个数限制',\r\n        'failCheck':'验证失败，本次上传被跳过！',\r\n        'fileCanceling':'取消中，请等待……',\r\n        'stopUploading':'上传已停止……',\r\n\r\n        'uploadSelectFile':'点击选择文件',\r\n        'uploadAddFile':'继续添加',\r\n        'uploadStart':'开始上传',\r\n        'uploadPause':'暂停上传',\r\n        'uploadContinue':'继续上传',\r\n        'uploadRetry':'重试上传',\r\n        'uploadDelete':'删除',\r\n        'uploadTurnLeft':'向左旋转',\r\n        'uploadTurnRight':'向右旋转',\r\n        'uploadPreview':'预览中',\r\n        'updateStatusReady': '选中_个文件，共_KB。',\r\n        'updateStatusConfirm': '成功上传_个，_个失败',\r\n        'updateStatusFinish': '共_个(_KB)，_个成功上传',\r\n        'updateStatusError': '，_张上传失败。',\r\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\r\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\r\n        'errorExceedSize':'文件大小超出',\r\n        'errorFileType':'文件格式不允许',\r\n        'errorInterrupt':'文件传输中断',\r\n        'errorUploadRetry':'上传失败，请重试',\r\n        'errorHttp':'http请求错误',\r\n        'errorServerUpload':'服务器返回出错'\r\n    },\r\n    'webapp':{\r\n        'tip1':\"本功能由百度APP提供，如看到此页面，请各位站长首先申请百度APPKey!\",\r\n        'tip2':\"申请完成之后请至ueditor.config.js中配置获得的appkey! \",\r\n        'applyFor':\"点此申请\",\r\n        'anthorApi':\"百度API\"\r\n    },\r\n    'template':{\r\n        'static':{\r\n            'lang_template_bkcolor':'背景颜色',\r\n            'lang_template_clear' : '保留原有内容',\r\n            'lang_template_select' : '选择模板'\r\n        },\r\n        'blank':\"空白文档\",\r\n        'blog':\"博客文章\",\r\n        'resume':\"个人简历\",\r\n        'richText':\"图文混排\",\r\n        'sciPapers':\"科技论文\"\r\n\r\n\r\n    },\r\n    'scrawl':{\r\n        'static':{\r\n            'lang_input_previousStep':\"上一步\",\r\n            'lang_input_nextsStep':\"下一步\",\r\n            'lang_input_clear':'清空',\r\n            'lang_input_addPic':'添加背景',\r\n            'lang_input_ScalePic':'缩放背景',\r\n            'lang_input_removePic':'删除背景',\r\n            'J_imgTxt':{title:'添加背景图片'}\r\n        },\r\n        'noScarwl':\"尚未作画，白纸一张~\",\r\n        'scrawlUpLoading':\"涂鸦上传中,别急哦~\",\r\n        'continueBtn':\"继续\",\r\n        'imageError':\"糟糕，图片读取失败了！\",\r\n        'backgroundUploading':'背景图片上传中,别急哦~'\r\n    },\r\n    'music':{\r\n        'static':{\r\n            'lang_input_tips':\"输入歌手/歌曲/专辑，搜索您感兴趣的音乐！\",\r\n            'J_searchBtn':{value:'搜索歌曲'}\r\n        },\r\n        'emptyTxt':'未搜索到相关音乐结果，请换一个关键词试试。',\r\n        'chapter':'歌曲',\r\n        'singer':'歌手',\r\n        'special':'专辑',\r\n        'listenTest':'试听'\r\n    },\r\n    'anchor':{\r\n        'static':{\r\n            'lang_input_anchorName':'锚点名字：'\r\n        }\r\n    },\r\n    'charts':{\r\n        'static':{\r\n            'lang_data_source':'数据源：',\r\n            'lang_chart_format': '图表格式：',\r\n            'lang_data_align': '数据对齐方式',\r\n            'lang_chart_align_same': '数据源与图表X轴Y轴一致',\r\n            'lang_chart_align_reverse': '数据源与图表X轴Y轴相反',\r\n            'lang_chart_title': '图表标题',\r\n            'lang_chart_main_title': '主标题：',\r\n            'lang_chart_sub_title': '子标题：',\r\n            'lang_chart_x_title': 'X轴标题：',\r\n            'lang_chart_y_title': 'Y轴标题：',\r\n            'lang_chart_tip': '提示文字',\r\n            'lang_cahrt_tip_prefix': '提示文字前缀：',\r\n            'lang_cahrt_tip_description': '仅饼图有效， 当鼠标移动到饼图中相应的块上时，提示框内的文字的前缀',\r\n            'lang_chart_data_unit': '数据单位',\r\n            'lang_chart_data_unit_title': '单位：',\r\n            'lang_chart_data_unit_description': '显示在每个数据点上的数据的单位， 比如： 温度的单位 ℃',\r\n            'lang_chart_type': '图表类型：',\r\n            'lang_prev_btn': '上一个',\r\n            'lang_next_btn': '下一个'\r\n        }\r\n    },\r\n    'emotion':{\r\n        'static':{\r\n            'lang_input_choice':'精选',\r\n            'lang_input_Tuzki':'兔斯基',\r\n            'lang_input_BOBO':'BOBO',\r\n            'lang_input_lvdouwa':'绿豆蛙',\r\n            'lang_input_babyCat':'baby猫',\r\n            'lang_input_bubble':'泡泡',\r\n            'lang_input_youa':'有啊'\r\n        }\r\n    },\r\n    'gmap':{\r\n        'static':{\r\n            'lang_input_address':'地址',\r\n            'lang_input_search':'搜索',\r\n            'address':{value:\"北京\"}\r\n        },\r\n        searchError:'无法定位到该地址!'\r\n    },\r\n    'help':{\r\n        'static':{\r\n            'lang_input_about':'关于UEditor',\r\n            'lang_input_shortcuts':'快捷键',\r\n            'lang_input_introduction':'UEditor是由百度web前端研发部开发的所见即所得富文本web编辑器，具有轻量，可定制，注重用户体验等特点。开源基于BSD协议，允许自由使用和修改代码。',\r\n            'lang_Txt_shortcuts':'快捷键',\r\n            'lang_Txt_func':'功能',\r\n            'lang_Txt_bold':'给选中字设置为加粗',\r\n            'lang_Txt_copy':'复制选中内容',\r\n            'lang_Txt_cut':'剪切选中内容',\r\n            'lang_Txt_Paste':'粘贴',\r\n            'lang_Txt_undo':'重新执行上次操作',\r\n            'lang_Txt_redo':'撤销上一次操作',\r\n            'lang_Txt_italic':'给选中字设置为斜体',\r\n            'lang_Txt_underline':'给选中字加下划线',\r\n            'lang_Txt_selectAll':'全部选中',\r\n            'lang_Txt_visualEnter':'软回车',\r\n            'lang_Txt_fullscreen':'全屏'\r\n        }\r\n    },\r\n    'insertframe':{\r\n        'static':{\r\n            'lang_input_address':'地址：',\r\n            'lang_input_width':'宽度：',\r\n            'lang_input_height':'高度：',\r\n            'lang_input_isScroll':'允许滚动条：',\r\n            'lang_input_frameborder':'显示框架边框：',\r\n            'lang_input_alignMode':'对齐方式：',\r\n            'align':{title:\"对齐方式\", options:[\"默认\", \"左对齐\", \"右对齐\", \"居中\"]}\r\n        },\r\n        'enterAddress':'请输入地址!'\r\n    },\r\n    'link':{\r\n        'static':{\r\n            'lang_input_text':'文本内容：',\r\n            'lang_input_url':'链接地址：',\r\n            'lang_input_title':'标题：',\r\n            'lang_input_target':'是否在新窗口打开：'\r\n        },\r\n        'validLink':'只支持选中一个链接时生效',\r\n        'httpPrompt':'您输入的超链接中不包含http等协议名称，默认将为您添加http://前缀'\r\n    },\r\n    'map':{\r\n        'static':{\r\n            lang_city:\"城市\",\r\n            lang_address:\"地址\",\r\n            city:{value:\"北京\"},\r\n            lang_search:\"搜索\",\r\n            lang_dynamicmap:\"插入动态地图\"\r\n        },\r\n        cityMsg:\"请选择城市\",\r\n        errorMsg:\"抱歉，找不到该位置！\"\r\n    },\r\n    'searchreplace':{\r\n        'static':{\r\n            lang_tab_search:\"查找\",\r\n            lang_tab_replace:\"替换\",\r\n            lang_search1:\"查找\",\r\n            lang_search2:\"查找\",\r\n            lang_replace:\"替换\",\r\n            lang_searchReg:'支持正则表达式，添加前后斜杠标示为正则表达式，例如“/表达式/”',\r\n            lang_searchReg1:'支持正则表达式，添加前后斜杠标示为正则表达式，例如“/表达式/”',\r\n            lang_case_sensitive1:\"区分大小写\",\r\n            lang_case_sensitive2:\"区分大小写\",\r\n            nextFindBtn:{value:\"下一个\"},\r\n            preFindBtn:{value:\"上一个\"},\r\n            nextReplaceBtn:{value:\"下一个\"},\r\n            preReplaceBtn:{value:\"上一个\"},\r\n            repalceBtn:{value:\"替换\"},\r\n            repalceAllBtn:{value:\"全部替换\"}\r\n        },\r\n        getEnd:\"已经搜索到文章末尾！\",\r\n        getStart:\"已经搜索到文章头部\",\r\n        countMsg:\"总共替换了{#count}处！\"\r\n    },\r\n    'snapscreen':{\r\n        'static':{\r\n            lang_showMsg:\"截图功能需要首先安装UEditor截图插件！ \",\r\n            lang_download:\"点此下载\",\r\n            lang_step1:\"第一步，下载UEditor截图插件并运行安装。\",\r\n            lang_step2:\"第二步，插件安装完成后即可使用，如不生效，请重启浏览器后再试！\"\r\n        }\r\n    },\r\n    'spechars':{\r\n        'static':{},\r\n        tsfh:\"特殊字符\",\r\n        lmsz:\"罗马字符\",\r\n        szfh:\"数学字符\",\r\n        rwfh:\"日文字符\",\r\n        xlzm:\"希腊字母\",\r\n        ewzm:\"俄文字符\",\r\n        pyzm:\"拼音字母\",\r\n        yyyb:\"英语音标\",\r\n        zyzf:\"其他\"\r\n    },\r\n    'edittable':{\r\n        'static':{\r\n            'lang_tableStyle':'表格样式',\r\n            'lang_insertCaption':'添加表格名称行',\r\n            'lang_insertTitle':'添加表格标题行',\r\n            'lang_insertTitleCol':'添加表格标题列',\r\n            'lang_orderbycontent':\"使表格内容可排序\",\r\n            'lang_tableSize':'自动调整表格尺寸',\r\n            'lang_autoSizeContent':'按表格文字自适应',\r\n            'lang_autoSizePage':'按页面宽度自适应',\r\n            'lang_example':'示例',\r\n            'lang_borderStyle':'表格边框',\r\n            'lang_color':'颜色:'\r\n        },\r\n        captionName:'表格名称',\r\n        titleName:'标题',\r\n        cellsName:'内容',\r\n        errorMsg:'有合并单元格，不可排序'\r\n    },\r\n    'edittip':{\r\n        'static':{\r\n            lang_delRow:'删除整行',\r\n            lang_delCol:'删除整列'\r\n        }\r\n    },\r\n    'edittd':{\r\n        'static':{\r\n            lang_tdBkColor:'背景颜色:'\r\n        }\r\n    },\r\n    'formula':{\r\n        'static':{\r\n        }\r\n    },\r\n    'wordimage':{\r\n        'static':{\r\n            lang_resave:\"转存步骤\",\r\n            uploadBtn:{src:\"upload.png\",alt:\"上传\"},\r\n            clipboard:{style:\"background: url(copy.png) -153px -1px no-repeat;\"},\r\n            lang_step:\"1、点击顶部复制按钮，将地址复制到剪贴板；2、点击添加照片按钮，在弹出的对话框中使用Ctrl+V粘贴地址；3、点击打开后选择图片上传流程。\"\r\n        },\r\n        'fileType':\"图片\",\r\n        'flashError':\"FLASH初始化失败，请检查FLASH插件是否正确安装！\",\r\n        'netError':\"网络连接错误，请重试！\",\r\n        'copySuccess':\"图片地址已经复制！\",\r\n        'flashI18n':{} //留空默认中文\r\n    },\r\n    'autosave': {\r\n        'saving':'保存中...',\r\n        'success':'本地保存成功'\r\n    }\r\n};\r\n","module.exports = __webpack_public_path__ + \"ZeroClipboard.cc114c6d.swf\";","module.exports = __webpack_public_path__ + \"iframe.04bcb769.css\";","/**\n * ueditor完整配置项\n * 可以在这里配置整个编辑器的特性\n */\n/**************************提示********************************\n * 所有被注释的配置项均为UEditor默认值。\n * 修改默认配置请首先确保已经完全明确该参数的真实用途。\n * 主要有两种修改方案，一种是取消此处注释，然后修改成对应参数；另一种是在实例化编辑器时传入对应参数。\n * 当升级编辑器时，可直接使用旧版配置文件替换新版配置文件,不用担心旧版配置文件中因缺少新功能所需的参数而导致脚本报错。\n **************************提示********************************/\n\n  /**\n   * 编辑器资源文件根路径。它所表示的含义是：以编辑器实例化页面为当前路径，指向编辑器资源文件（即dialog等文件夹）的路径。\n   * 鉴于很多同学在使用编辑器的时候出现的种种路径问题，此处强烈建议大家使用\"相对于网站根目录的相对路径\"进行配置。\n   * \"相对于网站根目录的相对路径\"也就是以斜杠开头的形如\"/myProject/ueditor/\"这样的路径。\n   * 如果站点中有多个不在同一层级的页面需要实例化编辑器，且引用了同一UEditor的时候，此处的URL可能不适用于每个页面的编辑器。\n   * 因此，UEditor提供了针对不同页面的编辑器可单独配置的根路径，具体来说，在需要实例化编辑器的页面最顶部写上如下代码即可。当然，需要令此处的URL等于对应的配置。\n   * window.UEDITOR_HOME_URL = \"/xxxx/xxxx/\";\n   */\n  // var URL = window.UEDITOR_HOME_URL || getUEBasePath();\n\n  var URL =\n    window.location.href.indexOf('/scms/') > -1\n      ? window.location.href.split('/scms/')[0] + '/'\n      : window.location.href.split('#')[0];\n  /**\n   * 配置项主体。注意，此处所有涉及到路径的配置别遗漏URL变量。\n   */\n  window.UEDITOR_CONFIG = {\n    //为编辑器实例添加一个路径，这个不能被注释\n    UEDITOR_HOME_URL: URL + 'scms/libs/ueditor/',\n\n    // 服务器统一请求接口路径\n    serverUrl: URL + '/goodstaxiAdmin/controller.jsp',\n\n    //工具栏上的所有的功能按钮和下拉框，可以在new编辑器的实例时选择自己需要的重新定义\n    /*, toolbars: [[\n            'fullscreen', 'source', '|', 'undo', 'redo', '|',\n            'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', '|',\n            'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',\n            'customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',\n            'directionalityltr', 'directionalityrtl', 'indent', '|',\n            'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',\n            'link', 'unlink', 'anchor', '|', 'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',\n            'simpleupload', 'insertimage', 'emotion', 'scrawl', 'insertvideo', 'music', 'attachment', 'map', 'gmap', 'insertframe', 'insertcode', 'webapp', 'pagebreak', 'template', 'background', '|',\n            'horizontal', 'date', 'time', 'spechars', 'snapscreen', 'wordimage', '|',\n            'inserttable', 'deletetable', 'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols', 'charts', '|',\n            'print', 'preview', 'searchreplace', 'drafts', 'help'\n        ]]*/\n    toolbars: [\n      [\n        'fullscreen',\n        '|',\n        'undo',\n        'redo',\n        '|',\n        'bold',\n        'italic',\n        'underline',\n        'fontborder',\n        'strikethrough',\n        'superscript',\n        'subscript',\n        'removeformat',\n        'formatmatch',\n        'autotypeset',\n        'blockquote',\n        'pasteplain',\n        '|',\n        'forecolor',\n        'backcolor',\n        'insertorderedlist',\n        'insertunorderedlist',\n        'selectall',\n        'cleardoc',\n        '|',\n        'rowspacingtop',\n        'rowspacingbottom',\n        'lineheight',\n        '|',\n        'customstyle',\n        'paragraph',\n        'fontfamily',\n        'fontsize',\n        '|',\n        'directionalityltr',\n        'directionalityrtl',\n        'indent',\n        '|',\n        'justifyleft',\n        'justifycenter',\n        'justifyright',\n        'justifyjustify',\n        '|',\n        'touppercase',\n        'tolowercase',\n        '|',\n        'link',\n        'unlink',\n        'anchor',\n        '|',\n        'imagenone',\n        'imageleft',\n        'imageright',\n        'imagecenter',\n        '|',\n        'simpleupload',\n        'insertimage',\n        'emotion',\n        'scrawl',\n        'attachment',\n        'pagebreak',\n        'background',\n        '|',\n        'horizontal',\n        'date',\n        'time',\n        '|',\n        'inserttable',\n        'deletetable',\n        'charts',\n        '|',\n        'print',\n        'preview',\n        'searchreplace',\n        'drafts',\n        'help',\n      ],\n    ],\n    //当鼠标放在工具栏上时显示的tooltip提示,留空支持自动多语言配置，否则以配置值为准\n    //,labelMap:{\n    //    'anchor':'', 'undo':''\n    //}\n\n    //语言配置项,默认是zh-cn。有需要的话也可以使用如下这样的方式来自动多语言切换，当然，前提条件是lang文件夹下存在对应的语言文件：\n    //lang值也可以通过自动获取 (navigator.language||navigator.browserLanguage ||navigator.userLanguage).toLowerCase()\n    //,lang:\"zh-cn\"\n    //,langPath:URL +\"lang/\"\n\n    //主题配置项,默认是default。有需要的话也可以使用如下这样的方式来自动多主题切换，当然，前提条件是themes文件夹下存在对应的主题文件：\n    //现有如下皮肤:default\n    //,theme:'default'\n    //,themePath:URL +\"themes/\"\n\n    //,zIndex : 900     //编辑器层级的基数,默认是900\n\n    //针对getAllHtml方法，会在对应的head标签中增加该编码设置。\n    //,charset:\"utf-8\"\n\n    //若实例化编辑器的页面手动修改的domain，此处需要设置为true\n    //,customDomain:false\n\n    //常用配置项目\n    //,isShow : true    //默认显示编辑器\n\n    //,textarea:'editorValue' // 提交表单时，服务器获取编辑器提交内容的所用的参数，多实例时可以给容器name属性，会将name给定的值最为每个实例的键值，不用每次实例化的时候都设置这个值\n\n    //,initialContent:'欢迎使用ueditor!'    //初始化编辑器的内容,也可以通过textarea/script给值，看官网例子\n\n    //,autoClearinitialContent:true //是否自动清除编辑器初始内容，注意：如果focus属性设置为true,这个也为真，那么编辑器一上来就会触发导致初始化的内容看不到了\n\n    //,focus:false //初始化时，是否让编辑器获得焦点true或false\n\n    //如果自定义，最好给p标签如下的行高，要不输入中文时，会有跳动感\n    //,initialStyle:'p{line-height:1em}'//编辑器层级的基数,可以用来改变字体等\n\n    //,iframeCssUrl: URL + '/themes/iframe.css' //给编辑区域的iframe引入一个css文件\n\n    //indentValue\n    //首行缩进距离,默认是2em\n    //,indentValue:'2em'\n\n    //,initialFrameWidth:1000  //初始化编辑器宽度,默认1000\n    //,initialFrameHeight:320  //初始化编辑器高度,默认320\n\n    //,readonly : false //编辑器初始化结束后,编辑区域是否是只读的，默认是false\n\n    //,autoClearEmptyNode : true //getContent时，是否删除空的inlineElement节点（包括嵌套的情况）\n\n    //启用自动保存\n    //,enableAutoSave: true\n    //自动保存间隔时间， 单位ms\n    //,saveInterval: 500\n\n    //,fullscreen : false //是否开启初始化时即全屏，默认关闭\n\n    //,imagePopup:true      //图片操作的浮层开关，默认打开\n\n    //,autoSyncData:true //自动同步编辑器要提交的数据\n    //,emotionLocalization:false //是否开启表情本地化，默认关闭。若要开启请确保emotion文件夹下包含官网提供的images表情文件夹\n\n    //粘贴只保留标签，去除标签所有属性\n    //,retainOnlyLabelPasted: false\n\n    //,pasteplain:false  //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴\n    //纯文本粘贴模式下的过滤规则\n    //'filterTxtRules' : function(){\n    //    function transP(node){\n    //        node.tagName = 'p';\n    //        node.setStyle();\n    //    }\n    //    return {\n    //        //直接删除及其字节点内容\n    //        '-' : 'script style object iframe embed input select',\n    //        'p': {$:{}},\n    //        'br':{$:{}},\n    //        'div':{'$':{}},\n    //        'li':{'$':{}},\n    //        'caption':transP,\n    //        'th':transP,\n    //        'tr':transP,\n    //        'h1':transP,'h2':transP,'h3':transP,'h4':transP,'h5':transP,'h6':transP,\n    //        'td':function(node){\n    //            //没有内容的td直接删掉\n    //            var txt = !!node.innerText();\n    //            if(txt){\n    //                node.parentNode.insertAfter(UE.uNode.createText(' &nbsp; &nbsp;'),node);\n    //            }\n    //            node.parentNode.removeChild(node,node.innerText())\n    //        }\n    //    }\n    //}()\n\n    //,allHtmlEnabled:false //提交到后台的数据是否包含整个html字符串\n\n    //insertorderedlist\n    //有序列表的下拉配置,值留空时支持多语言自动识别，若配置值，则以此值为准\n    //,'insertorderedlist':{\n    //      //自定的样式\n    //        'num':'1,2,3...',\n    //        'num1':'1),2),3)...',\n    //        'num2':'(1),(2),(3)...',\n    //        'cn':'一,二,三....',\n    //        'cn1':'一),二),三)....',\n    //        'cn2':'(一),(二),(三)....',\n    //     //系统自带\n    //     'decimal' : '' ,         //'1,2,3...'\n    //     'lower-alpha' : '' ,    // 'a,b,c...'\n    //     'lower-roman' : '' ,    //'i,ii,iii...'\n    //     'upper-alpha' : '' , lang   //'A,B,C'\n    //     'upper-roman' : ''      //'I,II,III...'\n    //}\n\n    //insertunorderedlist\n    //无序列表的下拉配置，值留空时支持多语言自动识别，若配置值，则以此值为准\n    //,insertunorderedlist : { //自定的样式\n    //    'dash' :'— 破折号', //-破折号\n    //    'dot':' 。 小圆圈', //系统自带\n    //    'circle' : '',  // '○ 小圆圈'\n    //    'disc' : '',    // '● 小圆点'\n    //    'square' : ''   //'■ 小方块'\n    //}\n    //,listDefaultPaddingLeft : '30'//默认的左边缩进的基数倍\n    //,listiconpath : 'http://bs.baidu.com/listicon/'//自定义标号的路径\n    //,maxListLevel : 3 //限制可以tab的级数, 设置-1为不限制\n\n    //,autoTransWordToList:false  //禁止word中粘贴进来的列表自动变成列表标签\n\n    //fontfamily\n    //字体设置 label留空支持多语言自动切换，若配置，则以配置值为准\n    //,'fontfamily':[\n    //    { label:'',name:'songti',val:'宋体,SimSun'},\n    //    { label:'',name:'kaiti',val:'楷体,楷体_GB2312, SimKai'},\n    //    { label:'',name:'yahei',val:'微软雅黑,Microsoft YaHei'},\n    //    { label:'',name:'heiti',val:'黑体, SimHei'},\n    //    { label:'',name:'lishu',val:'隶书, SimLi'},\n    //    { label:'',name:'andaleMono',val:'andale mono'},\n    //    { label:'',name:'arial',val:'arial, helvetica,sans-serif'},\n    //    { label:'',name:'arialBlack',val:'arial black,avant garde'},\n    //    { label:'',name:'comicSansMs',val:'comic sans ms'},\n    //    { label:'',name:'impact',val:'impact,chicago'},\n    //    { label:'',name:'timesNewRoman',val:'times new roman'}\n    //]\n\n    //fontsize\n    //字号\n    //,'fontsize':[10, 11, 12, 14, 16, 18, 20, 24, 36]\n\n    //paragraph\n    //段落格式 值留空时支持多语言自动识别，若配置，则以配置值为准\n    //,'paragraph':{'p':'', 'h1':'', 'h2':'', 'h3':'', 'h4':'', 'h5':'', 'h6':''}\n\n    //rowspacingtop\n    //段间距 值和显示的名字相同\n    //,'rowspacingtop':['5', '10', '15', '20', '25']\n\n    //rowspacingBottom\n    //段间距 值和显示的名字相同\n    //,'rowspacingbottom':['5', '10', '15', '20', '25']\n\n    //lineheight\n    //行内间距 值和显示的名字相同\n    //,'lineheight':['1', '1.5','1.75','2', '3', '4', '5']\n\n    //customstyle\n    //自定义样式，不支持国际化，此处配置值即可最后显示值\n    //block的元素是依据设置段落的逻辑设置的，inline的元素依据BIU的逻辑设置\n    //尽量使用一些常用的标签\n    //参数说明\n    //tag 使用的标签名字\n    //label 显示的名字也是用来标识不同类型的标识符，注意这个值每个要不同，\n    //style 添加的样式\n    //每一个对象就是一个自定义的样式\n    //,'customstyle':[\n    //    {tag:'h1', name:'tc', label:'', style:'border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;'},\n    //    {tag:'h1', name:'tl',label:'', style:'border-bottom:#ccc 2px solid;padding:0 4px 0 0;margin:0 0 10px 0;'},\n    //    {tag:'span',name:'im', label:'', style:'font-style:italic;font-weight:bold'},\n    //    {tag:'span',name:'hi', label:'', style:'font-style:italic;font-weight:bold;color:rgb(51, 153, 204)'}\n    //]\n\n    //打开右键菜单功能\n    //,enableContextMenu: true\n    //右键菜单的内容，可以参考plugins/contextmenu.js里边的默认菜单的例子，label留空支持国际化，否则以此配置为准\n    //,contextMenu:[\n    //    {\n    //        label:'',       //显示的名称\n    //        cmdName:'selectall',//执行的command命令，当点击这个右键菜单时\n    //        //exec可选，有了exec就会在点击时执行这个function，优先级高于cmdName\n    //        exec:function () {\n    //            //this是当前编辑器的实例\n    //            //this.ui._dialogs['inserttableDialog'].open();\n    //        }\n    //    }\n    //]\n\n    //快捷菜单\n    //,shortcutMenu:[\"fontfamily\", \"fontsize\", \"bold\", \"italic\", \"underline\", \"forecolor\", \"backcolor\", \"insertorderedlist\", \"insertunorderedlist\"]\n\n    //elementPathEnabled\n    //是否启用元素路径，默认是显示\n    //,elementPathEnabled : true\n    elementPathEnabled: false,\n    //wordCount\n    //,wordCount:true          //是否开启字数统计\n    //,maximumWords:10000       //允许的最大字符数\n    maximumWords: 8000,\n    //字数统计提示，{#count}代表当前字数，{#leave}代表还可以输入多少字符数,留空支持多语言自动切换，否则按此配置显示\n    //,wordCountMsg:''   //当前已输入 {#count} 个字符，您还可以输入{#leave} 个字符\n    //超出字数限制提示  留空支持多语言自动切换，否则按此配置显示\n    //,wordOverFlowMsg:''    //<span style=\"color:red;\">你输入的字符个数已经超出最大允许值，服务器可能会拒绝保存！</span>\n\n    //tab\n    //点击tab键时移动的距离,tabSize倍数，tabNode什么字符做为单位\n    //,tabSize:4\n    //,tabNode:'&nbsp;'\n\n    //removeFormat\n    //清除格式时可以删除的标签和属性\n    //removeForamtTags标签\n    //,removeFormatTags:'b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var'\n    //removeFormatAttributes属性\n    //,removeFormatAttributes:'class,style,lang,width,height,align,hspace,valign'\n\n    //undo\n    //可以最多回退的次数,默认20\n    //,maxUndoCount:20\n    //当输入的字符数超过该值时，保存一次现场\n    //,maxInputCount:1\n\n    //autoHeightEnabled\n    // 是否自动长高,默认true\n    //,autoHeightEnabled:true\n\n    //scaleEnabled\n    //是否可以拉伸长高,默认true(当开启时，自动长高失效)\n    //,scaleEnabled:false\n    //,minFrameWidth:800    //编辑器拖动时最小宽度,默认800\n    //,minFrameHeight:220  //编辑器拖动时最小高度,默认220\n\n    //autoFloatEnabled\n    //是否保持toolbar的位置不动,默认true\n    //,autoFloatEnabled:true\n    //浮动时工具栏距离浏览器顶部的高度，用于某些具有固定头部的页面\n    //,topOffset:30\n    //编辑器底部距离工具栏高度(如果参数大于等于编辑器高度，则设置无效)\n    //,toolbarTopOffset:400\n\n    //设置远程图片是否抓取到本地保存\n    //,catchRemoteImageEnable: true //设置是否抓取远程图片\n\n    //pageBreakTag\n    //分页标识符,默认是_ueditor_page_break_tag_\n    //,pageBreakTag:'_ueditor_page_break_tag_'\n\n    //autotypeset\n    //自动排版参数\n    //,autotypeset: {\n    //    mergeEmptyline: true,           //合并空行\n    //    removeClass: true,              //去掉冗余的class\n    //    removeEmptyline: false,         //去掉空行\n    //    textAlign:\"left\",               //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版\n    //    imageBlockLine: 'center',       //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版\n    //    pasteFilter: false,             //根据规则过滤没事粘贴进来的内容\n    //    clearFontSize: false,           //去掉所有的内嵌字号，使用编辑器默认的字号\n    //    clearFontFamily: false,         //去掉所有的内嵌字体，使用编辑器默认的字体\n    //    removeEmptyNode: false,         // 去掉空节点\n    //    //可以去掉的标签\n    //    removeTagNames: {标签名字:1},\n    //    indent: false,                  // 行首缩进\n    //    indentValue : '2em',            //行首缩进的大小\n    //    bdc2sb: false,\n    //    tobdc: false\n    //}\n\n    //tableDragable\n    //表格是否可以拖拽\n    //,tableDragable: true\n\n    //sourceEditor\n    //源码的查看方式,codemirror 是代码高亮，textarea是文本框,默认是codemirror\n    //注意默认codemirror只能在ie8+和非ie中使用\n    //,sourceEditor:\"codemirror\"\n    //如果sourceEditor是codemirror，还用配置一下两个参数\n    //codeMirrorJsUrl js加载的路径，默认是 URL + \"third-party/codemirror/codemirror.js\"\n    //,codeMirrorJsUrl:URL + \"third-party/codemirror/codemirror.js\"\n    //codeMirrorCssUrl css加载的路径，默认是 URL + \"third-party/codemirror/codemirror.css\"\n    //,codeMirrorCssUrl:URL + \"third-party/codemirror/codemirror.css\"\n    //编辑器初始化完成后是否进入源码模式，默认为否。\n    //,sourceEditorFirst:false\n\n    //iframeUrlMap\n    //dialog内容的路径 ～会被替换成URL,垓属性一旦打开，将覆盖所有的dialog的默认路径\n    //,iframeUrlMap:{\n    //    'anchor':'~/dialogs/anchor/anchor.html',\n    //}\n\n    //allowLinkProtocol 允许的链接地址，有这些前缀的链接地址不会自动添加http\n    //, allowLinkProtocols: ['http:', 'https:', '#', '/', 'ftp:', 'mailto:', 'tel:', 'git:', 'svn:']\n\n    //webAppKey 百度应用的APIkey，每个站长必须首先去百度官网注册一个key后方能正常使用app功能，注册介绍，http://app.baidu.com/static/cms/getapikey.html\n    //, webAppKey: \"\"\n\n    //默认过滤规则相关配置项目\n    //,disabledTableInTable:true  //禁止表格嵌套\n    //,allowDivTransToP:true      //允许进入编辑器的div标签自动变成p标签\n    //,rgb2Hex:true               //默认产出的数据中的color自动从rgb格式变成16进制格式\n\n    // xss 过滤是否开启,inserthtml等操作\n    xssFilterRules: true,\n    //input xss过滤\n    inputXssFilter: true,\n    //output xss过滤\n    outputXssFilter: true,\n    // xss过滤白名单 名单来源: https://raw.githubusercontent.com/leizongmin/js-xss/master/lib/default.js\n    whitList: {\n      a: ['target', 'href', 'title', 'class', 'style'],\n      abbr: ['title', 'class', 'style'],\n      address: ['class', 'style'],\n      area: ['shape', 'coords', 'href', 'alt'],\n      article: [],\n      aside: [],\n      audio: [\n        'autoplay',\n        'controls',\n        'loop',\n        'preload',\n        'src',\n        'class',\n        'style',\n      ],\n      b: ['class', 'style'],\n      bdi: ['dir'],\n      bdo: ['dir'],\n      big: [],\n      blockquote: ['cite', 'class', 'style'],\n      br: [],\n      caption: ['class', 'style'],\n      center: [],\n      cite: [],\n      code: ['class', 'style'],\n      col: ['align', 'valign', 'span', 'width', 'class', 'style'],\n      colgroup: ['align', 'valign', 'span', 'width', 'class', 'style'],\n      dd: ['class', 'style'],\n      del: ['datetime'],\n      details: ['open'],\n      div: ['class', 'style'],\n      dl: ['class', 'style'],\n      dt: ['class', 'style'],\n      em: ['class', 'style'],\n      font: ['color', 'size', 'face'],\n      footer: [],\n      h1: ['class', 'style'],\n      h2: ['class', 'style'],\n      h3: ['class', 'style'],\n      h4: ['class', 'style'],\n      h5: ['class', 'style'],\n      h6: ['class', 'style'],\n      header: [],\n      hr: [],\n      i: ['class', 'style'],\n      img: [\n        'src',\n        'alt',\n        'title',\n        'width',\n        'height',\n        'id',\n        '_src',\n        'loadingclass',\n        'class',\n        'data-latex',\n      ],\n      ins: ['datetime'],\n      li: ['class', 'style'],\n      mark: [],\n      nav: [],\n      ol: ['class', 'style'],\n      p: ['class', 'style'],\n      pre: ['class', 'style'],\n      s: [],\n      section: [],\n      small: [],\n      span: ['class', 'style'],\n      sub: ['class', 'style'],\n      sup: ['class', 'style'],\n      strong: ['class', 'style'],\n      table: ['width', 'border', 'align', 'valign', 'class', 'style'],\n      tbody: ['align', 'valign', 'class', 'style'],\n      td: ['width', 'rowspan', 'colspan', 'align', 'valign', 'class', 'style'],\n      tfoot: ['align', 'valign', 'class', 'style'],\n      th: ['width', 'rowspan', 'colspan', 'align', 'valign', 'class', 'style'],\n      thead: ['align', 'valign', 'class', 'style'],\n      tr: ['rowspan', 'align', 'valign', 'class', 'style'],\n      tt: [],\n      u: [],\n      ul: ['class', 'style'],\n      video: [\n        'autoplay',\n        'controls',\n        'loop',\n        'preload',\n        'src',\n        'height',\n        'width',\n        'class',\n        'style',\n      ],\n    },\n  };\n\n  function getUEBasePath(docUrl, confUrl) {\n    return getBasePath(\n      docUrl || self.document.URL || self.location.href,\n      confUrl || getConfigFilePath()\n    );\n  }\n\n  function getConfigFilePath() {\n    var configPath = document.getElementsByTagName('script');\n\n    return configPath[configPath.length - 1].src;\n  }\n\n  function getBasePath(docUrl, confUrl) {\n    var basePath = confUrl;\n\n    if (/^(\\/|\\\\\\\\)/.test(confUrl)) {\n      basePath =\n        /^.+?\\w(\\/|\\\\\\\\)/.exec(docUrl)[0] + confUrl.replace(/^(\\/|\\\\\\\\)/, '');\n    } else if (!/^[a-z]+:/i.test(confUrl)) {\n      docUrl = docUrl\n        .split('#')[0]\n        .split('?')[0]\n        .replace(/[^\\\\\\/]+$/, '');\n\n      basePath = docUrl + '' + confUrl;\n    }\n\n    return optimizationPath(basePath);\n  }\n\n  function optimizationPath(path) {\n    var protocol = /^[a-z]+:\\/\\//.exec(path)[0],\n      tmp = null,\n      res = [];\n\n    path = path\n      .replace(protocol, '')\n      .split('?')[0]\n      .split('#')[0];\n\n    path = path.replace(/\\\\/g, '/').split(/\\//);\n\n    path[path.length - 1] = '';\n\n    while (path.length) {\n      if ((tmp = path.shift()) === '..') {\n        res.pop();\n      } else if (tmp !== '.') {\n        res.push(tmp);\n      }\n    }\n\n    return protocol + res.join('/');\n  }\n\n  window.UE = {\n    getUEBasePath: getUEBasePath,\n  };\n"],"sourceRoot":""}